(window.webpackJsonp=window.webpackJsonp||[]).push([["b-4058e09ab5200ed1eb2e43364b82a2dd"],{"4zn2":function(e,t,r){"use strict";r.r(t),r.d(t,"API_VERSION",(function(){return n})),r.d(t,"VKPAY_TRANSACTION_EVENT",(function(){return a})),r.d(t,"PLATFORM",(function(){return i})),r.d(t,"CLIENT_SCHEME",(function(){return o})),r.d(t,"ERROR_CODES",(function(){return s})),r.d(t,"ERROR_REASONS",(function(){return c})),r.d(t,"ERROR_TYPES",(function(){return p})),r.d(t,"CLOSE_STATUS",(function(){return l})),r.d(t,"GROUP_STATUS",(function(){return d})),r.d(t,"VKPAY_APPS",(function(){return u})),r.d(t,"TEXTLIVE_APPS",(function(){return h})),r.d(t,"VK_CONNECT_EVENTS",(function(){return _}));var n="5.95",a="VKWebAppActionDone",i={WEB:"web",MOBILE_WEB:"mobile-web"},o={BRIGHT_LIGHT:"bright_light",SPACE_GRAY:"space_gray"},s={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,CUSTOM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11},c={UNSUPPORTED_PLATFORM:"Unsupported platform",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",NETWORK_ERROR:"Network error"},p={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},l=["success","failed"],d={OPEN:0,CLOSED:1,PRIVATE:2},u=[6217559,7131443],h=[7512376],_={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppGetCommunityAuthToken:"get_community_token",VKWebAppGetCommunityAuthTokenPreload:"get_community_scope",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_scope",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroup:"join_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppLeaveGroup:"leave_group",VKWebAppLeaveGroupPreload:"is_group_member",VKWebAppOpenApp:"open_app",VKWebAppGetUserInfo:"get_user_info",VKWebAppSendPayload:"send_payload",VKWebAppShowOrderBox:"order",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetGroupInfo:"get_group_info",VKWebAppGetGroupInfoPreload:"is_group_info_allowed"}},"9kLB":function(e,t,r){"use strict";var n,a;r.r(t),r.d(t,"EVENT_STATES",(function(){return n})),r.d(t,"CONNECT_EVENTS",(function(){return a})),function(e){e.FIRE="",e.FAILURE="Failed",e.SUCCESS="Result"}(n||(n={})),function(e){e.ADD_TO_COMMUNITY="VKWebAppAddToCommunity",e.ADD_TO_COMMUNITY_PRELOAD="VKWebAppAddToCommunityPreload",e.ADD_TO_FAVORITES="VKWebAppAddToFavorites",e.ADD_TO_MENU="VKWebAppAddToMenu",e.ADD_TO_HOME_SCREEN_INFO="VKWebAppAddToHomeScreenInfo",e.ALLOW_MESSAGES_FROM_GROUP="VKWebAppAllowMessagesFromGroup",e.ALLOW_MESSAGES_FROM_GROUP_PRELOAD="VKWebAppAllowMessagesFromGroupPreload",e.ALLOW_NOTIFICATIONS="VKWebAppAllowNotifications",e.ALLOW_NOTIFICATIONS_PRELOAD="VKWebAppAllowNotificationsPreload",e.COPY_TEXT="VKWebAppCopyText",e.CALL_API_METHOD="VKWebAppCallAPIMethod",e.CLOSE="VKWebAppClose",e.DENY_NOTIFICATIONS="VKWebAppDenyNotifications",e.FLASH_GET_INFO="VKWebAppFlashGetInfo",e.FLASH_SET_LEVEL="VKWebAppFlashSetLevel",e.GET_AUTH_TOKEN="VKWebAppGetAuthToken",e.GET_AUTH_TOKEN_PRELOAD="VKWebAppGetAuthTokenPreload",e.GET_CLIENT_VERSION="VKWebAppGetClientVersion",e.GET_COMMUNITY_AUTH_TOKEN="VKWebAppGetCommunityAuthToken",e.GET_COMMUNITY_TOKEN="VKWebAppGetCommunityToken",e.GET_COMMUNITY_AUTH_TOKEN_PRELOAD="VKWebAppGetCommunityAuthTokenPreload",e.GET_EMAIL_PRELOAD="VKWebAppGetEmailPreload",e.GET_EMAIL="VKWebAppGetEmail",e.GET_FRIENDS="VKWebAppGetFriends",e.GET_FLASH_INFO="VKWebAppGetFlashInfo",e.GET_GEODATA="VKWebAppGetGeodata",e.GET_PERSONAL_CARD="VKWebAppGetPersonalCard",e.GET_PHONE_NUMBER_PRELOAD="VKWebAppGetPhoneNumberPreload",e.GET_PHONE_NUMBER="VKWebAppGetPhoneNumber",e.GET_USER_INFO="VKWebAppGetUserInfo",e.INIT="VKWebAppInit",e.JOIN_GROUP="VKWebAppJoinGroup",e.JOIN_GROUP_PRELOAD="VKWebAppJoinGroupPreload",e.LEAVE_GROUP="VKWebAppLeaveGroup",e.LEAVE_GROUP_PRELOAD="VKWebAppLeaveGroupPreload",e.LOCATION_CHANGED="VKWebAppLocationChanged",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_CONTACTS="VKWebAppOpenContacts",e.OPEN_IN_NATIVE_APP="VKWebAppOpenInNativeApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.OPEN="VKWebAppOpenQR",e.REDIRECT="VKWebAppRedirect",e.RESIZE_WINDOW="VKWebAppResizeWindow",e.SCROLL="VKWebAppScroll",e.SEND_PAYLOAD="VKWebAppSendPayload",e.SEND_TO_CLIENT="VKWebAppSendToClient",e.SETTINGS="VKWebAppSettings",e.SET_LOCATION="VKWebAppSetLocation",e.SET_TITLE="VKWebAppSetTitle",e.SET_VIEW_SETTINGS="VKWebAppSetViewSettings",e.SHARE="VKWebAppShare",e.SHOW_NEW_POST_BOX="VKWebAppShowNewPostBox",e.SHOW_IMAGES="VKWebAppShowImages",e.SHOW_INVITE_BOX="VKWebAppShowInviteBox",e.SHOW_STORY_BOX="VKWebAppShowStoryBox",e.SHOW_LEADER_BOARD_BOX="VKWebAppShowLeaderBoardBox",e.SHOW_ORDER_BOX="VKWebAppShowOrderBox",e.SHOW_REQUEST_BOX="VKWebAppShowRequestBox",e.SHOW_WALL_POST_BOX="VKWebAppShowWallPostBox",e.TAPTIC_IMPACT_OCCURRED="VKWebAppTapticImpactOccurred",e.TAPTIC_NOTIFICATION_OCCURRED="VKWebAppTapticNotificationOccurred",e.TAPTIC_SELECTION_CHANGED="VKWebAppTapticSelectionChanged",e.UPDATE_CONFIG="VKWebAppUpdateConfig",e.VIEW_UPDATE_NAVIGATION_STATE="VKWebAppViewUpdateNavigationState",e.OPEN_ARTICLE_EDIT="VKWebAppOpenArticleEditor",e.OPEN_ARTICLE="VKWebAppOpenArticle"}(a||(a={}))},I3vf:function(e,t,r){"use strict";r.r(t);var n=r("wx14"),a=r("JX7q"),i=r("dI71"),o=r("Vy5E"),s=r("Y96s"),c=r("gNaZ"),p=r("4zn2"),l=r("PU8N"),d={error_type:"client_error",code:p.ERROR_CODES.CONNECTION_LOST},u=function(e){function t(t){var r;return(r=e.call(this,t)||this).showConfirm=function(e){r.params.modal.pic=e.photo_url,r.params.modal.title=e.title,r.params.modal.text=e.message,r.modal=new s.default(Object(n.default)({},r.params.modal)),c.default.push(r.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=function(){t.classList.add("vk_app_modal_container__pic--loaded")})},r.loadItemData=function(){return new Promise((function(e,t){var n=0;r.interval=setInterval((function(){ajax.post(r.controller,{act:"handle_vk_connect_event",event:r.getEventName(),hash:r.getEventHash(),item_id:r.itemId,order_id:r.orderId,app_id:r.app.appId},{onDone:function(a){switch((a=JSON.parse(a)).hasOwnProperty("error")&&t(a.error),a.status){case"pending":r.orderId=a.order_id,n++>=30&&t({error_type:"client_error",code:p.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case"loaded":r.orderId=a.order_id,r.confirmHash=a.confirm_hash,r.orderHash=a.order_hash,e(a.item_data)}},onFail:function(){t(d)}})}),1e3)}))},r.confirmOrder=function(){r.hideLoader(),ajax.post(r.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:r.itemId,order_id:r.orderId,app_id:r.app.appId,hash:r.confirmHash,order_hash:r.orderHash},{onDone:function(e){"charged"===(e=JSON.parse(e)).status?(r.successHandler(e),c.default.pop(r.modal)):(c.default.pop(r.modal),r.errorHandler(e.error))},onFail:function(){r.onError(d)}})},r.params.handlerName="VKWebAppShowOrderBox",r.useUI=!1,r.callApi=!1,r.controller="/apps",r.itemId="",r.orderId=0,r.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:r.cancel.bind(Object(a.default)(r))},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:r.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:r.confirmOrder,cancelAction:r.cancel.bind(Object(a.default)(r)),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},r.rawData=null,r}Object(i.default)(t,e);var r=t.prototype;return r.setData=function(t,r){e.prototype.setData.call(this,t,r),this.itemId=this.itemId?this.itemId:t.item,this.rawData=t},r.showLoader=function(){var e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new s.default(Object(n.default)({},e)),c.default.push(this.loader)},r.hideLoader=function(){this.loader&&(c.default.pop(this.loader),this.loader.destroy()),this.loader=null},r.handler=function(e,t,r){var n=this;this.setData(e,t),this.callback=r,Object(l.isMvk)()?(this.showLoader(),this.makeOrder()):(window.cur.app.registerVkBridgeCallback("onOrderCancel",(function(){n.errorHandler({reason:"User denied",code:p.ERROR_CODES.USER_DENIED})})),window.cur.app.registerVkBridgeCallback("onOrderSuccess",(function(e){n.successHandler({success:!0,order_id:e})})),window.cur.app.registerVkBridgeCallback("onOrderFail",(function(e){n.errorHandler({reason:"Payment error",code:e})})),window.cur.app.funcs.showOrderBox(this.rawData))},r.makeOrder=function(){var e=this;this.loadItemData().then((function(t){clearInterval(e.interval),e.hideLoader(),e.showConfirm(t)})).catch((function(t){e.onError(t)}))},r.cancel=function(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()},r.onError=function(e){clearInterval(this.interval),this.errorHandler(e),c.default.pop(this.modal),this.hideLoader()},t}(o.default);t.default=u},PU8N:function(e,t,r){"use strict";r.r(t),r.d(t,"isMvk",(function(){return a})),r.d(t,"getVideoDuration",(function(){return i})),r.d(t,"getMediaBlob",(function(){return o})),r.d(t,"getBlobType",(function(){return s})),r.d(t,"noop",(function(){return c})),r.d(t,"getAverageRGB",(function(){return p})),r.d(t,"loadImage",(function(){return l})),r.d(t,"loadImages",(function(){return d})),r.d(t,"loadFontFace",(function(){return u})),r.d(t,"loadFontFacePromise",(function(){return h})),r.d(t,"getCroppedImage",(function(){return _}));var n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){return!!window.isMVK}function i(e){return void 0===e&&(e=""),new Promise((function(t,r){var n=document.createElement("video");n.addEventListener("loadedmetadata",(function(){return t(n.duration)}),{once:!0}),n.addEventListener("error",r,{once:!0}),n.crossOrigin="anonymous",n.preload="metadata",n.src=e}))}function o(e){return new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(404===n.response.status)return r();t(n.response)},n.onerror=r,n.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var c=function(){};function p(e){var t,r={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,a=0;(n+=20)<t.data.length;)++a,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/a),r.g=~~(r.g/a),r.b=~~(r.b/a),r}function l(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin=e.startsWith("data:")?null:"Anonymous",n.onerror=function(){return r(new Error("Failed to load image's URL: "+e))},n.onload=function(){return t(n)},n.src=e}))}var d=function(e){return new Promise((function(t){var r=e.map((function(e){return l(e)}));Promise.all(r).then((function(e){return t(e)})).catch((function(){}))}))};function u(e,t){var r,n,a,i,o,s,c,p,l={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},u={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function h(e){var t=[];return each(e,(function(e,r){t.push(e+":"+r)})),t.join(";")}function _(e,t,r){return Math.abs(e.width-t.offsetWidth)>r||Math.abs(e.height-t.offsetHeight)>r}function m(){i||(utilsNode.appendChild(o),i=!0,a={sansSerif:{width:c.offsetWidth,height:c.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(c.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(c,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),i&&a&&(_(a.sansSerif,c,t.tolerance)||_(a.serif,s,t.tolerance))?(re(o),t.success()):(new Date).getTime()-n.getTime()>t.timeout?(re(o),t.error()):!i&&"requestAnimationFrame"in window?window.requestAnimationFrame(m):window.setTimeout(m,t.delay)}for(var f in d)t.hasOwnProperty(f)||(t[f]=d[f]);u["font-weight"]=t.weight,u["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(r=setTimeout((function(){t.error()}),t.timeout)),function(r){each(null===document||void 0===document?void 0:document.fonts,(function(n){n.family.toLowerCase()===e.toLowerCase()&&(l[n.weight]||n.weight)===""+t.weight&&n.style===t.style&&n.load().then((function(){t.success(),clearTimeout(r)}))}))}(r)):(p="AxmTYklsjo190QW"+t.glyphs,n=new Date,o=ce("div"),c=ce("div",{innerHTML:p}),s=ce("div",{innerHTML:p}),c.setAttribute("style",h(extend({"font-family":"sans-serif"},u))),s.setAttribute("style",h(extend({"font-family":"serif"},u))),o.appendChild(c),o.appendChild(s),m())}function h(e,t){return new Promise((function(r,a){u(e,n(n({},t),{glyphs:"",success:function(){var e=function(){r(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){a(),(null==t?void 0:t.error)&&t.error()}}))}))}function _(e,t,r,n,a){return new Promise((function(i,o){("string"==typeof e?l(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var c=s.getContext("2d");if(c){c.drawImage(e,0,0);var p=c.getImageData(t,r,n,a),d=document.createElement("canvas");d.width=n,d.height=a;var u=d.getContext("2d");if(u)return u.putImageData(p,0,0),l(d.toDataURL("image/jpeg",1)).then(i).catch(o);i(e)}else i(e)})).catch(o)}))}},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,a=!1;return function i(){if(a)return r=arguments,void(n=this);e.apply(this,arguments),a=!0,setTimeout((function(){a=!1,r&&(i.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},Vy5E:function(e,t,r){"use strict";r.r(t);var n=r("wx14"),a=r("vuIU"),i=r("gNaZ"),o=r("4zn2"),s=function(){function e(e,t,r){void 0===r&&(r=o.ERROR_TYPES.CLIENT),this.data=t||{},this.method=e,this.type=r}var t=e.prototype;return t._errorStrucuture=function(e,t){var r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===o.ERROR_TYPES.API?r.data.error_data.error_msg=t:r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),r},t.selectErrorType=function(){if(!this.data.hasOwnProperty("code"))return this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(o.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(o.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error");switch(this.data.code){case o.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(o.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case o.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(o.ERROR_CODES.CONNECTION_LOST,this.data.reason||"Connection lost");case o.ERROR_CODES.USER_DENIED:return this._errorStrucuture(o.ERROR_CODES.USER_DENIED,this.data.reason||"User denied");case o.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(o.ERROR_CODES.INVALID_PARAMS,this.data.reason||"Invalid params");case o.ERROR_CODES.CUSTOM:return this._errorStrucuture(o.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case o.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(o.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");default:return this._errorStrucuture(this.data.code?this.data.code:o.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error")}},e}(),c=r("Y96s"),p=r("PU8N"),l=r("jE6c"),d=function(){function e(e){void 0===e&&(e={}),this.params=Object(n.default)({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}var t=e.prototype;return t.getEventHash=function(e){return void 0===e&&(e=!1),cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+(e?"Preload":"")]+"_hash"]},t.getEventHashes=function(e){return void 0===e&&(e=!1),cur.app.options[o.VK_CONNECT_EVENTS[this.params.handlerName+(e?"Preload":"")]+"_hashes"]},t.getEventName=function(e){return void 0===e&&(e=!1),o.VK_CONNECT_EVENTS[this.params.handlerName+(e?"Preload":"")]},t.checkParams=function(e,t){for(var r=0;r<t.length;r++){var n=t[r],a=n.param,i=n.type,s=n.isRequired,c=n.extraChecks;if(!e.hasOwnProperty(a)&&s)return this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "'+a+'"'}),!1;if(e.hasOwnProperty(a)&&typeof e[a]!==i)return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:'Param "'+a+'" should be '+i},this.callback),!1;if(e.hasOwnProperty(a)&&c&&c.length>0)for(var p=0;p<c.length;p++)if(!c[p].check(e[a]))return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:c[p].error(a)},this.callback),!1}return!0},t.actionHandler=function(e){var t=this;return this.callApi?ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:function(r){t.handleResponse(r,e,t.checkResponse)},onFail:function(e){return t.errorHandler(e),!0}}):{}},t.checkResponse=function(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)},t.scopeStringToArray=function(e){return e?e.replace(/ /g,"").split(","):[]},t.denyUIAction=function(){this.errorHandler({error_type:"client_error",code:o.ERROR_CODES.USER_DENIED},null),i.default.pop(this.modal)},t.allowUIAction=function(e){this.actionHandler(e),i.default.pop(this.modal)},t.createDenyUIAction=function(e){var t=this;this.params.modal.cancelAction=void 0!==e?function(){return t.denyUIAction(e)}:this.denyUIAction},t.createAllowUIAction=function(e){var t=this;this.params.modal.allowAction=void 0!==e?function(){return t.allowUIAction(e)}:this.allowUIAction},t.launchUI=function(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new c.default(Object(n.default)({},this.params.modal,{},e)),i.default.push(this.modal)},t._enhanceBtnsWithActions=function(){var e=this;this.params.modal.buttons&&this.params.modal.buttons.forEach((function(t,r){"deny"===t.type?e.params.modal.buttons[r].action=e.params.modal.cancelAction:e.params.modal.buttons[r].action=e.params.modal.allowAction}))},t.setData=function(e,t){e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t},t.handleResponse=function(e,t,r,n){try{var a=JSON.parse(e);a.hasOwnProperty("error")?this.errorHandler(a.error):r(a,t)}catch(e){n?n(e):this.errorHandler(e)}},t.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)},t.successHandler=function(e,t){void 0===t&&(t=void 0),t&&t(),Object(l.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),Object(p.isMvk)()&&cur.app.frame.focus()},t.errorHandler=function(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);var n=new s(this.errorDescriptor,e,r);t&&t(),this.callback(n.selectErrorType()),Object(p.isMvk)()&&cur.app.frame.focus()},Object(a.default)(e,[{key:"successDescriptor",get:function(){return this.params.handlerName+"Result"}},{key:"errorDescriptor",get:function(){return this.params.handlerName+"Failed"}}]),e}();t.default=d},Y96s:function(e,t,r){"use strict";r.r(t);var n=r("wx14"),a=r("PU8N"),i=function(){function e(e,t){this.props=Object(n.default)({},e),t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.renderModal(),this._destroyed=!1}var t=e.prototype;return t.init=function(){this.appNode&&this.appNode.appendChild(this.modal)},t.show=function(){var e=this;Object(a.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout((function(){return e.modal.classList.add("show")}),300),this.initMvkCloseActions()},t.initMvkCloseActions=function(){var e=this;if(Object(a.isMvk)()){if(!window.DirectGames||!cur.app.isDirectGame)return;window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=function(t){t.target===e.modal&&e.onAction(e.props.cancelAction)})}},t.close=function(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)},t.destroy=function(){this._destroyed||(Object(a.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)},t.onAction=function(e){e(),this.destroy()},t._renderBtn=function(e){var t=this,r=document.createElement("button");return r.setAttribute("type","button"),r.classList.add("vk_app_modal_btn"),r.classList.add("vk_app_modal_btn--"+e.type),e.disabled&&(r.disabled=e.disabled),r.innerText=e.title,r.addEventListener("click",(function(){return t.onAction(e.action)})),r},t._renderBtns=function(e){var t=this,r=e.getElementsByClassName("vk_app_modal_btns")[0];r&&(this.props.buttons.map((function(e){r.appendChild(t._renderBtn(e))})),1===this.props.buttons.length&&r.classList.add("vk_app_modal_btns--single-btn"))},t._renderCloseBtn=function(e){var t=this,r=document.createElement("button");r.setAttribute("type","button"),r.classList.add("vk_app_modal_close_btn"),r.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',r.addEventListener("click",(function(){return t.onAction(t.props.cancelAction)})),e.children[0].appendChild(r)},t._renderOuter=function(){var e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e},t._enhanceBtnsWithActions=function(){var e=this;this.props.buttons&&this.props.buttons.forEach((function(t,r){"deny"===t.type?e.props.buttons[r].action=e.props.cancelAction:e.props.buttons[r].action=e.props.allowAction}))},t._renderScopes=function(e){return e.map((function(e,t){return 0===t?getLang("vkapps_scope_"+e):getLang("vkapps_scope_"+e).toLowerCase()})).join(", ")},t.prepareScopes=function(e){return 0===e.length?["general"]:e},t.prepareExtraBtn=function(){var e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e},t.renderModal=function(){var e=this.props.picClass?this.props.picClass:"",t='\n    <div class="vk_app_modal_container vk_app_modal_container--flex '+(this.props.containerClass||"")+'">\n      <div class="vk_app_modal_content">\n        '+(this.props.svgIcon?this.props.svgIcon:'<img src="'+this.props.pic+'" class="vk_app_modal_container__pic MiniAppModalContainer__pic '+e+'" alt aria-label="product">')+'\n        <h2 class="vk_app_modal_container__heading">'+this.props.title+"</h2>\n        "+(this.props.text?'<p class="vk_app_modal_container__text">'+this.props.text+"</p>":"")+"\n      ";this.props.scopes&&(t+='\n          <p class="vk_app_modal_container__text">'+getLang("apps_connect_modal_messages_scopes_text")+'</p>\n          <p class="vk_app_modal_container__list">'+this._renderScopes(this.prepareScopes(this.props.scopes))+".</p>"),t+='\n          </div>\n          <div class="vk_app_modal_btns"></div>\n      </div>',this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal)},e}();t.default=i},aJgW:function(e,t,r){"use strict";r.r(t),r.d(t,"ColorSchemeMode",(function(){return n})),r.d(t,"ColorSchemeName",(function(){return a})),r.d(t,"ColorScheme",(function(){return s})),r.d(t,"colorScheme",(function(){return o}));var n,a,i=r("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(n||(n={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(a||(a={}));var o,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var r=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){r.currentMode===n.Auto&&r.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?a.Dark:a.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(i.setCookie)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var r=!1;switch(t){case n.Light:r=!1;break;case n.Dark:r=!0;break;case n.Auto:if(e.isSchemesAutoSwitchingSupported())r=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(r),this.isModeSavingAllowed&&Object(i.setCookie)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var r,n=(null===(r=this.schemesMap)||void 0===r?void 0:r[t])||t;e.setAttribute("scheme",n)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();o=window.colorScheme?window.colorScheme:new s,window.colorScheme=o,window.isSchemesSupported=s.isSchemesSupported.bind(null)},bKAG:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return p})),r.d(t,"StoryType",(function(){return n})),r.d(t,"StoryEntryPoint",(function(){return a})),r.d(t,"StorySource",(function(){return i})),r.d(t,"getStoryUploadUrl",(function(){return l})),r.d(t,"uploadStoryBlobToServer",(function(){return d})),r.d(t,"saveStoryOnServer",(function(){return u}));var n,a,i,o=r("jE6c"),s=r("PU8N"),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=16;function l(e){return new Promise((function(t,r){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",c({act:"get_upload_url"},e),{onDone:t,onError:r,onFail:r})}))}function d(e,t){var r=new FormData,n=encodeURIComponent("edited_"+Object(o.irand)(0,99999)+".jpg");return r.append("file0",e,n),fetch(t,{method:"POST",body:r}).then((function(e){return e.json()}))}function u(e,t){return new Promise((function(r,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:r,onError:n,onFail:n})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(n||(n={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(a||(a={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(i||(i={}))},d4g6:function(e,t,r){"use strict";r.r(t),r.d(t,"objectToQuerystring",(function(){return a})),r.d(t,"getHostName",(function(){return i})),r.d(t,"destroyOpenedApp",(function(){return o})),r.d(t,"isVKPayApp",(function(){return s})),r.d(t,"filterPostMessageOrigin",(function(){return c})),r.d(t,"isAllowedPostMessageOriginHost",(function(){return p}));var n=r("4zn2"),a=function(e){return Object.keys(e).reduce((function(t,r,n){return[t,0===n?"?":"&",encodeURIComponent(r),"=",encodeURIComponent(e[r])].join("")}),"")},i=function(e){var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},o=function(e){if(cur.vkAppQueue){var t=Object.keys(cur.vkAppQueue).filter((function(t){return~t.indexOf(e)}));if(t.length>0){var r=t[0];cur.vkAppQueue[r].destroyView(),delete cur.vkAppQueue[r]}}},s=function(e){return n.VKPAY_APPS.includes(e)};function c(e,t){var r=i(t),n=e.vkApp?e.vk_app_url:e.src,a=i(n);if(r!==a&&!p(e,r))throw Error("Insecure method call from "+r+". Call must be from "+a);return!0}function p(e,t){return!!e.allowed_origin_regexp&&new RegExp(e.allowed_origin_regexp).test(t)}},gF8j:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o})),r.d(t,"getVisibilityState",(function(){return p})),r.d(t,"getVisiblityEvent",(function(){return l}));var n=r("uQjJ"),a=r("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,r){Object(a.isMvk)()?window.addEvent(e,t,r,{passive:!0}):window.addEvent(e,t,r)}function c(e,t,r){Object(a.isMvk)()?window.removeEvent(e,t,r,{passive:!0}):window.removeEvent(e,t,r)}function p(){return document.visibilityState||document.webkitVisibilityState}function l(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,n.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&c(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&s(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===p()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=p();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNaZ:function(e,t,r){"use strict";r.r(t);var n=function(){function e(){this.checkStack=function(){cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}var t=e.prototype;return t.push=function(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)},t.clearLayerPopups=function(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter((function(e){return!~e.appNode.id.indexOf("container_layer")})))},t.pop=function(e){var t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())},t.checkForNext=function(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()},e}();t.default=new n},lMzL:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return A}));var n=r("wx14"),a=r("d4g6"),i=r("lNyc"),o=r("4zn2"),s=r("9kLB"),c=r("UlUB"),p=r("gF8j"),l={id:"active_time",triggerEvents:"mouseover mousedown keypress",timeout:15e3,maxChainInterval:0,doesScrollTriggerIdle:!1,callback:function(){}},d=function(){function e(e){void 0===e&&(e={}),this._timeChainStart=void 0,this._timeStart=0,this._timeActivityStart=0,this._sumActiveTime=0,this.opts=Object.assign({},l,e),this._idle=new p.default({id:this.opts.id,element:document,focusElement:window,triggerEvents:this.opts.triggerEvents,idleTimeout:this.opts.timeout}),window.addEventListener("beforeunload",this._onTabClose.bind(this)),this.opts.doesScrollTriggerIdle&&window.addEventListener("scroll",Object(c.throttle)(this._onScroll.bind(this),this.opts.timeout)),this._idle.on("idle",this._onTabInactive.bind(this)),this._idle.on("unidle",this._onTabActive.bind(this)),this._idle.start(),this._timeChainStart=Date.now(),document.activeElement===document.body&&this.start()}var t=e.prototype;return t._checkTimeLimit=function(){this._timeStart&&this.opts.maxChainInterval&&(Date.now()-this._timeStart>this.opts.maxChainInterval&&this.endInterval())},t._sessionEnd=function(){this.opts.callback(this.getData())},t.getData=function(){var e=Date.now(),t=this._sumActiveTime;return this._timeActivityStart&&(t+=e-this._timeActivityStart),{timeChainStart:this._timeChainStart,timeStart:this._timeStart,timeEnd:e,activeTime:t}},t._onTabActive=function(){this.start()},t._onTabInactive=function(){this.stop()},t._onTabClose=function(){this.endInterval()},t._onScroll=function(){var e=this;this._idle.unidle(),clearTimeout(this._idleTimeoutHandler),this._idleTimeoutHandler=setTimeout((function(){return e._idle.idle()}),2*this.opts.timeout)},t.stop=function(){this._timeActivityStart&&(this._sumActiveTime+=Date.now()-this._timeActivityStart,this._checkTimeLimit(),this._timeActivityStart=0)},t.start=function(){if(this._checkTimeLimit(),!this._timeActivityStart){var e=Date.now();this._timeStart||(this._timeStart=e),this._timeActivityStart=e}},t.resetToNewTimer=function(){this._timeStart=0,this._sumActiveTime=0,this._timeActivityStart=0},t.endInterval=function(e){return void 0===e&&(e=!0),this._timeActivityStart?(e&&this._sessionEnd(),this._idle.stop(),this.resetToNewTimer(),this):this},t.startInterval=function(){return this._idle.start(),this.start(),this},e}(),u=r("J8bf"),h=r("W0P9"),_={triggerEvents:"mousemove keydown keypress",timeout:18e4},m=function(){function e(e,t){void 0===t&&(t={}),this.opts=Object.assign({},_,t),this.activeTime=null,this.sessionId=null,this.sessions={},this.appId=e,this.lastIdleTs=0}var t=e.prototype;return t.start=function(){this._loadSessions(),this.sessionId=this._getSessionId(),Object(h.log)("[AppSessionTimeLogger] started with session id",this.sessionId),this.activeTime=new d({id:"app_"+this.appId,triggerEvents:this.opts.triggerEvents,timeout:this.opts.timeout,doesScrollTriggerIdle:!0,callback:this._saveSession.bind(this)}),this.activeTime._idle.on("idle",this._onIdle.bind(this)),this.activeTime._idle.on("unidle",this._onUnIdle.bind(this)),this.activeTime.start()},t.stop=function(){Object(h.log)("[AppSessionTimeLogger] stopped."),this.activeTime&&(this.activeTime.endInterval(),this.activeTime.stop(),this.sessions={},this.activeTime=null)},t.idle=function(){this.activeTime&&this.activeTime._idle.cbInactive()},t.unIdle=function(){this.activeTime&&this.activeTime._idle.cbActive()},t._clearOldSessions=function(){var e=this,t=Object.keys(this.sessions);t.length>10&&(t.sort((function(e,t){var r=+e.split("_")[1];return+t.split("_")[1]-r})),t.slice(10).forEach((function(t){delete e.sessions[t],Object(h.log)("[AppSessionTimeLogger] deleted old session",t)})))},t._saveSession=function(){this._logSession(),Object(u.setCookie)("remixapp_session",JSON.stringify(this.sessions),.01)},t._logSession=function(){if(this.sessionId&&this.activeTime){this._clearOldSessions();var e=this.activeTime.getData().activeTime;(e=Math.round(e/1e3))>0&&(this.sessions[this.sessionId]=e),Object(h.log)("[AppSessionTimeLogger] Log sessions:",this.sessions)}},t._onIdle=function(){this.lastIdleTs=Date.now()},t._onUnIdle=function(){this.activeTime&&(this.lastIdleTs&&Date.now()-this.lastIdleTs>this.opts.timeout&&(this.activeTime.endInterval(),this.activeTime.startInterval(),this.sessionId=this._getSessionId(),Object(h.log)("[AppSessionTimeLogger] last session is ended after timeout",this.opts.timeout),Object(h.log)("[AppSessionTimeLogger] start new session with id",this.sessionId)),this.lastIdleTs=0)},t._getSessionId=function(){return this.appId+"_"+Date.now()},t._loadSessions=function(){var e=Object(u.getCookie)("remixapp_session");if(e)try{this.sessions=JSON.parse(e)}catch(e){this.sessions={}}Object(h.log)("[AppSessionTimeLogger] Load old sessions from cookie",this.sessions)},e}(),f=r("PU8N"),b=r("aJgW"),O=function(){function e(e,t,r,a,o){var s=this;this.sendIframeMessage=function(e,t){var r=document.getElementById(s.containerId);r&&Object(i.sendMessage)({type:e,data:Object(n.default)({},t)},r)},this.appId=t.aid,this.src=t.src,this.pic=a,this.params=Object(n.default)({},r),this.containerId=e,this.vkApp=o,this.apiHost=t.vk_app_api_host,this.isDirectGame=t.is_direct_game,this.isVKPayApp=t.is_vkpay_app,this.isTextliveApp=t.is_textlive_app,this.isMiniAppWidget=t.is_mini_app_widget,this.handler=this.handler.bind(this),this.onResize=this.onResize.bind(this),this.i=0,this.eventQueue=[]}var t=e.prototype;return t.init=function(){var e=this;this.sessionLogger=new m(this.appId),cur.destroy.unshift((function(){e.destroyView()})),window.addEventListener("visibilitychange",(function(){document.hidden?e.sessionLogger&&e.sessionLogger.idle():e.sessionLogger&&e.sessionLogger.unIdle()})),window.addEventListener("message",this.handler),window.addEventListener("beforeunload",(function(){e.destroyView()})),this.getWindowSize(),cur.VKApp=cur.VKApp||{},cur.VKApp.vkMiniAppsHistoryLength=window.history.length,Object(f.isMvk)()?(b.colorScheme.subscribe((function(){var t=b.colorScheme.isDarkScheme()?o.CLIENT_SCHEME.SPACE_GRAY:o.CLIENT_SCHEME.BRIGHT_LIGHT;e.sendUpdateEvent(t)})),this.onResize(),window.addEventListener("resize",this.onResize),this.checkDevice()):(window.matchMedia("(prefers-color-scheme: dark)").addListener((function(t){return t.matches&&e.sendUpdateEvent(o.CLIENT_SCHEME.SPACE_GRAY)})),window.matchMedia("(prefers-color-scheme: light)").addListener((function(t){return t.matches&&e.sendUpdateEvent(o.CLIENT_SCHEME.BRIGHT_LIGHT)})))},t.initOpenExternalApp=function(){var e=new URLSearchParams(location.search);if(cur.zNavInfo&&cur.zNavInfo.info.w&&e.has("w")){var t=/app[0-9]+/.exec(cur.zNavInfo.info.w);if(t){var r=parseInt(t[0].replace("app",""),10);Object(i.chooseAction)({eventData:{app_id:r},params:{app_id:r,request_id:"vkopenexternalapp"},handler:s.CONNECT_EVENTS.OPEN_APP},this)}}},t.destroyView=function(){window.removeEventListener("message",this.handler),this.sessionLogger&&this.sessionLogger.stop()},t.sendUpdateEvent=function(e){Object(i.chooseAction)({handler:s.CONNECT_EVENTS.UPDATE_CONFIG,params:{viewport_width:this.currentWidth,viewport_height:this.currentHeight,scheme:e||this.getColorScheme(),api_host:this.apiHost}},this)},t.onResize=function(){if(!this.isDirectGame&&!(Object(f.isMvk)()&&cur.share||this.currentHeight===window.innerHeight)){this.getWindowSize();var e=document.querySelector(".app_container"),t=e&&e.childNodes[0];t&&(t.style.height=this.currentHeight+"px",t.style.minHeight=this.currentHeight+"px",this.sendUpdateEvent())}},t.getWindowSize=function(){this.currentHeight=window.innerHeight,this.currentWidth=window.innerWidth},t.getColorScheme=function(){if(Object(f.isMvk)())return b.colorScheme.isDarkScheme()?o.CLIENT_SCHEME.SPACE_GRAY:o.CLIENT_SCHEME.BRIGHT_LIGHT;var e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=window.matchMedia("(prefers-color-scheme: light)").matches,r=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!e&&!t&&!r;return e&&Object(f.isMvk)()?o.CLIENT_SCHEME.SPACE_GRAY:t||r||n?o.CLIENT_SCHEME.BRIGHT_LIGHT:void 0},t.handler=function(e){var t=Object(a.getHostName)(e.origin)===Object(a.getHostName)(this.src)||Object(a.isAllowedPostMessageOriginHost)(this.vkApp.options,Object(a.getHostName)(e.origin));if(e.data&&"vk-connect"===e.data.type&&t){var r=this;if(e.data.handler===s.CONNECT_EVENTS.INIT&&(this.sessionLogger&&this.sessionLogger.start(),r&&r.sendUpdateEvent(),!Object(f.isMvk)())){var o=document.getElementById(this.containerId);o&&Object(i.sendMessage)({type:s.CONNECT_EVENTS.SETTINGS,frameId:this.containerId},o)}if(cur.vkAppQueue&&Object.keys(cur.vkAppQueue).length>1){var c=e.data.frameId||e.data.webFrameId||this.containerId;if(!c)throw new Error("There is no specified id for container");c===this.containerId&&(r=cur.vkAppQueue[c],Object(i.chooseAction)(Object(n.default)({},e.data,{pic:this.pic}),r))}else Object(f.isMvk)()?cur.app.hideVkAppPreload():this.initOpenExternalApp(),Object(i.chooseAction)(Object(n.default)({},e.data,{pic:this.pic}),r)}else if(e.data&&e.data.type===s.CONNECT_EVENTS.CLOSE&&Object(f.isMvk)()){var p=ge(this.containerId);p&&Object(i.sendMessage)({type:e.data.name,data:e.data.eventData},p)}},t.checkDevice=function(){this.isIOS()&&this.checkIOSXDevice()&&document.body.classList.add("vk_ios_x_device")},t.isIOS=function(){return document.body.classList.contains("vk_ios_yes")},t.checkIOSXDevice=function(){var e=window.screen.height;return e>=812&&e<900},t.actualizeEventQueue=function(){var e=Date.now()-3e4,t=this.eventQueue.findIndex((function(t){return t.timeInMs>=e}));-1===t?this.eventQueue=[]:this.eventQueue.splice(0,t)},t.isRequestsLimitReached=function(){return this.actualizeEventQueue(),15===this.eventQueue.length},e}();function A(e,t,r,n,a){if(cur.vkAppQueue||(cur.vkAppQueue={}),!cur.vkAppQueue[e]){var i=new O(e,t,r,n,a);i.init(),cur.vkAppQueue[e]=i}}},lNyc:function(e,t,r){"use strict";r.r(t),r.d(t,"sendMessage",(function(){return Le})),r.d(t,"chooseAction",(function(){return We}));var n=r("wx14"),a=r("dI71"),i=r("Vy5E"),o=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppInit",r}return Object(a.default)(t,e),t.prototype.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.successHandler({result:!0})},t}(i.default),s=r("JX7q"),c=r("gNaZ"),p=r("Y96s"),l=function(){function e(e,t){this.props=Object(n.default)({},e),t&&(this.callback=t),this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}var t=e.prototype;return t.show=function(){var e=this;setTimeout((function(){return e.modal.classList.add("show")}),300)},t.destroy=function(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()},t.onAction=function(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()},t.onCancelAction=function(e){e&&e(),this.destroy()},t.onAllow=function(){var e=this,t=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map((function(r){var n=parseInt(r.id.replace("scope_",""),10);if(!e.props.scopes[n])throw new Error("There is no such scope");t.push(e.props.scopes[n])})),this.onAction(t.join(","))},t._renderBtn=function(e){var t=this,r=document.createElement("button");return r.setAttribute("type","button"),r.classList.add("vk_app_modal_btn"),r.classList.add("vk_app_modal_btn--"+e.type),r.innerText=e.title,"success"===e.type?r.addEventListener("click",(function(){return t.onAllow()})):r.addEventListener("click",(function(){return t.onCancelAction(e.action)})),r},t._renderBtns=function(e){var t=this;this.props.buttons.map((function(r){e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(t._renderBtn(r))}))},t._renderCloseBtn=function(e){var t=this,r=document.createElement("div");r.setAttribute("aria-label","Close"),r.setAttribute("tabindex","0"),r.setAttribute("role","button"),r.classList.add("box_x_button"),r.addEventListener("click",(function(){return t.onCancelAction(t.props.cancelAction)})),e.querySelector(".box_title_wrap").appendChild(r)},t._renderOuter=function(){return document.querySelector(".vk_app_modal_outer")},t._enhanceBtnsWithActions=function(){var e=this;this.props.buttons&&this.props.buttons.forEach((function(t,r){"deny"===t.type?e.props.buttons[r].action=e.props.cancelAction:e.props.buttons[r].action=e.props.allowAction}))},t._renderScopes=function(e){return e.map((function(e,t){return'\n    <div class="scope_row">\n      <input class="blind_label" type="checkbox" id="scope_'+t+'" checked="">\n      <label for="scope_'+t+'">'+getLang("vkapps_scope_"+e)+"</label>\n    </div>\n    "})).join("\n")},t.renderModal=function(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML='\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">'+this.props.title+'</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      '+(this.props.text?"<p>"+this.props.text+"</p>":"")+"\n      "+(this.props.scopes&&'<div class="vk_app_modal_scopes">'+this._renderScopes(this.props.scopes)+"</div>")+'\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n',this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)},e}(),d=r("4zn2"),u=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetCommunityAuthToken",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},r.callApi=!0,r.useUI=!0,r.allowUIAction=r.allowUIAction.bind(Object(s.default)(r)),r.checkToken=r.checkToken.bind(Object(s.default)(r)),r.checkIntroData=r.checkIntroData.bind(Object(s.default)(r)),r.onEditClick=r.onEditClick.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.scopeList=function(e){var t=this,r=this.app.params.group_whitelist_scopes?e.filter((function(e){return t.app.params.group_whitelist_scopes.includes(e)})):e;return r=r.filter((function(e,t,r){return t===r.indexOf(e)}))},r.checkScopes=function(e){var t=this;return 0===e.filter((function(e){return!t.app.params.group_whitelist_scopes.includes(e)})).length},r.onEditClick=function(e){this.editScopesModal.renderModal()},r.launchUI=function(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new p.default(Object(n.default)({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new l(Object(n.default)({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),c.default.push(this.modal)},r.takeAction=function(e){var t=this;ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:function(e){t.handleResponse(e,null,t.checkToken)},onFail:function(e){return t.errorHandler(e),!0}})},r.checkToken=function(e){e.access_token?this.successHandler(Object(n.default)({},e)):this.errorHandler({reason:"Invalid params"})},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(r){t.handleResponse(r,e,t.checkIntroData)},onFail:function(e){return t.errorHandler(e),!0}})},r.allowUIAction=function(e){this.takeAction(e),c.default.pop(this.modal)},r.checkIntroData=function(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=this.params.modal.title+" "+e.group.name),this.launchUI(Object(n.default)({},t,{scopes:this.scopeStringToArray(t.scope)}))}},r.handler=function(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"!=typeof e.app_id||e.app_id<0)this.errorHandler({code:2,reason:'Param "app_id" should be a positive number'},r);else if(e.app_id===parseInt(this.app.appId,10))if(e.group_id)if("number"!=typeof e.group_id||e.group_id<0)this.errorHandler({code:2,reason:'Param "group_id" should be a positive number'},r);else{var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:2,reason:'Missing required param "group_id"'},r);else this.errorHandler({code:2,reason:'Wrong param "app_id"'},r);else this.errorHandler({code:2,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:2,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:2,reason:'Missing required param "scope"'},r)},r.actionHandler=function(e){this.loadIntroData(e)},t}(i.default),h=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetCommunityToken",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},r.callApi=!0,r.useUI=!0,r.allowUIAction=r.allowUIAction.bind(Object(s.default)(r)),r.checkToken=r.checkToken.bind(Object(s.default)(r)),r.checkIntroData=r.checkIntroData.bind(Object(s.default)(r)),r.onEditClick=r.onEditClick.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.scopeList=function(e){var t=this,r=this.app.params.group_whitelist_scopes?e.filter((function(e){return t.app.params.group_whitelist_scopes.includes(e)})):e;return r=r.filter((function(e,t,r){return t===r.indexOf(e)}))},r.checkScopes=function(e){var t=this;return 0===e.filter((function(e){return!t.app.params.group_whitelist_scopes.includes(e)})).length},r.onEditClick=function(e){this.editScopesModal.renderModal()},r.launchUI=function(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new p.default(Object(n.default)({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new l(Object(n.default)({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),c.default.push(this.modal)},r.takeAction=function(e){var t=this;ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:function(e){t.handleResponse(e,null,t.checkToken)},onFail:function(e){t.errorHandler(e)}})},r.checkToken=function(e){e.access_token?this.successHandler(Object(n.default)({},e)):this.errorHandler({reason:"Invalid params"})},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(r){t.handleResponse(r,e,t.checkIntroData)},onFail:function(e){return t.errorHandler(e),!0}})},r.allowUIAction=function(e){this.takeAction(e),c.default.pop(this.modal)},r.checkIntroData=function(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=this.params.modal.title+" "+e.group.name),this.launchUI(Object(n.default)({},t,{scopes:this.scopeStringToArray(t.scope)}))}},r.handler=function(e,t,r){if(this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:function(e){return e>0},error:function(e){return'Param "'+e+'" should be a positive number'}}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:function(e){return e>0},error:function(e){return'Param "'+e+'" should be a positive number'}}]}])){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.UNKNOWN_ERROR},r)}},r.actionHandler=function(e){this.loadIntroData(e)},t}(i.default),_=r("PU8N"),m=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAddToCommunity",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community"),text:getLang("apps_connect_modal_messages_request_add_to_community_text")},r.callApi=!0,r.useUI=!0,r.allowUIAction=r.allowUIAction.bind(Object(s.default)(r)),r.addToCommunitySuccessHandler=r.addToCommunitySuccessHandler.bind(Object(s.default)(r)),r.addToCommunityErrorHandler=r.addToCommunityErrorHandler.bind(Object(s.default)(r)),r.unsetCurHandlers=r.unsetCurHandlers.bind(Object(s.default)(r)),r.checkIntroData=r.checkIntroData.bind(Object(s.default)(r)),r.checkAppAdd=r.checkAppAdd.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.takeAction=function(){var e=this;ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:function(t){e.handleResponse(t,{},e.checkAppAdd)},onFail:function(t){return e.errorHandler(t),!0}})},r.checkAppAdd=function(e){parseInt(e,10)&&this.successHandler({result:!0})},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e);var r=Object(_.isMvk)()?Object(n.default)({act:"vkapps_add_to_community_box",hash:cur.app.options.hash,app_id:this.app.appId},this.request):Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request);Object(_.isMvk)()?window.ajax.post("apps.php",r,{onDone:function(e,t){cur.app.showAppsBox(e,t)},onFail:function(e){return t.errorHandler(e),!0}}):ajax.post("apps.php",r,{onDone:function(e){t.handleResponse(e,{},t.checkIntroData)},onFail:function(e){return t.errorHandler(e),!0}})},r.allowUIAction=function(e){this.loadIntroData(e),c.default.pop(this.modal)},r.checkIntroData=function(e){var t=this;e.items.length>0?showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}}):0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),(function(){t.noCommunitiesBox.hide()})).show())},r.unsetCurHandlers=function(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,Object(_.isMvk)()&&VKApps.cancelSettings()},r.addToCommunitySuccessHandler=function(e){this.successHandler(e),this.unsetCurHandlers()},r.addToCommunityErrorHandler=function(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,this.launchUI(e)},r.actionHandler=function(e){this.loadIntroData(e)},t}(i.default),f=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAddToHomeScreenInfo",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.successHandler({is_feature_supported:!1,is_added_to_home_screen:!1})},t}(i.default);function b(e){return navigator.clipboard?function(e){return navigator.clipboard.writeText(e)}(e):(function(e){var t=document.createElement("input"),r=document.activeElement;t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),r.focus()}(e),Promise.resolve())}var O=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppCopyText",r}Object(a.default)(t,e);var r=t.prototype;return r.copyError=function(){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Can’t copy text on this device"},this.callback)},r.actionHandler=function(e){var t=this;e.text?b(e.text).then((function(){t.successHandler({result:!0})})).catch((function(){t.copyError()})):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "text"'})},t}(i.default),A=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetUserInfo",r.callApi=!0,r.useUI=!1,r}return Object(a.default)(t,e),t}(i.default),v=r("9kLB"),E=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppSetLocation",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){e.hasOwnProperty("location")?"string"==typeof e.location?(Object(_.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):cur.app.funcs.setLocation(e.location),We({handler:v.CONNECT_EVENTS.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({result:!0})):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})},t}(i.default),R=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetClientVersion",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){var t=d.PLATFORM.WEB;Object(_.isMvk)()&&(t=d.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},this.callback)},t}(i.default),S=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetPhoneNumber",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var n=JSON.parse(r);t.checkIntroData(n,e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.checkIntroData=function(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()},t}(i.default),g=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetEmail",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var n=JSON.parse(r);t.checkIntroData(n,e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.checkIntroData=function(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()},t}(i.default),y=r("vuIU"),I=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetGeodata",r.callApi=!0,r.useUI=!1,r.timeoutFails=0,r.geodataSuccess=r.geodataSuccess.bind(Object(s.default)(r)),r.geodataFail=r.geodataFail.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.geodataSuccess=function(e){var t=e.coords.longitude,r=e.coords.latitude;this.successHandler({available:!0,lat:r,long:t},this.callback)},r.geodataFail=function(e){switch(e.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail):this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Geolocation timeout error"},this.callback);break;case 2:this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User didn't allowed"},this.callback)}},r.actionHandler=function(e){var t=this;if(!this.callApi)return{};navigator.geolocation.getCurrentPosition((function(e){return t.geodataSuccess(e)}),(function(e){return t.geodataFail(e)}),{maximumAge:15e5,timeout:2e3})},Object(y.default)(t,[{key:"successDescriptor",get:function(){return"VKWebAppGeodataResult"}},{key:"errorDescriptor",get:function(){return"VKWebAppGeodataFailed"}}]),t}(i.default),k=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenQR",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),w=function(e){function t(t){var r;r=e.call(this,t)||this;var n=getLang("apps_connect_modal_messages_send_install_push");return r.params.handlerName="VKWebAppSendToClient",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:n.replace("{app_name}",cur.app.options.app_name)},r.useUI=!0,r.callApi=!0,r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){var t=this;return new Promise((function(e,r){ajax.post("apps.php",{act:"send_install_request",al:1,hash:window.cur.app.options.hash,aid:t.app.appId,cid:0,ref:0},{onDone:function(t){e(t)},onFail:function(e){r(e)}})})).then((function(){t.successHandler({result:!0})})).catch((function(){t.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.UNKNOWN_ERROR})}))},t}(i.default),N=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppSetViewSettings",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),T=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppSetTitle",r}return Object(a.default)(t,e),t.prototype.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)},t}(i.default),C=function(e){function t(t){var r;r=e.call(this,t)||this;var n=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");return r.params.handlerName="VKWebAppGetAuthToken",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:n.replace("{app_name}",cur.app.options.app_name)},r.callApi=!0,r.useUI=!0,r.onEditClick=r.onEditClick.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.scopeList=function(e){var t=this,r=this.app.params.whitelist_scopes?e.filter((function(e){return~t.app.params.whitelist_scopes.indexOf(e)})):e;return r=r.filter((function(e,t,r){return t===r.indexOf(e)}))},r.checkScopes=function(e){var t=this;return 0===e.filter((function(e){return!t.app.params.whitelist_scopes.includes(e)})).length},r.onEditClick=function(e){this.editScopesModal.renderModal()},r.launchUI=function(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new p.default(Object(n.default)({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick}));var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new l(Object(n.default)({},this.params.modal,{},e,{text:t,scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),c.default.push(this.modal)},r.actionHandler=function(e){var t=this;return this.callApi?ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:function(e){if(e.hasOwnProperty("error"))t.errorHandler(e.error);else try{var r=JSON.parse(e);r.access_token?t.successHandler(Object(n.default)({},r)):t.errorHandler({reason:"Invalid params"})}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}}):{}},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),this.app.appId==e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,scope:e.scope},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var n=JSON.parse(r);t.checkIntroData(n,e)}catch(e){console.log(e),t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}}):this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Wrong app id"})},r.checkIntroData=function(e,t){if(e.status){var r={};e.access_token&&(r.access_token=e.access_token),r.scope=this.params.scope.join(","),this.successHandler(r)}else this.launchUI(t)},r.handler=function(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"==typeof e.app_id){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},r);else this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},r)},Object(y.default)(t,[{key:"successDescriptor",get:function(){return"VKWebAppAccessTokenReceived"}},{key:"errorDescriptor",get:function(){return"VKWebAppAccessTokenFailed"}}]),t}(i.default),P=r("d4g6"),H=r("W9Tc");var D=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppCallAPIMethod",r.params.v="5.85",r.params.method=null,r.resolveResponse=r.resolveResponse.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=Object(n.default)({},e.params);e.request_id&&(t.request_id=e.request_id),function(e,t,r,a,i){if(r||(r={}),delete r.callback,t)if(r.hasOwnProperty("access_token")){Object.keys(r).forEach((function(e){"object"==typeof r[e]&&(r[e]=JSON.stringify(r[e]))}));var o=Object(n.default)({api_id:e.appId,method:t,format:"json",v:d.API_VERSION},r),s=Object(P.objectToQuerystring)(o),c=new XMLHttpRequest,p=Object(H.partConfigEnabled)("mini_apps_web_call_api_form_data")&&6911063!==parseInt(e.appId,10);p?(c.open("POST","https://"+e.apiHost+"/method/"+t),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):c.open("POST","https://"+e.apiHost+"/method/"+t+s),c.onload=function(){if(200==c.status)try{var e=JSON.parse(c.response);r.request_id&&(e.request_id=r.request_id),e.hasOwnProperty("error")?i({reason:e.error}):a(e)}catch(e){i({code:1,reason:e.message})}else i({reason:c.statusText})},c.onerror=function(){i({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.NETWORK_ERROR})},p?c.send(s):c.send()}else i({code:d.ERROR_CODES.MISSING_PARAM,reason:"Missing required param access_token"});else i({code:d.ERROR_CODES.MISSING_PARAM,reason:"Missing required param method"})}({appId:this.app.appId,apiHost:this.app.apiHost},e.method,t,this.successHandler,this.errorHandler)},r.resolveResponse=function(e){e&&(e.hasOwnProperty("error")?this.errorHandler(e.error):this.successHandler(e))},r.handler=function(e,t,r){this.callback=r,this.setData(e,t),e.params?e.params.v||e.params.version?isNaN(parseInt(e.params.v,10))&&isNaN(parseInt(e.params.version,10))?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "v" should be a number'},r):(e.params.hasOwnProperty("v")?this.params.v=e.params.v:e.params.hasOwnProperty("version")&&(this.params.v=e.params.version),this.actionHandler(e)):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "v"'},r):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:"Missing required params"},r)},t}(i.default),V=function(e){function t(t){var r;return(r=e.call(this,t)||this).callApi=!0,r.useUI=!0,r.allowUIAction=r.allowUIAction.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.takeAction=function(){var e=this;ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:function(t){t.hasOwnProperty("error")?e.errorHandler(t.error):parseInt(t,10)?e.successHandler({result:!0}):e.errorHandler()},onFail:function(t){return e.errorHandler(t),!0}})},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var a=JSON.parse(r),i=a.group.is_closed;t.checkIntroData(Object(n.default)({isGroupMember:a.is_group_member,canJoin:i!==d.GROUP_STATUS.PRIVATE,can_send_messages:a.can_send_messages},a.group),e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.allowUIAction=function(e){this.takeAction(e),c.default.pop(this.modal)},r.checkIntroData=function(e,t){this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.title=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions()},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)},r.actionHandler=function(e){this.loadIntroData(e)},t}(i.default),M=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppJoinGroup",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0},r}return Object(a.default)(t,e),t.prototype.checkIntroData=function(t,r){e.prototype.checkIntroData.call(this,t,r),t.canJoin?t.isGroupMember?this.successHandler({result:!0}):(this.modal=new p.default(Object(n.default)({},this.params.modal)),c.default.push(this.modal)):this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"User can not join this group"})},t}(V),L=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppLeaveGroup",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_leave"),type:"success"}],text:getLang("apps_connect_modal_messages_leave_group_text"),showCloseBtn:!0},r}return Object(a.default)(t,e),t.prototype.checkIntroData=function(t,r){e.prototype.checkIntroData.call(this,t,r),t.isGroupMember?(this.modal=new p.default(Object(n.default)({},this.params.modal)),c.default.push(this.modal)):this.successHandler({result:!0})},t}(V),W=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAllowMessagesFromGroup",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")},r}return Object(a.default)(t,e),t.prototype.checkIntroData=function(t,r){e.prototype.checkIntroData.call(this,t,r),t.can_send_messages?this.successHandler({result:!0}):(this.params.modal.text=this.params.modal.text.replace("{group_name}",t.name),this.modal=new p.default(Object(n.default)({},this.params.modal)),c.default.push(this.modal))},t}(V),j=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppDenyNotifications",r.callApi=!0,r.useUI=!1,r}return Object(a.default)(t,e),t}(i.default),U=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenPayForm",r.checkTransaction=r.checkTransaction.bind(Object(s.default)(r)),r.destroyVkPayContainer=r.destroyVkPayContainer.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){this.app.isMiniAppWidget?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):window.cur&&window.cur.app&&window.cur.app.isDirectGame?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):this.launchVkPayContainer(e):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})},r.openPayApp=function(e){var t=Object(n.default)({},e.params);t.action=e.action,cur.app.funcs.openExternalApp("vkpay",t,this.errorHandler)},r.checkTransaction=function(e){var t=!Object(_.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===d.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler(Object(n.default)({},e.data.params),this.callback):this.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:Object(n.default)({},e.data.params,{error_msg:"VK Pay payment failed"})}),Object(_.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User denied"})},r.destroyVkPayContainer=function(){window.removeEventListener("message",this.checkTransaction)},r.launchVkPayContainer=function(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)},t}(i.default),K=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAllowNotifications",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.takeAction=function(){var e=this,t={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(t.key=this.request.key),ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},t),{onDone:function(t){e.handleResponse(t,{},(function(t){return e.successHandler(t)}))},onFail:function(t){return e.errorHandler(t),!0}})},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var a=JSON.parse(r);t.checkIntroData(Object(n.default)({can_send_messages:a.can_send_messages},a.group),e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.allowUIAction=function(e){this.takeAction(e),c.default.pop(this.modal)},r.checkIntroData=function(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.picClass="MiniAppModalContainer__pic--small",this.params.modal.app_name=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new p.default(Object(n.default)({},this.params.modal)),c.default.push(this.modal))},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,cur.app.isDirectGame?this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:"This method allowed for mini apps only"}):this.loadIntroData(e)},t}(i.default),x=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenApp",r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=this;if(this.app.appId!==e.app_id||Object(P.isVKPayApp)(parseInt(this.app.appId,10))){var r={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(r.location=e.location),this.openApp=Object(n.default)({},r),ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},r),{onDone:function(r){try{var n=JSON.parse(r);n.hasOwnProperty("original_url")?(t.successHandler({result:!0}),Object(_.isMvk)()?cur.app.openAppInLayer(n.original_url,!0):(cur.app.openAppInLayer(n.original_url,(function(){return Object(P.destroyOpenedApp)(e.app_id)})),cur.miniAppOpener||(cur.miniAppOpener=t.app))):n.hasOwnProperty("error")&&t.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})}else this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Same app id as origin"})},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.app.isMiniAppWidget?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},r):e.app_id?"number"==typeof e.app_id?e.hasOwnProperty("location")&&"string"!=typeof e.location?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'"location" param should be a string'},r):this.actionHandler(e):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "app_id" should be a number'},r):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r)},r.createUrl=function(e){return"app"+e.app_id+(e.hasOwnProperty("location")?"#"+e.location:"")},t}(i.default),G=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShare",r.appId=cur.app.params.api_id,r.userId=cur.app.params.viewer_id,r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){e.link&&"string"!=typeof e.link?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "link" should be a string'},this.callback):Object(_.isMvk)()?(this.shareEmitters(),e.link?cur.app.funcs.shareBox(e.link,"","","",this.successHandler,this.errorHandler):cur.app.funcs.shareBox("https://vk.com/app"+cur.aid,cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc,this.successHandler,this.errorHandler)):e.link?cur.app.funcs.showWallPostBox({message:e.link,attachments:e.link},this.successHandler,this.errorHandler):(this.shareEmitters(),this.share(this.appId,this.userId))},r.share=function(e,t){var r=this;showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t},{onFail:function(){r.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:"Unknown error",error_type:"client_error"},r.callback)},params:{onHide:function(){setTimeout((function(){cur.app.vkMiniAppShareSuccess&&r.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User denied",error_type:"client_error"},r.callback)}),1e3)}}})},r.cleanEmitters=function(){cur.app.vkMiniAppShareSuccess=null,cur.app.vkMiniAppShareFail=null},r.shareEmitters=function(){var e=this;cur.app.vkMiniAppShareSuccess=function(t){t.post_id?e.successHandler({type:"post",post_id:t.owner_id+"_"+t.post_id}):"number"==typeof t&&e.successHandler({type:"message"}),e.cleanEmitters()},cur.app.vkMiniAppShareFail=function(t){t?e.errorHandler(t):e.errorHandler({error_type:"client_error",code:d.ERROR_CODES.USER_DENIED}),e.cleanEmitters()}},t}(i.default),B=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowNewPostBox",r.appId=cur.app.params.api_id,r.userId=cur.app.params.viewer_id,r}Object(a.default)(t,e);var r=t.prototype;return r.checkFields=function(e){return this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"author_id",type:"number",isRequired:!0},{param:"textlive_id",type:"number",isRequired:!1,extraChecks:[{check:function(){return d.TEXTLIVE_APPS.includes(cur.app.params.api_id)},error:function(){return d.ERROR_REASONS.UNKNOWN_ERROR}}]}])},r.actionHandler=function(e){Object(_.isMvk)()?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM}):this.checkFields(e)&&this.open(e)},r.open=function(e){var t=e.textlive_id,r=e.author_id,n=e.owner_id;this.initEmitters(),cur.getWkviewOpts=function(){return{textlive_id:t,author_id:r,owner_id:n}},showWiki({w:"postbox"},null,null,{})},r.cleanEmitters=function(){cur.app.vkMiniAppNewPostSuccess=null,cur.app.vkMiniAppNewPostFail=null},r.initEmitters=function(){var e=this;window.cur.app.vkMiniAppNewPostSuccess=function(t){t.post_id?e.successHandler({type:"post",post_id:t.owner_id+"_"+t.post_id}):"number"==typeof t&&e.successHandler({type:"message"}),e.cleanEmitters()},window.cur.app.vkMiniAppNewPostFail=function(t){t?e.errorHandler(t):e.errorHandler({error_type:"client_error",code:d.ERROR_CODES.USER_DENIED}),e.cleanEmitters()}},t}(i.default),F=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowWallPostBox",r.externalSuccessHandler=r.externalSuccessHandler.bind(Object(s.default)(r)),r.externalErrorHandler=r.externalErrorHandler.bind(Object(s.default)(r)),r.setExternalHandlers(),r}Object(a.default)(t,e);var r=t.prototype;return r.setExternalHandlers=function(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler},r.unsetCurHandlers=function(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,Object(_.isMvk)()&&VKApps.cancelSettings()},r.externalSuccessHandler=function(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()},r.externalErrorHandler=function(){this.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()},r.actionHandler=function(e){e.hasOwnProperty("message")?e.message&&"string"!=typeof e.message?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback):(e.message=e.message.replace(/(\r)/g,""),cur.app.funcs.showWallPostBox(e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'})},t}(i.default),q=function(){function e(e,t,r){this.desiredOffset=e,this.speed=t,this.onComplete=r}return e.prototype.go=function(){window.Apps.scrollToY(this.desiredOffset,this.speed,void 0,void 0,this.onComplete)},e}(),Y=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppScroll",r.useUI=!1,r.DEFAULT_SPEED=100,r.onScrollEnd=r.onScrollEnd.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.onScrollEnd=function(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})},r.actionHandler=function(e){if(Object(_.isMvk)())this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);else if(e.hasOwnProperty("top"))if("number"==typeof e.top)if(e.hasOwnProperty("speed")&&"number"!=typeof e.speed)this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'"speed" param should be a number'});else{var t=e.hasOwnProperty("speed")?e.speed:this.DEFAULT_SPEED;if(this.params.data={top:e.top},~this.app.containerId.indexOf("layer")){var r=ge("wk_layer_wrap");r?r.scrollTop=e.top:this.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:d.ERROR_REASONS.UNKNOWN_ERROR})}else this.scroll=new q(e.top,t,this.onScrollEnd.bind(this)),this.scroll.go()}else this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "top" should be a number'});else this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "top"'})},t}(i.default),z=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppResizeWindow",r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.setWidth=function(e){var t=165;e&&this.app.vkApp&&(e=Math.min(Math.max(e,607),1e3),this.app.vkApp.options.layout_width&&(t=this.app.vkApp.options.layout_width-e),this.app.vkApp.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,607)+t}),cur.app.frame.style.width=cur.app.cont.style.width=e+"px",this.result.width=e)},r.setHeight=function(e){var t=500;if(e){this.app.isTextliveApp&&(t=0),e=Math.min(Math.max(e,t),8050),this.app.vkApp.inlineApp&&e>this.app.vkApp.options.heightMax&&!this.app.vkApp.params.is_vkpay_service&&(e=this.app.vkApp.options.heightMax);var r=e+"px";cur.app.frame.style.height=r,this.app.vkApp.options.boxed||(cur.app.cont.style.height=r),this.app.vkApp.options.layer&&WkView.onResize(),this.app.vkApp.options.onResize&&this.app.vkApp.options.onResize(),this.result.height=e}},r.actionHandler=function(e){Object(_.isMvk)()?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):e.hasOwnProperty("width")&&"number"!=typeof e.width?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "width" should be a number'}):e.hasOwnProperty("height")&&"number"!=typeof e.height?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "height" should be a number'}):e.hasOwnProperty("height")||e.hasOwnProperty("width")?(this.result={},e.hasOwnProperty("width")&&this.setWidth(e.width),e.hasOwnProperty("height")&&this.setHeight(e.height),this.successHandler({result:Object(n.default)({},this.result)})):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:"At least one parameter is required"})},t}(i.default),J=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppSendPayload",r.callApi=!0,r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.handler=function(e,t,r){if(this.setData(e,t),this.callback=r,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},r);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},r)}this.actionHandler(e)}else this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},r);else this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},r)},r.actionHandler=function(e){var t=this;return ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:function(r){try{var a=JSON.parse(r);a.hasOwnProperty("error")?t.errorHandler(a.error,t.callback,d.ERROR_TYPES.API):a.status?t.successHandler(Object(n.default)({},a,{scope:e.scope})):t.errorHandler({reason:"Invalid params"})}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},t}(i.default),Q=/^https:\/\/(?:(?:.*)\.)*vk.com(\/@[a-z0-9_-]+)$/im,X=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenArticle",r.callApi=!1,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.launchUI=function(e){var t=this,r=e.url,n=void 0===r?"":r,a=n.match(Q);if(a&&a[1]){var i=a[1];if(Object(_.isMvk)()){var o=window.location.pathname.substr(1);window.nav.go(i+"?from="+o)}else window.show(boxLoader),window.show(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(i,{onEducationCloseBtnClick:function(e){return t.successReadHandler(e)},onFailCallBack:function(){window.hide(boxLoader),window.hide(boxLayerWrap),t.errorHandler({code:d.ERROR_CODES.UNKNOWN,error_type:d.ERROR_TYPES.CLIENT,reason:"ServerError: Can't open article."})}},(function(){window.hide(boxLoader),window.hide(boxLayerWrap),window.nav.go(i),t.successHandler({result:!0})}))}else this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:"Error: incorrect url: "+n})},r.successReadHandler=function(e){this.callback({type:"VKWebAppArticleClosed",data:e},this.params.handlerName),Object(_.isMvk)()&&cur.app.frame.focus()},t}(i.default),Z=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppUpdateConfig",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){var t={api_host:e.api_host,scheme:e.scheme||d.CLIENT_SCHEME.BRIGHT_LIGHT};e.viewport_width?e.viewport_height?Object(_.isMvk)()?this.successHandler(Object(n.default)({},t),this.callback):this.successHandler(Object(n.default)({},t,{viewport_width:e.viewport_width,viewport_height:e.viewport_height}),this.callback):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_height"'}):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_width"'})},Object(y.default)(t,[{key:"successDescriptor",get:function(){return""+this.params.handlerName}},{key:"errorDescriptor",get:function(){return this.params.handlerName+"Failed"}}]),t}(i.default),$=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppTapticImpactOccurred",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),ee=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppTapticNotificationOccurred",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),te=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppTapticSelectionChanged",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),re=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowImages",r}Object(a.default)(t,e);var r=t.prototype;return r.checkUrlString=function(e){try{return!!new URL(e)}catch(e){return!1}},r.handler=function(e,t,r){var n=this;if(this.setData(e,t),this.callback=r,Object(_.isMvk)()){var a=window.photoview,i=e.start_index,o=e.images;if(this.checkParams(e,[{param:"images",type:"object",isRequired:!0,extraChecks:[{check:function(e){return e.every((function(e){return n.checkUrlString(e)}))},error:function(e){return'Param "'+e+'" should be a valid link.'}},{check:function(e){return e.every((function(e){return e.startsWith("https://")}))},error:function(e){return'Param "'+e+'" should be https link.'}}]},{param:"start_index",type:"number",extraChecks:[{check:function(e){return e>=0},error:function(e){return'Param "'+e+'" should be non-negative number.'}},{check:function(e){return void 0!==o[e]},error:function(e){return'Param "'+e+'" should be a valid index in the pictures array.'}}]}])){var s=i||0,c=o.map((function(e){return{src:e}}));a.open(s,c,{showControls:!1}),this.successHandler({result:!0})}}else this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)},t}(i.default),ne=r("I3vf"),ae=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowLeaderBoardBox",r.callApi=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(t){Object(_.isMvk)()?e.prototype.actionHandler.call(this,t):this.errorHandler({error_type:"client_error",error_code:d.ERROR_CODES.INVALID_PARAMS,reason:"Not supported for this platform"})},r.handleResponse=function(e,t){var r=this;if((e=JSON.parse(e)).hasOwnProperty("error"))this.errorHandler(e.error);else{var a=Object(n.default)({},t,{},e);window.DirectGames.showLeaderBoard({onClose:function(){r.successHandler({result:!0})},board:a})}},t}(i.default),ie=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowInviteBox",r.callApi=!0,r}return Object(a.default)(t,e),t.prototype.actionHandler=function(t){Object(_.isMvk)()?window.DirectGames.showInviteBox({onSuccess:e.prototype.actionHandler.bind(this),onFail:this.errorHandler}):cur.app.funcs.showInviteBox(this.successHandler.bind(this),this.errorHandler.bind(this))},t}(i.default),oe=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenArticleEditor",r.callApi=!1,r.useUI=!0,r.launchUI=r.launchUI.bind(Object(s.default)(r)),r}Object(a.default)(t,e);var r=t.prototype;return r.launchUI=function(e){if(cur.app.params.open_article_edit&&!window.isMvk){var t=e.owner_id,r=e.article_id,n=e.course_id,a="number"==typeof t,i="number"==typeof r,o="number"==typeof n;t&&a?r&&!i?this.errorHandler({code:i?d.ERROR_CODES.MISSING_PARAM:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "article_id" is wrong. Expected integer greater than 0, got type '+typeof r+" with value "+r+"."}):n&&(!o||n<=0)?this.errorHandler({code:o?d.ERROR_CODES.MISSING_PARAM:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "course_id" is wrong. Expected integer greater than 0, got type '+typeof n+" with value "+n+"."}):window.openArticleEditor&&window.openArticleEditor(t,r,null,{course_id:n,is_education:n>0?1:0,app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:a?d.ERROR_CODES.MISSING_PARAM:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "owner_id" is missing or wrong. Expected integer, got type '+typeof t+" with value "+t+"."})}else this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})},r.errorWrapper=function(e){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:e})},t}(i.default),se=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowRequestBox",r.callApi=!0,r}return Object(a.default)(t,e),t.prototype.actionHandler=function(t){var r=this;Object(_.isMvk)()?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:t.uid},{onDone:function(a){try{(a=JSON.parse(a)).hasOwnProperty("error")?r.errorHandler(a.error):(Object.assign(t,a),window.DirectGames.showRequestBox(Object(n.default)({},t,{onSuccess:e.prototype.actionHandler.bind(r),onFail:r.errorHandler})))}catch(e){r.errorHandler(e)}},onFail:function(e){r.errorHandler(e)}}):(cur.app.registerVkBridgeCallback("onRequestFail",(function(e){r.errorHandler(e)})),cur.app.registerVkBridgeCallback("onRequestCancel",(function(){r.errorHandler({reason:"User denied",code:d.ERROR_CODES.USER_DENIED})})),cur.app.registerVkBridgeCallback("onRequestSuccess",(function(){r.successHandler({request_key:t.requestKey,success:!0})})),cur.app.funcs.showRequestBox(t.uid,t.message,t.requestKey))},t}(i.default),ce=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppStorageGetKeys",r.callApi=!0,r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.handler=function(e,t,r){this.setData(e,t),this.callback=r,e.hasOwnProperty("count")&&"number"!=typeof e.count?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "count" should be a number'},r):e.hasOwnProperty("offset")&&"number"!=typeof e.offset?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "offset" should be a number'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e))},r.actionHandler=function(e){var t=this;return ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:function(r){t.handleResponse(r,e,(function(e){return t.successHandler(e)}))},onFail:function(e){t.errorHandler(e)}})},t}(i.default),pe=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppStorageSet",r.callApi=!0,r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.handler=function(e,t,r){this.setData(e,t),this.callback=r,e.key?"string"==typeof e.key?e.hasOwnProperty("value")&&"string"!=typeof e.value?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "value" should be a string'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "key" should be a string'},r):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "key"'},r)},r.actionHandler=function(e){var t=this;return ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:function(r){t.handleResponse(r,e,(function(e){return t.successHandler(e)}))},onFail:function(e){t.errorHandler(e)}})},t}(i.default),le=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppStorageGet",r.callApi=!0,r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.handler=function(e,t,r){this.setData(e,t),this.callback=r,e.keys?"object"==typeof e.keys?e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "keys" should be a string'},r):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "keys"'},r)},r.actionHandler=function(e){var t=this;return ajax.post("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:function(r){t.handleResponse(r,e,(function(e){return t.successHandler(e)}))},onFail:function(e){t.errorHandler(e)}})},t}(i.default),de=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAddToFavorites",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var n=JSON.parse(r);t.checkIntroData(n,e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.checkIntroData=function(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)},r.checkResponse=function(e){Object(_.isMvk)()?this.checkResponseMvk(e):this.checkResponseWeb(e)},r.checkResponseMvk=function(t){!0===t.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu()),e.prototype.checkResponse.call(this,t)},r.checkResponseWeb=function(t){t.result&&t.result.left_nav&&(window.Apps.updateLeftNav(t.result.left_nav),window.Apps.updateAddToMenuAction(),t={result:t.result.success}),e.prototype.checkResponse.call(this,t)},r.handler=function(e,t,r){(Object(H.partConfigEnabled)("mini_apps_web_add_to_favorites")||cur.app.isDirectGame)&&(this.setData(e,t),this.callback=r,this.loadIntroData())},t}(i.default),ue=r("o0o1"),he=r.n(ue),_e=r("HaE+"),me=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppAddToMenu",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_menu"),text:getLang("apps_connect_modal_messages_request_add_to_menu_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(){var e=Object(_e.default)(he.a.mark((function e(t){var r=this;return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1,window.Apps.addToMenuApi(this.app.appId,cur.app.options.hash,1,null,(function(e){r.successHandler({result:Boolean(e&&e.left_nav)})}),(function(e){r.errorHandler(e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.handler=function(e,t,r){var n=this;if(Object(H.partConfigEnabled)("mini_apps_web_add_to_menu")){if(this.setData(e,t),this.callback=r,Object(_.isMvk)())return void this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);window.Apps.isAppInLeftMenu((function(t){t?n.successHandler({result:!0}):n.launchUI(e)}))}},t}(i.default),fe=function(e){function t(t){var r;return(r=e.call(this,t)||this).onFlistHide=function(){r.hasSuccess||r.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User denied"})},r.params.handlerName="VKWebAppGetFriends",r.callApi=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e),cur.onFlistSave=function(){return t.onFlistSave.apply(t,arguments)},cur.onFlistHide=this.onFlistHide,showTabbedBox("apps.php",Object(n.default)({act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[""+this.params.handlerName]+"_hash"],event:d.VK_CONNECT_EVENTS[""+this.params.handlerName],app_id:this.app.appId},this.request),{stat:["ui_controls.js","ui_controls.css"]})},r.onFlistSave=function(e,t){this.hasSuccess=!0;var r={};r.users=t.friends.map((function(e){var t=e[1].split(" ");return{id:e[0],sex:parseInt(e[5],10),last_name:t[1]?t[1]:"",first_name:t[0],photo_200:e[2]}})),this.request.lists&&(r.lists=t.lists.map((function(e){return e[0]})).sort()),this.successHandler(r)},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,Object(_.isMvk)()?this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&(e.hasOwnProperty("lists")&&(e.lists=e.lists?1:0),e.hasOwnProperty("multi")&&(e.multi=e.multi?1:0),this.actionHandler(e))},r.actionHandler=function(e){this.loadIntroData(e)},t}(i.default),be=r("jE6c"),Oe=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppShowCommunityWidgetPreviewBox",r}Object(a.default)(t,e);var r=t.prototype;return r.resetBox=function(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout((function(){delete cur.appWidgetPreviewBox}),3e3)},r.actionHandler=function(e){if(Object(_.isMvk)())this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM});else{if(!this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}]))return;this.showWidgetPreviewBox(e)}},r.showWidgetPreviewBox=function(e){var t=this;if(!cur.appWidgetPreviewBox){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=function(e){t.resetBox(),t.errorHandler(e)},cur.onAppWidgetPreviewCancel=function(){t.resetBox(),t.errorHandler({code:d.ERROR_CODES.USER_DENIED,reason:"User denied"})},cur.onAppWidgetPreviewSuccess=function(){t.resetBox(),t.successHandler({result:!0})};var r=showBox("apps",{act:"app_widget_preview_box",aid:this.app.appId,gid:e.group_id,type:e.type,code:e.code},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:function(){r.setOptions({onHide:function(){Object(be.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:function(e){return~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(be.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0}})}},t}(i.default),Ae=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenInNativeApp",r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=window.browser,r=t.ipad,n=t.iphone,a=t.android;if(Object(_.isMvk)()&&(r||n||a)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM})},r.openInNativeApp=function(e){var t=this;if(this._openAppInProgress)return!1;var r="vk://vk.com/"+e,n=browser.mi?1500:300;browser.safari&&(n=browser.ios>=12?2800:300);var a=Date.now(),i=setTimeout((function(){t._openAppInProgress=!1,Date.now()-a>n+200||!document.hasFocus()?t.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),t.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))}),n);if(window.addEventListener("blur",(function e(){clearTimeout(i),t._openAppInProgress=!1,window.removeEventListener("blur",e)})),browser.ios){window.addEventListener("focus",(function e(){window.removeEventListener("focus",e)}))}return this._openAppInProgress=!0,nav.hard_go(r),!1},t}(i.default),ve=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppLocationChanged",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.successHandler({location:e.location})},Object(y.default)(t,[{key:"successDescriptor",get:function(){return""+this.params.handlerName}}]),t}(i.default),Ee=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppClose",r}Object(a.default)(t,e);var r=t.prototype;return r.closeMiniAppPage=function(){var e=-1,t=window.history.length;if(cur.VKApp){if(2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength)return void nav.go(Object(_.isMvk)()?"/services":"/feed");cur.VKApp.vkMiniAppsHistoryLength!==t&&(e=cur.VKApp.vkMiniAppsHistoryLength-t-1)}e<=1?nav.go(Object(_.isMvk)()?"/services":"/feed"):window.history.go(e)},r.actionHandler=function(e){Object(_.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage():cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),WkView.hide()):this.closeMiniAppPage()},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"status",type:"string",extraChecks:[{check:function(e){return d.CLOSE_STATUS.includes(e)},error:function(e){return'Param "'+e+'" should be "success" or "failed"'}}]},{param:"payload",type:"object",isRequired:!1}])&&this.actionHandler(e)},t}(i.default),Re=r("RHh3"),Se=r("bKAG"),ye=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).params.handlerName="VKWebAppShowStoryBox",t.callApi=!1,t.useUI=!1,t}Object(a.default)(t,e);var r=t.prototype;return r.loadFinishHandler=function(e){this.callback({type:this.loadFinishDescriptor,data:e},this.params.handlerName)},t.isValidUrl=function(e){try{return!!new URL(e)}catch(e){return!1}},r.initStoryPublisher=function(e){var t=this;window.StoryPublisher&&window.StoryPublisher.init(e,(function(){return t.successHandler({result:!0})}),(function(e,r){if(!e){var n={code:d.ERROR_CODES.USER_DENIED};return r&&r.error&&r.error.message&&(n.reason=r.error.message),t.errorHandler(n)}if(r&&r.story){var a=r.story,i=a.owner_id,o=a.id;return t.loadFinishHandler({story_owner_id:i,story_id:o})}}))},Object(y.default)(t,[{key:"loadFinishDescriptor",get:function(){return this.params.handlerName+"LoadFinish"}}]),t}(i.default),Ie=function(e){function t(){return e.apply(this,arguments)||this}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=this;if(!Object(H.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.validateParams(e)&&window.stManager.add([window.jsc("web/story_publisher.js")]).then((function(){t.initStoryPublisher(Object(n.default)({entrypoint:Se.StoryEntryPoint.MINI_APP,miniAppId:Number(t.app.appId),photoUrl:e.url?e.url:e.blob,stickers:e.stickers,attachment:e.attachment},e))})).catch((function(){return t.errorHandler({code:d.ERROR_CODES.UNKNOWN})}))},r.validateParams=function(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&!(e.stickers&&!this.checkAStickers(e.stickers)))},r.checkFields=function(e){return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return"image"===e},error:function(e){return'Param "'+e+'" should be a image'}}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:function(e){return ye.isValidUrl(e)},error:function(e){return'Param "'+e+'" incorrect'}}]},{param:"blob",type:"string",isRequired:!e.url},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:function(e){return Array.isArray(e)},error:function(e){return'Param "'+e+'" should be array'}}]}])},r.checkAttachment=function(e){var t=["url","photo","video","audio"],r=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","write","open","learn_more","view","go_to","contact","watch","play","install","read"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:function(e){return r.includes(e)},error:function(e){return'Param "'+e+'" should be a '+r.join(", ")}}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return t.includes(e)},error:function(e){return'Param "'+e+'" should be a '+t.join(", ")}}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:function(e){return ye.isValidUrl(e)},error:function(e){return'Param "'+e+'" incorrect'}}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))},r.checkAStickers=function(e){var t=this;return!e.length||e.every((function(e){return!!t.checkStickerContainer(e)&&!!t.checkSticker(e.sticker_type,e.sticker)}))},r.checkStickerContainer=function(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return["native","renderable"].includes(e)},error:function(e){return'Param "'+e+'" should be a native or renderable'}}]},{param:"sticker",type:"object",isRequired:!0}])},r.checkSticker=function(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)},r.checkNativeSticker=function(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return["text","sticker"].includes(e)},error:function(e){return'Param "'+e+'" should be a text or sticker'}}]},{param:"action",type:"object",isRequired:!0},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))},r.checkAction=function(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"app"===e?this.checkParams(t,[{param:"app_id",type:"number",isRequired:!0},{param:"app_context",type:"string"}]):(this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1)},r.checkTransform=function(e){var t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:function(e){return t.includes(e)},error:function(e){return'Param "'+e+'" should be '+t.join(", ")}}]}])},r.checkRenderableSticker=function(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return"image"===e},error:function(e){return'Param "'+e+'" should be a image'}}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:function(e){return ye.isValidUrl(e)},error:function(e){return'Param "'+e+'" incorrect'}}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:function(e){return Array.isArray(e)},error:function(e){return'Param "'+e+'" should be array'}}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))},r.checkClickableZones=function(e){var t=this;return e.every((function(r){return!!t.checkClickableZone(r)&&(!!t.checkAction(r.action_type,r.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(t.errorHandler({code:d.ERROR_CODES.UNKNOWN}),!1):e.clickable_area.every((function(e){return t.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}])})))))}))},r.checkClickableZone=function(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return["link","app"].includes(e)},error:function(e){return'Param "'+e+'" should be a link or app'}}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:function(e){return Array.isArray(e)},error:function(e){return'Param "'+e+'" should be array'}}]}])},t}(ye),ke=function(e){function t(){return e.apply(this,arguments)||this}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=this;if(!Object(H.partConfigEnabled)("bridge_mobile_story_box_enabled"))return this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM});var r=this.getEventHashes(),a=r.storyUploadUrlHash,i=r.storySaveHash;this.validateParams(e).then((function(){t.initStoryPublisher(Object(n.default)({entrypoint:Se.StoryEntryPoint.MINI_APP,miniAppId:Number(t.app.appId),miniAppName:t.app.vkApp.options.app_name,storyUploadUrlHash:a,storySaveHash:i,maxVideoDuration:Se.MAX_STORY_VIDEO_DURATION,closeAfterError:!0},e))})).catch((function(e){e&&t.errorHandler(e)}))},r.validateParams=function(e){return this.checkFields(e)},r.checkFields=function(e){var t=this;return new Promise((function(r,n){var a={check:function(e){return ye.isValidUrl(e)},error:function(e){return'Param "'+e+'" incorrect'}};return t.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:function(e){return"image"===e||"video"===e},error:function(e){return'Param "'+e+'" should be a image or video'}}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[a]},{param:"blob",type:"string",isRequired:!e.url,extraChecks:[{check:function(){return"image"===e.background_type},error:function(e){return'Param "'+e+'" available only for image background_type'}},a]}])?r():n()}))},t}(ye),we=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppSubscribeStoryApp",r.callApi=!1,r.useUI=!1,r}Object(a.default)(t,e);var r=t.prototype;return r.actionHandler=function(e){var t=this;if(this.validateParams(e)){var r={act:"subscribe_user_to_app",story_owner_id:e.story_owner_id,story_id:e.story_id,access_key:e.access_key,sticker_id:e.sticker_id,hash:this.getEventHash(),app_id:this.app.appId},n=function(r){t.handleResponse(r,e,(function(e){return t.successHandler(e)}))},a=function(e){t.errorHandler(e)};Object(_.isMvk)()?window.ajax.post("stories.php",r,{onDone:function(e,t){return t?a(t):n(e)}}):window.ajax.post("al_stories.php",r,{onDone:n,onFail:a})}},r.validateParams=function(e){return this.checkParams(e,[{param:"story_owner_id",type:"number",isRequired:!0},{param:"story_id",type:"number",isRequired:!0},{param:"sticker_id",type:"number",isRequired:!0},{access_key:"string",type:"string",isRequired:!1}])},t}(i.default),Ne=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetPersonalCard",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),Te=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenContacts",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),Ce=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppOpenCodeReader",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(){this.errorHandler({code:d.ERROR_CODES.CUSTOM,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)},t}(i.default),Pe=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).params.handlerName="VKWebAppShowSubscriptionBox",t}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){var t=this;Object(_.isMvk)()?this.errorHandler({error_type:d.ERROR_TYPES.CLIENT,error_code:d.ERROR_CODES.INVALID_PARAMS,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM}):e.hasOwnProperty("action")?~["create","resume","cancel"].indexOf(e.action)?"create"!==e.action||e.hasOwnProperty("item")?"resume"!==e.action&&"cancel"!==e.action||e.hasOwnProperty("subscription_id")?(window.cur.app.registerVkBridgeCallback("onSubscriptionCancel",(function(){t.errorHandler({reason:"User denied",code:d.ERROR_CODES.USER_DENIED})})),window.cur.app.registerVkBridgeCallback("onSubscriptionSuccess",(function(e){t.successHandler({success:!0,subscriptionId:e})})),window.cur.app.registerVkBridgeCallback("onSubscriptionFail",(function(e){t.errorHandler({reason:"Subscription error",code:e})})),window.cur.app.funcs.showSubscriptionBox(e.action,e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "subscription_id"'}):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "item"'}):this.errorHandler({code:d.ERROR_CODES.INVALID_PARAMS,reason:'Param "action" must be one of: create, resume or cancel'}):this.errorHandler({code:d.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})},t}(i.default),He=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).params.handlerName="VKWebAppShowInstallPushBox",t}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){var t=this;Object(_.isMvk)()?this.errorHandler({error_type:d.ERROR_TYPES.CLIENT,error_code:d.ERROR_CODES.INVALID_PARAMS,reason:d.ERROR_REASONS.UNSUPPORTED_PLATFORM}):(window.cur.app.registerVkBridgeCallback("onInstallPushSuccess",(function(){t.successHandler({success:!0})})),window.cur.app.registerVkBridgeCallback("onInstallPushCancel",(function(){t.errorHandler({reason:"User denied",code:d.ERROR_CODES.USER_DENIED})})),window.cur.app.registerVkBridgeCallback("onInstallPushFail",(function(e){t.errorHandler({reason:e})})),window.cur.app.funcs.showInstallPushBox(this.successHandler.bind(this),this.errorHandler.bind(this)))},t}(i.default),De=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppGetGroupInfo",r.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_group_info"),text:getLang("apps_connect_modal_messages_request_group_info_text")},r.callApi=!0,r.useUI=!0,r}Object(a.default)(t,e);var r=t.prototype;return r.launchUI=function(e){var t=e.groupPhoto,r=e.groupName;t&&(this.params.modal.pic=t),r&&(this.params.modal.title=this.params.modal.title+" "+r),this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new p.default(Object(n.default)({},this.params.modal)),c.default.push(this.modal)},r.handler=function(e,t,r){this.setData(e,t),this.callback=r,this.validateParams(e)&&this.loadIntroData(e)},r.validateParams=function(e){return this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:function(e){return e>0},error:function(e){return'Param "'+e+'" should be a positive number'}}]}])},r.loadIntroData=function(e){var t=this;this.request=Object(n.default)({},e);var r=e.group_id;ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:d.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,group_id:r},{onDone:function(r){if(r.hasOwnProperty("error"))t.errorHandler(r.error);else try{var n=JSON.parse(r);t.checkIntroData(n,e)}catch(e){t.errorHandler(e)}},onFail:function(e){return t.errorHandler(e),!0}})},r.checkIntroData=function(e,t){if(e.hasOwnProperty("error"))this.errorHandler({code:d.ERROR_CODES.ACCESS_DENIED,reason:d.ERROR_REASONS.USER_NOT_A_PRIVATE_GROUP_MEMBER,error_type:d.ERROR_TYPES.CLIENT});else{if(!e.hasOwnProperty("result"))return this.successHandler(e);var r=e.photo_100,a=e.name;this.launchUI(Object(n.default)({},t,{groupPhoto:r,groupName:a}))}},t}(i.default),Ve=function(e){function t(t){var r;return(r=e.call(this,t)||this).params.handlerName="VKWebAppFlashGetInfo",r}return Object(a.default)(t,e),t.prototype.actionHandler=function(e){this.successHandler({is_available:!1})},t}(i.default),Me={VKWebAppInit:o,VKWebAppGetCommunityAuthToken:u,VKWebAppGetCommunityToken:h,VKWebAppGetFriends:fe,VKWebAppAddToCommunity:m,VKWebAppAddToHomeScreenInfo:f,VKWebAppCopyText:O,VKWebAppAddToFavorites:de,VKWebAppAddToMenu:me,VKWebAppGetUserInfo:A,VKWebAppSetLocation:E,VKWebAppGetClientVersion:R,VKWebAppGetPhoneNumber:S,VKWebAppGetEmail:g,VKWebAppOpenArticle:X,VKWebAppGetGeodata:I,VKWebAppOpenQR:k,VKWebAppSetViewSettings:N,VKWebAppSetTitle:T,VKWebAppGetAuthToken:C,VKWebAppCallAPIMethod:D,VKWebAppJoinGroup:M,VKWebAppLeaveGroup:L,VKWebAppAllowMessagesFromGroup:W,VKWebAppDenyNotifications:j,VKWebAppAllowNotifications:K,VKWebAppOpenPayForm:U,VKWebAppOpenApp:x,VKWebAppShare:G,VKWebAppShowNewPostBox:B,VKWebAppShowWallPostBox:F,VKWebAppSendToClient:w,VKWebAppOpenArticleEditor:oe,VKWebAppScroll:Y,VKWebAppStorageGet:le,VKWebAppStorageGetKeys:ce,VKWebAppStorageSet:pe,VKWebAppResizeWindow:z,VKWebAppSendPayload:J,VKWebAppUpdateConfig:Z,VKWebAppTapticImpactOccurred:$,VKWebAppTapticNotificationOccurred:ee,VKWebAppTapticSelectionChanged:te,VKWebAppShowImages:re,VKWebAppShowOrderBox:ne.default,VKWebAppShowLeaderBoardBox:ae,VKWebAppShowInviteBox:ie,VKWebAppShowRequestBox:se,VKWebAppShowCommunityWidgetPreviewBox:Oe,VKWebAppOpenInNativeApp:Ae,VKWebAppLocationChanged:ve,VKWebAppClose:Ee,VKWebAppShowStoryBox:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object(_.isMvk)()?Object(Re.default)(ke,t):Object(Re.default)(Ie,t)},VKWebAppSubscribeStoryApp:we,VKWebAppGetPersonalCard:Ne,VKWebAppOpenContacts:Te,VKWebAppOpenCodeReader:Ce,VKWebAppShowSubscriptionBox:Pe,VKWebAppShowInstallPushBox:He,VKWebAppGetGroupInfo:De,VKWebAppFlashGetInfo:Ve},Le=function(e,t){var r;if(e.frameId){var a=ge(e.frameId);a&&(r=a.querySelector("iframe"))}else t&&(r=t.querySelector("iframe"));r&&r.contentWindow.postMessage(Object(n.default)({},e),"*")},We=function(e,t){if(Me[e.handler]){var r=new Me[e.handler]({request_id:e.params.request_id}),a=function(e){ge(t.containerId)&&e&&Le(e,ge(t.containerId))};if(Object(H.partConfigEnabled)("mini_apps_web_flood_control")){if(t.isRequestsLimitReached())return r.callback=a,void r.errorHandler({code:d.ERROR_CODES.REQUESTS_LIMIT_REACHED});t.eventQueue.push({eventData:e,timeInMs:Date.now()})}r.handler(Object(n.default)({},e.params,{containerId:t.containerId,pic:e.pic}),t,a)}}}}]);