(window.webpackJsonp=window.webpackJsonp||[]).push([["common"],{"+YbT":function(e,t){var n={obj:null,highlight:!1,start:function(e){e.touches&&1==e.touches.length&&(n.clear(),n.end(e),n.obj=this||null,n.obj&&(n.highlight=!0,addClass("hover",n.obj),addClass("_thover",n.obj)))},cancel:function(e){n.obj&&(n.highlight=!1,n.end(e))},end:function(){n.obj&&(removeClass("hover",n.obj),n.highlight&&(n.clear(),addClass("active",n.obj)),n.obj=null,n.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=n},"/8IX":function(e,t){function n(e,t){if(!e)throw new Error(t||"AssertionError")}n.notEqual=function(e,t,i){n(e!=t,i)},n.notOk=function(e,t){n(!e,t)},n.equal=function(e,t,i){n(e==t,i)},n.ok=n,e.exports=n},"/Id8":function(e,t,n){"use strict";n.r(t),n.d(t,"Msg__restoreInner",(function(){return D})),n.d(t,"Msg__reply",(function(){return U})),n.d(t,"Msg__authorName",(function(){return G})),n.d(t,"Msg__replyAttach",(function(){return q})),n.d(t,"Msg__replyLink",(function(){return z})),n.d(t,"Msg__textPreview",(function(){return F})),n.d(t,"Msg__attachPreview",(function(){return $})),n.d(t,"Msg_makeReplyLink",(function(){return H})),n.d(t,"Msg_makePinnedReplyLink",(function(){return N})),n.d(t,"Msg_detailed",(function(){return B}));var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("9y81"),s=n("KMpi"),l=n("u33z"),c=n("B+U2"),u=n("BoyB"),d=n("A6le"),_=n("SNk7"),f=n("Y6JH"),p=n("fdw3");function h(){var e=Object(i.default)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return g=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return A=function(){return e},e}function b(){var e=Object(i.default)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return w=function(){return e},e}function S(){var e=Object(i.default)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return S=function(){return e},e}function k(){var e=Object(i.default)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return k=function(){return e},e}function O(){var e=Object(i.default)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return O=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return C=function(){return e},e}function j(){var e=Object(i.default)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n    </div>\n  "]);return j=function(){return e},e}function E(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return E=function(){return e},e}function T(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return T=function(){return e},e}function I(){var e=Object(i.default)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return I=function(){return e},e}function M(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n    </div>\n  "]);return M=function(){return e},e}function P(){var e=Object(i.default)(['\n      <div class="','" ',">\n        ","\n      </div>\n    "]);return P=function(){return e},e}var x=function(e){var t=e.id,n=e.removed,i=e.isExpired,c=i||e.service,u=function(e){var t=window.lang,n=e.isDefaultCasperTimerShown;if(e.service)return e.text;var i,c=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),u=Object(r.default)({mix:"msg__check",icon:"check"}),_=o.default.html({class:"msg__star"}),h=!!e.attaches.gift,m=store.mail.msgs[e.id];m&&m.authorId===m.peerId&&(i=store.mail.peers[m.peerId]);var v=e.admin?(M=e.admin,a.default.html(k(),M.url,M.name)):"",g=e.removed?D(e.id):"",A=e.edited?R():"",b=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",y=e.pending?o.default.html({inner:[Object(f.default)({sprite:"mail",name:"recent_16"})],class:"msg__pending",tag:"div"}):"",w=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",S=e.channel?function(e){var t=Object(l.default)({class:"msg__actionForward",onClick:a.default.onClick("Msg._onActionClick","event","forward",e)});return a.default.html(O(),t)}(e.id):"",C=h&&i?'<div class="msg__giftHead">'+langSex(i.sex,t.mobile_mail_sent_gift)+"</div>":"",j=Object(p.timestamp)(),T=null;var M;e.ttl&&(T=Math.round(e.ts+e.ttl-j));var P,x=T?o.default.render(Object(d.default)({durationInSeconds:T,isDefaultCasperTimerShown:n})):"";P=h?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return a.default.html(E(),n,t)}(e):L(e);var B=e.keyboard?Y(e):"";return a.default.html(I(),c,e.authorUrl,e.authorName,C,b,y,w,A,v,x,u,_,S,P,B,g)}(e),h=!c&&!(!e.attaches||!e.attaches.gift),m=a.default.class("msg",{id:t,service:c,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:h}),v="";c||(v=e.pending||e.failed?a.default.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):a.default.onClick("Msg._onClick","event","this",t));if(i){var g=o.default.render(Object(_.default)());return a.default.html(P(),m,v,g)}return a.default.html(M(),m,v,u)};function L(e){var t,n,i=window.lang,o=e.text,r=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,o,r,s){void 0===i&&(i=""),void 0===o&&(o=!0),void 0===r&&(r=""),void 0===s&&(s="");var l=Date.now(),c=Math.random(),u=""+l+c,d="msg__sticker",_="";s&&(d+=" sticker_animation",_='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var f=a.default.onClick("Msg._onStickerClick","event","this",o,i);return a.default.html(m(),d,r,f,_,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=a.default.html(v(),n)):K(e)&&Object.keys(e.attaches).length&&(r+=1,t=W($(e),!e.failed&&1===r));var l,c=e.forwards;c.length&&(K(e)&&Q(c)?(r+=1,l=W(langNumeric(c.length,i.mobile_mail_N_forwards),!e.failed&&1===r)):l=(l=c.map((function(t){return function e(t,n,i){var o=window.lang,r=store.mail,l=r.forwards[t]||r.msgs[t];if(!l)return"";var c,u=r.members[l.authorId],d=l.peerId,_=(r.peers[d],G(u,d,r.cur.userId)),f=l.edited,p=u.avatar,h=u.url,m=_,v=l.date,g=l.text,A=l.attachesHTML,b=l.forwards,y=l.reply,w=Object(s.default)({mix:"mi_author_photo",photos:[p],size:36}),S=f?R():"";if(i>0){for(var k=[],O=b.length,j=0;j<O;j++){var E=e(b[j],n,i-1);k.push(E)}c=k.join("")}else if(b.length){var T=langNumeric(b.length,o.mobile_mail_N_forwards);c='<a href="/mail?act=msg&id='+n+'" class="msg__fwdsLink">'+T+"</a>"}A&&(A='<div class="mi_medias">'+(A=A.replace(/%top_msg_id%/g,n))+"</div>");c&&(c='<div class="mi_forwarded">'+c+"</div>");g&&(g='<div class="mi_text">'+g+"</div>");var I=y?V(y,n,{}):"",M=l.attaches.gift?" msg__forwardGift":"";return a.default.html(C(),M,w,h,m,v,S,I,g,A,c)}(t,e.id,e.maxDepth-1)}))).join(""));var u,d=e.reply;d&&(K(e)&&(Q([d])||!function(e){var t=store.mail;return Object(p.isForwardedMessageId)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(d))?(r+=1,u=W(i.mobile_mail_in_reply_to,!e.failed&&1===r)):u=V(d,e.id,{isPinned:e.isPinned,chatId:e.chatId}));return t&&(t='<div class="mi_medias">'+t+"</div>"),l&&(l='<div class="mi_forwarded">'+l+"</div>"),o&&(o='<div class="mi_text">'+o+"</div>"),a.default.html(T(),u,o,t,l)}function B(e){var t=L(e),n=e.keyboard?Y(e):"",i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),o=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],a=n.peers[i.peerId],o="";if(Object(p.isChatPeer)(i.peerId)){var r='<a href="'+Object(p.wrapCommunityMailUrl)("/mail?act=show&peer="+i.peerId)+'">'+a.title+"</a>";o=t.mobile_mail_message_to_chat.replace("{chat}",r)}return o}(e);return a.default.html(j(),i,e.authorUrl,e.authorName,o,e.date,t,n)}function R(){var e=window.lang;return a.default.html(S(),e.mobile_mail_edited_short)}function D(e){var t=window.lang,n=a.default.onClick("Msg._onRestoreClick","event",e);return a.default.html(w(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function N(e,t){var n="/mail?act=msg";return n=Object(p.concatValues)(n,"&id=pinned&chat="+e),t&&(n=Object(p.concatValues)(n,"&replyId="+t+"&reply=true")),Object(p.wrapCommunityMailUrl)(n)}function H(e,t,n){var i="/mail?act=msg";return t?(i=Object(p.concatValues)(i,"&id="+t+"&reply=true"),n&&(i=Object(p.concatValues)(i,"&reply_id="+n))):i=Object(p.concatValues)(i,"&id="+e),Object(p.wrapCommunityMailUrl)(i)}function V(e,t,n){var i=store.mail.forwards[e]||store.mail.msgs[e],a=store.mail.replies[e]||store.mail.pendingReplies[e];return z(U(i,G(store.mail.members[i.authorId],i.peerId,store.mail.cur.userId),a.preview_url),a.msg_id,t,e,n)}function U(e,t,n){var i="";i=e.isExpired?'<span class="msg__replyDisappeared">'+Object(p.getLang)("mobile_casper_chat_message_disappeared")+"</span>":e.body?F(e.body):q(e);var o="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(o=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),a.default.html(y(),o,t,e.date,i)}function F(e){return e=e.replace(/<br>/g,"\n"),e=Object(p.mailReplaceDomainMentions)(e,"@$3"),e=Object(p.mailReplaceMentions)(e,"$3"),e=Object(p.emojiToHTML)(e)}function $(e){var t,n=window.lang,i=Object.keys(e.attaches),a=i.length;if(a>1){for(var o=0,r=i.length,s=0;s<r;s++)o+=0|e.attaches[i[s]];t=langNumeric(o,n.mobile_mail_attachments)}else if(1===a){var l=i[0],c=e.attaches[l];if(1===c)switch(l){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"artist":t=n.mobile_mail_added_artist;break;case"curator":t=n.mobile_mail_added_curator;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":case"group_call_in_progress":t=n.mobile_mail_added_call}else if(c>1)switch(l){case"photo":t=langNumeric(c,n.mobile_mail_added_photos);break;case"video":t=langNumeric(c,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(c,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(c,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function W(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=Object(u.default)({large:!0}))+"</div>"),a.default.html(b(),e,n)}function q(e){var t=$(e);return a.default.html(A(),t)}function z(e,t,n,i,o){var r="";r=o.isPinned&&o.chatId?N(o.chatId,i):H(t,n,i);var s=a.default.onClick("Msg._onReplyClick","event",t,n,i);return a.default.html(g(),r,s,e)}function Y(e){var t=function(e){var t=window.store;if(!t.mail||!t.mail.cur||!t.mail.cur.pressedButtons)return{};return t.mail.cur.pressedButtons.msgs[e]}(e.id),n=o.default.render(Object(c.default)({msgId:e.id,pressed:t,keyboard:e.keyboard}));return a.default.html(h(),n)}function G(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function Q(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,a=e.length,o=0;o<a;o++){var r=e[o];if(Object(p.isForwardedMessageId)(r)){var s=i[r];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var l=t[r];if(!l)return!0;if(!l.authorId||!n[l.authorId])return!0}}return!1}function K(e){return e.pending||e.failed||e.waiting}var X=n("UxAg"),J=n("+cqQ"),Z=n("Gzds"),ee=n("OcsD"),te=need("Voting");Object.assign(x,{class:"msg",onClick:Object(J.default)(),onPendingClick:Object(J.default)(),onRestoreClick:Object(J.default)(),onReplyClick:Object(J.default)(),onForward:Object(J.default)(),onLoadAgain:Object(J.default)(),getElem:function(e){return Object(X.$)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?Object(X.$$)(".msg_id_"+e).forEach((function(e){return e.remove()})):se(e,!1)},spam:function(e){se(e,!0)},restore:function(e){Object(X.$$)(".msg_id_"+e).forEach((function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")}))},unselectAll:function(){Object(X.$$)(".msg_selected").forEach((function(e){return e.classList.remove("msg_selected")}))},getReplyDataFromHTML:function(e){var t=e&&x.getElem(e),n="";if(t){var i=Object(X.$)(".thumbs_map .thumb_map_img_as_div",t);return(n=i&&i.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach((function(e){var n=Object(X.$)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)}))},markAsRead:function(e){Object(X.$$)(".msg_id_"+e).forEach((function(e){return e.classList.remove("msg_unread")}))},getId:function(e){var t=a.default.parseClass(ie,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(ae).innerHTML}}),x._onClick=le,x._onPendingClick=ce,x._onTouchStart=de,x._onRestoreClick=re,x._onActionClick=_e,x._onReplyClick=pe,x._onStickerClick=he,x.onStickerTouchStart=me;var ne,ie="msg",ae=".msg__text",oe=!1;function re(e,t){e.stopPropagation(),t=parseInt(t,10),x.onRestoreClick(t)}function se(e,t){void 0===t&&(t=!1);var n=D(e);Object(X.$$)(".msg_id_"+e).forEach((function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)}))}function le(e,t,n){ue(e.target,t,(function(){t.classList.toggle("msg_selected"),x.onClick(n)}))}function ce(e,t,n,i,a){ue(e.target,t,(function(){x.onPendingClick(n,i,a)}))}function ue(e,t,n){for(var i=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(i&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+te.cls))return;e=e.parentElement}oe?oe=!1:fe()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||n()}function de(){fe()&&(oe=!0)}function _e(e,t,n){switch(t){case"forward":x.onForward(n)}}function fe(){return window.getSelection().toString().length>0}function pe(e,t,n,i){e.preventDefault(),x.onReplyClick(t,n,i)}function he(e,t,n,i){n&&(e.preventDefault(),i&&Z.default.stickersClick(t,i))}function me(e,t){if(clearTimeout(ne),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;Object(ee.addEvent)(t,"contextmenu",ve),Object(ee.addEvent)(t,"touchmove",a,{passive:!0}),Object(ee.addEvent)(t,"touchend",o,{passive:!0}),Object(ee.addEvent)(t,"touchcancel",o,{passive:!0}),ne=setTimeout((function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),o()}),500)}function a(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&o()}function o(){clearTimeout(ne),Object(ee.removeEvent)(t,"contextmenu",ve),Object(ee.removeEvent)(t,"touchmove",a,{passive:!0}),Object(ee.removeEvent)(t,"touchend",o,{passive:!0}),Object(ee.removeEvent)(t,"touchcancel",o,{passive:!0})}}function ve(e){event.preventDefault(),event.stopPropagation()}t.default=x;window.Msg=x},"03kU":function(e,t,n){"use strict";n.r(t);var i=n("OmnB"),a=n.n(i),o=n("jE6c"),r=100,s=101,l=102,c=103,u=105,d=106,_=107,f=108,p=109,h=110,m=112,v=113,g=[s,c,l,d,_,f,p,h],A="click_on_video",b="click_on_audio",y="click_on_photo",w="external_link_click",S="click_on_carousel_next",k="click_on_carousel_prev",O="click_on_mentions",C="night_mod_on",j="night_mod_off",E="close";function T(e,t,n){var i=[];if(Object(o.each)(e,(function(e,t){n&&!["w","z","y","x","m","s"].includes(e)||i.push(t)})),!i.length)return[!1];i.sort((function(e,t){return e[1]-t[1]})),t*=window.devicePixelRatio>=2?2:1;var a=i[i.length-1];return Object(o.each)(i,(function(e,n){if(n[1]>=t)return a=n,!1})),a}var I={};function M(e,t){if(Object(o.isObject)(t)&&!Object(o.isEmpty)(t)){var n="https://vk-callback.go.mail.ru/longread_pxl?action="+e;Object(o.each)(t,(function(e,t){n+="&"+e+"="+t})),(new Image).src=n}}function P(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function x(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,n=document.getElementsByTagName("iframe"),i=n.length-1;i>=0;i--){var a=n[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout((function(){if("MEASURE"===e.type){var n=e.details.height;t.setAttribute("height",n)}}),100)}}}function L(e,t){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes"));(domData(n,"media-links")||"").split(",");if(!(i.length<=1||domData(e,"carousel-inited"))){if(domData(e,"carousel-inited",1),t.mobile)return function(e,t,n){void 0===n&&(n={});var i,a,r,s=geByClass1("article_photo_carousel__controls",t),l=geByClass1("article_photo_carousel__counter",t),c=domData(l,"counter-lang")||getLang("global_article_carousel_counter"),u=getSize(geByClass1("article_figure_content",t)),d=geByClass1("article_photo_carousel_inner",t),_=n.onClick,f=0,p=0,h=!1,m=0,v=0,g=!1,A=!1;s.addEventListener("touchstart",(function(e){a=e.touches[0].pageX,i=e.touches[0].pageY,addClass(d,"--no_trans"),h=!0,clearTimeout(r)}));var b,y=!1;function w(n,i,a,s,p){if(void 0===s&&(s=!1),void 0===p&&(p=!0),!i||!h){if(h=!0,i)return d.style.transform="translateX(-50px)",void(r=setTimeout((function(){d.style.transform="translateX(0px)"}),700));clearTimeout(r),f=void 0===f?Math.min(e.length-1,Math.max(0,f+n)):a,s&&Object(o.isFunction)(_)&&v!==f&&_(v<f?S:k),domData(t,"photo-carousel-index",f),B(f,t),l.innerHTML=c.replace("{counter}",f+1).replace("{total}",e.length),p||addClass(d,"--no_trans"),d.style.transform="translateX(-"+f*u[0]+"px)",p||(d.offsetWidth,removeClass(d,"--no_trans"))}}return s.addEventListener("touchmove",(function(t){if(A||!(Math.abs(t.touches[0].pageY-i)>5||g)){if(p=t.touches[0].pageX-a,!(Math.abs(p)<10)||y){A||window.addEventListener("touchmove",b=function(e){return cancelEvent(e)},{passive:!1}),A=!0,y=!0;var n=Math.min(e.length-1,Math.max(0,f+(p<0?1:-1))),o=0===n&&0===f,r=n===e.length-1&&f===e.length-1;m=n;var s=-f*u[0];s+=o||r?.2*p:p,d.style.transform="translateX("+s+"px)"}}else g=!0})),s.addEventListener("touchend",(function(){y=!1,g=!1,A=!1,v=f,removeClass(d,"--no_trans"),b&&window.removeEventListener("touchmove",b),Math.abs(p)<50||(f=m),w(0,!1,m,!0)})),function(e,t,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0),t||(m=n),v=f,w(e,t,n,i,a)}}(i,e,t);var a=function(e,t,n,i){var a,o=0,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=geByClass1("article_photo_carousel__left",t),_=geByClass1("article_photo_carousel__right",t),f=n.onClick,p=!1;function h(n,i){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(a=setTimeout((function(){u.style.transform="translateX(0px)"}),700));clearTimeout(a),o=Math.min(e.length-1,Math.max(0,o+n)),u.style.transform="translateX(-"+o*c[0]+"px)",s.innerHTML=l.replace("{counter}",o+1).replace("{total}",e.length),toggle(d,o>0),toggle(_,o<e.length-1),domData(t,"photo-carousel-index",o),B(o,t)}}return _.addEventListener("click",(function(e){return h(1),f&&f(S),cancelEvent(e)})),d.addEventListener("click",(function(e){return h(-1),f&&f(k),cancelEvent(e)})),t.addEventListener("mousemove",(function(){r.style.opacity=1})),t.addEventListener("mouseleave",(function(){r.style.opacity=0})),h}(i,e,t);return window.data(e,"changePhotoFunction",a),a}}function B(e,t){var n=geByTag1("figcaption",t),i=[];n&&((i=domData(n,"captions"))&&(i=JSON.parse(i)),n.innerHTML=i[e]||"")}var R,D,N=n("lkNA"),H={};window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;var V,U=function(){function e(e,t,n){var i=this;this._handleClick=function(e){if(e.target.href)try{var t=new URL(e.target.href);window.location.pathname===t.pathname&&t.search.match(/\?|&anchor=/)&&(e.preventDefault(),i.scrollToAnchor(null,t.search),window.history.replaceState({},document.title,""+t.pathname+t.search))}catch(e){console.error(e)}},this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._els={view:ge("article_view_"+e.raw_id)},window.cur&&cur.destroy&&cur.destroy.push((function(){i.deinit()})),n&&this.ready()}var t=e.prototype;return t.getEl=function(){return this._els.view},t.getArticle=function(){return this._article},t.getScrollNode=function(){return this._options.getScrollNode?this._options.getScrollNode():document},t._getScrollTop=function(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop},t.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.changeCarouselPosition=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var a=H[e];Object(o.isFunction)(a)&&a(0,!1,t,n,i)},t.deinit=function(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),document.removeEventListener("click",this._handleClick),clearTimeout(this._readTO)},t._onViewScroll=function(){var e=this,t=scrollGetY(),n=window.innerHeight;Object(o.each)(geByTag("figure",this._els.view),(function(i,a){var r=Object(o.intval)(domData(a,"done"));if(!r){var s=getH(a),l=getXY(a)[1],c=Object(o.intval)(domData(a,"type")),u=101==c?-200:100,d=l<=t+n-u&&t+u<=l+s;(r=e._onObjectView(d,c,a))&&domData(a,"done",1)}})),Object(o.each)(geByTag("figure",this._els.view),(function(i,a){var r,s=getH(a),l=getXY(a)[1],c=Object(o.intval)(domData(a,"type")),u=l,d=l+s,_=t,f=t+n;if(u>f||_>d)r=!1;else{var p=Math.max(u,_);r=(Math.min(d,f)-p)/s>.7}e._onObjectPartialView(r,c,a)}))},t._initObjects=function(){var e=this;this._initedObjects=this._initedObjects||{},Object(o.each)(geByClass("_article_unmute_button",this._els.view),(function(t,n){e._initedObjects[t]||(e._initedObjects[t]=!0,n.addEventListener("click",(function(){var e=n.parentNode,t=geByTag1("video",e);t.muted=!t.muted,toggleClass(e,"article_object_unmuted",!t.muted)})))})),Object(o.each)(geByTag("figure",this._els.view),(function(t,n){if(!e._initedObjects[t])switch(e._initedObjects[t]=!0,parseInt(domData(n,"type"))){case s:var i=L(n,{mobile:e._options.mobile,moderDeletePhoto:e._options.moderDeletePhoto,onClick:function(t){e.sendStats({type:t})}});if(e._initPhoto(n),i){var a=window._articleCarouselGlobalId++;n.setAttribute("data-carousel-id",a),H[a]=i}break;case u:case r:geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:b})}),!0);break;case m:case v:break;case c:case l:if(e._options.mobile){var o=geByTag1("video",n);o&&(o.addEventListener("play",(function(){e.sendStats({type:A})})),o.addEventListener("pause",(function(){e.sendStats({type:A})})))}else{geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:A})}),!0)}}})),this._els.view&&this._els.view.addEventListener("click",(function(t){var n=t.target;if(matchesSelector(n,'a[href^="/away"]')){var i=decodeURIComponent(unescape(n.href)).split("vk.com/away.php?to=")[1];i&&e.sendStats({type:w,domain:encodeURIComponent(e._getUrlDomain(i))})}}))},t._initPhoto=function(e){var t=this;geByClass1("article_figure_content",e).addEventListener("click",(function(){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes")),a=Object(o.intval)(domData(e,"photo-carousel-index"));t._options.onImageOpen&&t._options.onImageOpen.call(t,i,e,a),t.sendStats({type:y})}))},t._initStats=function(){if(this._statsInited)this._scrollStatEvent&&this._scrollStatEvent();else{this._statsInited=!0,this._openTime=Date.now();var e,t=-1,n=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);var i=this;this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){var o=i.getCurrentScrollRatio();if(!(o<0)){var r=1;o>=.95?r=4:o>.66?r=3:o>.33&&(r=2),function(o){if(i._isReady&&(i._article.has_more&&(o=Math.min(o,1)),!(t>=o))){for(var r=t+1;r<=o;r++)n.push(r);if(t=o,clearTimeout(e),e=setTimeout(a,300),3==o&&i._article.ttr){var s=i._article.ttr-i.getTimeSpent();s>0&&(i._readTO=setTimeout((function(){if(!document.hidden){var e=i.getCurrentScrollRatio();if(!(e<0||e>1.3)){var o=4==t;n=[t=4],a(o)}}}),1e3*s))}}}(r),4!=r||i._article.has_more||(i.getScrollNode().removeEventListener("scroll",i._scrollStatEvent),i._scrollStatEvent=!1)}},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}function a(e){if(n.length){var t=i._article,a=i._options,r="";if(t.ref)r=t.ref;else if(window.cur){if("feed"===(r=window.cur.module)&&cur.articlePrevLoc&&!a.mobile)"search"===nav.fromStr(cur.articlePrevLoc).section&&(r="feed_search")}var s={act:"stats",scroll:n.join(","),spent:i.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:a.isWebView?1:0,post_id:a.sourcePostId,is_widget:a.isWidget,is_delayed_scroll_4:Object(o.intval)(e),track_code:a.trackCode,ref:r};ajax.post(a.mobile?"article.php":"al_articles.php",s),t.mailru_stats_data&&n.forEach((function(e){M("scroll_"+e,t.mailru_stats_data)})),n=[]}}},t._initGoogleAnalytics=function(){var e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{var t=document.createElement("script");t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+e),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}},t._onObjectPartialView=function(e,t,n){if(t==s){var i=domQuery1("[data-sizes]",n);if(JSON.parse(domData(i,"sizes")).length>1){var a=n.getAttribute("data-carousel-id");e?D!=a&&(clearTimeout(R),R=setTimeout((function(){var e=H[a];e&&e(1,!0)}),400),D=a):a==D&&(D=-1,clearTimeout(R))}}},t._onObjectView=function(e,t,n){var i=!1;switch(t){case s:if(e){var a=geByTag1("img",n),r=getW(a)||this._options.width,l=domQuery1("[data-sizes]",n),u=JSON.parse(domData(l,"sizes")),m=geByTag("img",n);u.forEach((function(e,t){var n=T(u[t],r,!0)[0];!function(e,t){if(!0===I[e])return t&&t(),!0;if(Array.isArray(I[e]))return I[e].push(t),!1;I[e]=[t];var n=new Image;n.onload=function(){var t=I[e];I[e]=!0,Object(o.each)(t,(function(e,t){t&&t()}))},n.src=e}(n,(function(){var e=m[t];removeClass(e,"article_object_photo__image_blur"),e.src=n}))})),i=!0}break;case c:if(!this._options.mobile){var v=geByTag1("video",n);if(v)if(e){if(v.hasAttribute("autoplay")){var g=v.play();g&&g.catch((function(){}))}}else v.pause();else i=!0}break;case d:case _:case f:case p:case h:this.initEmbed(t,n),i=!0}return i},t.initEmbed=function(e,t){var n=this;switch(e){case d:var i=domQuery1("[data-tweet-id]",t),a=domData(i,"tweet-id");Object(N.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){window.twttr.widgets.createTweet(a,i,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case _:var o=window.vk&&0==window.vk.lang?"ru_RU":"en_US";Object(N.loadScript)("https://connect.facebook.net/"+o+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){window.FB.XFBML.parse()}});break;case f:Object(N.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){window.instgrm.Embeds.process(),addEvent(window,"message",x)}});break;case p:var r=domQuery1("[data-raw-id]",t),s=domData(r,"raw-id"),l=domData(r,"index"),c=s.split(";"),u=c[0],m=c[1];Object(N.loadScript)("/js/api/openapi.js",{onLoad:function(){ajax.post("dev.php",{act:"a_get_post_hash",post:u+"_"+m},{onDone:function(e){e&&window.VK&&window.VK.Widgets&&window.VK.Widgets.Post("vk_post_"+s+"_"+l,u,m,e,{from:n._options.isWebView?"article_webview":""})}})}});break;case h:Object(N.loadScript)("https://telegram.org/js/telegram-widget.js?5",{})}},t.getCurrentScrollRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e},t.getScreenVisibilityRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1],n=this._getScrollTop(),i=window.innerHeight,a=t,o=t+e,r=n,s=n+i;if(r>o||a>s)return 0;var l=Math.max(a,r);return(Math.min(o,s)-l)/i},t.update=function(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())},t.ready=function(){var e=this;(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),setTimeout((function(){var t=P("anchor");if(t){e._options.isWebView||e.scrollToAnchor(t);var n=e.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body),n.click&&n.click(),n.focus()}}),0),!this._options.mobile&&window.AudioPlaylist)&&(this._article.audios_list&&this._article.audios_list.length>0&&new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list}));this.getScrollNode().addEventListener("scroll",this._scrollEvent=function(){e._onViewScroll(),e._options.onScroll&&e._options.onScroll.call(e,e.getCurrentScrollRatio())}),document.addEventListener("click",this._handleClick),setTimeout((function(){e._scrollEvent()}),this._options.objectsInitDelay||0)},t.scrollToAnchor=function(e,t){e=e||P("anchor",t);var n=this._options,i=this.getScrollNode();i===document&&(i=document.scrollingElement||window.scrollNode||document.body);e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var a=n.isWebView?0:25,o=t.parentNode.offsetTop-a;window.setTimeout((function(){i.scrollTo?i.scrollTo(0,o):i.scrollTop=o}),10)}}()},t.sendStats=function(e){var t=this._article,n=this._options,i={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:n.isWebView?1:0};Object.assign(i,e),ajax.post(n.mobile?"article.php":"al_articles.php",i)},t._getUrlDomain=function(e){var t=document.createElement("a");return t.href=e,t.hostname},e}(),F=[],$=!1,W=function(){function e(){}return e.init=function(e,t,n){if(void 0===n&&(n={}),$=n.mobile||n.isWebView,t&&e.ads&&!isEmpty(e.ads)&&!(e.has_more||isArray(e.ads)&&0==e.ads.length)){var i=ce("ins");addClass(i,"mrg-tag"),addClass(i,"article_adsblock"),n.mobile&&addClass(i,"article_adsblock_mobile"),setStyle(i,{display:"block","text-decoration":"none"});var a="";for(var o in n.deviceInfo)n.deviceInfo.hasOwnProperty(o)&&(a+="&"+o+"="+n.deviceInfo[o]);for(var r in e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",a),e.ads.data)e.ads.data.hasOwnProperty(r)&&domData(i,r,""+e.ads.data[r]);t.appendChild(i),window.MRGtag||(window.MRGtag=[]);var s=n.isWebView?{iframeMode:!0}:{},l=e.ads.eventsHash;if(q(e,n,"requested",l),s.onNoAds=function(){q(e,n,"no_ads",l)},s.onAdsLoaded=function(){q(e,n,"ads_loaded",l)},s.onAdsClosed=function(){q(e,n,"ads_closed",l)},s.onAdsSuccess=function(){q(e,n,"ads_success",l)},s.onAdsClicked=function(){q(e,n,"ads_clicked",l)},s.onScriptError=function(){q(e,n,"script_error",l)},window.MRGtagOnAdsImpression=function(){q(e,n,"ads_impression",l)},window.MRGtag.push(s),!window.mailRuSdsScriptLoaded){var c=document.createElement("script");c.setAttribute("src",e.ads.script),c.setAttribute("async","true"),document.head.appendChild(c),window.mailRuSdsScriptLoaded=!0}}},e.wasShown=function(){return!1},e}();function q(e,t,n,i){F.push(n+"/"+e.owner_id+"_"+e.id+"/"+i),clearTimeout(V),V=setTimeout((function(){var e=$?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:F.join(","),is_web_view:intval(t.isWebView)}),F=[]}),200)}var z,Y,G,Q,K,X,J=n("aJgW");window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var Z,ee,te,ne=!1,ie=[],ae=[],oe=1,re=2,se={},le={};function ue(e,t){e=e.split("_");for(var n=0;n<t.length;n++){var i=t[n].split("_");if(i[0]==e[0]&&i[1]==e[1])return n}return-1}function de(){return document}function _e(){return(document.scrollingElement||window.scrollNode||document.body).scrollTop}function fe(e){return domQuery('.articleView__social_buttons[data-article-id="'+e+'"] .articleView__footer_btn_bookmark')}function pe(e){if(X!=e.raw_id)if(X=e.raw_id,Y.isWebView)!function(e){a.a.send("articleUpdate",{article:Se(e),isSubscribedToOwner:e.is_subscribed_to_owner})}(e);else{var t=geByClass1("articleView__owner"),n=geByTag1("img",t);t&&n&&(n.src=e.owner_photo);var i=geByTag1("a",t);t&&i&&(i.href=e.owner_href);var r=geByClass1("articleView__ownerName"),s=geByTag1("a",r);r&&s&&(s.href=e.owner_href,s.innerHTML=e.owner_name);var l=geByClass1("articleView__footer"),c=geByClass1("articleView__footer_views");c&&(c.innerHTML=e.views_formatted);var u=geByClass1("articleView__social_buttons",l);l&&u&&!e.is_blog&&u.setAttribute("data-article-id",e.raw_id);var d=[domQuery1('.articleView__content_misc_block[data-article-id="'+e.raw_id+'"] .articleView__footer_btn_share'),l&&domQuery1(".articleView__footer_btn_share",l)];Object(o.each)(d,(function(t,n){n&&!e.is_blog&&(n.href="/like?act=publish&object=article"+e.raw_id+"&list="+e.access_hash)}));var _=fe(e.raw_id),f=JSON.stringify(e.mailru_stats_data);Object(o.each)(_,(function(t,n){n&&(n.setAttribute("onclick","Article.fave(this, '"+e.url+"', '"+e.fave_hash+"', "+f+", '"+e.raw_id+"')"),toggleClass(n,"_active",e.is_faved))}));var p=geByClass1("Unfold__item_name_noted");p&&(p.href="/feed?section=search&q=url:https://vk.com"+e.url);var h=geByClass1("Unfold__item_name_report");h&&(h.href="/reports?act=add&object=article"+e.raw_id+"_"+e.access_hash+"&refrom=feed")}}function he(e,t){void 0===t&&(t=!1),e.has_more||(ie=ie.concat(e.audios_list));var n=new U(e,{notFull:!!Y.preloadMoreHash,isWebView:Y.isWebView,mobile:!0,width:Y.width,getScrollTop:_e,getScrollNode:de,trackCode:Y.trackCode,onScroll:function(t){if(!e.has_more){var n=ae[ae.length-1],i=gpeByClass("articleView__content",n.getEl());t>.6&&e.next_article_url&&(ae.length<20&&(ve(e.next_article_url),addClass(i,"articleView_waitNextArticle")),function(){var e=ae[ae.length-1];if(e){var t=gpeByClass("articleView__content",e.getEl()),n=geByClass1("articleView__social_buttons",t);n&&show(n)}}()),t>.99&&e.next_article_url&&ae.length<20&&ve(e.next_article_url,(function(e,t){if(e){for(var n=0;n<ae.length;n++)if(ae[n].getArticle().raw_id==t.raw_id)return;te||(te=setTimeout((function(){var n=domCreate(e);K.appendChild(n),removeClass(i,"articleView_waitNextArticle"),addClass(n,"articleView_nextPrepared"),requestAnimationFrame((function(){removeClass(n,"articleView_nextPrepared")})),he(t),te=null}),400))}})),this.getScreenVisibilityRatio()>.5&&pe(e)}},onImageOpen:function(e,t,i){if(Y.isWebView){for(var o=[],r=0;r<e.length;r++){var s=e[r],l=[];for(var c in s)s.hasOwnProperty(c)&&l.push({type:c,src:s[c][0],width:s[c][1],height:s[c][2]});o.push(l)}Z=t,ee=n,a.a.send("articlePhotoView",{photos:o,index:i})}}});if(t||n.ready(),ae.push(n),me(e),Object(o.each)(geByTag("video"),(function(e,t){domData(t,"auto-pause-inited")||(domData(t,"auto-pause-inited",1),t.addEventListener("play",(function(){Object(o.each)(geByTag("video"),(function(e,n){n!=t&&n.pause()}))})))})),Y.isWebView){Object(o.each)(geByTag("figure",n._els.view),(function(e,t){var i=Object(o.intval)(domData(t,"type"));n._onObjectView(!1,i,t)&&domData(t,"done",1)}));var i=document.getElementsByClassName("articleView__educationCloseButton")[0];i&&i.addEventListener("click",(function(e){var t=e.target,n=Object(o.intval)(domData(t,"article-id")),i=Object(o.intval)(domData(t,"course-id")),r=Object(o.intval)(domData(t,"step-id")),s=t.href;a.a.send("articleClose",{fallback_url:s,payload:{status:"read",data:{author_id:n,course_id:i,step_id:r}}}),e.preventDefault()}))}}function me(e){var t=gpeByClass("articleView__content",ge("article_view_"+e.raw_id)),n=geByClass1("articleView__ads_block",t);W.init(e,n,Y)}function ve(e,t){var n=le[e];n!==re?Object(o.isArray)(n)?t&&t(n[0],n[1]):(se[e]=se[e]||[],t&&se[e].push(t),n!=oe&&(le[e]=oe,ajax.post("article.php",{act:"view",url:e,scroll_load:1,wall_owner_id:Y.wallOwnerId,audio_bridge:Object(o.intval)(Y.audioBridge),can_infinite_scroll:Object(o.intval)(Y.canInfiniteScroll),web_view:Y.isWebView,context:Y.context,ref:"scroll",v:Y.clientVersion},{onDone:function(t,n){for(var i=se[e],a=0;a<i.length;a++)i[a](t,n);le[e]=[t,n]}}))):t&&t()}function Ae(e,t){var n=fe(e);Object(o.each)(n,(function(e,n){toggleClass(n,"_active",t)}))}function be(){var e=P("anchor");e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var n=Y.isWebView?0:25,i=t.parentNode.offsetTop-n;window.setTimeout((function(){var e;e=i,(document.scrollingElement||window.scrollNode||document.body).scrollTop=e}),0)}}()}function ye(e){if(void 0===e&&(e={}),ne)be();else{Y.deviceInfo=e.deviceInfo;var t=ae[0],n=t.getArticle();t.ready(),n.has_more?ajax.post("article.php",{act:"load_more",rev:n.rev,hash:n.has_more_hash,article_owner_id:n.owner_id,article_id:n.id,audio_bridge:Object(o.intval)(Y.audioBridge),no_lazy_images:Object(o.intval)(Y.noLazyImages),can_infinite_scroll:Object(o.intval)(Y.canInfiniteScroll),wall_owner_id:Y.wallOwnerId,context:Y.context,client_version:Y.clientVersion},{onFail:function(){Y.failTries>0&&(Y.failTries--,setTimeout((function(){ye(e)}),2e3))},onDone:function(e,i){ne=!0,n.audios_list=i.audios_list,n.next_article_url=i.next_article_url,n.has_more=!1,n.audios_list&&n.audios_list.length&&(ie=ie.concat(n.audios_list));var a=domCreate(e),o=geByClass1("article_view",a),r=geByClass1("article_view");"figure"!==r.lastElementChild.tagName.toLowerCase()&&r.lastChild.remove();for(var s=r.children.length,l=o.children;s<l.length;)r.appendChild(l[s]);var c=geByClass1("article_preload_spinner");c&&c.parentNode.removeChild(c);var u=geByClass1("articleView__content_misc_block",a);r.parentNode.appendChild(u),function(){for(var e=geByClass1("article").children,t=0;t<e.length;t++){var n=t>0&&e[t-1],i=e[t],a=t+1<e.length&&e[t+1],o=n?n.tagName+"_"+domData(n,"type"):"",r=i?i.tagName+"_"+domData(i,"type"):"",s=a?a.tagName+"_"+domData(a,"type"):"",l=!1,c=!1,u=!1;o&&r==o||(l=!0),s&&r==s||(c=!0),(g.includes(+s.type)||s.sep)&&(u=!0),toggleClass(i,"article_decoration_first",l),toggleClass(i,"article_decoration_last",c),toggleClass(i,"article_decoration_before",u)}}(),me(n),be(),t.update()}}):ajax.post("article.php",{act:"next_url",access_hash:n.access_hash,article_owner_id:n.owner_id,article_id:n.id,wall_owner_id:Y.wallOwnerId,context:Y.context},{onDone:function(e){e&&(n.next_article_url=e,t.update())}});var i=t.getEl();e.paddingTop&&setStyle(i,"marginTop",Object(o.intval)(e.paddingTop)),e.paddingBottom&&setStyle(i,"marginBottom",Object(o.intval)(e.paddingBottom)),e.noDarkModeTransition&&addClass(i,"article_dark_no_transition")}}function we(e){var t=null;return Object(o.each)(ae,(function(n,i){var a=i.getArticle();if(a.raw_id==e)return t=a,!1})),t}function Se(e){var t="https://"+Y.devHost+"vk.com"+e.url,n={id:e.id,owner_id:e.owner_id,owner_name:e.owner_name,state:"available",can_report:e.can_report,title:e.title,subtitle:"",views:e.views,shares:e.shares,is_favorite:e.is_faved,url:t,view_url:t,access_key:e.access_hash,published_date:e.published_date,no_footer:e.no_footer};return e.owner_photo&&0!=e.owner_photo.indexOf("/images/")&&(n.owner_photo=e.owner_photo),n}function ke(e,t){void 0===t&&(t="");var n=ae[ae.length-1];if(t)for(var i=0;i<ae.length;i++)if(ae[i]._article.raw_id===t){n=ae[i];break}n.sendStats({type:e})}window.ArticleView=U,window.Article={init:function(e,t){if((Y=t).mobile=!0,Y.failTries=50,window.cur&&(window.cur.lang=window.cur.lang||{},extend(window.cur.lang,t.lang||{})),K=geByClass1("articleView__content_list"),!Y.isWebView){var n,i=_e(),r=geByClass1("articleView__header"),s=geByClass1("articleView__footer"),l=geByClass1("articleView__layout");de().addEventListener("scroll",n=function(){var e=l.clientHeight,t=Math.max(0,_e()),n=t-i>0,a=t+window.innerHeight+20>e;toggleClass(r,"articleView__header--narrow",n),s&&toggleClass(s,"articleView__footer--hidden",!a&&n),i=t},{passive:!0});var c=geByClass1("articleView__close"),u=geByClass1("articleView__close_mini");c.addEventListener("click",ke.bind(window,E)),u.addEventListener("click",ke.bind(window,E)),window.cur&&cur.destroy.push((function(){document.removeEventListener("scroll",n),removeClass(document.body,"article_body_with_transition")})),Y.isStandalone&&(window.al=!1);var d=Object(o.intval)(l.classList.contains("article_dark")),_=document.querySelector(".basis");_&&J.colorScheme.applyScheme(_,d?J.ColorSchemeName.Dark:J.ColorSchemeName.Light)}if(Y.preloadMoreHash||show(geByClass1("article_layer_prev_next")),Y.isWebView){var f=geByClass1("article");addClass(f,"article_webview")}Y.isWebView&&Y.audioBridge&&(window.audioplayer={playPause:function(e,t){var n=gpeByClass("audio_item",e.target);if(G&&G!=n&&(removeClass(G,"ai_playing"),G=!1),Q&&(removeClass(Q,"article_object_audioplaylist_playing"),Q=!1),hasClass(n,"ai_playing"))a.a.send("audioPause",{}),removeClass(n,"ai_playing");else{var i=ue(t,ie),o=ie;-1==i&&(o.unshift(t),i=0),a.a.send("audioPlay",{audioIds:o,pos:i}),addClass(n,"ai_playing"),G=n}return cancelEvent(e),!1}}),Y.isWebView?(a.a.send("articleReady"),window.addEventListener("VKWebAppEvent",(function(e){var t=e.detail||{};switch(t.type){case"articleOwnerSubscribed":var n=t.ownerId,i=t.isSubscribed;Object(o.each)(ae,(function(e,t){var a=t.getArticle();if(a.owner_id==n)return a.is_subscribed_to_owner=i,!1}));break;case"articleBookmarked":var a=t.articleOwnerId+"_"+t.articleId,r=we(a);r&&(r.is_faved=t.isBookmarked);var s=fe(a);Object(o.each)(s,(function(e,n){toggleClass(n,"_active",!!t.isBookmarked)}));break;case"articleWebViewShow":ye(t);break;case"articleWebViewClose":ke(E);break;case"didShareArticle":var l=t.articleRawId,c=t.shareType;if(!c)break;ke(c,l);break;case"articleMentionClick":var u=t.articleRawId;ke(O,u);break;case"articlePhotoCarouselPositionChanged":default:var d=t.index;if(void 0===d)return;ee&&Z&&ee.changeCarouselPosition(domData(Z,"carousel-id"),d,!0,!1)}})),he(e,!0)):he(e,!1)},fave:function(e,t,n,i,r){var s=!hasClass(e,"_active");ajax.post("article.php",{act:"fave",url:t,add:Object(o.intval)(s),hash:n}),ae.forEach((function(e){var n=e.getArticle();n.url==t&&(n.is_faved=s)})),M(s?"fave":"unfave",i),Ae(r,s),Y.isWebView?function(e){var t=we(e);t&&(JSON.stringify({article:Se(t)}),a.a.send("articleBookmarked",{article:Se(t)}))}(r):Share&&Share.setBookmarkState(r,s)},toggleButton:Ae,share:function(e,t,n){return function(e){var t=we(e),n=Y.clientVersion;if(t)if(n){var i={type:"article",data:Se(t)};a.a.send("share",i)}else{var o={article:Se(t)};a.a.send("articleShare",o)}}(t),!1},subscribe:function(e,t,n){ajax.post("article.php",{act:"subscribe",owner_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"articleView__subscribed",t),e.innerHTML=n}})},toggleDarkMode:function(e){z||(z=setTimeout((function(){var t=geByClass1("articleView__layout");toggleClass(t,"article_dark",e),toggleClass(document.body,"article_dark",e);var n=Object(o.intval)(hasClass(t,"article_dark"));z=!1,void 0!==e||Y.isWebView||ajax.post("article.php",{act:"set_dark_mode",dark:n});var i=geByClass1("articleMenu");i&&Unfold.setTitle(i,"dark_mode",n?getLang("mobile_articles_menu_dark_disable"):getLang("mobile_articles_menu_dark")),ke(n?C:j);var a=document.querySelector(".basis");a&&!Y.isWebView&&J.colorScheme.applyScheme(a,n?J.ColorSchemeName.Dark:J.ColorSchemeName.Light)}),e?0:10))},onWebViewShow:ye,sendStats:ke,audioPlayPlaylist:function(e,t,n){var i=gpeByClass("article_object_audioplaylist_webview",e);if(G&&(removeClass(G,"ai_playing"),G=!1),Q){var o=Q;if(removeClass(o,"article_object_audioplaylist_playing"),Q=!1,o==i)return a.a.send("audioPause",{}),cancelEvent(n)}var r=ue(t,ie),s=ie;return-1==r&&(s.unshift(t),r=0),a.a.send("audioPlay",{audioIds:s,pos:r}),addClass(i,"article_object_audioplaylist_playing"),Q=i,cancelEvent(n)},onAudioStateChanged:function(e,t){G&&(removeClass(G,"ai_playing"),G=!1),Q&&(removeClass(Q,"article_object_audioplaylist_playing"),Q=!1),e=(e=e.split("_"))[0]+"_"+e[1];var n=ge("audio"+e);n&&toggleClass(n,"ai_playing","play"==t);for(var i=geByClass("_article_object_audioplaylist_webview"),a=0;a<i.length;a++){if((domData(i[a],"ids")||"").split(",").indexOf(e)>=0&&"play"==t){addClass(i[a],"article_object_audioplaylist_playing"),Q=i[a];break}}}}},"0hva":function(e,t,n){"use strict";n.r(t),n.d(t,"initAlbumPage",(function(){return p}));var i=n("vOib"),a=n("1VZq"),o=n("z1UI"),r=n("O5lf"),s=(n("tlMv"),n("z9sQ"));var l,c,u,d,_=function(e){void 0===e&&(e={});var t=window.lang,n=e.title||"",l=e.description||"",c=e.pretag,u=e.buttons||{},d=(e.photos||[]).map((function(e){return Object(a.default)({photo:e})})),_=null;if(e.is_loading)_=Wd.wrap(Object(r.default)({mix:"al_loading",type:"pageLoader"}));else{if(!d.length)return Object(o.default)({separator:!0,more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_type:"primary",more_url:e.add_url,text:t.mobile_photos_placeholder_album_text});_={inner:[d],class:"AlbumPage__photos photos_page",tag:"div"}}var f=s.default.class("AlbumPage",{withoutDescription:!l},"--");return{inner:[Object(i.default)({inner:[{inner:[{inner:[n],class:"AlbumPage__title",tag:"h2"},l&&{inner:[l],class:"AlbumPage__description",tag:"span"}],class:"AlbumPage__info",tag:"div"},u.prev,_,u.more,c]})],class:f,tag:"div"}},f=n("OcsD");function p(){var e=$("#mhead");Object(f.getH)(e);$(".AlbumPage")&&(l=!1,c=!1,u=!1,d=!1,Object(f.onBodyScroll)(h),Object(f.onBodyScroll)(!0))}function h(){if(l||(l=$(".AlbumPage__title"),c=Object(f.getH)(l)),u||(u=$(".header__title",$("#mhead"))),!u)return Object(f.onBodyScroll)("__clear",h);d||(d=$(".header__text",u));var e=Math.min(40,Math.max(0,getY(l)-c-scrollTop()));f.setStyle.transform(d,1,[0,e]),u.classList.toggle("header__title--initial-position",0===e)}var m=n("Cbap");m.default.getRouter().addRoute(/\/(?:album|tag)(-?\d+(?:_\d+)?)/,p),m.default.getRouter().addRoute(/\/(?:attachments\?act=choose_photo).*(?:album|tag)=(-?\d+(?:_\d+)?)/,p);t.default=_},"1KAK":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=(n("KMpi"),n("/Id8")),r=n("fdw3");function s(){var e=Object(i.default)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=function(e){var t=e.msgId,n=e.withDivider?function(){var e=window.lang;return a.default.html(s(),e.mobile_mail_new_msgs)}():"",i=store.mail,c=Object(r.isForwardedMessageId)(t)?i.forwards[t]:i.msgs[t];if(!c)return null;var u,d=i.members[c.authorId],_=c.peerId,f=i.peers[_];if(!e.detailed){var p=store.mail.presend,h=(p=p&&p.msgs)&&p["edit"+t];h&&(c=h)}f&&(f.isIncomingMR||f.isRejectedMR)&&(n="");if(c.isService)u=Object(o.default)({id:t,text:c.service,service:!0,unread:c.isUnread});else{var m=Object(o.Msg__authorName)(d,_,i.cur.userId),v={id:t,text:c.text,important:c.isImportant,unread:c.isUnread,authorPhoto:d.avatar,authorName:m,authorUrl:d.url,date:c.date,removed:i.cur.msgRemoved[t],admin:c.adminName?{name:c.adminName,url:c.adminUrl}:null,edited:c.edited,channel:f.isChannel&&f.ownerId!==i.cur.viewerId,attaches:c.attaches,attachesHTML:c.attachesHTML,attachesLoading:c.attachesLoading,forwards:c.forwards,reply:c.reply,pending:c.pending,waiting:c.waiting,failed:c.failed,sendId:c.sendId,sticker:c.sticker,keyboard:c.keyboard,maxDepth:e.detailed?i.cur.maxDetailedMsgDepth:i.cur.maxMsgDepth,ttl:c.ttl,ts:c.ts,isExpired:c.isExpired,isDefaultCasperTimerShown:!f.isCasper,isPinned:e.isPinned,chatId:e.chatId};u=e.detailed?Object(o.Msg_detailed)(v):Object(o.default)(v)}return a.default.html(l(),n,u)};t.default=c;window.uMsg=c},"1VZq":function(e,t,n){"use strict";n.r(t);var i=n("Y6JH");var a=function(e){var t,n=e.photo,a=n.restriction;if(a&&"block"===a.type)t={inner:[{inner:[Object(i.default)({sprite:"wall",name:"do_not_disturb_outline_56"})],class:"PhotosPhotoItem__restriction",tag:"div"}],class:"_image PhotosPhotoItem__photo",tag:"div"};else{var o=["_image",Bem.class("PhotosPhotoItem__photo",{blur:a&&"blur"===a.type},"--")];t={inner:[a&&a.type?{inner:[Object(i.default)({sprite:"wall",name:"hide_outline_56"})],class:"PhotosPhotoItem__restriction",tag:"div"}:null],style:"background-image: url("+n.src+")",attrs:n.attrs,class:o,tag:"div"}}return{inner:[t],href:n.href,class:"PhotosPhotoItem "+n.class,onclick:n.onclick,tag:"a"}};t.default=a},"29dZ":function(e,t,n){"use strict";n.r(t);var i=n("UvyM"),a=n("myok");Object.assign(i.default,a.default),window.Btn=i.default,t.default=i.default},"2IoG":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return o=function(){return e},e}t.default=function(e){void 0===e&&(e={});var t,n,i=a.default.list(e.inner);e.url?(t="a",n=a.default.attr("href",e.url)):(t=e.tag||"div",n="");return a.default.html(o(),t,e.mix,n,e.attrs,i,t)}},"3pHe":function(e,t,n){"use strict";n.r(t),n.d(t,"Messenger",(function(){return se}));var i={};n.r(i),n.d(i,"showCaptcha",(function(){return De})),n.d(i,"renderBody",(function(){return Ne}));var a,o=n("MUpH"),r=n("bZ/P"),s=n("z9sQ"),l=n("TYsd"),c=n("Mc5h"),u=(n("9y81"),n("O5lf")),d=n("AgBx"),_=n("QBkA"),f=n("rKp0"),p=n("u33z"),h=n("PUg3"),m=n("CkGd"),v=n("drfJ"),g=n("+cqQ"),A=n("DkIl");function b(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&y())}function y(){var e=store.mail.cur;(e?e.peerId:null)?a=setTimeout((function(){O(),y()}),3e4):w()}function w(){a&&clearTimeout(a)}function S(){$$(".mailHat").forEach((function(e){return e.outerHTML=Object(v.default)()}))}function k(){}function O(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,a=n?n.peerId:null;if(a){var o=i[a];if(o.lastActionTime&&!o.isOnline){var r=n.timeShift,s=function(e,t){var n=window.lang,i="";e+=t;var a=parseInt(Date.now()/1e3)-e;if(a>7776e3)return"";if(a<60)i=n.mobile_profile_status_just_now;else if(a<3600){var o=intval(a/60);i=langWordNumeric(o,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(a<14400){var r=intval(a/3600);i=langWordNumeric(r,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,a=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,a.mobile_mail_date,0,a.months_sm_of,!1):langDate(t,a.mobile_mail_short_date_time,0,a.months_sm_of,!1)}(e);return i}(o.lastActionTime,r);o.offlineText=s?langSex(o.sex,e.mobile_mail_last_activity_tip).replace("{time}",s):""}else o.canSeeOnline||(o.offlineText=function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(o.onlineStatus,o.sex));S()}}Object.assign(v.default,{onUnreadClick:Object(g.default)(),onBackClick:Object(g.default)(),onBackToDialogClick:Object(g.default)(),onCancelEditing:Object(g.default)(),setModifiers:A.MailHat_convo.setModifiers,redrawCounter:function(){var e=store.mail.cur.countUnread;if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}navigator.setAppBadge&&navigator.setAppBadge(e);Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e)},redrawOnline:O,redraw:S,startStatusUpdate:y,cancelStatusUpdate:w}),A.MailHat_main.onUnreadClick(v.default.onUnreadClick),A.MailHat_main.onBurgerClick(menu.open),A.MailHat_main.onCancelForwardTap(v.default.onBackToDialogClick),A.MailHat_convo.onBackTap(v.default.onBackClick),A.MailHat_convo.onCancelEditingTap(v.default.onCancelEditing),uVK.onReady(b),uVK.onReady(k),page.onChange(k);var C=v.default;window.uMailHat=v.default;var j=n("29dZ"),E=function(e){var t=window.lang;return l.default.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[Object(j.default)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),Object(j.default)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})};Object.assign(E,{accept:function(e,t,n){j.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&j.default.setLoading(t,!1)}),(function(){j.default.setLoading(t,!1)}))},reject:function(e,t,n){j.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&j.default.setLoading(t,!1)}),(function(){j.default.setLoading(t,!1)}))}});var T=E;var I=T;window.MessageRequestBox=T;var M=n("Y6JH"),P=n("fdw3"),x=function(e){var t=e.tagsData,n=[];e.tags&&t.peerTags&&(n=e.tags.filter((function(e){return t.peerTags.indexOf(e.id)>-1})));var i=L({fromAd:t.fromAd,peerTags:n,urls:e.data.urls}),a=R(e.data),o=(l=e.data,c=l.likesCount||l.repliesCount,{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_activity_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[c?[l.likesCount?{inner:[l.likesCount],class:"PeerProfile__blockItem",tag:"span"}:"",l.repliesCount?{inner:[l.repliesCount],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(P.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}),r=function(e){return{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_note_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.note?{inner:[e.note],tag:"span"}:"",{inner:[Object(P.getLang)(e.note?"mobile_mail_peer_profile_edit_note_link":"mobile_mail_peer_profile_add_note_link")],href:e.urls.editNote,class:e.note?"PeerProfile__editNoteLink":"PeerProfile__blockLink",tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}(e.data),s=D(e.data);var l,c;return[i,a,o,r,s]};function L(e){for(var t=e.fromAd?1:0,n=3-t,i=[],a=e.fromAd?{inner:[Object(M.default)({sprite:"mail",name:"ad_tag_10"}),{inner:[Object(P.getLang)("mobile_mail_ad_tag_no_access_text")],tag:"span"}],class:"PeerProfile__adTag",tag:"div"}:"",o=e.peerTags,r=0,s=0;s<o.length;s++)e.fromMessenger&&s>=n?r++:i.push(o[s]);var l=window.lang,c=i.length+t;return{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_tags_label")],class:"PeerProfile__blockLabel",tag:"div"},c>0?{inner:[a,B(i),r>0?{inner:["+"+langNumeric(r,l.mobile_mail_peer_profile_extra_tags)],href:e.urls.showPeerProfile,class:"PeerProfile__extraTag",tag:"a"}:"",e.fromMessenger?"":{inner:[Object(P.getLang)("mobile_mail_peer_profile_edit_tags_link")],href:e.urls.toggleTags,class:"PeerProfile__editTag",tag:"a"}],class:"PeerProfile__blockContent PeerProfile__tagsList",tag:"div"}:{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_add_tags_link")],href:e.urls.toggleTags,tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function B(e){return[e.map((function(e){return{inner:[e.name],class:"PeerProfile__peerTag",style:"background-color: "+e.color,tag:"div"}}))]}function R(e){var t=e.city||e.age;return{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_info_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[t?[e.city?{inner:[e.city],class:"PeerProfile__blockItem",tag:"span"}:"",e.age?{inner:[e.age],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(P.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function D(e){return{inner:[{inner:[Object(P.getLang)("mobile_mail_peer_profile_join_date_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.joinDate?e.joinDate:Object(P.getLang)("mobile_mail_peer_profile_join_date_empty_text")],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}n("wCFN");var N=n("UxAg"),H=n("OcsD"),V=n("p5n7");function U(e){var t=e.index+"_";return{inner:[Object(V.default)({name:"tags["+t+"id]",type:"hidden",value:e.id}),Object(V.default)({name:"tags["+t+"state]",type:"hidden",value:e.state||"",class:"PeerProfileManageTags__stateLabel"}),Object(V.default)({name:"tags["+t+"color]",type:"hidden",value:e.color,class:"PeerProfileManageTags__colorLabel"}),Object(V.default)({name:"tags["+t+"name]",class:"PeerProfileManageTags__label",placeholder:Object(P.getLang)("mobile_mail_peer_profile_manage_tags_placeholder"),value:e.name,maxlength:20,on_change:["PeerProfile.onTagNameChange","this"]}),{class:"PeerProfileManageTags__color",style:"background-color: "+e.color,tag:"span"},{inner:[Object(M.default)({sprite:"mail",name:"cancel_24"})],class:"PeerProfileManageTags__remove",onClick:["PeerProfile.onRemoveTagClick","this"],tag:"div"}],class:"PeerProfileManageTags__field",tag:"div"}}Object.assign(x,{onMessengerBlockClick:function(e,t){if(Object(H.gpeByClass)("PeerProfile__adTag",e.target))return;nav.go(t)},toggleTag:function(e,t,n,i){ajaxRequest("/mail",{act:"toggle_peer_profile_tag",tag_id:e,action:i.checked?"bind":"unbind",peer_id:t,hash:n})},onAddTagClick:function(e){var t=e.$btn,n=t.parentElement,i=Object(N.$$)(z,n),a=Object(N.$$)("."+X(),n);if(i.length-a.length>=20)return;var o=l.default.elem(U({id:"",name:"",color:G(n),state:"new",index:i.length}));n.insertBefore(o,t),K()},onRemoveTagClick:function(e){var t=e.parentElement,n=Object(N.$)(".PeerProfileManageTags__stateLabel",t),i=Object(N.$)(".TextInput__native",n);"new"===i.value?t.remove():(Object(H.addClass)(X(),t),i.value="deleted",Q());K()},onTagNameChange:function(e){var t=e.parentElement.parentElement,n=Object(N.$)(".PeerProfileManageTags__stateLabel",t),i=Object(N.$)(".TextInput__native",n);"new"!==i.value&&(i.value="changed");Q()}});var F=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],W="PeerProfileManageTags__field",z="."+W,Y="PeerProfileManageTags__addLink";function G(e){var t=Object(N.$$)(z,e),n=Array.from(t).reduce((function(e,t){var n=Object(N.$)(".PeerProfileManageTags__stateLabel",t);if("deleted"!==Object(N.$)(".TextInput__native",n).value){var i=Object(N.$)(".PeerProfileManageTags__colorLabel",t);e[Object(N.$)(".TextInput__native",i).value]=!0}return e}),{});return F.find((function(e){return!n[e]}))}function Q(){var e=Object(N.$)(".HeaderBtn"),t=s.default.class("HeaderBtn",{hidden:!0},"--").replace("HeaderBtn ","");Object(H.removeClass)(t,e)}function K(){var e=Object(N.$)(".PeerProfileManageTags__addLink"),t=e.parentElement,n=Object(N.$$)(z,t),i=Object(N.$$)("."+X(),t),a=n.length-i.length,o=s.default.class(Y,{hidden:!0},"--").replace(Y+" ","");Object(H.toggleClass)(o,e,a>=20)}function X(){return s.default.class(W,{removed:!0},"--").replace(W+" ","")}function J(){var e=Object(o.default)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return J=function(){return e},e}function Z(){var e=Object(o.default)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return Z=function(){return e},e}function ee(){var e=Object(o.default)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return ee=function(){return e},e}function te(){var e=Object(o.default)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return te=function(){return e},e}function ne(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return ne=function(){return e},e}function ie(){var e=Object(o.default)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return ie=function(){return e},e}function ae(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ','\n    </div>\n    <div class="messenger__content">\n      <div class="','">','</div>\n      <div class="messenger__pinned">','</div>\n      <div class="messenger__peerProfile">',"</div>\n      ",'\n      <div class="','">\n        <div class="messenger__mrbox">','</div>\n        <div class="messenger__write">','</div>\n        <div class="messenger__acts">',"</div>\n      </div>\n    </div>\n  "]);return ae=function(){return e},e}function oe(){var e=Object(o.default)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">','</div>\n        <div class="messenger__content">\n          ','\n        </div>\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return oe=function(){return e},e}window.PeerProfile=x;var re=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=Object(f.default)({scrap:"folder"}),a=Object(f.default)({scrap:"search"}),o=e.page,r="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR;return se({mix:fe(),mailHat:C(),convo:le(),page:o,mrs:r,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:a})};function se(e){var t=window.lang.mobile_mail_search_only_messages,n=Object(_.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?he(e.mrs):"",a=r.default.onClick("Messenger._onSearchMsgsClick"),o=Object(d.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onMainScroll","this"),inner:[Object(c.default)({mix:"messenger__filter",inner:n}),Object(c.default)({mix:r.default.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),Object(c.default)({mix:"messenger__searchMsgs",attrs:a,inner:t}),Object(c.default)({mix:"messenger__loadable",inner:[Object(c.default)({mix:"messenger__folderList",inner:e.scrapFolder}),Object(c.default)({mix:"messenger__searchList",inner:e.scrapSearch}),ce()]})]});return r.default.html(oe(),e.mix,e.mailHat,o,e.convo,e.page)}function le(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=C(),a=ue(),o=de(),s=Object(h.default)(),l=n&&n.canPin,u=Object(m.default)({canPin:l,isChannel:n.isChannel}),_=n.isCasper,p=Object(f.default)({scrap:"peer",isCasper:_}),v=n.isIncomingMR?I(t.peerId):"",g=n.isRejectedMR?function(){var e=window.lang;return r.default.html(ie(),e.mobile_mail_mrs_rejected_info)}():"",A=t.peerId>0&&t.peerId<2e9,b=e.flags.isPeerProfileEnabled&&A?me({tags:e.peerProfileTags,tagsData:n.peerProfileTagsData,data:n.peerProfileData}):"",y=Object(d.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onConvoScroll","this"),inner:[Object(c.default)({mix:"messenger__spacer"}),Object(c.default)({mix:"messenger__convoList",inner:[p,g]}),ce()]}),w="messenger__banner";o&&(w+=" messenger__bannerVisible");var S=r.default.class("messenger__footer",{actionsOpen:pe(),isIncomingMR:n.isIncomingMR});return r.default.html(ae(),i,w,o,a,b,y,S,v,s,u)}function ce(){var e=Object(u.default)({mix:""});return r.default.html(te(),e)}function ue(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function de(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if(!i)return"";var a="";i.icon&&(a=r.default.html(ee(),i.icon));for(var o=i.buttons,s=o.length,l=[],c=0;c<s;c++)l.push(_e(o[c],c));l=r.default.list(l);var u=Object(p.default)({class:"messenger__banner_close",onClick:r.default.onClick("uMessenger.onBannerButtonClick","event")}),d=r.default.onClick("uMessenger.onBannerTextClick","event");return r.default.html(Z(),a,d,i.text,l,u)}function _e(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=r.default.class("messenger__banner_button",n),o=e.type;return"gifts_link"===e.type&&(o="link",i="_self"),Object(p.default)({class:a,text:e.text,type:"link"===o?"link":"button",link:"link"===o?{href:e.link,target:i}:null,onClick:r.default.onClick("uMessenger.onBannerButtonClick","event",t)})}function fe(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null;return r.default.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e))}function pe(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function he(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return r.default.html(J(),n)}function me(e){var t=e.tags,n=e.tagsData,i=e.data;if(!i)return"";var a=[];t&&n.peerTags&&(a=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var o,r=a.length;return o=n.fromAd||r?L({fromAd:n.fromAd,peerTags:a,fromMessenger:!0,urls:e.data.urls}):i.city||i.age?R(i):D(i),l.default.html({class:"PeerProfile__wrapper",inner:[{class:s.default.class("PeerProfile",{messenger:!0},"--"),inner:o},{class:"PeerProfile__link",inner:Object(M.default)("mail","chevron_compact_right_24")}],onClick:["PeerProfile.onMessengerBlockClick","event",i.urls.showPeerProfile]})}var ve=n("jk6M"),Ae=n("Qz23");function be(){Object(Ae.cleanScrollView)(se.getConvoBody()),removeEvent(se.getConvoBody(),"touchstart",ye,{passive:!0})}function ye(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function we(e,t){$$(".messenger__layer_"+e).forEach((function(e){e.classList.toggle("messenger__layer_loading",t)}))}function Se(e){return $(".messenger__layer_"+e+" .messenger__body")}function ke(e){se.onMainScroll(e)}function Oe(e){se.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&se.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&se.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout((function(){e._isScrolling=!1}),100)}function Ce(){var e,t,n=se.getConvoBody();n&&(n.prevHeight&&n.prevHeight!==n.offsetHeight&&(e=n,t=n.scrollBottom,e.scrollTop=e.scrollHeight-e.offsetHeight-t),n.prevHeight=n.offsetHeight,n.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(n),je&&requestAnimationFrame(Ce))}Object.assign(se,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:Object(g.default)("scrollElem"),onQueryChange:_.default.onChange,onQueryClear:_.default.onClear,onSearchMsgsClick:Object(g.default)(),setQuery:_.default.setQuery,setQuerySilently:_.default.setQuerySilently,getMainBody:function(e){return Se("main")},setMainLoading:function(e){return we("main",e)},onConvoAtTop:Object(g.default)(),onConvoAtBottom:Object(g.default)(),onConvoScroll:Object(g.default)("scrollElem"),setConvoLoading:function(e){return we("convo",e)},getConvoBody:function(){return Se("convo")},scrollConvoToBottom:function(){var e=se.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=le();be(),$$(".messenger__layer_convo").forEach((function(t){t.innerHTML=e}))},cleanConvoBody:be,setupConvoBody:function(){Object(Ae.setScrollView)(se.getConvoBody(),{topBanner:!1}),addEvent(se.getConvoBody(),"touchstart",ye,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")},renderMessengerPeerProfile:function(e){$(".messenger__peerProfile").innerHTML=me(e)}}),se._onMainScroll=ke,se._onConvoScroll=Oe,se._onSearchMsgsClick=se.onSearchMsgsClick;var je=!1;if(re.startPolling=function(){je=!0,Ce()},re.stopPolling=function(){je=!1},Object.assign(re,{redraw:function(){$$(".uMessenger").forEach((function(e){return e.outerHTML=re()}))},redrawView:function(){$$(".uMessenger").forEach((function(e){return e.className=fe()}));var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(Ie(),m.default.togglePin(n[t.peerId].canPin));Me()},redrawMailActions:function(){var e=pe();$$(".messenger__layer_convo").forEach((function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),m.default.update();var n=store.mail,i=n.cur,a=n.peers;if(!i.peerId||!a[i.peerId].isIncomingMR){var o=t.$(".messenger__write").offsetHeight,r=t.$(".messenger__acts").offsetHeight-o,s=t.$(".messenger__body");requestAnimationFrame((function(){!s._fixed&&r&&(s.style.paddingBottom=r+"px",s._fixed=!0),r<=0&&(s.style.paddingBottom=0,s._fixed=!1)}))}}))},redrawPinnedMsg:Ie,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,a=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach((function(t){t.classList.toggle("messenger_pinnedVisible",a&&e),t.classList.toggle("messenger_pinnedHidden",a&&!e)}))},redrawBanner:function(){var e=de();$$(".messenger__banner").forEach((function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)}))},redrawMRsHint:Me,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=se.getConvoBody();if(ve.default.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach((function(e){return e.classList.remove("load_before_closed")}));var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(Te&&clearInterval(Te),Te=setInterval((function(){e.isScrolling||(clearInterval(Te),t())}),10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach((function(e){return e.classList.remove("load_before_closed")}));var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var a=se.getConvoBody();if($(".mailScrap__loading_before"),t)a.scrollTop=i.offsetTop-.18*a.offsetHeight;else{var o=$(".typing_id_curConvo").offsetHeight;a.scrollTop=i.offsetTop-.5*(a.offsetHeight+2)+(i.offsetHeight+o)/2,i.offsetHeight>a.offsetHeight&&(a.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout((function(){removeClass("msg_highlight",i)}),1500)),!0},loadMailPage:Object(g.default)()}),ve.default.safari_mobile){var Ee=null;se.onConvoScroll((function(e){e.isScrolling=!0,Ee&&clearTimeout(Ee),Ee=setTimeout((function(){return e.isScrolling=!1}),50)}))}var Te=null;function Ie(){var e=store.mail,t=e.peers,n=e.cur,i=ue(),a=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(a)}function Me(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var a=t?he(t):"";i.innerHTML=a}i.classList.toggle("messenger__mrsHint_hidden",!n)}var Pe=n("cq4b"),xe=n("/Id8"),Le=n("fWqt"),Be=n("qHA9"),Re=n("iS9e");function De(e,t){Re.default.open({body:Ne(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var a,o=Object(N.$)('[name="'+e.key+'"]',i);o=o&&o.value||"",Re.default.close(),Object(Be.mailRequest)(e.location,Object.assign({},e.post,(a={},a[e.key]=o,a))).then((function(e){t(Promise.resolve(e))}),(function(e){t(Promise.reject(e))}))},onClose:function(){Re.default.close(),t(null)}})}function Ne(e){return l.default.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[Object(V.default)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}var He=i,Ve=n("V4qE"),Ue=n("cZev"),Fe=n("GYWy"),$e=n.n(Fe),We=n("eWFs"),qe=n("wMVj"),ze={onTemplateInput:function(e,t,n,i){var a=$("."+n),o=i-t.value.length;a.textContent=o,a.className=s.default.class(n,{error:o<=0})},onButtonMouseDown:function(e,t){ve.default.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),a=i.value,o=i.selectionStart,r=i.selectionEnd;i.value=a.slice(0,o)+n+a.slice(r);var s=o+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,a){var o=$(".MailTemplatePage__NameInput .TextInput__native"),r=$(".MailTemplatePage__TextTextarea");j.default.setLoading(t,!0),Object(H.ajaxRequest)("/mail",{act:"save_template",name:o.value,text:r.value,hash:i,id:n},(function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),o=$(".MailTemplatePage__ErrorText");return j.default.setLoading(t,!1),i.hidden=!1,void(o.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var r=store.mail.cur.templates,s=n?r.findIndex((function(e){return e.id===n})):-1;-1!==s?r.splice(s,1,e.result):r.push(e.result)}qe.default.go(a)}}),(function(){j.default.setLoading(t,!1)}))},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=ze;var Ye=function(e){var t=window.lang,n=Object(A.MailHat)({type:"page",left:l.default.html({class:"mailHat__back",inner:Object(M.default)("base","back_outline_28"),href:"/mail"}),center:Object(A.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),i=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},l.default.wrap(Object(f.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[Object(j.default)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:r.default.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:l.default.wrap(n)},{class:"messenger__content",inner:[{class:"messenger__body",inner:i}]}]}};Object.assign(Ye,{rejectAll:function(e,t){j.default.setLoading(t,!0),Ye.onRejectAll(t)},onRejectAll:befall()});var Ge=Ye;var Qe=Ge;window.MessageRequestsPage=Ge;var Ke,Xe,Je=n("V2dH"),Ze=n("iWgD"),et=n("HGMY"),tt=n("zq7H"),nt=n("9M99"),it=n("hw56"),at=n("H5mD"),ot=n("aiw/"),rt=n("W38l"),st=n("HdGT"),lt=n("gF8j"),ct=Object(g.default)();function ut(){Xe=null,Ke&&Ke.stop()}function dt(e,t){Ke&&(Ke.is_idle?Xe[e]=t:setTimeout(t,0))}function _t(){var e=Xe;Xe={},Object.keys(e).forEach((function(t){(0,e[t])()}))}var ft=null,pt=null;function ht(e){if(pt&&(clearTimeout(pt),pt=null),ft&&(ft=Object.assign({},ft,{fails:0})),"online"===e.type&&ft){var t=ft;ft=null,mt(t)}}function mt(e){if(!1!==navigator.onLine)return Object(Be.mailRequest)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then((function(t){e.onResult(t)})).catch((function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));ft=Object.assign({},e,{fails:n}),pt=setTimeout((function(){pt=null,mt(ft)}),1e3*i)}else ft=Object.assign({},e,{fails:0})}));ft=Object.assign({},e,{fails:0})}window.addEventListener("online",ht),window.addEventListener("offline",ht);var vt=n("UlUB"),gt=n("chpQ"),At=n("BZzM"),bt=n("N4ZS"),yt=n("r/ag"),wt=n("j80l"),St=n("vk58"),kt=!1;uVK.onReady(cn),se.onQueryChange(_n),se.onQueryClear(fn),We.default.onTap(Ft),C.onUnreadClick(It),C.onBackClick(Ln),C.onBackToDialogClick(Bn),C.onCancelEditing(Oi),h.default.onAttachedMsgsRemove(Ut),h.default.onToBottomClick(jn),h.default.onMessage(Rt),st.onMessage(Bt),st.onStopped(Dt),st.onMessageRemove(Nt),st.onCaptcha(Vi),xe.default.onClick(si),xe.default.onRestoreClick(ci),xe.default.onReplyClick(di),xe.default.onForward(fi),Voting.onHtmlUpdate(Ei),se.onMainScroll(Cn),se.onConvoScroll(En),se.onSearchMsgsClick(dn),se.onConvoScroll(re.expandPeerBefore),se.onConvoAtTop(Sn),se.onConvoAtBottom(kn),m.default.onCloseClick(Xn),m.default.onRemoveClick(Jn),m.default.onImportantClick(ii),m.default.onReplyClick(oi),m.default.onForwardClick(ri),m.default.onSpamClick(ni),m.default.onPinClick(Qn),m.default.onEditClick(Kn),Le.default.onConfirmDelete(ei),PinnedMsg.onHideClick(vi),Qe.onRejectAll(xi),im.onNewMsg(Ht),im.onEditMsg(Vt),im.onMultiTyping(Dn),im.onRecordingAudio(Un),im.onOnlineChange(Fn),im.onMsgReadByMe($n),im.onMsgReadByOther(Wn),im.onMsgImportantRemove(Wt),im.onMsgImportantAdd($t),im.onMsgRemove(qt),im.onMsgListen(zt),im.onPeerKeyboard(Gt),im.onPeerBanner(nn),im.onPeerConvert(an),im.onPeerAdmin(on),im.onMsgRequestChange(rn),im.onDialogImportant(Qt),im.onDialogMarkedUnread(Xt),im.onDialogAdTag(Kt),im.onUnreadCount(Jt),im.onIncomingCall(Zt),im.onKeyboardCallback(tn),im.onResync(en),ct(Ni),AudioMessagePlayer.events.on("listened",Hi),nav.onPopState(qn),nav.onBeforeGo(zn),nav.onBeforeGo2(Yn),page.onChange(Gn),uVK.onReady(yi),page.onChange(yi),uVK.onReady(wi),page.onChange(wi),page.onChange(Lt),page.onChange(ji),uVK.onReady(Lt),uVK.onReady(hi),uVK.onReady(ji),uVK.onOrientationChange(xt),re.loadMailPage(Ti),re.onShowPinnedMsgClick=mi,re.onHidePinnedMsgClick=vi,re.onMarkDialogAsUnreadClick=gi,re.onBannerButtonClick=Ai,re.onBannerTextClick=bi,re.onCall=zi,re.goToMsg=ui;var Ot=!1,Ct=0,jt=[],Et=[],Tt=Object(vt.throttle)((function(){if(!jt.length)return;var e=store.mail,t=e.members,n=e.cur,i=jt,a=Et;jt=[],Et=[],ajaxRequest("/mail",{act:"get_members",members:i},(function(e){Object.assign(t,e),a.forEach((function(e){e===n.peerId&&Je.default.redraw(),We.default.redrawTyping(e)}))}))}),3e3);function It(){se.scrollMainBodyToTop()}function Mt(){Object(Ae.preventDocumentScroll)();var e=se.getMainBody();e&&Object(Ae.setScrollView)(e);var t=$(".leftMenu__searchItems");t&&Object(Ae.setScrollView)(t,{topBanner:!1,overscrollY:!1})}function Pt(){Object(Ae.preventDocumentScroll)({topBanner:!1}),se.setupConvoBody()}function xt(){ve.default.safari_mobile&&document.activeElement.blur()}function Lt(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame((function(){re.scrollToMsg(e)})):requestAnimationFrame(se.scrollConvoToBottom)}function Bt(e){var t=store.mail.cur;Object(it.addPendingMsg)(e),t.peerId&&(0===e.sendId.indexOf("edit")?Mn(e):(et.removeMsg(e),et.addMsg(e),Ri()))}function Rt(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&Mn(e)}function Dt(){Object(it.failAllPendingMsgs)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map((function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?Mn(t):i.push(t))})),et.setMsgs(i)}}else Object.keys(n.failed).forEach((function(e){We.default.redrawLastMsg(e)}))}function Nt(e){var t=store.mail.presend.msgs[e];t&&(Object(it.removePendingMsg)(t),Object(it.removeFailedMsg)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&f.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&et.removeMsg(t),Ri()))}function Ht(e){In(e)}function Vt(e){In(e)}function Ut(){var e=store.mail,t=e.cur;e.peers;Object(it.setPeerDraft)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],h.default.uiRedrawAttachments(t.peerId)}function Ft(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs;if(n){var a=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[a]||[])];return un(e)}}function $t(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=i[e];if(r&&(r.isImportant=!0,o.folder.important=o.folder.important.concat(e).filter(unique).sort(desc),xe.default.toggleImportant(e,!0),"important"===n.folder)){var s=a.folder.slice();a.folder=a.folder.concat(e).filter(unique).sort(desc),f.default.redrawFolder(s)}}function Wt(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,o=n.scraps,r=n.rolls,s=a[e];if(s&&(s.isImportant=!t,Object(Pe.arrayRemove)(r.folder.important,e),xe.default.toggleImportant(e,!1),"important"===i.folder)){var l=o.folder.slice();Object(Pe.arrayRemove)(o.folder,e),f.default.redrawFolder(l)}}function qt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=t.peers,s=i[e];if(s&&!n.msgRemoved[e]){delete i[e],Object(Pe.arrayRemove)(o.peer[s.peerId],e),n.peerId===s.peerId&&(Object(Pe.arrayRemove)(a.peer,e),xe.default.remove(e,!0),n.msgSelected[e]&&(delete n.msgSelected[e],m.default.setCount(Object.keys(n.msgSelected).length),re.redrawMailActions()),a.peer.length?f.default.checkDivider():f.default.redrawPeer()),s.isImportant&&n.countImportant--;var l=r[s.peerId],c=l.isIncomingMR,u=l.isRejectedMR;s.isUnread&&s.authorId!==n.viewerId&&(r[s.peerId].countUnread=r[s.peerId].countUnread-1,c||u||r[s.peerId].countUnread<=0&&(n.countUnread=n.countUnread-1),h.default.redrawToBottom(),C.redrawCounter()),o.peer[s.peerId].length?Yt(s,e):ajaxRequest("/mail",{act:"get_last_msg",peer_id:s.peerId,user_id:n.userId},(function(t,n){n&&(storeMethods.injectMail(t),o.peer[s.peerId].push(n)),Yt(s,e)}),(function(){Yt(s,e)}))}}function zt(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}))}}function Yt(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),o=n.rolls,r=n.peers,s=r[e.peerId],l=s.isIncomingMR,c=s.isRejectedMR;o.peer[e.peerId].length||(l||c?Object(Pe.arrayRemove)(o.mrs,e.peerId):(Object(Pe.arrayRemove)(o.folder.all,e.peerId),Object(Pe.arrayRemove)(o.folder.unread,e.peerId),Object(Pe.arrayRemove)(o.folder.unrespond,e.peerId)),"mrs"===i.page?Object(Pe.arrayRemove)(a.mrs,e.peerId):"important"!==i.folder&&Object(Pe.arrayRemove)(a.folder,e.peerId)),o.peer[e.peerId]=o.peer[e.peerId].filter(unique).sort(asc),l||c?o.mrs=o.mrs.filter(unique).sort(pi):(0===s.countUnread&&(o.folder.unread=o.folder.unread.filter((function(t){return t!==e.peerId}))),o.folder.all=o.folder.all.filter(unique).sort(pi),o.folder.unread=o.folder.unread.filter(unique).sort(pi),i.groupId&&(o.folder.unrespond=o.folder.unrespond.filter(unique).sort(pi))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(pi),f.default.redrawMRs()):"important"===i.folder?(Object(Pe.arrayRemove)(a.folder,t),f.default.redrawFolder()):"all"===i.folder?(a.folder=a.folder.filter(unique).sort(pi),f.default.redrawFolder()):"unread"===i.folder?(0===r[e.peerId].countUnread&&Object(Pe.arrayRemove)(a.folder,e.peerId),a.folder=a.folder.filter(unique).sort(pi),f.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(pi),f.default.redrawFolder())}function Gt(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var a=Object(it.getKeyboardState)(e);if(!(Date.now()-a.updateTime<=500)){var o=a.updateTime;ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){o===a.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&h.default.renderKeyboardIfNeeded({update:!0}))}))}}}function Qt(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),We.default.redrawImportant(e,t)}function Kt(e){ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){storeMethods.injectMail(t),We.default.updateAdTag(e)}))}function Xt(e,t){var n=store.mail,i=n.rolls,a=n.peers,o=n.scraps,r=n.cur,s=a[e];if(s){s.isMarkedUnread=t;var l=function(n){return t?n.concat(e):n.filter((function(t){return t!==e}))};if(i.folder.unread=l(i.folder.unread).filter(unique).sort(pi),"unread"===r.folder){var c=o.folder.slice();o.folder=l(o.folder).filter(unique).sort(pi),f.default.redrawFolder(c)}We.default.redrawUnread(e)}}function Jt(e){var t;nav.getQuery("community")||(t=e,setNotify(t),menu.refreshSingleCounter(tt.COUNTERS_POS_MESSAGES,t));var n=store.mail.cur;n&&(n.countUnread=e,C.redrawCounter()),navigator.setAppBadge&&navigator.setAppBadge(e)}function Zt(e){gt.EduIntegration.isIntegrated&&gt.EduIntegration.embedded.sendMessage("incoming_call",e)}function en(){im.pause(),ln((function(){im.resume()}))}function tn(e,t,n,i){void 0===i&&(i={}),function(e,t,n){void 0===n&&(n={});if(store.mail&&store.mail.cur&&"msg"!==store.mail.cur.page&&store.mail.cur.peerId!==e)return;switch(n.type){case"show_snackbar":if(n.text){var i=store.mail.members[t],a=(store.mail.peers[e],!1);e>2e9&&i&&(a=i.avatar),Snackbar.init({position:Ve.SNACKBAR_POSITION_MAIL,text:Object(nt.emojiToHTML)(htsc(n.text)),avatar:a,avatar_position:"left"})}break;case"open_app":var o=makeUrl("/app"+n.app_id,{from:nav.cur.slice(1)});nav.hard_go(o+"#"+n.hash);break;case"open_link":var r=Object(bt.wrapAwayIfExternal)(n.link,!0),s=store.mail.members[t],c=Object(wt.parseURL)(n.link),u=c.host||c.hostname||r;u.startsWith("xn--")&&(u=$e.a.toUnicode(u));var d=l.default.elem(Object(yt.default)({scrollable:!0,header:{title:lang.mobile_mail_callback_popup_title},content:[l.default.wrap(lang.mobile_mail_callback_popup_text.replace("{name}",s.name).replace("{domain}",u)),{class:"Popup__buttons",inner:Object(St.default)({inner:[Object(j.default)({inner:[lang.mobile_open],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"regular",url:r,open_in_new_tab:!0}),Object(j.default)({inner:[lang.mobile_cancel],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"secondary"})]})}]}));yt.default.open(d,!0)}}(t,n,i),Object(it.stopCallbackButtonWaiting)(e)}function nn(e){Date.now()-Ct<=500||ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&re.redrawBanner()}))}function an(e,t){im.pause(),ajaxRequest("/mail",{act:"get_peers",peer_ids:[t]},(function(n){Object(it.replacePeer)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(f.default.redrawFolder(),t===i.peerId?vn(t):un("/mail?act=show&peer="+t,{replace:!0})):i.folder&&f.default.redrawFolder(),im.resume()}))}function on(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(a){var r=o[e];r&&(t===a.userId&&(r.isAdmin=n),n&&!Object(Pe.arrayContains)(r.adminIds,t)?r.adminIds.push(t):!n&&Object(Pe.arrayContains)(r.adminIds,t)&&Object(Pe.arrayRemove)(r.adminIds,t))}}function rn(e,t){var n=store.mail,i=n.cur,a=n.rolls,o=n.scraps;i&&("created"!==t&&kt||("created"===t&&kt&&(kt=!1),"created"===t?sn(e,(function(t,n){Object(it.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(pi)),i.folder&&(f.default.redrawFolder(),re.redrawMRsHint()),i.peerId===e&&vn(e)})):"canceled"===t||"rejected"===t?sn(e,(function(t,n){Object(it.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(Pe.arrayRemove)(a.mrs,e),i.folder&&(f.default.redrawFolder(),re.redrawMRsHint()),i.peerId===e?vn(e):"mrs"===i.page&&(Object(Pe.arrayRemove)(o.mrs,e),f.default.redrawMRs())})):"accepted"===t&&sn(e,(function(t,n){Object(it.addPeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(Pe.arrayRemove)(a.mrs,e),i.folder&&(f.default.redrawFolder(),re.redrawMRsHint()),i.peerId===e?vn(e):"mrs"===i.page&&(Object(Pe.arrayRemove)(o.mrs,e),f.default.redrawMRs())}))))}function sn(e,t){im.pause(),ajaxRequest("/mail",{act:"mrs_get_peer",peer_id:e},(function(e,n){t(e,n),im.resume()}))}function ln(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls;o.folder[n.folder]=[],a.folder=[],se.setMainLoading(!0),ajaxRequest("/mail",{act:"all"===n.folder?null:n.folder,offset:0},(function(t,r){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder||Object.keys(t.msgs).forEach((function(e){e=toInt(e);var n=t.msgs[e].peerId;o.peer[n]=(o.peer[n]||[]).concat(e).filter((function(e){return!!i[e]})).filter(unique).sort(asc)}));var s="important"===n.folder,l=s?desc:pi,c=Object.keys(s?t.msgs:t.peers).map(toInt).sort(l).filter((function(e){return-1===a.folder.indexOf(e)})),u=[].concat(c).filter(unique).sort(l);o.folder[n.folder]=u,a.folder=first(20,u),store.mail.reached.folder[n.folder]=r,f.default.redrawFolder(),C.redrawCounter(),se.setMainLoading(!1),e&&e()}}))}function cn(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||Ii()}function un(e,t){void 0===t&&(t={});var n=pn(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function dn(){un("/mail?q="+store.mail.cur.query+"&tab=messages")}function _n(e){var t=_n;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var a="msgs"===n.tab?"&tab=messages":"",o=makeUrl("/mail?q="+e+a);pn(o),i?un(o):t.timer=setTimeout((function(){un(o,{replace:!0})}),300)}else un("/mail",{replace:!0})}}function fn(){se.setMainLoading(!1),se.setConvoLoading(!1),_n.clearTimer(),un("/mail",{replace:!0})}function pn(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),a=store.mail,o=a.cur,s=a.scraps;if(o){var c=i.act,u=i.peer,_=i.chat,p=i.email,h=i.m,m=toInt(i.msg)||toInt(i.id)||null,v="messages"===i.tab?"msgs":"peers",g=i.q||"",b=+i.community||0;if(zn())return qi(n,i,e),!0;if(!Object(Be.isNewMailPage)(n,i))return clog("[mail nav] Exit Mail"),void Mi();if((o.groupId?-o.groupId:0)===b){qi(n,i,e),m&&(Ot=!0),f.default.clearSystemMessage2();var y=u?toInt(u):_?toInt(_)+2e9:p?-toInt(p)-2e9:null,w="unread"===c||"important"===c||"unrespond"===c||"ad_tag"===c?c:"all",S=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(c),k=!S&&!!o.page,O=o.query!==g||o.tab!==v;o.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&Object(it.saveFolderScroll)(o.folder,se.getMainBody().scrollTop),k&&(o.page=null),O&&y&&("peers"===o.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===o.tab&&(store.mail.cur.mvk_entrypoint="message_search")),o.peerId&&!y&&g)clog("[mail nav] Peer back to Search"),o.query=g,o.peerId=null,o.tab=v,gn(),se.setQuery(g),wn();else if(O&&o.peerId===y)o.query=g,o.tab=v,s.search=[],o.tab!==v&&(store.mail.reached.search.msgs={}),re.redrawView(),se.setQuery(g),f.default.redrawSearch(),g?(clog("[mail nav] Search update"),wn()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],re.redrawView(),f.default.redrawSearch(),se.setQuery("")}(),0===s.folder.length&&yn());else if(S)clog("[mail nav] Enter Page: "+c),o.page=c,o.peerId&&(o.peerId=null,gn()),o.backUrl=Pi({peerId:y}),re.redrawView(),function(e){var t=store.mail.cur,n=se.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=l.default.html(Qe({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(i=Object(A.MailHat_page)(),a=Object(d.default)({mix:"messenger__body",inner:[ce()]}),r.default.html(ne(),i,a)),ajaxRequest(e,{},(function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e})));var i,a}(e);else{if(o.peerId&&o.peerId===y)return!0;o.peerId!==y||k&&y?y?(clog("[mail nav] Enter Dialog"),o.backUrl=Pi({peerId:y}),vn(y,m)):(clog("[mail nav] Exit Dialog"),gn(),hn(w),yn()):y&&h?(clog("[mail nav] Peer System Msg"),store.mail.peers[y].systemMessageCode=toInt(h),f.default.updateClass("peer"),f.default.redrawSystemMessage(),se.scrollConvoToBottom()):(o.folder!==w||k&&w)&&(clog("[mail nav] Enter Folder"),hn(w),yn())}return!0}}}function hn(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,a=n.scraps,o=n.rolls;i.folder=e,mn()?ln():(t.restoreScroll?a.folder=(o.folder[e]||[]).concat():a.folder=first(20,o.folder[e]),f.default.folderSetItems(a.folder),re.redrawView(),C.redraw()),t.restoreScroll?se.getMainBody().scrollTop=Object(it.restoreFolderScroll)(e):se.getMainBody().scrollTop=0}function mn(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,a=t.folder[n.folder];return!a||("important"===n.folder?a.some((function(e){return!i[e]})):a.some((function(e){return!(t.peer[e]&&t.peer[e].length>0)})))}function vn(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.peers,r=n.scraps,s=n.rolls,l=n.reached;if(o[e]){var c=s.peer[e]||[];if(t||!(o[e].countUnread>1)||o[e].isIncomingMR||o[e].isRejectedMR){i.peerId=e,r.peer=[],hi(),t?(r.peer=[t],s.peer[e]=[],l.peer.before[e]=!1,l.peer.after[e]=!1):(r.peer=last(20,c),_()),store.mail.reached.peer.after[e]=!0,f.default.updateClass("peer"),re.redrawView(),se.redrawConvoLayer(),yi(),C.startStatusUpdate(),Ue.default.checkStickers(),f.default.peerSetItems(r.peer),Pt(),st.ready().then((function(){h.default.init()})),t||An(e);var u=o[e];t&&(f.default.updateClass("peer"),re.scrollToMsg(t)),t?Sn(t):Sn(),Object(At.resizePosters)(),requestAnimationFrame((function(){t||(se.scrollConvoToBottom(),st.ready().then((function(){se.scrollConvoToBottom()}))),AudioMessagePlayer.redrawWaves(),requestAnimationFrame((function(){t||se.scrollConvoToBottom()}))})),u.banner&&"birthday"===u.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{se.setConvoLoading(!0),window._preventedCheckTop=!0,Ot=!0,i.peerId=e,r.peer=[],hi(),We.default.redrawUnread(e),re.redrawView(),se.redrawConvoLayer(),yi(),C.startStatusUpdate(),_(),f.default.peerSetItems([]),Pt(),st.ready().then((function(){h.default.init()}));var d={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};ajaxRequest("/mail",d,(function(t,n,i){if(store.mail.cur){var o=t.rolls.peer[e];if(storeMethods.injectMail(t),l.peer.after[e]=n,l.peer.before[e]=i,c=s.peer[e]||[],(Object(Pe.arrayIntersects)(o,c)||n&&0===c.length)&&(s.peer[e]=c.concat(o).filter(unique).sort(asc)),store.mail.cur.peerId===e){h.default.preventShowToBottom(),r.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",f.default.updateClass("peer"),f.default.peerSetItems(o),AudioMessagePlayer.redrawWaves(),An(e);var u=o.find((function(e){return a[e].isUnread}));re.scrollToMsg(u,!0,!1),requestAnimationFrame((function(){window._preventedCheckTop=!1,Ot=!1,se.setConvoLoading(!1)}))}}}))}}else ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(n){storeMethods.injectMail(n),o[e]?vn(e,t):window.location.reload()}));function _(){i.forwardFromId&&(ai(),i.forwardFromId=null)}}function gn(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;C.cancelStatusUpdate(),Oi(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],hi(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),re.redrawView(),C.redraw(),h.default.reset(),se.cleanConvoBody(),Mt(),requestAnimationFrame((function(){m.default.setCount(0),re.redrawMailActions(),Je.default.redraw(),requestAnimationFrame((function(){f.default.peerSetItems(i.peer)}))}))}function An(e){dt("read_dialog"+e,(function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0||n.isMarkedUnread?ajaxRequest("/mail",{act:"read_dialog",peer_id:e,mark_conversation_as_read:n.isMarkedUnread,hash:n.hashRead},(function(){$n(null,e)})):setTimeout((function(){$n(null,e)}),500)}(e)}))}function bn(e,t){dt("read_dialog"+t,(function(){!function(e,t){var n=store.mail.peers;if(!n)return;$n(null,t),ajaxRequest("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},(function(){}))}(e,t)}))}function yn(){var e=yn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.folder,l=a.folder,c=o.folder[s],u="folder_"+s,d=r.folder[s]&&last(l)===last(c);if(se.setMainLoading(0===l.length&&!d),!t[u]&&!d){var _="important"===s,p=mn(),h=_?desc:pi,m=[];if(0===l.length)m=first(20,c);else{var v=c.indexOf(last(l));m=v>=0?c.slice(v+1,v+21):[]}if(m.length&&!p){var g=l.concat(m).filter(unique).sort(h);a.folder=g,f.default.folderAddItems(m)}else{t[u]=!0;var A="all"===s?null:s,b=p?0:l.length;ajaxRequest("/mail",{act:A,offset:b},(function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach((function(e){store.mail.reached.peer.after[e]=!0})),"all"!==s&&"unread"!==s||Object.keys(e.msgs).forEach((function(t){t=toInt(t);var n=e.msgs[t].peerId;o.peer[n]=(o.peer[n]||[]).concat(t).filter(unique).sort(asc)}));var d=Object.keys(_?e.msgs:e.peers).map(toInt).sort(h).filter((function(e){return-1===l.indexOf(e)})),m=c.concat(d).filter(unique).sort(h);o.folder[s]=m,n&&(r.folder[s]=n),t[u]=!1,i.folder===s&&(a.folder=m,f.default.updateClass("folder"),f.default.folderAddItems(d),se.setMainLoading(!1),p&&(f.default.folderSetItems(a.folder),re.redrawView(),C.redraw()))}}))}}}function wn(){var e=wn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.tab,l=i.query,c="search_msgs_"+s+"_"+l,u=a.search,d=o.search[s][l]||[],_=r.search[s][l]&&last(u)===last(d);if(se.setMainLoading(0===u.length&&!_),!t[c]&&!_){var p=[];if("peers"===s&&(d.length||(d=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),a=QuickSearch.getQueryREs(t.query),o=[];return a.forEach((function(e){i.forEach((function(t){n[t].title.match(e)&&o.push(t)}))})),o.filter(unique).sort(pi)}()),d.length))if(0===u.length)p=first(20,d);else{var h=d.indexOf(u);p=h>=0?d.slice(h+1,h+41):[]}if(p.length&&(a.search=u.concat(p).filter(unique),f.default.redrawSearch(),f.default.updateClass("search"),se.setMainLoading(!1)),!p.length||"peers"===s){var m="msgs"===s?{act:"search",q:l,offset:a.search.length,messages:1}:{act:"search",q:l};e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){t[c]=!0,ajaxRequest("/mail",m,(function(e,n){if(store.mail.cur){t[c]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),_="peers"===s?pi:desc,p=d.concat(u).filter(unique).sort(_);o.search[s][l]=p,n&&(r.search[s][l]=n),i.tab===s&&i.query===l&&(se.setMainLoading(!1),a.search=a.search.concat(u).filter(unique).sort(_),f.default.redrawSearch(),f.default.updateClass("search"))}}))}),300)}}}function Sn(e){if(!$(".load_before_closed")){var t=Sn,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,o=i.scraps,r=i.rolls,s=i.reached;if(a){var l=a.peerId,c=o.peer,u=r.peer[l]||[],d="peer_before_"+l,_=s.peer.before[l]&&c[0]===u[0],p=a.msgReply[l];if(se.setConvoLoading(c.length<1&&!_),!n[d]&&!_){var m=se.getConvoBody(),v=!Object(Pe.arrayIntersects)(c,u),g=first(c),A=g?u.indexOf(g):-1,b=0===c.length?last(10,u):A>=0?u.slice(A-20,A):[];if(b.length&&!e){if(m.scrollTop>6e3&&!v)return;if(window._preventedCheckTop)return;var y=o.peer.slice(),w=c.concat(b).filter(unique).sort(asc);o.peer=w,f.default.peerAddItemsBefore(b.filter((function(e){return-1===y.indexOf(e)}))),AudioMessagePlayer.redrawWaves(),f.default.updateClass("peer"),se.setConvoLoading(!1)}else{if(!l)return;var S={act:"show",peer_id:l,msg:c[0],direction:e?"around":"before",reply_msg_id:p},k=c[0];n[d]=!0,ajaxRequest("/mail",S,(function(t,i,_){if(store.mail.cur){e&&setTimeout((function(){Ot=!1}),10);var p=a.peerId>0&&a.peerId<2e9;store.mail.flags.isPeerProfileEnabled&&p&&(store.mail.peers[l].peerProfileData=t.peers[l].peerProfileData,se.renderMessengerPeerProfile({tags:store.mail.peerProfileTags,tagsData:t.peers[l].peerProfileTagsData,data:t.peers[l].peerProfileData})),n[d]=!1,t.peers=[],storeMethods.injectMail(t);var g=Object.keys(t.msgs).map(toInt).filter((function(e){return-1===c.indexOf(e)})),A=c.concat(g).filter(unique).sort(asc);if(_&&(s.peer.before[l]=!0),i&&(s.peer.after[l]=!0),u=r.peer[l]||[],(Object(Pe.arrayIntersects)(A,u)||_&&0===u.length)&&(r.peer[l]=(r.peer[l]||[]).concat(A).filter(unique).sort(asc)),store.mail.cur.peerId===l){if(h.default.preventShowToBottom(),m.scrollTop>6e3&&!v)return;var b=o.peer.slice();o.peer=A,f.default.updateClass("peer"),k?(f.default.peerAddItemsBefore(g.filter((function(e){return-1===b.indexOf(e)&&e<k})),!0),f.default.peerAddItemsAfter(g.filter((function(e){return-1===b.indexOf(e)&&e>k})),!0)):f.default.peerAddItemsBefore(g,!0),e&&(re.scrollToMsg(e),se.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),g.forEach((function(e){CasperTimer.init(e)})),se.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),re.expandPeerBefore(),setTimeout(re.expandPeerBefore,100),e&&ai(),h.default.redrawReply()}}}))}}}}}function kn(){var e=kn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached;if(!Ot&&i){var s=i.peerId,l=a.peer,c=o.peer[s]||[],u="peer_after_"+s;if(!(t[u]||r.peer.after[s]&&last(l)===last(c))){var d=se.getConvoBody(),_=!Object(Pe.arrayIntersects)(l,c),p=function(){return d.scrollHeight-d.scrollTop-d.offsetHeight},h=last(l),m=h?c.indexOf(h):-1,v=m>=0?c.slice(m+1,m+21):[];if(!v.length||nav.getQuery("msg")||nav.getQuery("id")){if(!s)return;var g={act:"show",peer_id:s,msg:last(l),direction:"after"};t[u]=!0,ajaxRequest("/mail",g,(function(e,n){if(store.mail.cur){t[u]=!1,e.peers=[],storeMethods.injectMail(e);var i=Object.keys(e.msgs).map(toInt).filter((function(e){return-1===l.indexOf(e)})).sort(asc),d=l.concat(i).filter(unique).sort(asc);if(n&&(r.peer.after[s]=n),c=o.peer[s]||[],(Object(Pe.arrayIntersects)(d,c)||n&&0===c.length)&&(o.peer[s]=(o.peer[s]||[]).concat(d).filter(unique).sort(asc)),store.mail.cur.peerId===s){if(p()>6e3&&!_)return;n&&f.default.updateClass("peer"),a.peer=d,f.default.updateClass("peer"),f.default.peerAddItemsAfter(i),AudioMessagePlayer.redrawWaves()}}}))}else{if(p()>6e3&&!_)return;var A=l.concat(v).filter(unique).sort(asc);a.peer=A,f.default.peerAddItemsAfter(v),f.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}_n.clearTimer=function(){self=_n,self.timer&&(clearTimeout(self.timer),self.timer=null)};var On=!1;function Cn(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.rolls,o=e.scrollTop,r=e.scrollHeight,s=e.offsetHeight;if(n)if(!n.query&&o<=20&&i.folder.length){if(On){On=!1;i.folder.slice();i.folder=first(20,a.folder[n.folder]),f.default.folderCutItems(20)}}else o>20&&(On=!0,r-o-s<window.innerHeight&&(n.query?wn():yn()))}function jn(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,a=e.reached,o=n.peer,r=i.peer[t.peerId]||[];if(r.length&&last(o)===last(r)&&a.peer.after[t.peerId])se.scrollConvoToBottom(),h.default.hideToBottom(),f.default.updateClass("peer");else{var s=t.peerId;ajaxRequest("/mail",{act:"show",peer_id:s},(function(e,t){if(store.mail.cur){var o=e.rolls.peer[s];i.peer[s]=o.slice(),storeMethods.injectMail(e),a.peer.after[s]=!0,store.mail.cur.peerId===s&&(h.default.preventShowToBottom(),n.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",f.default.peerAddItemsBefore(o),f.default.updateClass("peer"),se.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}}))}}function En(e){var t=En;t.timer||(t.timer=setTimeout((function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.msgs,o=t.peers;if(!n)return;var r=i.peer.find((function(e){return a[e]&&a[e].isUnread&&a[e].authorId!==n.viewerId})),s=e.scrollTop,l=e.scrollHeight-s-e.offsetHeight;if(r){var c=xe.default.getElem(r),u=e.scrollHeight-c.offsetTop;l-u<=100&&An(n.peerId)}e._prevScroll||(e._prevScroll=0),l<300&&$(".mailScrap_reachedAfter")?h.default.hideToBottom():s>e._prevScroll-5||n.peerId&&o[n.peerId].countUnread?h.default.showToBottom():h.default.hideToBottom();e._prevScroll=s}(e)}),50))}function Tn(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function In(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.attaches,r=e.adminId,s=e.isService,l=e.isStealth,c=e.isOut,u=e.keyboard,d=e.ttl,_=e.ts,f=e.text,p=store.mail,h=(p.cur,p.peers),m=(p.msgs,p.members),v=h[n]&&h[n].pinnedMsgId===i,g=Object(Be.getMsgSendId)(e),A=Object(it.getPendingMsg)(g,n),b=!(!A&&!e.replaced);if(A?(rt.mark(g,"opt_to_lp"),t=function(e){return!!e.length}(o)):t=s||o.length||v||!h[n]||!m[a]||r&&!m[r],A){var y=function(e){var t=store.mail.cur;if(Object(it.removePendingMsg)(e),st.remove(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return et.getMsg(e)}(A),w=Object.assign({},A,{id:i,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:Tn(e),ts:_,ttl:d,text:Pn(f)});if(storeMethods.injectMsg(w),Mn(w,{existingElem:y}),!t)return void rt.clean(g)}if(!u||!u.inline){if((u||t)&&!c&&!e.edited)Object(it.getKeyboardState)(n).updateTime=Date.now();!u||t||c||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,a=e.keyboard,o=store.mail.peers[t];Object(it.clearCallbackButtons)(t),o&&(o.keyboard=Object(Be.prepareKeyboard)({keyboard:a,authorId:n,msgId:i}))}({peerId:n,authorId:a,msgId:i,keyboard:u})}if(t)return im.pause(),void mt({msgId:i,forcePinned:v,onTryError:function(e){var t=e.type;g&&(rt.error(g,"server_load_attach",t),rt.clean(g))},onResult:function(e){var t=e[0],a=e[1];g&&(rt.mark(g,"attach"),rt.clean(g)),store.mail.cur&&(storeMethods.injectMail(t),a&&function(e,t){var n=t.unpin,i=t.pinned,a=store.mail,o=a.cur,r=a.peers;if(n){r[e].pinnedMsg="",r[e].hasPinnedMsg=!1;var s=Si();delete s[e],ki(s),o.peerId===e&&(re.redrawPinnedMsg(),yi())}else i&&(r[e].pinnedMsg=i,r[e].hasPinnedMsg=!0,o.peerId===e&&(re.redrawPinnedMsg(),yi()))}(n,a),Mn(t.msgs[i],{isStealth:l,isServerMsg:!0,isReplace:b}),im.resume())}});var S=function(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.isOut,r=e.text,s=e.ts,l=e.flags,c=e.adminId,u=e.isService,d=e.ttl,_=e.isExpired,f=store.mail,p=f.cur,h=(f.peers,f.msgs),m=f.members,v=Object(Be.formatTime)(s,p.timeShift),g=h[i],A="";r&&(A=r.replace(/<br>/g,"\n").replace(Be.MENTION_DOMAIN_REGEXP,"@$3").replace(Be.MENTION_REGEXP,"@$1 ($3)"));t=e.replaced?!!g&&g.edited:!!e.edited;var b=r,y=Pn(r,l),w=e.keyboard;w=w&&w.inline?Object(Be.prepareKeyboard)({keyboard:w,authorId:a,msgId:i}):null;var S={id:i,peerId:n,authorId:a,ts:s,date:v,dateShort:v,text:y,textInput:A,body:b,isUnread:!g||g.isUnread,edited:t,canEdit:Tn(e),isOut:o,isService:u,keyboard:w,attaches:{},forwards:[],hasReply:!!e.hasReply,ttl:d,isExpired:Boolean(_)};c&&(S.adminName=c===p.userId?lang.mobile_mail_you:m[c].name,S.adminUrl=m[c].url);return S}(e);storeMethods.injectMsg(S),Mn(S,{isStealth:l,isReplace:b})}function Mn(e,t){var n=void 0===t?{}:t,i=n.isStealth,a=n.isServerMsg,o=n.isReplace,r=n.existingElem,s=store.mail,l=s.cur,c=s.peers,u=(s.msgs,s.members,s.rolls),d=s.scraps,_=s.reached,p=e.peerId,m=(e.keyboard,e.authorId),v=e.isOut,g=e.id,A=!v,b=c[p]&&0===c[p].countUnread&&A,y=o||!!e.edited,w=c[p],S=w.isIncomingMR,k=w.isRejectedMR,O=se.getConvoBody(),j=!1;if(e.isUnread&&(j=l.viewerId===p||l.peerId===p&&A&&O.scrollHeight-O.scrollTop-O.offsetHeight<400&&!!$(".mailScrap_reachedAfter")),j&&A&&!S&&!k&&bn(g,p),!y){var E=last(u.peer[p]||[]);u.peer[p]=(u.peer[p]||[]).concat(g).filter(unique).sort(asc),i||S||k||(u.folder.all=u.folder.all.concat(p).filter(unique).sort(pi),_.peer.after[p]||(_.peer.after[p]=!0,_.peer.before[p]=!1));var T=c[p];if(A&&(p===l.peerId&&h.default.renderKeyboardIfNeeded({update:!0}),i||(S||k||(u.folder.unread=u.folder.unread.concat(p).filter(unique).sort(pi)),a||(T.countUnread||(T.countUnread=0),T.countUnread+=1)),p!==l.peerId&&i||h.default.redrawToBottom()),!i&&!S&&!k)if(b&&(l.countUnread+=1,C.redrawCounter()),l.groupId&&(A?u.folder.unrespond=u.folder.unrespond.concat(p).filter(unique).sort(pi):Object(Pe.arrayRemove)(u.folder.unrespond,p)),"all"===l.folder){var I=d.folder.slice();d.folder=d.folder.concat(p).filter(unique).sort(pi),f.default.redrawFolder(I)}else if("unread"===l.folder&&m!==l.viewerId){var M=d.folder.slice();d.folder=d.folder.concat(p).filter(unique).sort(pi),f.default.redrawFolder(M)}else if("unrespond"===l.folder){var P=d.folder.slice();A?d.folder=d.folder.concat(p).filter(unique).sort(pi):Object(Pe.arrayRemove)(d.folder,p),f.default.redrawFolder(P)}if(S&&(u.mrs=u.mrs.concat(p).filter(unique).sort(pi),"mrs"===l.page)){var x=d.mrs.slice();d.mrs=d.mrs.concat(p).filter(unique).sort(pi),f.default.redrawMRs(x)}if(l.peerId!==p||!Object(Pe.arrayIntersects)(d.peer,u.peer[p])&&0!==d.peer.length||last(d.peer)!==E)r&&r.remove();else{d.peer.slice();d.peer=d.peer.concat(g).filter(unique).sort(asc);var L=xn((function(){r?f.default.peerAddElemAfter(g,r):f.default.peerAddItemsAfter([g])}));A&&!L&&h.default.showToBottom(),m===l.viewerId&&f.default.removeDivider()}var B=Object(Ze.uTyping_getPeerTyping)(p);B&&B.users.length&&(Object(it.removePeerTypingUser)(p,m),p===l.peerId&&Je.default.redraw(),We.default.redrawTyping(p))}var R=g===Object(We.uConvo_getLastMsgId)(p);y&&(Object(it.clearCallbackButtons)(p,g),R?xn((function(){return f.default.peerReplaceItems([g])})):f.default.peerReplaceItems([g])),!i&&R&&(We.default.redrawLastMsg(p),We.default.redrawUnread(p),StickersAnimation.checkSettingsAndLoad(e.id)),CasperTimer.init(e.id),p===l.peerId&&AudioMessagePlayer.redrawWaves(),e.attaches&&e.attaches.gift&&Ue.default.checkStickers({force:!0,ignore_hash:!0})}function Pn(e,t){return void 0===t&&(t=0),e=Object(Be.wrapLinks)(e,t),e=Object(Be.wrapMention)(e),e=Object(nt.emojiToHTML)(e)}function xn(e){var t=se.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&se.scrollConvoToBottom(),i}function Ln(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,Mt(),e)history.back();else un(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):(e.tab||e.peerId,"/mail")}(),{replace:!0})}}function Bn(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach((function(e){delete t[e]})),xe.default.unselectAll(),re.redrawMailActions(),n&&vn(n)}var Rn={};function Dn(e,t,n){var i=store.mail,a=i.cur,o=i.peers,r=o?o[e]:null;if(r&&!r.isIncomingMR&&!r.isRejectedMR){var s=Object(it.filterPeerTypingUser)({type:"text",users:t,count:n},a.viewerId);Object(it.setPeerTyping)(e,s);var l=Rn[e];l&&clearTimeout(l),s.count&&s.users.length&&(Rn[e]=setTimeout((function(){Rn[e]=null,Dn(e,[],0)}),7e3),Bi(s.users,e)),e===a.peerId&&Je.default.redraw(),We.default.redrawTyping(e)}}var Nn,Hn,Vn={};function Un(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(o?o[e]:null){var r=Object(it.filterPeerTypingUser)({type:"audio",users:t,count:n},a.viewerId);Object(it.setPeerTyping)(e,r);var s=Vn[e];s&&clearTimeout(s),r.count&&r.users.length&&(Vn[e]=setTimeout((function(){Vn[e]=null,Un(e,[],0)}),7e3),Bi(r.users,e)),e===a.peerId&&Je.default.redraw(),We.default.redrawTyping(e)}}function Fn(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,a=e.lastActionTime,o=store.mail,r=o.cur,s=o.peers[t];s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),a&&(s.lastActionTime=a),We.default.redrawOnline(t),r.peerId===t&&C.redrawOnline())}function $n(e,t){var n=store.mail,i=n.cur,a=n.peers,o=n.msgs,r=n.scraps,s=n.rolls;if(i){var l=i.peerId===t?r.peer:[],c=s.peer[t]||[],u=a[t];if(c.concat(l).forEach((function(e){var t=o[e];t&&t.isUnread&&t.authorId!==i.viewerId&&(delete t.isUnread,xe.default.markAsRead(e))})),u?u.countUnread&&(i.countUnread-=1,u.countUnread=0):i.countUnread-=1,Object(Pe.arrayRemove)(s.folder.unread,t),"unread"===i.folder){var d=r.folder.slice();Object(Pe.arrayRemove)(r.folder,t),f.default.redrawFolder(d)}C.redrawCounter(),h.default.redrawToBottom(),We.default.redrawUnread(t)}}function Wn(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.rolls,r=n.scraps,s=o.peer[t]||[];if(a[e])for(var l=s.indexOf(e);l>=0;){var c=a[s[l]];c.authorId===i.viewerId&&c.isUnread&&(delete c.isUnread,xe.default.markAsRead(c.id)),l--}else last(s)&&e<=last(s)&&s.forEach((function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,xe.default.markAsRead(t.id))}));i.peerId===t&&r.peer.forEach((function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,xe.default.markAsRead(t.id))})),We.default.redrawUnread(t)}function qn(){if(zn())return!0;var e=store.mail.cur;if(e&&(e.backUrl=null),e&&e.forwardFromId)return Bn(),!0;ve.default.safari_mobile&&document.activeElement.blur();var t=qs2obj(location.search.slice(1)).act;if(!$(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==t)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var n=new RegExp(/z=photo/).test(location.search);if($(".uMessenger")&&!n&&!ge("z_photoview")&&!ge("StoriesView")){var i=pn(location.pathname+location.search);return i&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),i}}function zn(){var e=zn;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout((function(){e.noAlert=!1}),10),!0}function Yn(e,t,n,i){void 0===i&&(i={});var a=store.mail.cur;if(gt.EduIntegration.isIntegrated&&!t.edu_force){if(!gt.EduIntegration.isNewMail)return delete t._eat,delete t.forced_color_scheme_mode,gt.EduIntegration.embedded.sendMessage("nav",{isNewMail:Object(Be.isNewMailPage)(e,t),path:e,query:t,url:n}),!0;if(!Object(Be.isNewMailPage)(e,t))return delete t._eat,delete t.forced_color_scheme_mode,gt.EduIntegration.embedded.sendMessage("nav",{isNewMail:!1,path:e,query:t,url:n}),a||setTimeout((function(){location.reload()})),!0}if(!("/mail"===n&&a&&a.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?un(n):void 0}function Gn(){window.isNewMail&&(store.mail.cur?Object(Be.isNewMailPage)(location.pathname,location.search)?Ii():Mi():_n.clearTimer())}function Qn(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,a=t.msgSelected,o=toInt(Object.keys(a)[0]),r=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},r.pinnedMsgId=o,r.hasPinnedMsg=!0,xe.default.unselectAll(),re.redrawMailActions(),ajaxRequest("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:o,_ajax:1})}function Kn(){var e,t=store.mail,n=t.cur,i=t.msgs,a=(t.peers,t.hash),o=(t.replies,t.pendingReplies,n.msgSelected),r=toInt(Object.keys(o)[0]),s=n.peerId,l=Object(it.getPeerDraft)(n.viewerId,n.peerId),c=i[r],u=function(e){c.hasReply||l&&l.editing&&l.editing.id==r&&l.msgs&&(n.msgAttached[s]=l.msgs),c.hasReply?n.msgReply[s]=c.reply:n.msgReply[s]=null,h.default.redrawReply(),h.default.onAttachedMsgsRemove(),h.default.uiRedrawAttachments(s),h.default.setModifiers({editing:!0}),C.setModifiers({editing:!0}),re.redrawMailActions(),Xn(),h.default.setText(e)};if(n.editing==r)return e=l&&l.editing&&l.editing.id==r?l.editing.text||"":c.textInput,void u(e);n.editing=r,Ci(),ajaxRequest("/mail?act=edit_message_start",{hash:a.edit,edit_msg_id:r,peerId:s,_ajax:1},(function(e,t){Object(it.pushPeerAttachments)(n.peerId,e),u(t)}))}function Xn(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach((function(t){delete e[t]})),xe.default.unselectAll(),m.default.setCount(0),re.redrawMailActions()}function Jn(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(Zn);1!==Object.keys(t.msgSelected).length||n?Le.default.open({canDeleteForAll:n}):ti()}function Zn(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),a=vk.id,o=n[e],r=nav.getQuery().community,s=i[o.peerId];return!!o&&(o.authorId!==a&&o.authorId!==-r?s.isAdmin&&-1===s.adminIds.indexOf(o.authorId):!(o.peerId===a&&!r)&&(333!==o.peerId&&(!(Date.now()/1e3-o.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function ei(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),a=n.peerId;qt(e),ajaxRequest("/mail",{act:"delete_for_all",peer:a,ids:e+"",hash:i[a].hashRemove},(function(){})),re.redrawMailActions()}(e),Oi(!0)):ti(!1,Le.default.isDeleteMessagesForAll()),Le.default.close()}function ti(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,a=(n.hash,n.msgs,n.peers),o=i.peerId,r=i.msgRemoved,s=i.msgSelected,l=Object.keys(s);l.forEach((function(n){delete s[n=+n],t?qt(n):(r[n]=!e||"spam",e?xe.default.spam(n):xe.default.remove(n))})),ajaxRequest("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:o,ids:l.join(","),hash:a[o].hashRemove},(function(){})),re.redrawMailActions()}function ni(){ti(!0)}function ii(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,a=t.msgSelected,o=Object.keys(a),r=o.some((function(e){return!i[e].isImportant}))?1:0;o.forEach((function(e){delete a[e],i[e].isImportant!=!!r&&(r?t.countImportant++:t.countImportant--),i[e].isImportant=!!r,xe.default.toggleImportant([e],!!r)})),ajaxRequest("/mail",{act:"mark_important",ids:o,hash:n.important,val:r},(function(){})),xe.default.unselectAll(),re.redrawMailActions()}function ai(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,Object(it.setPeerDraft)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},xe.default.unselectAll(),m.default.setCount(0),h.default.redrawReply(),h.default.uiRedrawAttachments(t),re.redrawMailActions()}function oi(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,a=t.peerId;if(!Object(Be.isContactPeer)(a)){if(!n.replies)return ai();var o=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[a]=o,i[o]=xe.default.getReplyDataFromHTML(o),Object(it.setPeerDraft)(t.viewerId,t.peerId,{reply:o,msgs:void 0},t.editing),ajaxRequest("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:o}),t.msgAttached[a]=[],t.msgSelected={},xe.default.unselectAll(),m.default.setCount(0),h.default.redrawReply(),h.default.uiRedrawAttachments(a),re.redrawMailActions(),h.default.openKeyboard("text")}}function ri(){var e=store.mail.cur;if(e){var t=e.msgSelected,n=Object.keys(t);Object(Be.isContactPeer)(e.peerId)||li(n)&&(e.forwardFromId=e.peerId,e.query="",e.tab="peers",se.setQuerySilently(""),gn({keepSelected:!0}),hn("all",{restoreScroll:!1}),yn())}}function si(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=t.msgs,o=t.flags,r=n.msgRemoved,s=n.msgSelected,l=i[n.peerId];if(h.default.hideStickersPanel(),!r[e]){s[e]?delete s[e]:s[e]=!0;var c=Object.keys(s),u=c.length,d=1===u&&c[0]==i[n.peerId].pinnedMsgId,_=c.reduce((function(e,t){return e&&a[t].isImportant}),!0),f=c.some((function(e){return a[e].ttl}));m.default.setCount(u),m.default.setModifiers({pinned:d,important:_}),m.default.setLabels({pinned:d,important:_}),Object(Be.isContactPeer)(n.peerId)?m.default.toggleQuickButtons(!1):m.default.toggleQuickButtons(!0),o.replies&&(1!==u||l.isIncomingMR?m.default.setReplyAvailable(!1):m.default.setReplyAvailable(!0));var p=toInt(Object.keys(s)[0]),v=1==u&&a[p];if(m.default.setEditAvailable(v&&v.canEdit&&!l.unableToWrite),m.default.setImportantAvailable(u>0&&n.viewerId>0),m.default.setForwardAvailable(li(c)),l.canPin&&function(e){var t=store.mail.msgs[e];if(!t)return!1;return!t.noPin}(p)){var g=toInt(Object.keys(s)[0]);m.default.togglePin(1===u&&g!==l.pinnedMsgId)}else m.default.togglePin(!1);m.default.setForwardAvailable(!0),f&&(m.default.setImportantAvailable(!1),m.default.togglePin(!1),m.default.setForwardAvailable(!1)),re.redrawMailActions()}}}function li(e){var t=store.mail.msgs;return 0===e.filter((function(e){return t[e]&&t[e].noForward})).length}function ci(e){var t=store.mail,n=t.cur,i=t.hash,a=t.msgs[e],o="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],xe.default.restore(e),ajaxRequest("/mail",{act:o,id:e,hash:i.restore},(function(){})),a.isImportant&&(n.countImportant++,$t(e)),f.default.redrawFolder()}function ui(e){var t=store&&store.mail&&store.mail.cur;if(t&&e){var n=store.mail.msgs[e],i=!n;if((!n||n.peerId&&n.peerId===t.peerId)&&!t.msgRemoved[e])re.scrollToMsg(e)||(i=!0),i&&ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},(function(t){storeMethods.injectMail(t);var n=store.mail,i=n.msgs,a=n.cur;a.peerId&&i[e]&&!i[e].isDeletedForAll&&vn(a.peerId,e)}))}}function di(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var a=store.mail.forwards[n];if(a.peerId&&a.peerId===i.peerId&&!i.msgRemoved[e])re.scrollToMsg(e)||ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},(function(i){storeMethods.injectMail(i);var a=store.mail,o=a.msgs,r=a.cur;r.peerId&&(!o[e]||o[e].isDeletedForAll?_i(e,t,n):vn(r.peerId,e))}));else _i(e,t,n)}else _i(e,t,n)}function _i(e,t,n){var i=nav.getQuery();t&&"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}));var a=i&&i.chat?Object(xe.Msg_makePinnedReplyLink)(i.chat,n):Object(xe.Msg_makeReplyLink)(e,t,n);nav.go(a,null,{force:!0})}function fi(e){var t,n=store.mail.cur;n&&li([e])&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),ri())}function pi(e,t){var n=store.mail,i=n.rolls,a=n.presend,o=n.msgs,r=i.peer[e]||[0],s=i.peer[t]||[0],l=Di(a.pending[e],(function(e){return-1===e.indexOf("edit")})),c=Di(a.pending[t],(function(e){return-1===e.indexOf("edit")})),u=last(r),d=last(s),_=u&&o[u].majorSortId||0,f=d&&o[d].majorSortId||0,p=u&&o[u].id||0,h=d&&o[d].id||0,m=l&&a.msgs[l].ts||0,v=c&&a.msgs[c].ts||0;return v||(v=d&&o[d].ts||0),m?v-m:_!==f?f-_:h-p}function hi(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach((function(t){return t.classList.toggle("messenger_noPullToRefresh",e)}))}}function mi(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){Number(t.dataset.id);var n=Si();delete n[e],ki(n),yi()}}function vi(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=Si();i[e]=n,ki(i),yi()}}function gi(){var e=store.mail.cur.peerId,t=store.mail.hash;Xt(e,!0),ajaxRequest("/mail",{act:"mark_dialog_as_unread",peer_id:e,hash:t.markDialogAsUnread},(function(t){t.error&&Xt(e,!1)})),Ln()}function Ai(e,t){var n,i=store.mail,a=i.cur,o=i.peers[a.peerId],r=o.banner;void 0!==t&&(n=o.banner&&o.banner.buttons[t],"birthday"===r.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",a.peerId)),ajaxRequest("/mail",{act:"banner_callback",hash:o.hashBanner,peer_id:a.peerId,callback_data:n&&n.callback_data}),Ct=Date.now(),o.banner=null,re.redrawBanner()}function bi(e){var t=$(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function yi(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=$(".pinnedMsg"),a=Si()[n],o=i?intval(i.dataset.id):null;re.setPinnedVisibility(o&&a!==o)}}}function wi(){if(store.mail.cur&&store.mail.cur.peerId){var e=$(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=Si();delete n[t],ki(n)}}}function Si(){return lsGet("messenger.pinHidden")||{}}function ki(e){lsSet("messenger.pinHidden",e)}function Oi(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,Ci(),!0!==e&&ajaxRequest("/mail?act=edit_message_cancel",{peerId:t.peerId}),Object(it.popPeerAttachments)(t.peerId),Object(it.setPeerDraft)(t.viewerId,t.peerId,{});var n=Object(it.getPeerDraft)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,h.default.setText(n&&n.text||""),h.default.setModifiers({editing:!1}),C.setModifiers({editing:!1}),h.default.uiRedrawAttachments(t.peerId),h.default.redrawReply();var i=se.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&se.scrollConvoToBottom()}}function Ci(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function ji(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,Kn())}}function Ei(e){var t=e.closest("."+xe.default.class);if(t){var n=xe.default.getId(t);store.mail.msgs[n].textFull=xe.default.getTextHtml(t)}}function Ti(e){un(e)}function Ii(){var e;store.mail.cur&&(window.isCustomScroll&&Object(Ae.restoreDocumentScroll)(),!store.mail.cur&&!store.mail.page||store.mail.cur.peerId||Mt(),store.mail.cur.peerId&&Pt(),st.ready().then(Li).then((function(){Ri(),store.mail.cur.peerId&&(h.default.init(),$n(0,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||se.scrollConvoToBottom()})),im.on(),Ke||((Ke=new lt.default({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",_t),Ke.on("unidle",ct)),Xe={},Ke.start(),e=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=e.mvk_entrypoint||"notifications"===e.from&&"notifications"||"",re.startPolling(),addEvent(window,"resize",At.resizePosters),navigator.setAppBadge&&navigator.setAppBadge(store.mail.cur.countUnread),ot.onOpenCallback(Ui),ot.onCloseCallback(Fi),gt.EduIntegration.onMessage.on("edu",Wi))}function Mi(){if(gt.EduIntegration.onMessage.off("edu",Wi),store.mail.cur){if(ot.onOpenCallback(Ui),ot.onCloseCallback(Fi),!document.body.classList.contains("vk__page_mail"))return im.off(),ut(),void storeMethods.resetMail();Object(Ae.restoreDocumentScroll)(),se.cleanConvoBody(),im.off(),ut(),re.stopPolling(),C.cancelStatusUpdate(),f.default.resetPrevScraps(),storeMethods.resetMail()}}function Pi(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var a="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+a}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var o="";"all"!==n.folder&&(o="?act="+n.folder),i="/mail"+o}return i}function xi(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,kt=!0,store.mail.rolls.mrs=[],t.forEach((function(e){Object(it.removePeer)(e)})),ajaxRequest("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},(function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,kt=!1,void Qe.cancelRejeectLoading();re.redrawView(),un("/mail")}),(function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,kt=!1,Qe.cancelRejeectLoading()}))}function Li(){store.mail.cur&&Object(it.queueToPresendMsgs)(st.getItems())}function Bi(e,t){var n=store.mail.members;(e=e.filter((function(e){return!n[e]}))).length&&(jt=jt.concat(e),Et.push(t),Tt())}function Ri(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(pi),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(pi),f.default.redrawFolder())}function Di(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function Ni(){im.abortWaiting()}function Hi(e){var t=+e.getAttribute("data-msg");if(t&&!Object(Be.isForwardedMessageId)(t)&&store.mail.cur){var n=store.mail.msgs[t],i=n&&store.mail.peers[n.peerId];i&&!n.listened&&n.authorId!==store.mail.cur.viewerId&&n.peerId===store.mail.cur.peerId&&Object(Be.mailRequest)("/mail",{act:"listen_audiomsg",msg_id:t,hash:i.hashRead})}}function Vi(e,t){He.showCaptcha(e,t)}function Ui(){Nn&&clearTimeout(Nn),Nn=setTimeout((function(){return addClass($(".messenger__layer_convo"),$i())}),200)}function Fi(){Nn&&clearTimeout(Nn),Nn=setTimeout((function(){return removeClass($(".messenger__layer_convo"),$i())}),200)}function $i(){return Hn||(Hn="messenger__layer_convo--iosKeyboard",at.isIPad&&at.isIOSChrome&&at.iosMajor>=11&&(Hn="messenger__layer_convo--iosKeyboardChrome"),Hn)}function Wi(e,t){("nav"===e&&t.url&&(un(t.url)||nav.go(t.url)),"reload_current_chat"===e)&&vn(store.mail.cur.peerId)}function qi(e,t,n){gt.EduIntegration.isIntegrated&&gt.EduIntegration.embedded.sendMessage("nav_info",{isNewMail:!0,path:e,query:t,url:n})}function zi(){var e=store.mail.cur;if(e){var t=e.peerId,n=t>=2e9,i=store.mail.peers[t];i&&gt.EduIntegration.isIntegrated&&gt.EduIntegration.embedded.sendMessage("call",{isGroup:n,peerId:t,peer:i})}}t.default=re;window.uMessenger=re,window.Messenger=se},"4bPz":function(e,t,n){"use strict";n.r(t);var i=n("+cqQ");window.uVK={onReady:Object(i.default)(),onResize:Object(i.default)(),onOrientationChange:Object(i.default)()},onDOMReady((function(){if(window.isNewMail&&document.body){window.uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}}))},"4fRq":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},"4qiT":function(e,t){var n={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.store.offset?this.store.offset:this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push((function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)})))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,a=t.content,o=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),o&&window.scrollTop()+2*window.innerHeight>a.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),(function(t){e.elems.content.innerHTML+=t}))},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_link",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,(function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")}))},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,a){e.preventDefault(),this._closeUnfold(e);var o=+domData(t,"is-bookmarked"),r=o?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:r,item_type:5,item_oid:n,item_id:i,hash:a},{onDone:function(e,n,i){domData(t,"is-bookmarked",o?0:1),o?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,a){var o=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:a},{onDone:function(){o.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){a.updateList()}})}};window.AuthorPage=n},"6Mr/":function(e,t,n){"use strict";n.r(t),n.d(t,"TOOLTIP_ID_VIDEO_FILTER",(function(){return o}));var i=n("Ubt6"),a=n("nj7l");n.d(t,"setShown",(function(){return a.setShown})),n.d(t,"canShow",(function(){return a.canShow})),n.d(t,"initShownTooltips",(function(){return a.initShownTooltips}));var o="mvk:video_filters";t.default=i.default,window.Tooltip={initShownTooltips:a.initShownTooltips,initEnabledTooltips:a.initEnabledTooltips}},"75Qd":function(e,t,n){"use strict";n.r(t);n("XCiN");var i=n("OcsD"),a=n("aJgW"),o=n("CQvH"),r=n("a0wW"),s=n("z9sQ"),l=n("+cqQ"),c=n("TYsd"),u=n("chpQ"),d=n("qHA9");window.EduIntegration=u.EduIntegration,window.mobileEduIntegrationInit=function(e){e.isNewMail=Object(d.isNewMailPage)(location.pathname,location.search),u.EduIntegration.init(e)};var _,f,p=n("Cbap"),h=n("tgcV"),m=n("FbVm"),v=n("r0fY"),g=n("T24x"),A=new m.ProductionStatCollector,b=new m.NavigationStatCollector(A);g.default.onChanged((function(){return b.addStatEvent(b.getModule(),m.NavigationProductionStatEventTypes.GO)})),function(e){e.PAYMENT_FORM="payment_form",e.PAYMENT_FORM_CLICK_OFFER="payment_form_click_offer",e.PAYMENT_FORM_CLICK_PAY="payment_form_click_pay",e.PAYMENT_FORM_CLICK_CLOSE="payment_form_click_close",e.PAYMENT_FORM_CHANGE_CLICK_CHANGE="payment_form_change_click_change",e.CLICK_SHOW_MORE="click_show_more",e.WIDGET_VIEW="widget_view",e.DESCRIPTION_VIEW="description_view"}(_||(_={})),function(e){e.PAYMENT_START="payment_start",e.DATA_ACCESS="data_access",e.RESULT_PAYMENT_SUCCESS_OK="result_payment_success_ok",e.RESULT_PAYMENT_SUCCESS_WAITING="result_payment_success_waiting",e.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT="result_payment_success_waiting_timeout",e.RESULT_RESUB_SUCCESS_WAITING="result_resub_success_waiting",e.RESULT_RESUB_SUCCESS_WAITING_OK="result_resub_success_waiting_ok",e.RESULT_PAYMENT_UNAVAILABLE="result_payment_unavailable",e.RESULT_PAYMENT_CANCEL="result_payment_cancel",e.RESULT_ERROR="result_error",e.CHANGE_START="change_start",e.RESULT_CHANGE_ERROR="result_change_error",e.RESULT_CHANGE_SUCCESS_OK="result_change_success_ok",e.RESULT_CHANGE_SUCCESS_WAITING="result_change_success_waiting",e.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT="result_change_success_waiting_timeout",e.RESULT_CHANGE_UNAVAILABLE="result_change_unavailable",e.UNKNOWN="donut_payment_screen_unknown"}(f||(f={}));var y=function(){return(y=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},w=new(function(){function e(){this.productionStatCollector=new m.ProductionStatCollector,this.actionStatCollector=new m.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEventAction=function(t){return this.actionStatCollector.logEvent(e.createDonutActionStatEvent(t))},e.prototype.logEventActionView=function(e){return this.logEventAction(y(y({},e),{event_type:_.PAYMENT_FORM}))},e.createDonutActionStatEvent=function(e){var t;return(t={type:v.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM})[v.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM]=e,t},e}()),S=n("HLtZ");function k(e){var t=function(e){try{return JSON.parse(e)}catch(n){var t={environment:"parseJsonError",breadcrumb:{message:"Uncaught json parse error",data:{json:e},category:"custom"}};return Object(S.logError)(n,t),{}}}(e),n=t.type_property,i=t.params;n===v.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM&&w.logEventAction({event_type:i.event_type,source:i.source,owner_id:i.owner_id})}var O=n("BZzM"),C=(n("eGQV"),n("uQjJ"),n("jk6M")),j=(n("wcVR"),n("kr3z")),E=n("wx14"),T=n("Y6JH"),I=n("V4qE"),M=n("UxAg"),P={isUploading:!1,onBeforeRemove:Object(l.default)(),onRemove:Object(l.default)("removeElem"),onStart:Object(l.default)(),onError:Object(l.default)("response"),onComplete:Object(l.default)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),(function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}})),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),a=geByTag1("input",i),o=intval((a&&a.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var r=attr("add_post_btn","data-value");r&&val("add_post_btn",r)}else o&&each(geByTag("input",t),(function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==o?this.disabled=!0:e>o&&(this.name="attach"+(e-1)+(n[2]||""))}}))}},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=P.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),a=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),a){toggleClass("cp_attachBtnEl_sel",a,e>0);var o=geByClass1("inline_upload",a);if(o||(o=geByClass1("inline_upload",a.parentNode)),o){var r=attr(o,"data-max-attaches")||10;o.disabled=e>=r}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!P._processUploadQueue||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(c.default.html(t))},attachedTpl:function(e){void 0===e&&(e={});var t=e,n=t.id,i=t.type,a=["medias_row","mr_x_wrap","thumb_upload"];i&&a.push("attachment_type_"+i);var o={inner:[{inner:[{inner:[{inner:[Object(T.default)({sprite:"wall",name:"document_24"})],class:"medias_link_icon",tag:"span"}],class:"medias_link_icon",tag:"span"},{inner:[{inner:[e.label],class:"medias_link_labeled medias_link_title",tag:"span"}],class:"medias_link_texts",tag:"span"}],class:"mr_label medias_link",tag:"span"},{inner:[{class:"tu_progress",id:"item_progress_"+n,tag:"div"}],class:"tu_progress_wrap",id:"item_progress_wrap_"+n,tag:"div"},{inner:[{class:"tu_progress",id:"item_cancel_"+n,tag:"div"}],class:"tu_cancel_wrap",id:"item_cancel_wrap_"+n,onclick:"return mediaUpload.reset(this, event, '"+n+"');",tag:"div"}],id:"upload_item_"+n,class:a,tag:"div"};return ceFromString(c.default.html([o]))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)P.onUploadError.call(t,e);else{var a=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(a)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),o=P.getLastAttachId()+1,r=ge("upload_item_"+t.id);if(r&&r.classList.add("thumb_uploaded"),a?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=Object(M.$)('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n)if(e.src)var s=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(a&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(s,n),t.iw&&t.ih){if(t.iw>t.ih==s.width>s.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(s,"width",i)}reflow(s),setStyle(s,"opacity",1)},src:e.src});else{var l=ge("upload_image_"+t.id);setStyle(l,"opacity",1)}var c=t.attach_type||"photo",u=(e.hash,e.photo_raw);t.attach_type&&"photo"!==t.attach_type&&(u=e.owner_id+"_"+e.id),r&&(r.appendChild(ce("input",{type:"hidden",name:"attach"+o,value:u})),r.appendChild(ce("input",{type:"hidden",name:"attach"+o+"_type",value:c}))),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,P._processUploadQueue||(P.isUploading=!1,P.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,P.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),Snackbar.init({text:"blog"===cur.module?lang.mobile_jobs_upload_error:lang.mobile_unknown_error,type:I.SNACKBAR_TYPE_ERROR}),this.id&&P.reset(null,null,this.id),P.uploadQueueNext(),P.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=e.file_attr_name||"photo",i=JSON.parse(e.upload_params);e.xhr=uploadFile(e.upload_url,Object(E.default)(((t={})[n]=e.file,t),i),{onProgress:bind(P.onUploadProgress,e),onComplete:bind(P.onUploadComplete,e),onError:bind(P.onUploadError,e)})})),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){readFile(e.file,(function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});P.readerQueueNext()}))})),addFile:function(e){var t,n=ge("attached_wrap"),i=geByClass1("pi_medias",n),a=i?geByClass("medias_thumb",i):[],o=i?geByClass1("medias_row",i):null,r=a[a.length-1],s=e.attach_type||"photo";if(t="photo"===s?P.attachedPhotoTpl(e.id):P.attachedTpl({id:e.id,type:s,label:e.file?e.file.name:""}),n){if(window.ThumbsEdit&&ThumbsEdit.initialized)readFile(e.file,(function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,a=n.height;window.fakeImg=n;var o=getImageOrientation(t);t="/images/blank.gif";var r=!1;o>4&&o<9&&(r=!0);var s=["photo",e.id,{sizes:{temp:[t,r?a:i,r?i:a]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}}));else{if(!i){var l=geByClass1("AddedAttach",n);i=ce("div",{className:"pi_medias"}),append(i,l||n)}r?after(t,r):o?before(t,o):append(t,i)}P._processReaderQueue||P.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),P._processUploadQueue=!0;var e=P.uploadQueueRemove();if(!e)return clog("empty upload"),P._processUploadQueue=!1,void(P.isUploading=!1);P.uploadFile(e)},readerQueueNext:function(){clog("next reader"),P._processReaderQueue=!0;var e=P.readerQueueRemove();if(!e)return clog("empty reader"),void(P._processReaderQueue=!1);P.readFile(e)},queueInsert:function(e){var t=srand();return P.getUploadDataById(t)?P.queueInsert(e):(P._uploadData[t]=extend(e,{id:t}),P._uploadQueue.push(t),P._readerQueue.push(t),P._uploadData[t])},uploadQueueRemove:function(){var e=P._uploadQueue.shift();return!!e&&P.getUploadDataById(e)},readerQueueRemove:function(){var e=P._readerQueue.shift();return!!e&&P.getUploadDataById(e)},getUploadDataById:function(e){return P._uploadData[e]||!1},delUploadDataById:function(e){delete P._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return P.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),a=submitBtn(i),o=ge("attach_photo_btn"),r=attr(e,"data-upload-url"),s=attr(e,"data-upload-params"),l=domData(e,"file-attr-name"),c=domData(e,"attach-type"),u=attr(e,"data-done-url"),d=attr(e,"data-max-attaches")||10,_=P.getAttachesCount();return r&&u?(each(n,(function(){var e={attach_type:c,file_attr_name:l,upload_url:r,upload_params:s,done_url:u,file:this,uploaded:!1,attached:!1};if(_>=d)return!1;P.queueInsert(e),P.addFile(e),_++})),removeEvent(i,"submit",P.checkUploading),addEvent(i,"submit",P.checkUploading),removeEvent(a,"click",P.checkUploading),addEvent(a,"click",P.checkUploading),removeEvent(o,"click",P.checkUploading),addEvent(o,"click",P.checkUploading),P.refreshUploadState(_),replace(clone(e),e),P._processUploadQueue||P.uploadQueueNext(),window.isNewMail&&P.onStart(),P.isUploading=!0,!1):P.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&P.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),P.refreshAttachIds(e);var a=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(a)}else{var o=n,r=P.getUploadDataById(o);if(!r)return!1;r.attached?r.delete_url&&(ajax.post(r.delete_url,{_ajax:1}),P.refreshAttachIds(e)):(r.xhr&&r.xhr.abort&&r.xhr.abort(),r.loaded||P.uploadQueueNext()),i?i():remove("upload_item_"+o),P.delUploadDataById(o)}return P.refreshUploadState(),window.isNewMail&&P.onRemove(e),Replies.abortTimer("editing"),!1},onUnfoldItemClick:function(e,t){var n=Object(M.$)('[type="file"]',t);e.target!==n&&n.click()}};window.mediaUpload=P;var x=n("cGUQ"),L=n("PU8N"),B=function(e,t,n,i,a,o,r,s,l,c,u){var d=s||i,_=l||a,f=c||o||t.naturalWidth,p=u||r||t.naturalHeight;e.beginPath(),e.arc(d+n,_+n,n,Math.PI,Math.PI+Math.PI/2),e.lineTo(d+f-n,_),e.arc(d+f-n,_+n,n,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(d+f,_+p-n),e.arc(d+f-n,_+p-n,n,2*Math.PI,Math.PI/2),e.lineTo(d+n,_+p),e.arc(d+n,_+p-n,n,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,i,a,o,r,s,l,c,u),e.restore()},R=function(e,t,n,i,a,o){var r={};if("number"==typeof o)r={tl:o,tr:o,br:o,bl:o};else{var s={tl:0,tr:0,br:0,bl:0};for(var l in s)r[l]=r[l]||s[l]}e.save(),e.beginPath(),e.moveTo(t+r.tl,n),e.lineTo(t+i-r.tr,n),e.quadraticCurveTo(t+i,n,t+i,n+r.tr),e.lineTo(t+i,n+a-r.br),e.quadraticCurveTo(t+i,n+a,t+i-r.br,n+a),e.lineTo(t+r.bl,n+a),e.quadraticCurveTo(t,n+a,t,n+a-r.bl),e.lineTo(t,n+r.tl),e.quadraticCurveTo(t,n,t+r.tl,n),e.closePath(),e.restore()};function D(e,t,n){var i=Object.assign({},{pollStickerX:157,pollStickerY:1075,pollStickerWidth:760,pollStickerHeight:391},n||{}),a=i.pollStickerX,o=i.pollStickerY,r=i.pollStickerWidth,s=i.pollStickerHeight;return{type:"poll",poll_id:t,poll_owner_id:e,clickable_area:[{x:a,y:o},{x:a+r,y:o},{x:a,y:o+s},{x:a+r,y:o+s}]}}var N={title:"",titleColor:"#000",titleAlign:"center",titleFontSize:58,titleFont:"TT Commons",voteButtonText:window.getLang("stories_poll_sticker_vote_button_text"),voteButtonTextAlign:"center",voteButtonTextColor:"#fff",voteButtonFontSize:49,voteButtonFont:"TT Commons",voteButtonBackgroundColor:"#3F8AE0",width:760,height:391,radius:50,offset:45,backgroundColor:"#fff",backgroundCircleColor:"#fff",backgroundCircleSize:90,foregroundCircleColor:"#3F8AE0",foregroundCircleSize:72};function H(e){return Object(L.loadImage)("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDJhMiAyIDAgMTE0IDB2MjBhMiAyIDAgMTEtNCAwVjJ6bTggMTJhMiAyIDAgMTE0IDB2OGEyIDIgMCAxMS00IDB2LTh6TTIgOGEyIDIgMCAwMC0yIDJ2MTJhMiAyIDAgMTA0IDBWMTBhMiAyIDAgMDAtMi0yeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==").then((function(t){return new Promise((function(n){var i=Object.assign({},H.defaultOptions,e||{}),a=i.title,o=i.titleColor,r=i.titleAlign,s=i.titleFontSize,l=i.titleFont,c=i.voteButtonText,u=i.voteButtonTextAlign,d=i.voteButtonTextColor,_=i.voteButtonFontSize,f=i.voteButtonFont,p=i.voteButtonBackgroundColor,h=i.width,m=i.height,v=i.radius,g=i.offset,A=i.backgroundColor,b=i.backgroundCircleColor,y=i.backgroundCircleSize,w=i.foregroundCircleColor,S=i.foregroundCircleSize,k=document.createElement("canvas"),O=k.getContext("2d");k.width=h,k.height=m+g,O.fillStyle=A,R(O,0,g,h,m,v),O.fill(),O.fillStyle=b,O.beginPath(),O.arc(h/2,y,y,0,2*Math.PI,!1),O.fill(),O.fillStyle=w,O.beginPath(),O.arc(h/2,y,S,0,2*Math.PI,!1),O.fill();O.drawImage(t,h/2-27,y-36,54,72),O.save(),O.font="500 "+s+"px "+l,O.fillStyle=o,O.textAlign=r,O.fillText(a,h/2,230),O.restore(),O.save();var C=h-75,j=(h-C)/2,E=m+g-103-35;O.fillStyle=p,R(O,j,E,C,103,29),O.fill(),O.restore(),O.save();var T=h/2,I=m+g-103+30;O.font="500 "+_+"px "+f,O.fillStyle=d,O.textAlign=u,O.fillText(c,T,I),O.restore(),n(k)}))}))}H.defaultOptions=N;var V={newAvatarUrl:"",oldAvatarUrl:"",newAvatarStrokeWidth:17,newAvatarStrokeColor:"#fff",oldAvatarStrokeWidth:17,oldAvatarStrokeColor:"#fff",baseWidth:1080,baseHeight:1920,displayWidth:375,backgroundColor:"rgba(0, 0, 0, .16)",newAvatarInBackgroundBlur:160,avatarWidth:500,title:window.getLang("stories_new_avatar_story_title_header"),titleColor:"#fff",titleTextAlign:"center",titleFont:"TT Commons",titleFontSize:69,titleLineHeight:87,titleShadowOffsetX:0,titleShadowOffsetY:4,titleShadowBlur:12,titleShadowColor:"rgba(0, 0, 0, 0.24)",pollStickerX:157,pollStickerY:1075,blobImageType:"image/jpeg",blobQuality:1};function U(e,t){var n=Object.assign({},U.defaultOptions,e||{}),i=n.newAvatarUrl,a=n.oldAvatarUrl,o=n.newAvatarStrokeWidth,r=n.newAvatarStrokeColor,s=n.oldAvatarStrokeWidth,l=n.oldAvatarStrokeColor,c=n.baseWidth,u=n.baseHeight,d=n.displayWidth,_=n.backgroundColor,f=n.newAvatarInBackgroundBlur,p=n.avatarWidth,h=n.title,m=n.titleColor,v=n.titleTextAlign,g=n.titleFont,A=n.titleFontSize,b=n.titleLineHeight,y=n.titleShadowOffsetX,w=n.titleShadowOffsetY,S=n.titleShadowBlur,k=n.titleShadowColor,O=n.pollStickerX,C=n.pollStickerY,j=n.pollStickerOptions,E=n.blobImageType,T=n.blobQuality;j=Object.assign({},{title:window.getLang("stories_new_avatar_story_poll_sticker_title")},j||{});var I=d*(u/c),M=t||document.createElement("canvas"),P=M.getContext("2d");return M.width=c,M.height=u,M.style.width=d+"px",M.style.height=I+"px",new Promise((function(e,t){Object(L.loadImages)([i,a]).then((function(n){var i=n[0],a=n[1];P.clearRect(0,0,M.width,M.height),P.fillStyle=_,P.fillRect(0,0,M.width,M.height),P.save(),P.filter="blur("+f+"px)";var c,u,d,I,x,R,D,N,V,U=(c=i.naturalWidth,u=i.naturalHeight,d=M.width,I=M.height,(V=c/u)>d/I?(D=I,N=I*V):(N=d,D=d/V),{width:N,height:D,offsetLeft:(d-N)*(x=void 0===(x=.5)?.5:x),offsetTop:(I-D)*(R=void 0===(R=.5)?.5:R)});if(P.drawImage(i,U.offsetLeft,U.offsetTop,U.width,U.height),P.restore(),"none"!==P.filter){var F=Object(L.getAverageRGB)(P);P.fillStyle="rgb("+F.r+", "+F.g+", "+F.b+")",P.fillRect(0,0,M.width,M.height)}P.save(),P.shadowOffsetX=y,P.shadowOffsetY=w,P.shadowBlur=S,P.shadowColor=k,P.font="600 "+A+"px/"+b+"px "+g,P.fillStyle=m,P.textAlign=v;var $=null==h?void 0:h.split("{br}");null==$||$.forEach((function(e,t){var n=b*t,i=M.width/2,a=M.height/2-b*$.length/2+n-395;P.fillText(e,i,a)})),P.restore();var W=(M.width-p)/2,q=Math.min(a.width,a.height),z=Math.min(i.width,i.height);P.save(),B(P,a,p/2,0,0,q,q,W-165,665,p,p),P.lineWidth=s,P.strokeStyle=l,P.stroke(),B(P,i,p/2,0,0,z,z,W+165,665,p,p),P.lineWidth=o,P.strokeStyle=r,P.stroke(),P.restore(),H(j).then((function(t){P.drawImage(t,O,C),null==M||M.toBlob(e,E,T)})).catch(t)})).catch(t)}))}U.defaultOptions=V;var F=n("fdw3"),W=n("bKAG"),q={newAvatarStoryOptions:{},onUploadedDone:Object(l.default)("resp"),fallback:function(e,t){var n=window.nav,i=e.nextSibling;return!!i&&!n.go(i)},onUploadProgress:function(e){window.photoview.updateUpload({progress:e.loaded/e.total})},onUploadComplete:function(e){var t=window.photoview,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)q.onUploadError.call(this,e);else{this.xhr=null,this.photo_res=n,this.photo_size=i.size;var a=this.static_url+i.x_src,o=i.size[0],r=i.size[1],s=Math.min(o,r);if(t.onClose=bind(q.onClose,this),t.openCrop({src:a,max_scale:s/200,onSelect:bind(q.onCropSelected,this)}),q.newAvatarStoryOptions.shouldCreateNewAvatarStory){var l;if(i.photo.sizes2&&i.photo.sizes2.length>0){var c=i.photo.sizes2.findIndex((function(e){return e[3]===i.size[0]&&e[4]===i.size[1]}));i.photo.urls2&&i.photo.urls2[c]&&(l=this.static_url+i.photo.urls2[c])}l=l||a,q.initNewAvatarStory(vk.id,l)}}},onUploadError:function(e){var t=window.photoview;clog("upload error.",e.target.responseText),t.close()},onClose:function(e){this.xhr&&this.xhr.abort&&this.xhr.abort()},onCropSelected:function(e,t,n){var i=window.photoview,a=this,o=a.photo_res,r=a.photo_size,s=r[0],l=r[1],c=Math.min(s,l),u=Math.round(e*s),d=Math.round(t*l),_=Math.round(n*c);if(a.upload_edit_url)var f=a.upload_edit_url;else f=a.base_url+"upload.php?"+Object(x.toQueryString)({act:"owner_photo_edit",_query:o,_origin:location.protocol+"//"+location.host},!0);a.xhr=ajax.plainpost(f,{_crop:[u,d,_].join(",")},(function(e){q.onCropSuccess.call(a,e)}),(function(e){q.onCropCancel.call(a)}),!0),i.updateCrop({saving:!0})},onCropSuccess:function(e){var t=window.photoview,n=this;new Promise((function(e){q.newAvatarStoryOptions.shouldCreateNewAvatarStory?q.saveNewAvatarStory().then((function(){return e(!0)})).catch((function(){return e(!1)})):e()})).then((function(i){n.xhr=ajax.post("/photos.php?act=done_photo",{_ajax:1,_query:e,_from:n.from,is_snackbar_disabled:Boolean(i)},{onDone:function(e){q.onUploadedDone(e),t.close()},onFail:function(){q.onCropCancel.call(n)}})}))},onCropCancel:function(){window.photoview.updateCrop({saving:!1})},prepareInput:function(e){e.files&&e.files.length&&(e.value="")},start:function(e,t){var n=window.photoview;if(!e||!canUploadFile())return q.fallback(e,t);var i=e.files[0]||!1,a=attr(e,"data-upload-url"),o=attr(e,"data-base-url"),r=attr(e,"data-static-url"),s=attr(e,"data-from"),l=JSON.parse(attr(e,"data-new-avatar-story-data"))||{};if(!i)return!1;if(!a)return q.fallback(e,t);var c={upload_url:a,base_url:o,static_url:r,file:i,from:s};return q.newAvatarStoryOptions=Object(E.default)({},l),c.xhr=uploadFile(a,{photo:i},{onProgress:bind(q.onUploadProgress,c),onComplete:bind(q.onUploadComplete,c),onError:bind(q.onUploadError,c)}),readFile(i,(function(e){n.updateUpload({thumb:e})})),replace(clone(e),e),n.onClose=bind(q.onClose,c),n.openUpload({src:null}),!1},initNewAvatarStory:function(e,t){var n;q.getNewAvatarStoryUploadResult=Object(h.addStatic)((n={},n[q.newAvatarStoryOptions.newAvatarStoryFontsCssPath]=null,n)).then((function(){return Promise.all([Object(L.loadFontFacePromise)("TT Commons",{weight:500}),Object(L.loadFontFacePromise)("TT Commons",{weight:600})])})).then((function(){return Promise.all([U({newAvatarUrl:t,oldAvatarUrl:q.newAvatarStoryOptions.currentPhoto,title:Object(F.getLang)("mobile_stories_new_avatar_story_title_header"),pollStickerOptions:{title:Object(F.getLang)("mobile_stories_new_avatar_story_poll_sticker_title"),voteButtonText:Object(F.getLang)("mobile_stories_poll_sticker_vote_button_text")}}),(n=q.newAvatarStoryOptions.newAvatarStoryCreatePollHash,new Promise((function(e,t){window.ajax.post(Object(L.isMvk)()?"stories.php":"al_stories.php",{act:"create_new_avatar_poll",hash:n},{onDone:e,onError:t,onFail:t})}))).then((function(e){return e||Promise.reject()})).then((function(t){return Object(W.getStoryUploadUrl)({clickable_stickers:JSON.stringify({original_width:1080,original_height:1920,clickable_stickers:[D(e,t)]}),hash:q.newAvatarStoryOptions.newAvatarStoryUploadUrlHash,entry_point:W.StoryEntryPoint.CHANGE_AVATAR,ref:window.cur.module})}))]).then((function(e){var t=e[0],n=e[1];return window.StoryPublisher.uploadStoryBlobToServer(t,n)}));var n}))},saveNewAvatarStory:function(){return q.getNewAvatarStoryUploadResult.then((function(e){var t=e.response;return Object(W.saveStoryOnServer)(t&&t.upload_result,q.newAvatarStoryOptions.newAvatarStorySaveHash).then((function(e){var t=e.story,n=t.owner_id,i=t.id;I.init({type:I.SNACKBAR_TYPE_SUCCESS,text:{inner:[{inner:Object(F.getLang)("mobile_stories_new_avatar_story_success_box_text"),attrs:{style:"margin-bottom: 8px;"}},{tag:"a",class:"link",href:"/story"+n+"_"+i,onclick:"window.ownerPhotoUpload.openNewAvatarStory(event, "+n+", "+i+")",inner:Object(F.getLang)("mobile_stories_new_avatar_story_success_box_open_story")}]}})})).catch((function(e){I.init({type:I.SNACKBAR_TYPE_ERROR,text:e&&e.message||Object(F.getLang)("global_error")})}))}))},openNewAvatarStory:function(e,t,n){e.metaKey||e.ctrlKey||(e.preventDefault(),window.Stories.init(t+"/"+t+"_"+n,{source:W.StorySource.PROFILE_SNACKBAR}))},getCropFromTag:function(e,t,n){if(!e)return!1;if(3==e.length)var i=+e[0],a=+e[1],o=+e[2];else{i=+e[0]*t/1e4,a=+e[1]*n/1e4,o=+e[2]*t/1e4;var r=+e[3]*n/1e4;if(o>r&&(i+=(o-r)/2,o=r),o<200){var s=(200-o)/2;i-=s,a-=s,o=200}o=Math.min(Math.max(o,200),Math.min(t,n)),i=Math.min(Math.max(i,0),t-o),a=Math.min(Math.max(a,0),n-o)}return[i/t,a/n,o/Math.min(t,n)]},crop:function(e){if(!e||!e.size&&!e.url)return!1;var t=window.photoview,n={upload_edit_url:e.upload_url};if(e.size){n.photo_size=e.size;var i=Math.min(e.size[0],e.size[1]);t.onClose=bind(q.onClose,n),t.openCrop({src:e.thumb,max_scale:i/200,rect:q.getCropFromTag(e.rect,e.size[0],e.size[1]),onSelect:bind(q.onCropSelected,n)})}else{var a=ce("img",{src:e.url,onload:function(){n.photo_size=[a.width,a.height];var i=Math.min(a.width,a.height);t.updateCrop({src:e.thumb,max_scale:i/200,rect:q.getCropFromTag(e.rect,a.width,a.height),onSelect:bind(q.onCropSelected,n)})}});t.onClose=bind(q.onClose,n),t.openCrop({src:!0})}return!0},generateNewAvatarStory:U,drawPollSticker:H};window.ownerPhotoUpload=q;n("+YbT");var z=n("DM2o");var Y=function(){return Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)},G=function(){return Boolean(window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)"))},Q=function(){return Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches)};var K=n("wTbK"),X=n("t7Ww");var J,Z=function(){return[Object(X.ModalMenuHeaderCloseButton)({onClose:["DarkSchemeModal.closeAndSendStat","click_close_button"]}),Object(X.ModalMenuIcon)({inner:[{inner:[Object(T.default)({sprite:"color_scheme",name:"img_dark_theme"})],class:"DarkSchemeModal__icon",tag:"div"}]}),Object(X.ModalMenuTitle)({inner:[c.default.wrap(Object(F.getLang)("mobile_dark_scheme_modal_title"))]}),Object(X.ModalMenuBody)({inner:[{inner:[c.default.wrap(Object(F.getLang)("mobile_dark_scheme_modal_description"))],class:"DarkSchemeModal__description",tag:"div"},{inner:[c.default.wrap(Object(F.getLang)("mobile_dark_scheme_modal_description_additional"))],class:"DarkSchemeModal__descriptionAdditional",tag:"div"}]}),Object(X.ModalMenuBtn)({inner:[Object(F.getLang)("mobile_dark_scheme_modal_button")],url:"/settings?act=appearance",theme:"regular",size:"large",isBtn:!0,onclick:["DarkSchemeModal.goToAppearance","this","event"]})]};function ee(){K.default.close()}function te(e){if(!J){var t={event:e,_ajax:1};j.default.post("/promo?act=dark_scheme_guide_close",t),J=!0}}var ne={open:function(){var e=c.default.elem(Object(K.default)({class:"DarkSchemeModal",on_overlay_click:["DarkSchemeModal.closeAndSendStat","click_overlay"],body:Z()}));a.colorScheme.applyScheme(e,a.ColorSchemeName.Dark),J=!1,K.default.open(e,!0,"",{onClose:function(){te("close")}}),Object(z.statlogsValueEvent)("mvk_dark_scheme_guide","shown")},close:ee,closeAndSendStat:function(e){te(e),ee()},goToAppearance:function(e,t){return te("click_button"),ee(),nav.go(e,t)}};window.DarkSchemeModal=ne;var ie=n("W9Tc"),ae=n("wMVj"),oe=n("BoyB"),le=n("YU/R"),ue=n("Fkq0"),de=n("h8oe"),_e=n("z9Td"),fe=n("RJa5"),pe=n("IetZ"),he=function(){function e(){}return e.getContainerElement=function(){return document.querySelector("."+e.CONTAINER)},e.getSection=function(t){return document.querySelector("."+e.BASE_SELECTOR+"__"+t)},e.getAllSections=function(){return Array.from(document.querySelectorAll("."+e.BASE_SELECTOR))},e.setSectionContent=function(e,t){var n=document.querySelector("."+e);n&&(n.innerHTML=t)},e.onSearchLoaded=function(t,n,i,a,o){e.toggleSearch(a,o)},e.onSearchFiltered=function(t,n){e.toggleSearch(t,n)},e.toggleSearch=function(t,n){e.getAllSections().forEach((function(e){var a=n===e?!!t:!t,o=e.querySelector(".show_more");o instanceof HTMLElement&&(a?delete o.dataset.disabled:o.dataset.disabled="1"),Object(i.toggle)(e,a)}))},e.handlePagination=function(t,n){var i=e.getSection(n.name),a=window.cdf(t);if(i&&a){var o=void 0,r=i.querySelectorAll(".AudioBlock"),s=r[r.length-1];(o=s instanceof HTMLElement&&s.dataset.view_type&&["list","music_chart_list"].includes(s.dataset.view_type)?s.querySelector(".AudioBlock__content"):i)&&o.append(a)}},e.BASE_SELECTOR="AudioSection",e.CONTAINER="AudioSerp",e}();function me(e){var t=!1,n={onStart:function(){Object(i.addClass)("wia_item--loading",this.link)},onDone:function(){var a=e.onDone&&e.onDone.apply(this,arguments);if(a){var o=a.wdHTML,r=a.data,s=a.onDoneEnd;if(o){var l=Wd.elem(o);Object(i.replace)(l,this.link.parentNode),r&&!t&&Snackbar.init({text:r.title,action:{url:r.href,text:r.undo_title,callback:function(e,i){var a=i.id;e.preventDefault(),t=!0,ajax.click(l.querySelector("a"),n),Snackbar.close(a)}}}),t=!1}s&&s()}}};return n}var ve={onDone:function(e,t,n,a){var o=Object(i.ge)(e)||Object(i.geByClass1)("like_box","z")||Object(i.geByClass1)("like_box")||Object(i.geByClass1)("wall_item_for_like_"+e);if(o&&e){var r,s,l=Object(i.geByClass1)("item_repost",o);if(Object(i.hasClass)("wall_item",o)||Object(i.hasClass)("market_item",o)||o.parentNode.classList.contains("PhotoviewPage")||o.parentNode.classList.contains("VideoPage")?s=Object(i.geByClass1)("wi_like_wrap",o):Object(i.hasClass)("ReplyItem",o)?r=Object(i.geByClass1)("ReplyItem__likeWrap",o):s=Object(i.geByClass1)("item_like",o),r||(r=Object(i.geByClass1)("like_wrap",o)),s&&(s.innerHTML=t||"",Object(i.toggleClass)("is_empty",s,!t),Object(i.toggle)(s,t)),l&&(l.innerHTML=n||"",Object(i.toggle)(l,n)),r){var c=Object(i.ceFromString)(a);o.classList.contains("wall_item")||o.classList.contains("BookmarksItem_video")||!c.classList.contains("like_wrap")?Object(i.val)(r,a||""):Object(i.val)(r.parentNode,a||"");var u=Object(ue.marketItemIdToObject)(e);if(u){var d=r.querySelector(".item_like");d&&Object(de.trackMarketEvent)({event:d.classList.contains("item_sel")?fe.ECommGoodsEvent.LIKE_ITEM:fe.ECommGoodsEvent.UNLIKE_ITEM,ownerId:u.ownerId,itemId:u.itemId,instant:!0,platform:_e.PLATFORM_MVK})}}}},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:nav.hard_go(e[0])}}},Ae={onDone:function(e,t,n,a,o){var r=window,s=r.photo;if(ve.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){Object(i.ce)("div",{innerHTML:t});var c=Object(i.ce)("div",{innerHTML:a});l.likes=Object(i.val)(u),l.likes_cnt=Object(i.intval)((Object(i.attr)(Object(i.geByClass1)("v_like",c),"data-like_count")||"").replace(/\D+/g,"")),l.likes_me=o,l.liked_people=t,l.like_buttons=a;var u=Object(i.ce)("div",{innerHTML:l.actions}),d=Object(i.geByClass1)("like_wrap",u);Object(i.val)(d,a),s.save(l)}}},onFail:ve.onFail},be={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:I.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:I.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var a=t.get(this.photo_id);a&&(a.tag_info="",t.save(a));var o=Object(i.geByClass1)("photo_view"),r=Object(i.geByClass1)("pv_tag_wrap",o);Object(i.val)(r,"")}}},ye=me({onStart:function(e){console.log(this,e)},onDone:function(e,t,n,a){var o=photo.get(t);o&&(o.isDeleted=n,photo.save(o)),Object(M.$)(".PhotoviewPage").classList.toggle("PhotoviewPage--deleted",n);return{wdHTML:e,data:a,onDoneEnd:function(){var e=Object(M.$)("#photo_actions"),t=$$(".ContextMenu__list li",e);Array.from(t).forEach((function(e){n&&"delete"!==domData(e,"name")&&Object(i.hide)(e),n||Object(i.show)(e)})),o&&(o.actions=e.innerHTML,photo.save(o))}}}}),we={onDone:function(e,t){var n=window.isNewMail&&Object(M.$)(".messenger")&&this.link.closest(".msg");if(Object(i.val)(e,t),n){var a=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[a].textFull=n.$(".msg__text").innerHTML}}},Se={onDone:function(e){this.link&&(Object(i.after)(cdf(e),Object(i.gpeByClass)("pic_body_wrap",this.link)),Object(i.hide)(this.link))}},ke=me({onStart:function(){Object(i.addClass)("cm_item_loading",this.link)},onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};this.link&&Object(i.val)(this.link.parentNode,e)}}),Oe={onDone:function(e,t,n){if(void 0===n&&(n={}),e){var a=window.photo;Object(i.remove)(e+"_msg");var o=Object(i.ge)(e);if(o){if(n.remove)re(o),re(e+"_msg");else if(t){var r=Object(i.ce)("div",{id:e+"_msg",className:(o.className||"")+" post_message_item"}),s=n.no_wrap?t:'<div class="pi_cont">'+t+"</div>";Object(i.val)(r,s),Object(i.after)(r,o),Object(i.hide)(o),Object(i.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else Object(i.show)(e);if(this.photo_id){var l=a.get(this.photo_id);if(l){var c=Object(i.geByClass1)("photoview"),u=Object(i.geByClass1)("comments_wrap",c);l.comments_html=Object(i.val)(u)}}}}}},Ce={onDone:function(e,t,n,a){if(e){Object(i.remove)(e+"_msg");var o=Object(i.ge)(e);if(o)if(t){var r=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=Object(i.ce)("div",{id:e+"_msg",className:r+"_item "+r+"_message_item"}),l=a||"message_item_cont";Object(i.val)(s,'<div class="'+l+'">'+t+"</div>"),Object(i.after)(s,o),Object(i.hide)(o)}else!1===t?(o.classList.add("_deleted"),Object(i.hide)(o)):Object(i.show)(o)}}},je={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e),o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),s=o+(u<320?r:0)-Object(i.scrollTop)();if(Object(i.remove)(e+"_msg"),a){var l=Object(i.hasClass)("wall_item",a)||Object(i.hasClass)("post",a)?"wall":"post";if(n){var c=Object(i.ce)("div",{id:e+"_msg",className:l+"_item post_message_item"});Object(i.val)(c,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(c,a)}if(t){Object(i.each)(Object(i.geByClass)(l+"_item"),(function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),a=Object(i.attr)(this,"data-copy"),o=!!a&&a.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||o&&o[1]==t)&&Object(i.toggleClass)("post_item_ignored",this,n)}));var u=Object(i.getCw)(),d=(o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),o+(u<320?r:0)-s);Object(i.geByClass1)("wall_item")===a&&(d=0),Object(i.scrollTop)(d);var _=Object(M.$)(".ContextMenu",a);_&&le.default.close(_)}}}}},Ee={onDone:function(e,t){if(e){var n=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),n&&t){var a=Object(i.hasClass)("wall_item",n)||Object(i.hasClass)("post",n)?"wall":"post",o=Object(i.ce)("div",{id:e+"_msg",className:a+"_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+t+"</div>"),Object(i.after)(o,n)}Object(i.toggleClass)("post_item_ignored",n,t)}}},Te={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),a){if(n){var o=Object(i.ce)("div",{id:e+"_msg",className:"wall_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(o,a)}Object(i.toggleClass)("post_item_ignored",a)}}}},Ie={onStart:function(){var e=Object(i.gpeByClass)("show_more_wrap",this.link),t=Object(i.geByClass1)("show_more",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=Object(i.ge)("show_more_wrap"),a=cdf(e);Object(i.before)(a,n),Object(i.remove)(n),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),Gif.onUpdate(),Object(O.resizePosters)()}},Me={onStart:Ie.onStart,onDone:function(e){Ie.onDone.apply(null,arguments),Object(pe.cutTextToHighlight)(".SearchItemServicesInfo__textMatch")}},Pe={onStart:Ie.onStart,onDone:function(e,t){Ie.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},xe={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("photos_page","mcont"),o=Object(i.ge)("show_more_wrap"),r=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),Object(O.resizePosters)()}},Le={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("audios_block",Object(i.geByClass1)("audios","mcont")),o=Object(i.ge)("show_more_wrap"),r=cdf(t),s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},Be={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur,a=e[0],o=e[1],r=Object(i.ge)("show_more_wrap");ajax.tAlProcess=Date.now(),he.handlePagination(a,t),Object(i.remove)(r);var s=he.getSection(t.name);s&&s.appendChild(cdf(o)),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=Date.now()}},Re=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.ge)(e);a&&a.parentNode&&t&&Object(i.replace)(cdf(t),a.parentNode)}}),De=me({onDone:function(e,t,n){return void 0===n&&(n={}),n.snackbar&&Snackbar.init(n.snackbar),{wdHTML:e,data:t}}}),Ne={onStart:function(){Object(i.addClass)("mva_item_loading",this.link)},onDone:function(e,t){Object(i.removeClass)("mva_item_loading",this.link),ownerPhotoUpload&&ownerPhotoUpload.newAvatarStoryOptions.shouldCreateNewAvatarStory&&(ownerPhotoUpload.newAvatarStoryOptions={}),e.upload_url||t&&nav.hard_go(t),ownerPhotoUpload&&ownerPhotoUpload.crop(e)||t&&nav.hard_go(t)},onFail:function(){Object(i.removeClass)("mva_item_loading",this.link)}},He={onStart:function(){var e=this.link,t=Object(i.gpeByClass)("notify_lite",e);if(t)return Object(i.remove)(t);for(;e=e.parentNode;)if(Object(i.hasClass)("notify_item",e)){Object(i.hasClass)("notify_panel",e.parentNode)?Object(i.remove)(e.parentNode):Object(i.remove)(e);break}}},Ve={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,(function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t,n){var a=window.mail,o=Object(i.ge)("messages"+t);o&&(Object(i.val)(o,e),a.onMessagesRepainted(!0),!this.save&&Object(i.scrollToEl)()),this.save&&a.saveDialog({messages:e},t),this.clear&&(Object(i.val)(Object(i.geByTag1)("textarea","write_form"),""),Object(i.remove)(Object(i.geByClass1)("pi_medias","write_form"))),Object(i.removeClass)("cp_attach_btn_sel",Object(i.geByClass1)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},Ue={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,(function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t){var n=window.mail,a=Object(i.ge)("dialogs");a&&(Object(i.val)(a,e),!this.no_scroll&&Object(i.scrollToEl)(),n.cacheDialogsPage()),n.save(t)}},Fe={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},$e={onStart:function(){var e=Object(i.gpeByClass)("friendsList__showMoreBtnWrap",this.link),t=Object(i.geByClass1)("friendsList__showMoreBtn",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent friendsList__showMoreBtnWrap"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout((function(){ajax.post(t,{_ajax:1},{onDone:$e.onDone.bind(e),onFail:$e.onFail.bind(e)})}),500)},onDone:Ie.onDone},We=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.ge)(e);a&&a.parentNode&&t&&Object(i.replace)(cdf(t),a.parentNode)}}),qe=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.geByClass)(e);if(a.length&&t)for(var o=0,r=a.length;o<r;o++)a[o].parentNode&&Object(i.replace)(cdf(t),a[o].parentNode)}}),ze={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,a,o){if(e){var r=Object(i.geByClass)(e);if(r.length&&t)for(var s=0,l=r.length;s<l;s++)r[s].parentNode&&Object(i.replace)(cdf(t),r[s].parentNode);Share.setBookmarkState(a,o),n&&Bookmarks.showSuccessSnack(n);var c=Object(ue.parseBookmarkedProductClass)(e);c&&Object(de.trackMarketEvent)({event:o?fe.ECommGoodsEvent.ADD_ITEM_TO_BOOKMARKS:fe.ECommGoodsEvent.REMOVE_ITEM_FROM_BOOKMARKS,ownerId:c.ownerId,itemId:c.itemId,instant:!0})}}},Ye=me({onDone:function(e,t,n,a,o,r){if(!e)return{wdHTML:o,data:r};var s=Object(i.ge)(e);if(!s)return{wdHTML:o,data:r};var l=Object(i.geByClass1)("wia_close",s);if(l&&(Object(i.val)(l,n),l.href=t),!Object(i.hasClass)("single_wall_item",s))return{wdHTML:o,data:r};var c=Object(i.ge)("nc_form"),u=Object(i.geByClass1)("wall_replies");return c?Object(i.toggle)(c,!!a):a&&(u?domInsert(u,a):(domInsertAfter(Object(i.ce)("div",{innerHTML:a}),s),u=Object(i.geByClass1)("wall_replies"))),Object(i.toggleClass)("closed_comments",u,!a),{wdHTML:o,data:r}}}),Ge={onStart:function(){var e=domPN(this.link),t=Object(i.geByClass1)("Loading",e);t||(t=Object(i.ceFromString)(Object(oe.default)({})),append(t,e)),Object(i.addClass)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,a){var o,r=domPN(this.link),s=Object(i.hasClass)("RepliesThreadNext_prev",r),l=0,c=cdf(e);if(domChildren(c).forEach((function(e){Object(i.ge)(e.id)&&re(e)})),s?(o=Object(i.gpeByClass)("wall_replies",r),l=Object(i.getH)(o),Object(i.after)(c,r)):Object(i.before)(c,r),a?(this.link.href=a,Object(i.removeClass)("RepliesThreadNext_loading",r)):re(r),Gif.onUpdate(),Object(O.resizePosters)(),n&&(cur.replyNames=Object(i.extend)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),s){var u=Object(i.getH)(o)-l;Object(i.scrollTop)(Object(i.scrollTop)()+u)}Object(i.onBodyScrollForce)()},onFail:function(){var e=domPN(this.link),t=Object(i.geByClass1)("i_loading",e);Object(i.hide)(t),Object(i.show)(this.link),Object(i.removeClass)("RepliesThreadNext_loading",e)}},Qe={onDone:function(e,t,n){var a=Object(i.geByClass1)("RepliesWrap");a.innerHTML=e,Gif.onUpdate(),Object(O.resizePosters)(),n&&Object(i.extend)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),Object(i.scrollTop)(Object(i.getH)(a)+Object(i.getY)(a))}},Ke={onDone:function(e,t,n,a){if(e){var o=Object(i.ge)(e);if(o){if(a)Object(i.geByClass)("ReplyItem__message_type_"+a,o).forEach((function(e){re(e)}));var r=Object(i.geByClass1)("ReplyItem__wrap",o),s=Object(i.geByClass)("ReplyItem__message",o),l=s.pop();if(t){var c=cdf(t);Object(i.hide)(l||r),Object(i.after)(c,l||r),Object(i.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else a||(re(l),l=s.pop()),Object(i.show)(l||r);if(n){var u=Object(i.ge)("RepliesThread"+n);u&&Object(i.toggle)(u,!t)}}}}};window.Like=ve,window.PhotoLike=Ae,window.PhotoTag=be,window.PhotoDelete=ye,window.Poll=we,window.CopyHistory=Se,window.ToggleMenu=ke,window.Comment=Oe,window.ItemDelete=Ce,window.FeedIgnore=je,window.FeedIgnoreItem=Ee,window.FeedIgnoreComments=Te,window.Wall=Ie,window.SearchServices=Me,window.Bookmark=Pe,window.BookmarkToggle=ze,window.Photos=xe,window.Audios=Le,window.AudioSection=Be,window.FixPost=Re,window.ContextMenuCommonAction=De,window.ProfileMove=Ne,window.Notify=He,window.Dialog=Ve,window.Dialogs=Ue,window.LoginCheckAuthCodePage=Fe,window.WallSubscribe=We,window.FeedSubscribe=qe,window.ImportedFriends=$e,window.CloseComments=Ye,window.RepliesNext=Ge,window.RepliesLast=Qe,window.ReplyAction=Ke,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=Object(i.ge)("mini_apps_"+e.dataset.section);t&&t.remove()}})}};n("AeId"),n("Gzds"),n("kYGI");var Xe=n("Qz23"),Je=n("dONA"),Ze=n("zq7H"),et=!1,tt={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return!1},opened:function(){return Object(i.hasClass)("lm_opened",window.bodyNode)},toggle:function(e,t){return Object(i.checkEvent)(e),!0},open:function(e){window.zlayer;return Object(i.checkEvent)(e),!0},close:function(e){return Object(i.checkEvent)(e),!0},fix_size:function(e){var t=Object(i.ge)("l"),n=Object(i.ge)("m"),a=Object(i.ge)("mhead"),o=a&&a.offsetHeight||0,r=tt._st||0;t&&n&&(e?n.style.minHeight="0":(r=r>o?r:0,n.style.minHeight=t.offsetHeight+r+"px"),!tt.fixed||Object(i.getCw)()<320?e?n.style.marginTop="0":(t.style.minHeight=Object(i.getCh)()+"px",n.style.marginTop=-r+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},hasMenu:function(){return window.al&&window.al.menu},isMenuHasItems:function(){return tt.hasMenu()&&Object(i.isArray)(window.al.menu)&&window.al.menu.length||Object(i.isObject)(window.al.menu)&&Object.keys(window.al.menu).length},refreshCounters:function(e){if(!tt.hasMenu())return!0;if(!e)return!0;if(Object(i.isArray)(e)&&!e.length)return!0;if(Object(i.isObject)(e)&&!Object.keys(e).length)return!0;if(Object(i.isArray)(e)&&!Object(i.isArray)(window.al.menu))return!1;if(Object(i.isObject)(e)&&!Object(i.isObject)(window.al.menu))return!1;if(Object(i.isArray)(e)&&e.length!=window.al.menu.length)return!1;if(Object(i.isObject)(e)&&Object.keys(e).length!=Object.keys(window.al.menu).length)return!1;void 0!==e[Ze.COUNTERS_POS_NOTIFICATIONS]&&Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[Ze.COUNTERS_POS_NOTIFICATIONS]),void 0!==e[Ze.COUNTERS_POS_MESSAGES]&&Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[Ze.COUNTERS_POS_MESSAGES]);var t=e[Ze.COUNTERS_POS_NOTIFICATIONS];"number"==typeof t&&isFinite(t)&&(Bell.setCount(t),window.store&&(store.notificationsCount=t));var n=window.al,a=Object(M.$)(".main_menu",document.getElementById("l"));return Object.entries(e).forEach((function(e){var t=e[0],o=e[1];if(void 0===o)return!0;var r=n.menu[t],s=Object(M.$)(".mmi_"+r[0],a),l=Object(M.$)(".mm_item",s),c=Object(M.$)(".mmi_wrap",s),u=Object(M.$)(".mm_counter",c);Object(i.attr)(l,"data-href",!1),o?(r[3]&&Object(i.attr)(l,"href",r[3]),u?Object(i.val)(u,o):Object(i.append)(Object(i.ce)("em",{className:"mm_counter",innerHTML:o}),c)):(r[2]&&Object(i.attr)(l,"href",r[2]),Object(i.remove)(u)),ajax.prepare_click(l)})),!0},refreshSingleCounter:function(e,t){var n;tt.hasMenu()&&(Object(i.isArray)(window.al.menu)&&((n=new Array(al.menu.length))[e]=t),Object(i.isObject)(window.al.menu)&&(n={},Object.entries(window.al.menu).forEach((function(i){i[0];var a=i[1];parseInt(a,10)===parseInt(e,10)?n[a]=t:n[a]=void 0}))),tt.refreshCounters(n))},refreshNotifications:function(e){window.store&&(store.menuNotifications=e);var t=Object(M.$)(".mmi_apps .mmi_wrap");if(t){var n=Object(M.$)('[data-id="menu-apps-notification"]',t);!e[Ze.COUNTERS_POS_APPS]&&n&&n.remove(),e[Ze.COUNTERS_POS_APPS]&&!n&&(t.innerHTML+=c.default.render(Object(Je.default)({id:"menu-apps-notification"})))}},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&Object(i.val)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&Object(i.val)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&Object(i.val)("lm_bottom_notify",e.bn),e.lm&&Object(i.val)("l",e.lm),e.counters&&tt.refreshCounters(e.counters),e.notifications&&tt.refreshNotifications(e.notifications),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||Object(i.remove)("vk_topbar")},initEvents:function(){var e=tt.getStickedScrollingHandler();e&&(Object(i.onBodyScroll)(e),e(Object(i.scrollGetY)())),Object(i.onBodyResize)((function(){var t=Object(i.ge)("vk_wrap"),n=t&&t.offsetWidth,a=Object(i.hasClass)("_hfixed",window.bodyNode);n>=882&&tt.close(),tt.fix_size(!tt.opened(),a),e&&e(Object(i.scrollGetY)())}))},init:function(){tt.fixed=Object(i.hasClass)("_hfixed",window.bodyNode),tt.initEvents(),Object(i.addEvent)(window,"orientationchange",(function(){var e=Object(i.ge)("vk_wrap").offsetWidth,t=tt._st||0;e>=882&&t>44&&tt.close()}));var e=Object(M.$)(".leftMenu__content");e&&Object(Xe.setScrollView)(e,{topBanner:!!C.default.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=Object(i.ge)("vk_wrap");tt.opened()&&Object(i.getW)(t)<882&&Object(i.preventEvent)(e)},qsOpened:!1,qsOpen:function(){tt.qsOpened||(tt.qs_st=Object(i.scrollTop)(),Object(i.addClass)("qs_opened","vk_wrap"),Object(i.addClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(0),tt.qsOpened=!0)},qsClose:function(){tt.qsOpened&&(Object(i.removeClass)("qs_opened","vk_wrap"),Object(i.removeClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(tt.qs_st||0),tt.qsOpened=!1)},initSearch:function(){et||(et=!0,Object(i.addEvent)("lm_search_items","mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(i.addEvent)(Object(M.$)(".head_search",document.getElementById("l")),"mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(i.addEvent)(document,"mousedown touchstart",(function(e){Object(i.ge)("vk_wrap");tt.qsOpened&&(tt.qsClose(),Object(i.elblur)("lm_search_field"))}),{passive:!0}))},closeSearch:function(){return!0},cancelSearch:function(){return!0},headerAction:function(e,t){return Object(i.getW)("vk_wrap")>=882?nav.go(e,t):tt.toggle()},getStickedScrollingHandler:function(){var e=Object(M.$)(".leftMenu__content"),t=document.body;if(e&&t&&t.classList.contains("_hfixed")&&!t.classList.contains("_touch")){var n,a=Object(i.scrollGetY)(),o=Object(i.scrollGetY)(),r=!1,s=function(t,n){void 0===n&&(n=0),e.style.position=t,e.style.top=n+"px",e.style.bottom=""};return function(t){if(!(t<0||t+window.innerHeight>document.body.scrollHeight||Object(i.getCw)()<882)){var l=e.getBoundingClientRect(),c=Math.round(l.top),u=Math.floor(l.height);if(0!==u){var d=document.body,_=document.documentElement;if(u+56>=Math.max(d.scrollHeight,d.offsetHeight,_.clientHeight,_.scrollHeight,_.offsetHeight))s("absolute");else if(!(u+56>_.scrollHeight)){if((t>a||t===a&&t>0)&&(n="down"),t<a&&(n="up"),a=t,u<window.innerHeight)return s("fixed"),void(o=t+c-56);switch(n){case"down":r=u+c<=window.innerHeight;break;case"up":r=0<=c-56}var f,p;r?("down"===n?(f="fixed",void 0===p&&(p=0),e.style.position=f,e.style.top="",e.style.bottom=p+"px"):s("fixed"),o=t+Math.round(e.getBoundingClientRect().top)-56):s("absolute",o)}}else s("absolute")}}}}};window.menu=tt;var nt=n("wTgh"),it=n("cZev"),at=function(){var e={},t={},n=null,a=!1,o={},r={},s={},l=null;function c(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),(function(){var e=+attr(this,"data-id");e&&t.push(e),i=at.getPeerByMsg(e),replaceClass("_unread","_read",this)})),i){var a=ge("messages"+i);a&&e[i]&&(e[i].messages=val(a))}if(t.length)at.sendMarkAsRead(n,t);else{var o=e[n].last_msg;at.sendMarkAsRead(n,o?[o]:[]),at.updateMarkAsUnread(n,!1)}}}function u(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!C.mobPlatforms[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function d(e){(0,e.updater)(document.body),each(e.caches,(function(t,n){var i=n.storage,a=n.getter,o=function(e,t){var n,i=t.split("."),a=i.length,o=e;for(n=0;n<a;n++)if(!(o=o[i[n]]))return null;return o}(i,a);if(o){var r="string"==typeof o;r&&(o=ce("div",{innerHTML:o})),e.updater(o),function(e,t,n){var i,a,o=t.split("."),r=o.length-1,s=e;for(a=0;a<r;a++)s=s[i=o[a]]||(s[i]={});s[o[r]]=n}(i,a,r?o.innerHTML:o)}}))}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0})),!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];at.actualizeMessagesCornerCounter(n)}catch(e){}}})})),{wrapLinks:nt.wrapLinks,wrapMention:rt,onShowDialogFromCache:Object(i.se)(),onShowWritePageFromCache:Object(i.se)(),onShowDialogsPageFromCache:Object(i.se)(),onMessagesRepainted:Object(i.se)(),init:function(t,i){var o=window.im;window.cur.destroy.push((function(){AudioMessagePlayer.detachPlayer()})),i&&(cur.ref=i.ref,cur.refSource=i.ref_source),t&&(n=t,i&&(at.saveDialog(i,t),e[t])),a||(a=!0,addEvent(document,C.isTouch?"touchstart":"mousedown",c)),setTimeout((function(){o.on()}))},unpinMessage:function(t){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.remove("head_actions_has_pinned")})),e.$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.classList.add("pinnedMsg_hidden")}))}})},pinMessage:function(t,n){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.add("head_actions_has_pinned")})),$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.outerHTML=n}))}})},clear:function(){nav.clear();var i=window.im;e={},t={},o={},n=null,removeEvent(document,C.isTouch?"touchstart":"mousedown",c),a=!1,i.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,(function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,at.saveDialog(n,t)}))},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,(function(e,t){o[t]=n}))},getPeerByMsg:function(e){return o[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=ot("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=l||"",a=e.value||"";i.length==a.length&&i==a||(at.myTyping(t,n),l=a)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();s[e]&&n-s[e]<5e3||(s[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(r[e]||(r[e]={}),r[e][t]=vkNow()):r[e]=vkNow(),at.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),a=geByClass1("di_current_peer",i),o=geByClass1("di_typing",i);if(i){var s=[],l=vkNow();if(e>2e9)each(r[e]||{},(function(e,n){t(o,"data-u"+e)&&n&&l-n<6e3&&s.push(e)}));else{var c=r[e];t(o,"data-u"+e)&&c&&l-c<6e3&&s.push(e)}if(s.length){if(1==s.length){var u=s[0],d=t(o,"data-u"+u),_=t(o,"data-s"+u);val(o,'<i class="i_typing"></i>'+(n.mobile_mail_typing[_]||"").replace("{user}",d))}else{each(s,(function(e,n){s[e]=t(o,"data-u"+n)}));var f=s.pop();val(o,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",s.join(", ")).replace("{last_user}",f))}a.offsetWidth&&setStyle(o,"minWidth",a.offsetWidth),addClass("di_typing_now",i),setTimeout((function(){addClass("di_typing_animated",i)}),10),setTimeout((function(){at.updateTyping(e)}),2e3)}else val(o,""),setStyle(o,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),(function(e,t){u(t,n)})),e[t]){if(e[t].write_form){var a=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,a),(function(e,t){u(t,n)})),e[t].write_form=val(a)}if(e[t].messages){a=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",a)),e[t].messages=val(a)}}},updateImportantMessages:function(n,i,a){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+a;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),d({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===a)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var a=e[n];a&&a.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:a.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})),a&&a.messages)){var t=ce("div",{innerHTML:a.messages}),n=geByClass1("_msg"+i,t),o=$('.audio-msg-track[data-msg="'+i+'"]',n);o&&o.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),a.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),mark_conversation_as_read:0===n.length,hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,(function(e,n){at.markAsRead(t,n)}))}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var a=geByClass1("_msg"+n,i);hasClass("_read",a)||removeClass("mi_unread",a);var o=e[t];if(o&&o.messages){var r=ce("div",{innerHTML:o.messages});a=geByClass1("_msg"+n,r);hasClass("_read",a)||removeClass("mi_unread",a),o.messages=val(r)}}},markPeerAsRead:function(n,i,a){var o=ge("messages"+n);if(o&&(each(geByClass("msg_item",o),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),(c=e[n])&&c.messages)){var r=ce("div",{innerHTML:c.messages});each(geByClass("msg_item",r),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),c.messages=val(r)}var s=ge("dialogs"),l=a?"di_unread_outbox":"di_unread_inbox";if(s)(c=geByClass1("_peer"+n,s))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c)));else if(t.page){var c;r=ce("div",{innerHTML:t.page});(c=geByClass1("_peer"+n,r))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c))),t.page=val(r)}d({caches:[{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(l,t)&&(removeClass(l,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var a=e[t];if(a&&a.messages){var o=ce("div",{innerHTML:a.messages});remove(geByClass1("_msg"+n,o)),a.messages=val(o)}}ajax.click(ot(nav.path),extend({no_scroll:!0},Dialogs))},updateMarkAsUnread:function(e,t){d({caches:[{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(n){var i=$("._peer"+e,n);if(i){i.classList.toggle("di_unread_inbox",t);var a=$(".di_head",i);if(t){var o=$(".di_chat_user",i),r=document.createElement("span");r.classList.add("di_unread_cnt"),r.innerHTML="&nbsp;",a.insertBefore(r,o)}else{var s=$(".di_unread_cnt",i);s&&s.remove()}}}})},addMessage:function(t,n,i,a){if(t<2e9?delete r[t]:r[t]&&delete r[t][i],at.updateTyping(t),!0!==a){if(t&&n&&(o[n]=t),!geByClass1("_msg"+n)){var s=e[t];if(s&&s.messages){s.msgs&&s.msgs.push(n);var l=ce("div",{innerHTML:s.messages});(u=geByClass1("di_activity",l))?(after(cdf(a),u),s.messages=val(l)):s.messages=a+s.messages,(c=ge("messages"+t))&&(val(c,s.messages),at.onMessagesRepainted(!0))}else{var c,u;if(c=ge("messages"+t))(u=geByClass1("di_activity",c))?after(cdf(a),u):val(c,a+val(c))}}}else if(ge("dialogs")&&"/mail"==nav.path){var d=nav.getQuery();d.act||d.offset||d.q||ajax.click(ot(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,a){var o=ge("messages"+t),r=e[t];if(r&&r.messages){var s=ce("div",{innerHTML:r.messages}),l=geByClass1("_msg"+n,s);l&&(l.outerHTML=a),r.messages=val(s),val(o,r.messages)}else geByClass1("_msg"+n).outerHTML=a},getMsgHTML:function(t,n,i,a,o,r,s,l){var c=window,u=c.vk,d=c.lang,_=2&n?u.id:s&&s.from||i;if(!_)return!1;if(!ge("messages"+i))return!0;if(s.attach1||s.fwd||s.geo||s.emoji)return!1;if(s.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var f="_u"+_,p=geByClass1(f,"mcont","a"),h=stripTags(attr(p,"data-name")||val(p)||""),m=getHref(p),v=geByClass1(f,"mcont","img"),g=v&&v.src||"";if(!h||!m||!g)return!1;i=intval(i),t=intval(t),o=o&&-1==o.toString().indexOf(" ... ")&&i<2e9?o:"";var A,b,y,w=1&n?" mi_unread":"";return!(2&n)&&1&n&&(w+=w?" _unread":""),r=at.wrapLinks(r,n),r=at.wrapMention(r),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+ot("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,f).replace(/{{href}}/g,m).replace("{{msgClass}}",w).replace("{{edited}}",l?'<span class="mi_edited">'+d.mobile_mail_edited+"</span>":"").replace("{{photo}}",g).replace("{{time}}",(A=new Date(1e3*a),b=A.getHours(),y=A.getMinutes(),b+":"+(y<10?"0":"")+y)).replace("{{dataName}}",escapeAttr(h)).replace("{{name}}",h.split(" ").shift()).replace("{{mi_title}}",o?'<div class="mi_title">'+o+"</div>":"").split("{{text}}").join(r)},updateStickers:function(){window.cur;var t=window.post,i=e[n];if(i){var a=i.write_form?(it.default.getStickerPanel()||"").split("mail-0").join("mail"+n):"",o=ge("stickers_panel");o&&(replace(cdf(a),o),o=null,t.stickersInit())}},showDialog:function(i,a,o){window.cur;var r=window,s=r.MessagesActions,c=r.Mention,u=r.Dialog,d=window.post;if(s.hasFwdMessages())return s.attachFwdMessages(a),!1;t.scroll_top=scrollTop();var _=e[a];if(_){var f=ce("div",{innerHTML:val("m")}),p=geByClass1("mhb_back",f);if(p&&_.header){var h=ce("div");val(h,_.header),before(h.firstElementChild,p),remove(p)}var m=_.write_form?(it.default.getStickerPanel()||"").split("mail-0").join("mail"+a):"";val(geByClass1("pcont",geByClass1("mcont",f)),_.write_form+m+(a?'<div id="messages'+a+'" class="messages bl_cont">'+(_.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",f.innerHTML),d.stickersInit(),ajax.refreshLinks(_.fv_link,_.app_link),alLoadingFix(),n=a,_;var v=getHref(i);nav.go(v,null,{push_only:!0,no_push:o}),a?(l=null,at.updateTyping(a),ajax.click(v,extend({save:a},u),{scroll:!0})):at.onShowWritePageFromCache(!0),at.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(_&&_.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var g=geByClass1("MentionContainer"),A=parseJSON(attr(g,"data-mentions"))||[];return A.length&&c.init({url:!1,appendTo:g,defaultItems:A,items:A,preferDomain:!0}),AudioMessagePlayer.events.on("listened",at.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),at.onShowDialogsPageFromCache(!0);else{var i=ot(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function ot(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,a=n&&-1===e.indexOf("community=")?"community="+n:"",o=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return a?e+(e.indexOf("?")>=0?"&":"?")+a+o:e}function rt(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,(function(e,t,n,i,a){return'<a href="/'+(t+n)+'" class="mem_link">'+a+"</a>"}))}window.mail=at,window.makeUrl=ot,window.Scroller=function(e,t){var n,i,a,o,r,s=t&&t.ignoreMouseWheel,l=t&&t.noAutoScroll,c=!isUndefined(document.ontouchmove),u=!0,d=!1,_=!1,f=!1,p=!1,h=0,m=0,v=!1,g=0,A=!1,b=!1,y=!1,w=!1;function S(e){var t=e.touches,n=getX(i),a=getY(i);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-a}}function k(e){v||(v=[]),v.push([vkNow(),e]),v=v.slice(-20)}function O(){v=!1}function j(){if(!v||v.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=v.pop(),i=v.length-1;i>=0;i--){if((a=e-v[i][0])>150)break;t=v[i]}if(!t||!n)return[0,0,0];var a,o=n[1].x-t[1].x,r=n[1].y-t[1].y,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}function E(e){"touchstart"==e.type?u=!e.touches||1==e.touches.length:"touchmove"==e.type?u=!1:"click"==e.type&&(u||(cancelEvent(e),u=!0))}function T(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||w&&e.touches&&e.touches.length>1)){if(O(),_){if(m<=1)return}else if(getW(i)-getW(a)>=0)return;f=S(e),k(p=f),y=!0,setStyle.animate(a)}}function I(e){if(f&&(w||y)){thover&&thover.cancel(e);var t=S(e);if(k(p=t),y){var n=f.x-t.x,o=f.y-t.y;if(Math.abs(n)>=Math.abs(o)&&(cancelEvent(e),w=!0),y=!1,w){var r=getY(i),s=getH(i),c=scrollTop(),u=getCh();!l&&(r-7<c?scrollTop(r-7):r+s+7>c+u&&scrollTop(r+s+7-u))}}if(w)if(cancelEvent(e),_){var v=getW(i);n=f.x-t.x;(h<=0&&n<0||h>=m-1&&n>0)&&(n/=3);var A=-h-n/v,b=d?100*A+"%":A*v;setStyle.transform(a,{translate:[b,0]})}else{var O=getW(i)-getW(a);n=f.x-t.x;if(O>0&&(O=0),(A=g-n)<O)b=O-(O-A)/3;else if(A>0)b=0+(A-0)/3;else b=g-n;L(b),setStyle.transform(a,{translate:[b,0]})}}}function M(e){if(f&&w){if(cancelEvent(e),_){var t=4.7*j()[1],n=f.x-p.x,o=getW(i),r=Math.abs(n)>=o/2;(h>0&&(r&&n<0||t>1)||h<m-1&&(r&&n>0||t<-1))&&(h+=n>0?1:-1);var s=-h,l=d?100*s+"%":s*o;f=!1,O(),B(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}else{var c=function(){if(!v)return!1;var e=j(),t=e[0],n=e[1];if(O(),!t)return!1;var i=t/4.7,a=n*i-4.7*i*i/2;return i*=530,a*=140,clog("dx",a,"t",i),!(t<.1||!a)&&{dx:a,t:i}}(),u=getW(i)-getW(a);n=f.x-p.x,s=g-n;c&&(s+=c.dx),u>0&&(u=0),g=s<u?u:s>0?0:s;var A={duration:200,func:"ease"};c&&(A={duration:c.t,func:"cubic-bezier(0, 1, 1, 1)"}),L(g),setStyle.animate(a,"transform",A),setStyle.transform(a,{translate:[g,0]})}w=!1}}function P(e){if(!(s||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),_){if(m<=1)return}else if((n=getW(i)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===A&&(A=0),A+=t,!_){var n=getW(i)-getW(a),o=g-A;if(n>0&&(n=0),o<n)var r=n-(n-o)/3;else if(o>0)r=0+(o-0)/3;else r=g-A;L(r),setStyle.transform(a,{translate:[r,0]})}clearTimeout(b),b=setTimeout((function(){if(_){(h>0&&A<0||h<m-1&&A>0)&&(h+=A>0?1:-1);var e=-h,t=getW(i),n=d?100*e+"%":e*t;B(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var o=getW(i)-getW(a);o>0&&(o=0),(e=g-A)<o?g=o:e>0?g=0:g-=A,L(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]})}A=!1}),200)}}function x(e){if(_){var t=h;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),o=+attr(n,"data-i");h=o<0?0:o>m-1?m-1:o}f=!1,O(),w=!1;var r=getW(i),s=-h,l=d?100*s+"%":s*r;B(),t!=h&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}}function L(e){if(!_){e=e||g;var t=getW(i)-getW(a);toggleClass("sw_left",i,e<0),toggleClass("sw_right",i,e>t)}}function B(){if(_){var e=geByClass1("sp_ppt_sel",n);e&&e===r[h]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",r[h]))}}extend(this,{init:function(){i=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",i),_?(o=geByClass1("sp_pages_pts",n),r=geByClass("sp_ppt",o),m=(geByClass("scroller_page",a)||[]).length,h=0,B()):L(g=0),v=!1,setStyle.transform(a,{translate:[0,0]}),c?(addEvent(i,"touchstart touchmove click",E),addEvent(i,"touchstart",T),addEvent(i,"touchmove",I),addEvent(i,"touchend touchcancel",M)):(addEvent(i,"mousewheel",P),addEvent(o,"click",x)),d||onBodyResize(x)},destroy:function(){c?(removeEvent(i,"touchstart touchmove click",E),removeEvent(i,"touchstart",T),removeEvent(i,"touchmove",I),removeEvent(i,"touchend touchcancel",M)):(removeEvent(i,"mousewheel",P),removeEvent(o,"click",x)),d||onBodyResize("__clear",x)},onShow:function(){_?B():L(g)},canClick:function(){return u}}),n=e,(t=t||{}).byPage?(_=!0,d=!C.default.android):(_=!1,d=!1,this.showElem=function(e){if(!_){var t=getX(e)-getX(i),n=t+g,o=n+getW(e),r=getW(i),s=!1;n<0?s=0-t+20:o>r&&(s=r-getW(e)-t-20);var l=getW(i)-getW(a);if(l>0&&(l=0),s<l)s=l;else if(s>0)s=0;clog(t,g,n,o,0,r,s),!1!==s&&(L(g=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]}))}})};var st=n("izth"),lt=function(){var e=null,t={},n=1,i=null,a=!1,o=!1;function r(){n<64&&(n*=2)}function s(e,t){!1===e&&(e=getNotify()+(t||1)),setNotify(e),menu.refreshSingleCounter(Ze.COUNTERS_POS_MESSAGES,e)}function c(e){return Object.keys(e).some((function(e){return-1!==e.indexOf("attach")}))||e.fwd||e.emoji||e.geo}function u(e,t,n){var i=toInt(e.from_admin)||null,a=toInt(nav.getQuery("community"));return i&&a?a:2&t?window.vk.id:toInt(e.from)||n}function d(){return Number(nav.getQuery("offset"))>0}function _(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:Object(l.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(l.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(l.default)("msgId","dialogId"),onMsgReadByOther:Object(l.default)("msgId","dialogId"),onOnlineChange:Object(l.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(l.default)("dialogId","authorId"),onMultiTyping:Object(l.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(l.default)("msgId"),onMsgImportantAdd:Object(l.default)("msgId"),onMsgRemove:Object(l.default)("msgId"),onMsgRestore:Object(l.default)("msgId"),onPeerKeyboard:Object(l.default)("peerId"),onPeerBanner:Object(l.default)("peerId"),onDialogImportant:Object(l.default)("peerId","isImportant"),onDialogMarkedUnread:Object(l.default)("peerId","isMarkedUnread"),onUnreadCount:Object(l.default)("count"),onResync:Object(l.default)(),isLongPollingEnabled:function(){return!!a},init:function(t){e||(Object(st.setDocumentDomain)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady((function(){append(e,window.bodyNode),!0}))),lt.refreshParams(t),setTimeout(lt.check,1e3)},on:function(){clog("[longpoll] start"),a=!0,setTimeout(lt.check,1e3)},off:function(){clog("[longpoll] pause"),a=!1},refreshParams:function(e){extend(t,e||{}),extend(lt,t)},getKey:function(){if(i)try{i.abort()}catch(e){}i=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(lt.refreshParams({key:e}),lt.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(lt.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),r()}})},check:function(){if(a&&!o)if(lt.makeRequest)try{lt.makeRequest((function(e,t){if(o=!1,a)if(window.vk.__debug)lt.checked(parseJSON(t))&&(lt.check(),n=1);else try{lt.checked(parseJSON(t))&&(lt.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(lt.check,1e3*n),r()}}),(function(){o=!1,setTimeout(lt.check,1e3*n),r()})),o=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(lt.check,1e3)},checked:function(e){var i,a,o,l=e.failed;if(1==l||t.ts>=e.ts+256){if(lt.refreshParams({ts:e.ts}),l)return!0}else{if(2==l)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(lt.getKey,1e3*n),r(),!1;if(l)return void clog("[longpoll]",e)}if(lt.refreshParams({ts:e.ts}),e.updates){var f=[],p=!1;for(var h in e.updates){if(116==e.updates[h][0])var m=e.updates[h][1],v=[e.updates[h][0],m.id,m.flags,m.peer_id,m.date,m.title||"",m.message,m.kludges,m.random_id];else v=e.updates[h];var g=intval(v[0]),A=intval(v[1]),b=intval(v[2]),y=intval(v[3]);if(1===b){if(10===g){mail.updateImportantDialog(A,!1);continue}if(12===g){mail.updateImportantDialog(A,!0);continue}}if(b&1<<20){if(10===g){mail.updateMarkAsUnread(A,!1);continue}if(12===g){mail.updateMarkAsUnread(A,!0);continue}}if(8&b){if(2===g){if(window.isNewMail){lt.onMsgImportantAdd(A);continue}mail.updateImportantMessages(y,A,1);continue}if(3===g){if(window.isNewMail){lt.onMsgImportantRemove(A);continue}mail.updateImportantMessages(y,A,-1);continue}}if(51!=g)if(61!=g)if(62!=g)if(8!=g)if(9!=g)if(6!=g&&7!=g)if(80!=g||!A||nav.getQuery("community"))if(52!=g){if(y)if(4!=g&&5!=g&&116!=g)if(0!=g)if(2!=g);else{if(128&b){if(window.isNewMail){lt.onMsgRemove(A);continue}mail.markAsDeleted(y,A)}window.isNewMail&&64&b&&lt.onMsgRemove(A)}else{if(window.isNewMail){lt.onMsgRemove(A);continue}mail.markAsDeleted(A)}else{var w=5==g||116==g;if(window.isNewMail){var S=v,k=S[1],O=S[3],C=S[4],j=S[6],E=S[7],T=void 0===E?{}:E,I=S[8],M=c(T),P=(i=void 0,a=void 0,o=void 0,i=new Date(1e3*C),a=i.getHours(),o=i.getMinutes(),a+":"+(o<10?"0":"")+o),x=toInt(T.from_admin)||null,L=(toInt(nav.getQuery("community")),u(T,b,O)),B=!!T.source_act,R=T.keyboard?_(T.keyboard):null;if(w){var D={peerId:O,msgId:k,authorId:L,text:j,date:P,hasAttachments:M,flags:b,adminId:x,randomId:I};116==g?D.refreshed=1:D.edited=Math.floor(Date.now()/1e3),lt.onEditMsg(D)}else lt.onNewMsg({peerId:O,msgId:k,authorId:L,text:j,date:P,hasAttachments:M,flags:b,adminId:x,randomId:I,isService:B,keyboard:R});continue}var N=window.vk,H=2&b?N.id:v[7]&&v[7].from||y,V=v[7]&&v[7].source_act;p||(p=!!need("PinnedMsg").getByMsgId(A));var U=v[7].from_admin||V||p?null:mail.getMsgHTML(A,b,y,v[4],v[5],v[6],v[7],116!=g?w:"");if(U&&(w?mail.replaceMessage(y,A,H,U):d()||mail.addMessage(y,A,H,U),2&b||nav.getQuery("community")||s(!1,1)),"chat_kick_user"===V&&v[7].source_mid==N.id){var F=v[3];mail.unpinMessage(F)}U&&"chat_pin_message"!==V&&"chat_unpin_message"!==V||f.push({peer:y,msg_id:A,from_id:H,source_act:V,edited:w})}}else{var $=v,W=$[1],q=$[2];if(!window.isNewMail)continue;11==W&&lt.onPeerKeyboard(q),10==W&&lt.onPeerBanner(q)}else s(A);else{if(window.isNewMail){var z=v[1],Y=v[2];6===g?lt.onMsgReadByMe(Y,z):lt.onMsgReadByOther(Y,z);continue}mail.markPeerAsRead(A,b,7==g)}else{if(window.isNewMail){lt.onOnlineChange({userId:-A,isOnline:!1,lastActionTime:y});continue}mail.updateOnline(-A,0)}else{if(window.isNewMail){lt.onOnlineChange({userId:-A,isOnline:!0,onlinePlatform:7===(b||7)?"desktop":"mobile"});continue}mail.updateOnline(-A,b||7)}else{if(window.isNewMail){var G=2e9+b,Q=A;lt.onTyping(G,Q);continue}mail.typing(2e9+b,A)}else{if(window.isNewMail){var K=A,X=A;lt.onTyping(K,X);continue}mail.typing(A)}}if(f.length){var J=[];each(f,(function(e,t){J.push(t.msg_id)}));var Z={_ajax:1,act:"get_messages",msgs:J.join(","),community:nav.getQuery("community")};p&&(Z.force_pinned=1),ajax.post("/mail",Z,{onDone:function(e,t){var n=window.cur,i=d();each(f,(function(t,n){var a=e[n.msg_id],o=n.peer;a.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,a.text):mail.addMessage(n.peer,n.msg_id,n.from_id,a.text)),a.unpin&&mail.unpinMessage(o),a.pinned&&mail.pinMessage(o,a.pinned)})),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}(),ct=lt,ut=n("WwUR");window.isNewLongpoll?window.im=ut.default:window.im=ct;n("gNTM"),n("eoxF");var dt=n("j80l"),_t={};function ft(e){var t,n,a;ft.getQueryREs=te;var o,r,s,l,c,u,d,_,f,p,h,m,v,g=!1,A=[],b={},y={},w={},S={},k=!1,O=null,C=null,j=null,I=0,P=[],x=null,L=null,B=null,R=!1,D=!1,N=10,H=[],V=!0,U=!1,F=!1,$=!1,W={},q=[],z=!1,Y="",G=!1,Q=0,K=0,X=!1,J={},Z=e&&"au_search_field"===e.field&&attr(ge(e.field),"data-newsearch"),ee=Wd.elem({class:["show_next_wrap","show_next_wrap_transparent"],inner:{class:"show_more_loading",inner:{tag:"i",class:"i_loading",inner:""}}});function te(e){e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var t,n,i,a=D,o=[e,n=parseRusKeys(e,a)||e,i=parseLatKeys(e,a)||e,parseLat(n),parseCyr(i)],r={},s=[],l=0,c=o.length;l<c;l++)o[l]&&!r[o[l]]&&(r[o[l]]=!0,t=(t=escapeRE(o[l])).replace(/[её]/gi,"[её]").replace(/(e|yo)/gi,"(?:e|yo)"),s.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return s}function ne(e){return void 0===e&&(e=""),"_"+e+(W&&Object(i.len)(W)?JSON.stringify(W):"")}function ie(e,n,a,r){if(clearTimeout(C),!a)return C=setTimeout((function(){ie(e,n,!0)}),10),!1;var s=val(e)||"";if(O===s&&!r)return!1;var l,c=ne(s),h=y[c],m=[];if(!Z&&!h&&s.length>2&&y["_"+s.slice(0,-2)]){var v="_"+s.slice(0,-2);y[v]&&S[v]&&!y[v].length&&(!$||$&&!w[v])&&(S[c]=!0,h=y[c]=[],$&&(w[c]=""))}r&&(delete S[c],delete y[c],delete w[c]);var g=0;if(!h){h=[];if(pt.isCachedPage)g=(geByClass1("_si_container",o)||o).childNodes.length;if(!s&&A.length)for(var T=I,M=I+Math.min(Math.max(N,g),A.length);T<M;T++)h.push([A[T]]);else{var P={},x=0;for(T=0,M=A.length;T<M;T++){var L=A[T];if(b[L]){if(P[L]=!0,(l=oe(m,b[L][0]))&&(h.push([L,l]),++x>=30))break;0}}if(x<30)for(var L in b)if(!P[L]&&(l=oe(m,b[L][0]))){if(h.push([L,l]),++x>=30)break;0}}S[c]=S[c]||!s&&A.length||h.length>2*N,S[c]=S[c]||$&&h.length>N}var B=!_||!!s;(!S[c]&&(V||$)||r)&&!d&&B&&function e(n,a,r){var s=Z?800:200;if(clearTimeout(j),!r)return j=setTimeout((function(){e(n,a,!0)}),s),!1;ajax.post(t,Object(i.extend)({_ajax:1,q:a},W),{onDone:function(e,t,r){var s;"string"==typeof f?(s=Wd).handle2.apply(s,[[f],null].concat(Array.prototype.slice.call(arguments),[a,o])):f&&f.apply(void 0,Array.prototype.slice.call(arguments).concat([a,o]));for(var l,c=ne(a),d=y[c]||[],_={},p=te(a),h=0;h<d.length;h++)_[d[h][0]]=!0;for(var m=0;m<t.length;m++){var v=t[m];_[v]||((l=oe(p,e[v][0]))||R||!a)&&d.push([v,l])}S[c]=!0,y[c]=d,$&&(w[c]=r||""),b=Object(i.extend)(e,b),J._cache=b,V=!U||Object(i.len)(b)<U,O===a?(re(d,w[c]),onBodyScrollForce()):delete y[c],V||removeClass("input_loading",n),u&&(V=!1,U=Object.keys(b).length)},onFail:function(){var e=ne(a);delete y[e],removeClass("input_loading",n)}}),geByClass1("al_loading",o)||addClass("input_loading",n)}(e,s),y[c]=h;var D=O!==s;if(O=s,re(h,w[c]),"string"==typeof p?Wd.handle2([p],null,s,o):p&&p(s,o),(F||!O||D)&&(Q=Math.max(N,g)),z&&k){var H=Object(dt.parseURL)(nav.cur),Y=qs2obj(H.search.replace("?","")),G=Object.keys(Y).reduce((function(e,t){return q.includes(t)?e[t]=W[t]:q.includes(t)||(e[t]=isUndefined(e[t])?Y[t]:e[t]),e}),Object(i.extend)(copy(W),{q:s})),K=dt.default.make(nav.path,Object(E.default)({act:G.act},G)),X=Object(i.extend)(nav.page_get(nav.cur)||{},{page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}});nav.set({replace:!0,nav:Object(i.extend)({},nav,{cur:nav.path,path:nav.path||"",push:K||""})}),page.save(K,X)}return onBodyScrollForce(),!1}function ae(){var e=o&&o.querySelector(".show_next_wrap");e&&e.remove()}function oe(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([№])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var a=0;a<n.length;a++)for(var o=0,r=e.length;o<r;o++)if(-1!==n[a].search(e[o]))return e[o];return!1}function re(e,t){var n="";if(L&&o){var i=Object.keys(H).filter((function(e){return!!H[e]})).map((function(e){return e+""}));i.length&&""===O&&(e=e.filter((function(e){return!i.includes(String(e[0]))})),i.forEach((function(t){e.unshift([t,!1])})));for(var a=function(t){var i=e[t],a=i[0],o=i[1];if(!b[a])return"continue";var r=b[a].slice(1);if(o)for(var s in P){var l=P[s];r[l]&&(r[l]=r[l].replace(o,'$1<em class="found">$2</em>'))}n+=L.apply({id:a,q:O,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(o,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,(function(e,i,a){return a&&t[a-1]?n.highlight(t[a-1]):i&&t[i-1]?t[i-1]:""}))}},r)},s=0;s<e.length;s++)a(s);if(!n&&!S[ne(O)]&&(V||$)&&!d){ae(),removeClass("_si_container_loading",o);var u=Wd.html({class:"al_loading qs_loading",inner:Object(T.default)("wall","loading_40")});n=O?u:'<div id="al_loading"></div>'}if(!n&&B&&(n=B(O)),removeClass("input_loading",r),t||n!==v||G){var _=x?x(n,O,F,t):n+(t||"");val(o,_)}if(v=n,l){var f=Object(M.$)('[data-prefix="'+Y+'"]');f&&f.classList.toggle("qs_with_clear",!!O)}c&&toggle(c,!!O),!O&&alLoadingFix(),Object(M.$)(".al_loading",o)&&(X=!0),h&&h(O)}}Object(i.extend)(this,{go:function(e){return!r||(ie(r,e,!0,!0),r.blur(),cancelEvent(e),!1)},redraw:function(){var e=ne(O);re(y[e],w[e]),onBodyScrollForce()},clear:function(e,t){return val(r,""),t?elfocus(r):elblur(r),this.setSearchParams({}),this.go(e),cancelEvent(e),!1},blur:function(){elblur(r)},toggleAttach:function(e,t){H[e]=t},setSearchParams:function(e){var t=copy(W);if(isArray(e)){var n=nav.getQuery()||{};W=Object(i.extend)(W,e.reduce((function(e,t){var i=n[t];return i&&(e[t]=i),e}),{}))}else W=e;var a=JSON.stringify(t)!==JSON.stringify(W);this.onSearchParamsChange(W,t,a);var o=Object(M.$)('[data-prefix="'+Y+'"]');if(o){var r=Object(M.$)(".filter_btn",o);r&&(toggle(r,!!O),k&&a&&(b={}))}},getSearchParams:function(){return W},onSearchParamsChange:befall(),init:function(e){var v=this;if(e=e||{},o=ge(e.container)||null,r=ge(e.field)||null,s=ge(e.btn)||null,l=ge(e.clear_btn)||null,c=ge(e.filter_btn)||null,O=null,!k||t!=e.action||!e.init_once){y={},w={},S={},t=e.action||"",g=null!==e.next_from,a=e.next_from,n=e.al_action||t,A=e.top_items||[],b=e._cache||{},G=e.forceRerender||!1,P=e.hl_fields||[],x=e.tpl||null,L=e.item_tpl||null,B=e.null_tpl||null,R=e.soft_filter||!1,D=e.need_invalid_keys||!1,N=e.top_len||10,U=e.load_limit||!1,f=e.onLoaded||!1,p=e.onFiltered||!1,h=e.onRendered||!1,m=e.onFocusChanged||!1,F=e.al_need||!1,I=!F&&e.init_offset||0,$=e.global_search||!1,d=e.no_search_query||!1,_=e.search_non_empty_query||!1,u=e.load_once||!1,z=e.updateQuery||!1,q=e.availableSearchParams||[],Y=e.prefix||"";var C=e.action+e.container;_t[C]?J=_t[C]:(J._cache=b,J.top_items=A,_t[C]=J),pt.isCachedPage&&(A=J.top_items,b=J._cache,a=J.next_from),q.length&&(this.setSearchParams(q),onDOMReady((function(){v.setSearchParams(q),onBodyResize((function(){v.setSearchParams(q)}))})))}var j=null;t&&o&&r&&L&&(V=!0!==t&&(!U||Object(i.len)(b)<U),addEvent(r,"focus",(function(e){e&&e.preventDefault();clearTimeout(j),m&&m.call({q:O},!0),function t(n){!n&&ie(r,e,!0),j=setTimeout(t,100)}(!0)})),addEvent(r,"keydown keypress change blur",(function(e){"blur"==e.type&&(clearTimeout(j),m&&m.call({q:O},!1)),ie(r,e,"keydown"!=e.type&&"keypress"!=e.type)})),e._new||s&&!attr(s,"onclick")&&attr(s,"onclick","return qsearch.go(event);"),!F||k&&e.init_once||(Q=N,K=Object(i.len)(b),initAutoScroll((function(){var e=(geByClass1("_si_container",o)||o).childNodes;return e[Q]||e[e.length-1]}),(function(){var e=geByClass1("_si_container",o)||o;if(!X&&!O)if(g?!!a:Q+N>K&&V)X=!0,o&&o.append(ee),addClass(e,"_si_container_loading"),ajax.post(n,{_ajax:1,offset:K,next_from:a,q:O},{onDone:function(n,o,r){var s;(a=r,"string"==typeof f)?(s=Wd).handle2.apply(s,[[f],null].concat(Array.prototype.slice.call(arguments))):f&&f.apply(void 0,arguments);var l=Object(i.len)(n);if(X=!1,ae(),removeClass(e,"_si_container_loading"),U||(A=A.slice(0,K).concat(o),J.top_items=A),K+=l,b=Object(i.extend)(n,b),J._cache=b,J.next_from=a,V=!0!==t&&(!U&&l||Object(i.len)(b)<U),!O){Q+=N;for(var c=[],u=0,d=Math.min(Q,A.length);u<d;u++)c.push([A[u]]);re(c,w._),onBodyScrollForce()}},onFail:function(){X=!1,ae(),removeClass(e,"_si_container_loading")}});else if(Q<A.length){Q+=N;for(var r=[],s=0,l=Math.min(Q,A.length);s<l;s++)r.push([A[s]]);re(r,w._),onBodyScrollForce()}}))),e.common_cache&&(e.common_cache&&e.common_cache._gq_cache&&(w=e.common_cache._gq_cache),e.common_cache._q_loaded&&(S=e.common_cache._q_loaded)),!e.skip_init_filter&&ie(r,null,!0),k=!0)}}),e&&this.init(e)}var pt=new ft;window.QuickSearch=ft,window.QuickSearchCache=_t,window.qsearch=pt;var ht={onClose:Object(l.default)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){ht.inited||(ht.inited=!0,ht.initEvents())},initEvents:function(){var e=function(e){ht.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==ht.opened&&toggleClass("z_opened",window.bodyNode,ht._opened),ht._opened},toggle:function(e,t){return!!checkEvent(e)||(ht.opened()?ht.close(e,t):ht.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||(ht.opened()||(thover.clear(),ht.init(),ht._st=scrollTop(),ht._lastNav=!1,addClass("z_opened",window.bodyNode),ht._opened=!0,ht.fixHeight(vkNow()+2e3,!0),scrollTop(0)),!1)},close:function(e,t){return!!checkEvent(e)||!!ht.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),ht._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},ht._opened=!1,ht._destroy&&(ht._destroy(),ht._destroy=!1),scrollTop(ht._st,1),ht._st=!1,ht.onResize=null,ht.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(ht.width=e.offsetWidth,ht.height=e.offsetHeight,ht.onResize&&ht.onResize())},fixHeight:function(e,t){if((ht._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),i=getCh();(ht._lastWidth!=n||ht._lastHeight!=i||t)&&(ht._lastWidth=n,ht._lastHeight=i,setStyle("z","height",i),ht.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(ht._fixTo),ht._fixTo=setTimeout(ht.fixHeight,50,e)}},create:function(e,t){val("z",e),ht._destroy=t}};window.zlayer=ht;var mt=n("rc7J"),vt=n("GVTI"),gt=n("vhZE");window.photo=function(){var e,t,n,i,a,o,r,s,l,c,d=4,_=!1,f={},p={},h={},m=null,v=null,g=!1,A=null,b=null,y=!0,w=0,S=!1;function k(){if(!(e=$(".PhotoviewPage")))return nav.al_go(nav.cur),!1;if(geByClass1("pv_summary",e),geByClass1("photo_msg",e),r=geByClass1("pv_tag_wrap",e),n=geByClass1("PhotoviewPage__thumb",e),t=geByClass1("pv_nav",n),o=geByClass1("PhotoviewPage__photo",e),a=$(".PhotoviewPage__photo img",n),geByClass1("pv_footer",e),_=hasClass("pv_touch_full",e),t){var u=geByClass1("pv_nav_left",t),d=geByClass1("pv_nav_z",t),f=geByClass1("pv_nav_right",t);s=geByClass1("pv_nav_link",u),c=geByClass1("pv_nav_link",d),l=geByClass1("pv_nav_link",f),attr(s,"onclick","return photo.prev(event);"),attr(l,"onclick","return photo.next(event);"),attr(i,"onclick",!_&&"return photo.next(event);"),ajax.prepare_click([s,l,i])}return removeEvent(window,"orientationchange",x),addEvent(window,"orientationchange",x),removeEvent(window,"keydown",L),addEvent(window,"keydown",L),removeEvent(window,"resize",B),addEvent(window,"resize",B),gt.default.onClear("__clear",B),gt.default.onClear(B),!0}function O(){var t=window.photoview;return!!t&&(S||(S=!0,t.onPhotoChange=function(e,t){w=e,D(e,t)},t.onUpdate=function(){},t.onClose=function(t){if(uRegisterFloatBtn.show(),!function(e){var t=qs2obj(nav.params);if(delete t.z,!e.local&&!e.crop){if(nav.tryHistoryBack())return!1;var n=nav.path+obj2qs(t)+nav.hash;nav.go(n,null,{push_only:!0})}return!0}(t))return!0;var n=qs2obj(nav.params);e&&n.list==v&&R(w,!0)}),!0)}function C(e){var t=window.photoview,n=[];return each(e,(function(e,t){if(!t)return!0;n.push(f[t.id]=t)})),m&&t&&t.saveSource(M(m)),n}function j(e){return f[e]||{}}function T(e,t,n){if(null!==t){p[e]||(p[e]=new Array(n||len(t))),C(t);var i=p[e];g&&i.reverse(),extend(i,t),g?(m=copy(i),i.reverse()):m=i}else delete p[e]}function I(e){if("string"!=typeof e)return e;var t=p[e]||[];return g?copy(t).reverse():t}function M(e){var t=I(e),n=new Array(t.length),i=qs2obj(nav.params);for(var a in delete i.z,t){var o=m[a],r="",s="";o.hash&&(s=obj2qs({hash:o.hash,mp4:!0})),o.isDoc?(r="doc"+o.id+s,n[a]={id:o.id,photo_url:"/"+r,src:o.original_src,isDoc:!0,hasVideo:o.hasVideo}):(r="photo"+o.id+"?list="+v+(g?"&rev=1":"")+(b?"&from="+b:""),n[a]={id:o.id,photo_url:"/"+r,like_url:"/like?act="+(o.likes_me?"del":"add")+"&object=photo"+o.id+"&from="+encodeURIComponent(r)+"&list="+v+"&hash="+o.like_hash,likes_me:o.likes_me,src:o.original_src,max_src:o.max_src,tags:o.tags,caption:o.caption,likes_cnt:o.likes_cnt,replies_cnt:o.replies_cnt,market_tags:o.market_tags,restriction:o.restriction})}return n}function P(e,t){for(var n in t||(t=m),t)if(m[n].id==e)return+n;return-1}function x(){nav.hash||onDOMReady((function(){if(geByClass1("photo_view")){var e=scrollTop();n&&getY(n)<e&&scrollToEl(n)}}))}function L(e){if(zlayer.opened())return!1;switch(e.which){case 37:e.preventDefault(),photo.prev();break;case 39:e.preventDefault(),photo.next()}}function B(t){e&&document.body.contains(e)&&(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||isVisible($("#stickers_panel"))||R(w,!0))}function R(t,u,f){var p=window.cur,v=window.lang,S=m[t],k=1==m.length;if(S){nav.hash?scrollToHash(nav.hash):x();var O={};A&&(O.list=A),g&&(O.rev=1),b&&(O.from=b);var C=obj2qs(O),j="photo"+S.id+C,T=S.photo,I=(H(t-1)||{}).id,M=(H(t+1)||{}).id;if(k||(o&&(o.href="/photo"+M+C),s&&(s.href="/photo"+I+C),l&&(l.href="/photo"+M+C),ajax.prepare_click([s,l,i])),_){var P="photo"+S.id+"/"+A+(g?"/rev":""),L=extend({},O,{z:P}),R="/photo"+S.id+obj2qs(L);if(zlayer._lastNav){var D=zlayer._lastNav;(L=qs2obj(D.params)).z=P,R=D.path+obj2qs(L)+D.hash}c&&(c.href=R),ajax.prepare_click(c),attr(c,"onclick","return photo.fullscreen('"+escapeAttr(R)+"', event);")}if(a&&a.src!=T){a.onload=null,remove(a);var N;N=Wd.html(Object(vt._PhotoviewPage_tags)(S.tags)),val(o,'<img src="'+(T||"/images/blank.gif")+'" alt="" class="ph_img" />'+N),a=geByTag1("img",o)}toggleClass("photo_deleted",e,!!S.deleted),toggleClass("pv_one_photo",n,1==m.length),val(r,S.tag_info||"");var U=(it.default.getStickerPanel()||"").split("photo-0_0").join("photo"+S.id),W=S.comments_html||"";U&&(W=W.split("\x3c!--stickers_panel--\x3e").join(U)),e.classList.toggle("PhotoviewPage--deleted",!!S.isDeleted),e.childNodes[0].setAttribute("id","photo"+S.id);var q=$(".wi_like_wrap",e);q&&(q.innerHTML=S.liked_people||"",q.classList.toggle("is_empty",!S.liked_people));var z,Y=$(".PhotoviewPage__restrictedInfo"),G=!!(S.restriction&&"block"===S.restriction.type||S.restriction&&"blur"===S.restriction.type&&!gt.default.isCleared("photo"+S.id));G&&(z=Object(E.default)({},S.restriction,{forceText:!0,raw:"photo"+S.id,width:getW(o),height:getH(o)}),a.complete||a.onload||(a.onload=B)),e.classList.toggle("pv_touch--hideZOpen",G),toggle(Y,G),o.classList.toggle("PhotoviewPage__photo--block",!(!z||"block"!==z.type)),o.classList.toggle("PhotoviewPage__photo--blur",!(!z||"blur"!==z.type)),G&&Y&&(Y.innerHTML=Wd.html(Object(gt.default)(z)));var Q=$(".wi_buttons",e);val(Q,S.like_buttons||"");var K=$(".AlbumInfoRow",e);K&&(K.outerHTML=Wd.html(Object(mt.default)({url:S.album_href,author_url:S.author_href,avatar:S.avatar,title:Wd.wrap(S.album_title),subtitle:Wd.wrap(S.album_info_subtitle),withoutBottomBorder:!S.has_replies})));var X=$(".PhotoviewPage__description",e);if(X){S.description&&S.description,X.innerHTML=S.description,X.classList.toggle("PhotoviewPage__description--empty",!S.description)}var J=$(".PhotoviewPage__caption",e);if(J){var Z="";S.caption&&(Z+=S.caption),val(J,Z)}var ee=$(".Replies");ee&&(ee.outerHTML=S.replies_html);var te=$(".RepliesField"),ne=it.default.getStickerPanel();te&&S.reply_field_html&&ne&&(te.outerHTML=S.reply_field_html.replace("\x3c!--stickers_panel--\x3e",ne));var ie=$("#mhead .HeaderSubtitle__subtitle");ie&&(ie.innerHTML=v.mobile_photos_photo_header.replace("%s",w+1).replace(/%s|{count}/,m.length));var ae=ge("photo_actions");if(ae&&(ae.innerHTML=Wd.render(S.actions)),post.stickersInit(),p.replyTo=0,ajax.refreshLinks(S.fv_link,S.app_link),photo.closeTags(),!u){var oe="/"+j;nav.go(oe,null,{no_push:u,push_only:!0,replace:f}),page.save(oe,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}setTimeout((function(){var e=Object(F.getState)("autoload")||{};Replies.init(e.enable||!1,S.author_id||S.owner_id)}))}y||(V(),function(){for(var e=0,t=w+1;e<d;e++){var n=H(e+t),i=n&&n.photo;if(i&&!h[i]){var a=h[i]=new Image;a.src=i,a.onload=function(){h[i]=!0}}}}())}function D(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,o=n.hasVideo,r=window.photoview,s=m[e];m.length;if(s){var l=qs2obj(nav.params);if(l.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+A+(g?"/rev":""),t.no_open||r.open(e,M(m),{local:t.local,showControls:t.showControls,isDoc:i,hasVideo:o}),!t.local&&!t.crop){var c=nav.path+obj2qs(l)+nav.hash;nav.go(c,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0})}}t.local||t.crop||V(!0,i)}var N=!1;function H(e){return e>0?e%=m.length:e=(100*m.length+e)%m.length,m[e]}function V(e,t){if(void 0===t&&(t=!1),!N){for(var n=window.photoview,i=!1,a=1,o=0;o<5;o++){if(!(s=H(r=o+w))||!s.owner_id){i=r,a=1;break}}if(!1===i)for(o=-1;o>-3;o--){var r,s;if(!(s=H(r=o+w))||!s.owner_id){i=r,a=-1;break}}if(!1!==i){var l=H(w);if(l){N=!0,show(void 0);var c=window.cur,u=l.owner_id||(l.id||"").split("_")[0],d=Gif.isMp4Supports()&&l.hasVideo,_=r==w&&l.id?(t?"/doc":"/photo")+l.id+(l.hash?"?hash="+l.hash:"")+(d?(l.hash?"&":"?")+"mp4":""):"/photos.php",f={_ajax:1,oid:u,list:v,offset:i,direction:a,rev:g?1:0};it.default.getStickerPanel()||(f.need_stickers=1),nav.getQuery("community")&&(f.community=nav.getQuery("community")),ajax.post(_,f,{onDone:function(t,i,a,o){hide(void 0),N=!1,a&&(c.replyNames||(c.replyNames={}),extend(c.replyNames,a)),o&&extend(c,o),T(v,t,i||m.length),e?n&&n.saveSource(M(v),!1,!0):R(w,!0)}})}}}}function U(e,t,n,i,a){if(m=[],e){var o=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e);o&&each(geByTag("img",o),(function(){var e=domData(this,"id"),t=JSON.parse(domData(this,"restriction")),n=domData(this,"src_big");if(!e||!n)return!0;var i=(n=n.split("|"))[0],a=intphoto_data[1]||0,o=+n[2]||0;m.push({id:e,original_src:i,width:a,height:o,restriction:t})}))}m.length||m.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a})}function W(){addClass("pv_icons_hide",n)}return{save:C,get:j,saveSource:T,getSource:I,clear:function(){removeEvent(window,"resize",B),removeEvent(window,"orientationchange",x),removeEvent(window,"keydown",L)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!k())return!0;if(g=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),g=!0),b=i||null,t)v=t;else{var o=j(e);v=o.album?"album"+o.album:""}if(A=v,m=I(v),-1===(w=P(e,m))){if(!(o=j(e)).id)return!1;m=[o],w=0}y=m.length<2,!1;var r=m[w]&&e!=m[w].id;return R(w,a&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(N&&!H(w-1))&&(!k()||(y?photo.close():(--w<0&&(w=m.length-1),R(w),W(),!1)))},next:function(e){return!!checkEvent(e)||!(N&&!H(w+1))&&(!k()||(y||(++w>=m.length&&(w=0),R(w),W()),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",n)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("PhotoviewPage","m");if(!e)return!1;setTimeout((function(){removeClass("pv_hidden_icons",e),setTimeout((function(){addClass("pv_icons_hide",e)}),2e3)}),10)},selectTag:function(e,t,i){if(i&&!hasClass("pv_photo_tags_selected",n))return!0;var a=ge("pv_tag"+e),o=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),r=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",a)||(removeClass("pv_tag_selected",o),addClass("pv_tag_selected",a)),hasClass("pv_tag_label_selected",r)?nav.go(r,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",r),addClass("pv_photo_tags_selected",n),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",n))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),i=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),i&&removeClass("pv_tag_label_selected",i),removeClass("pv_photo_tags_selected",n),cancelEvent(e),!1},init:function(e,t,n,i,a,o,r){d=isUndefined(r.preload)?1:r.preload,g=!!a,photo.saveSource(e,t,n),onDOMReady((function(){photo.open(i,e+(a?"/rev":""),null,o,!0)}))},zopen:function(e,t,n,i,a){if(void 0===a&&(a={}),checkEvent(t))return!0;if(u.EduIntegration.isIntegrated)return u.EduIntegration.embedded.sendMessage("photo",{id:n+"_"+(a.key||"")}),!1;var o=a,r=o.isDoc,s=o.hasVideo,l=o.hash;if(O(),g=!1,"/rev"==i.substr(-4)&&(i=i.slice(0,-4),g=!0),delete qs2obj(nav.params).z,b=a.from||!1,i)v=i;else{var c=j(n);v=c.album?"album"+c.album:""}if(A=v,(m=I(v))[0]&&m[0].isDoc&&m[0].hasVideo!==s&&(m=[]),m.length||U(e,n,r,s,l),-1===(w=P(n,m))&&(U(e,n,r,s,l),w=P(n,m)),-1===w){if(!(c=j(n)).id)return!0;m=[c],w=0}y=m.length<2,!1;var d=m[w]&&n!=m[w].id;return D(w,{no_push:a.no_push&&!d,replace:d,local:a.local,showControls:a.showControls,isDoc:r,hasVideo:s,hash:l}),uRegisterFloatBtn.hide(),cancelEvent(t),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}();var At=function(){function e(){}return e.follow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.add("MusicAuthorCover__followBtn__followed"),a.onclick=function(o){o.preventDefault(),e.unfollow(t,n,i,a)}},onFail:function(){return unlockButton(a)}})},e.unfollow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.remove("MusicAuthorCover__followBtn__followed"),a.classList.contains("MusicAuthorCover__followBtn__canFollow")&&(a.onclick=function(o){o.preventDefault(),e.follow(t,n,i,a)})},onFail:function(){return unlockButton(a)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}(),bt=function(){function e(){}return e.follow=function(t,n,i){lockButton(i),ajax.post("curator.php",{_ajax:1,act:"follow",hash:n,curator_id:t},{onDone:function(n){unlockButton(i),i.classList.add("MusicAuthorCover__followBtn__followed"),i.onclick=function(a){a.preventDefault(),e.unfollow(t,n,i)}},onFail:function(){return unlockButton(i)}})},e.unfollow=function(t,n,i){lockButton(i),ajax.post("curator.php",{_ajax:1,act:"unfollow",hash:n,curator_id:t},{onDone:function(n){unlockButton(i),i.classList.remove("MusicAuthorCover__followBtn__followed"),i.classList.contains("MusicAuthorCover__followBtn__canFollow")&&(i.onclick=function(a){a.preventDefault(),e.follow(t,n,i)})},onFail:function(){return unlockButton(i)}})},e}(),yt=n("lkNA"),wt=n("rEJs"),St=0,kt=1,Ot=2,Ct=3,jt=4,Et=5,Tt=6,It=8,Mt=9,Pt=10,xt=11,Lt=12,Bt=13,Rt=14,Dt=15,Nt=16,Ht=17,Vt=18,Ut=19,Ft=20,$t=21,Wt=22,qt=24,zt=25,Yt=2,Gt=4,Qt=32,Kt=128,Xt=512,Jt=1024;function Zt(e){if(!e)return!1;var t=isObject(e)?e.extra:e[Lt];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}var en=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,i=function(e){return t&&t(e)};if(this._admanLoaded)i();else{var a=0;Object(yt.loadScript)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,i()},onError:function(){window.abp?(n._admanLoaded=!0,i()):(3===(a+=1)&&(n._admanLoaded=!0),i("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,o){var r=this;this.loadAdman((function(s){if(!window.AdmanHTML)return r._sendEvent("no_adman",n,e.AD_TYPE,s),a&&a();r._adman=new AdmanHTML;var l=r._adsConfig||vk.audioAdsConfig||window.audioAdsConfig,c={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:tn(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other,sign:l.sign||""};extend(c,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(c.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(c.preview=1,c.vk_id=398724832),r._adman.setDebug(!!c.preview),r._adman.onError((function(){return a&&a()})),r._adman.onReady((function(){if(r._adman){var t=r._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(r._play(!0,n),a&&a()):(r._sendEvent("received",n),i?(r._sendEvent("rejected",n,e.AD_TYPE,o),r.deinit(),a&&a()):(r._sendEvent("ready",n),r.player.notify(wt.events.AD_READY),r._play(!1,n,a))):(i||r._sendEvent("not_received",n),a&&a())}})),r._adman.init({slot:3514,wrapper:r.isMvk?ce("div"):se("<div></div>"),params:c,browser:{adBlock:!!window.abp,mobile:!1}}),r._sendEvent("requested",n)}))},t._sendEvent=function(e,t,n,i){var a=this,o=n?"/"+n:"",r=i?"/"+i:"";this._adEvents.push(e+"/"+t+o+r),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout((function(){ajax.post(a.adsStatUrl,{act:"ad_event",events:a._adEvents.join(","),v:a.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),a._adEvents=[]}),500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted((function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(wt.events.PROGRESS,0),a.player.notify(wt.events.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())})),this._adman.onStarted((function(){t||(a.player.setIsPlaying(!0),a.player.notify(wt.events.PLAY),a.player.notify(wt.events.PROGRESS,0),a.player.notify(wt.events.AD_STARTED),a.updateVolume(),a._sendEvent("started",n),window.statlogsValueEvent&&statlogsValueEvent("audio_web_ad_link","show"))})),this._adman.onPaused((function(){a.player.setIsPlaying(!1),a.player.notify(wt.events.PAUSE)})),this._adman.onPlayed((function(){a.player.setIsPlaying(!0),a.player.notify(wt.events.PLAY)}));var o=[.25,.5,.75];if(this._adman.onTimeRemained((function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(wt.events.PROGRESS,a._adsCurrentProgress,a._duration),each(o,(function(e,t){if(a._adsCurrentProgress>=t)return o.shift(),a._sendEvent("progress_"+intval(100*t),n),!1}))})),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(wt.events.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.stop=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.stop())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(wt.events.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),a=this._isAllowed(t),o=a.type,r=a.reason,s=function(){return n&&n()};switch(o){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,r),s()}},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if(Zt(t))return{type:e.ALLOW_DISABLED};if(window.browser&&window.browser.safari)return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled)return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t){this.checkPlay(e,t)},e}();function tn(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}en.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",en.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},en.AD_TYPE="preroll",en.ALLOW_DISABLED=1,en.ALLOW_ALLOWED=2,en.ALLOW_REJECT=3,en.REJECT_REASON_UNKNOWN="unknown",en.REJECT_REASON_LIMIT="track_limit_exceeded",en.REJECT_REASON_SECTION="section_not_allowed";var nn=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case wt.events.AD_COMPLETED:case wt.events.AD_STARTED:this.audioplayer.notify(e,n);break;case wt.events.PAUSE:case wt.events.PLAY:this.audioplayer.notify(e,n.fullId);break;case wt.events.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=Object(i.ssGet)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}(),an=n("Po+v");function on(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function i(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function o(e,t){0>e?e=0:e>v-1&&(e=v-1);for(var n=S.dots.length-1;n>=0;n--)a(S.dots[n],j.activeDot);return i(S.dots[e],j.activeDot),O=e,r(-e*S.width,void 0===t?C.speed:t),_(),C.onSlideChange&&C.onSlideChange(e),e}function r(e,t){var n=t?t+"ms":"";A.style.webkitTransitionDuration=A.style.MozTransitionDuration=A.style.msTransitionDuration=A.style.OTransitionDuration=A.style.transitionDuration=n,l(e)}function s(e,t){if(w&&clearInterval(w),t){var n=+new Date,i=S.left;w=setInterval((function(){function a(e,t){return(t-e)*s+e}var o,r,s=(+new Date-n)/t,c=[0,.7,1,1];return s>=1?(l(e),void clearInterval(w)):(o=e-i,r=a(a(a(c[0],c[1]),a(c[1],c[2])),a(a(c[1],c[2]),a(c[2],c[3]))),void l(Math.floor(r*o+i)))}),15)}else l(e)}function l(e){A.style.webkitTransform="translate("+e+"px,0) translateZ(0)",A.style.msTransform=A.style.MozTransform=A.style.OTransform=A.style.transform="translateX("+e+"px)",S.left=e}function c(e){A.style.left=e+"px",S.left=e}function u(){var e=O+1;return e>v-1&&(e=0),o(e)}function d(){y=!0,_()}function _(){y&&(b&&clearTimeout(b),b=setTimeout((function(){u()}),C.slideshowInterval))}function f(){b&&clearTimeout(b)}function p(){y=!1,b&&clearTimeout(b)}function h(){S.width=e.offsetWidth,A.style.width=S.width*v+"px";for(var t=0;v>t;t++)S.slides[t].style.width=S.width+"px";r(-O*S.width)}function m(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var v,g,A,b,y,w,S={slides:[],dots:[],left:0},k=200,O=0,C={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(C,t);var j={inactive:C.cssPrefix+"inactive",active:C.cssPrefix+"active",mouse:C.cssPrefix+"mouse",drag:C.cssPrefix+"drag",slides:C.cssPrefix+"slides",dots:C.cssPrefix+"dots",activeDot:C.cssPrefix+"active-dot",mouseClicked:C.cssPrefix+"mouse-clicked"},E={transforms:n("transform"),transitions:n("transition")};return function(){var t=C.slidesContainer||e,n=C.dotsContainer||e;if(!(C.disableIfOneSlide&&t.children.length<=1)){(!E.transforms||window.opera)&&(l=c),(!E.transitions||window.opera)&&(r=s),i(A=C.slidesContainer||document.createElement("div"),j.slides);for(var u=0,_=t.children.length;_>u;u++){var b=t.children[u],y=document.createElement("li");S.slides.push(b),y.setAttribute("tabindex","0"),y.setAttribute("role","button"),y.innerHTML="<span></span>",function(t,n){m(n,"click",(function(){o(t),C.stopSlideshowAfterInteraction&&p()})),m(n,"keyup",(function(e){13==e.keyCode&&(o(t),C.stopSlideshowAfterInteraction&&p())})),m(n,"mouseup",(function(){i(n,j.mouseClicked)})),m(n,"blur",(function(){a(n,j.mouseClicked)}),!0),m(b,"focus",b.onfocusin=function(){e.scrollLeft=0,setTimeout((function(){e.scrollLeft=0}),0),o(t)},!0)}(u,y),S.dots.push(y)}v=S.slides.length,100/v,i(e,j.active),a(e,j.inactive),C.mouseDrag&&i(e,j.mouse),S.width=e.offsetWidth,A.style.width=S.width*v+"px";for(u=0;v>u;u++)S.slides[u].style.width=S.width+"px",A.appendChild(S.slides[u]);if(C.slidesContainer||e.appendChild(A),C.dots&&v>1){i(g=document.createElement("ul"),j.dots);for(u=0,_=S.dots.length;_>u;u++)g.appendChild(S.dots[u]);C.dotsPrepend?n.insertBefore(g,n.firstChild):n.appendChild(g)}m(window,"resize",h),m(window,"orientationchange",h),setTimeout((function(){o(C.startSlide,0)}),0),C.slideshow&&d(),rn(A,{mouse:C.mouseDrag,start:function(){i(e,j.drag)},move:function(e,t,n){f(),n.x=n.x/(!O&&n.x>0||O==v-1&&n.x<0?Math.abs(n.x)/S.width*2+1:1),r(n.x-S.width*O)},end:function(t,n,i){if(i.x){var r=Math.abs(i.x)/S.width,s=Math.floor(r)+(r-Math.floor(r)>.25?1:0);s+=i.time<k+k*s/1.8&&Math.abs(i.x)-s*S.width>(s?-S.width/9:20)?1:0,i.x<0?o(O+s,C.touchSpeed):o(O-s,C.touchSpeed),C.stopSlideshowAfterInteraction&&p()}a(e,j.drag)}}),setTimeout((function(){C.onSetup&&C.onSetup(v)}),0)}}(),{slideTo:function(e,t){return o(parseInt(e,10),t)},next:u,prev:function(){var e=O-1;return 0>e&&(e=v-1),o(e)},start:d,stop:p,pause:f,getCurrentPos:function(){return O},getSlidesNumber:function(){return v},recalcWidth:h}}function rn(e,t){function n(e,t,n,a){return t?(e.addEventListener?e.addEventListener(t,n,!!a):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,a)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function a(e){}function o(e){if((m={x:(_?e.clientX:e.touches[0].clientX)-h.x,y:(_?e.clientY:e.touches[0].clientY)-h.y,time:Number(new Date)-h.time}).time-g[g.length-1].time){for(var t=0;t<g.length-1&&m.time-g[t].time>80;t++);v={x:(m.x-g[t].x)/(m.time-g[t].time),y:(m.y-g[t].y)/(m.time-g[t].time)},g.length>=5&&g.shift(),g.push({x:m.x,y:m.y,time:m.time})}}function r(e,t){b=!0,S[_=t](e)||(n(document,w[_][1],s),n(document,w[_][2],l),n(document,w[_][3],l),u.preventDefault,h={x:_?e.clientX:e.touches[0].clientX,y:_?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,m={x:0,y:0,time:0},v={x:0,y:0},g=[{x:0,y:0,time:0}],u.start(e,h))}function s(e){!u.preventScroll&&d||S[_](e)||(o(e),(Math.abs(m.x)>u.clickTolerance||Math.abs(m.y)>u.clickTolerance)&&(b=!1),void 0===d&&3!==_&&(d=Math.abs(m.x)<Math.abs(m.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,h,m,v)))}function l(e){_&&o(e),!b&&e.target&&e.target.blur&&e.target.blur(),i(document,w[_][1],s),i(document,w[_][2],l),i(document,w[_][3],l),u.end(e,h,m,v)}var c=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:c,move:c,end:c,click:c};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,_,f=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,h={},m={},v={},g=[],A=[],b=!0,y=f?1:p?2:0,w=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],S=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return A.push(n(e,w[y][0],(function(e){r(e,y)}))),A.push(n(e,"dragstart",a)),u.mouse&&!y&&A.push(n(e,w[3][0],(function(e){r(e,3)}))),A.push(n(e,"click",(function(e){b&&u.click(e)}))),{getClicksAllowed:function(){return b},kill:function(){for(var e=A.length-1;e>=0;e--)A[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each((function(){e(this).data("Peppermint",on(this,t))})),this}}(window.jQuery),window.Peppermint=on,window.EventBurrito=rn;var sn=on,ln=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){Object(i.statlogsValueEvent)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=an.default.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach((function(n){n.addEventListener("click",(function(n){Object(i.gpeByClass)("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):Object(i.gpeByClass)("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()}))})),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",(function(){return e.sendStat("click_more")})),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",(function(){e.sendStat("continue_free"),t.close()})),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",(function(){t.slider.next(),e.sendStat("next_1screen")})),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",(function(){return e.sendStat("get_offer")}))},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=sn(this.screens,{dots:!0,speed:500})},t.close=function(){an.default.close(this.popup)},e}(),cn=n("r/ag"),un=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=C.default.version.split(".")[0];if(C.default.safari_mobile&&n<=7)return window.addEventListener("pagehide",(function(){return e._hidden()})),void window.addEventListener("pageshow",(function(){return e._visible()}));var i=C.default.android&&C.default.safari&&n<5,a=!i&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)})),window.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)}))):document.addEventListener?(window.addEventListener("focus",(function(){return e._visible()}),1),window.addEventListener("blur",(function(){return e._hidden()}),1)):(document.attachEvent("onfocusin",(function(){return e._visible()})),document.attachEvent("onfocusout",(function(){return e._hidden()})))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach((function(e){return e()}))},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach((function(e){return e()}))},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();function dn(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var i=["AudioPopup"];e.popupClass&&i.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new cn.default({content:a,class:i.join(" ")})}un.prefixes=["webkit","o","ms","moz",""];var _n=n("J8bf"),fn=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt(Object(_n.getCookie)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(dn({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,Object(_n.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(cn.default.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new un,this.pageVisibility.onVisible((function(){e.isIdle=!1})),this.pageVisibility.onHidden((function(){e.isIdle=!0,e.onIdle()}))},e}();fn.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",fn.REMOVE_RESTRICTION_LINK="/offermusic",fn.EXPLANATION_LINK="https://vk.cc/9uFgyl";var pn,hn=n("L9Nh"),mn=(pn=function(e,t){return(pn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}pn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),vn=function(e){function t(t){return e.call(this,t)||this}return mn(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,hn.QueueManager.addQueue({key:e.key,ts:e.timestamp},(function(e,n){return t.queueHandler(n)})),hn.QueueManager.start())},t}((function(e){this.queueHandler=e}));var gn=0,An=function(){function e(){this.audioQueueListener=new vn(this.handleAudioQueueMessage),this.subscriptionQueueListener=new vn(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),hn.QueueManager.initialized){var n=window.audio.getCurrent(),i=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);n&&!i&&window.ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(e){var n,i,a=(i={},(n=e)&&n.length&&n.filter((function(e){return!!e})).map((function(e){return e.queues&&e.queues[0]})).forEach((function(e){return i[e.type]=e})),i);a.audio&&t.audioQueueListener.connect(a.audio),a.subscription&&t.subscriptionQueueListener.connect(a.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout((function(){return t.connect(!0)}),3e4))},onFail:function(){return gn<3&&(gn++,setTimeout((function(){return t.connect()}),5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var n=window.audio.playing(),i=0;i<t.events.length;i++){var a=t.events[i].data;if("start"===a.type&&window.audio.getDeviceId()!==a.uuid&&!e.startPlaybackBox&&n){window.audio.pause(),e.showMultipleStreamPopup(a);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach((function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}}))},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);cn.default.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",(function(){cn.default.close()})),e.startPlaybackBox=!0},e.createPopup=function(e){return c.default.elem(dn({title:Object(F.getLang)("mobile_audio_start_playback_title"),description:Object(F.getLang)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:Object(F.getLang)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}(),bn="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",yn=n("xk4V"),wn=n.n(yn),Sn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],r=0,s=o.length;r<s;r++,a++)i[a]=o[r];return i},kn=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach((function(e){return n.subscribe(e,t)})),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},e.prototype.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.precheck&&!this.precheck.apply(this,Sn([e],t))||(this.onAnyCallBack&&this.onAnyCallBack.apply(this,Sn([e],t)),this.subscriptions[e]&&this.subscriptions[e].forEach((function(e){return e.apply(void 0,t)})))},e}(),On="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",Cn={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var i=On+On,a=e.length;a--;)~(n=i.indexOf(e[a]))&&(e[a]=i.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var a=n;for(t=Math.abs(t);a--;)t=(n*(a+1)^t+a)%n,i[a]=t}return i}(e,t),a=0;for(e=e.split("");++a<n;)e[a]=e.splice(i[n-1-a],1,e[a])[0];e=e.join("")}return e},i:function(e,t){return Cn.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),(function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))})),n.join("")}};function jn(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":En(i[1]);if(i=En(i[0]),"string"!=typeof a||!i)return e;for(var o=(a=a?a.split(String.fromCharCode(9)):[]).length;o--;){if(t=(n=a[o].split(String.fromCharCode(11))).splice(0,1,i)[0],!Cn[t])return e;i=Cn[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function En(e){if(!e||e.length%4==1)return!1;for(var t,n,i=0,a=0,o="";n=e.charAt(a++);)~(n=On.indexOf(n))&&(t=i%4?64*t+n:n,i++%4)&&(o+=String.fromCharCode(255&t>>(-2*i&6)));return o}function Tn(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}var In,Mn,Pn=n("Bj12"),xn=function(){function e(){}return e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(Pn.saveNetworkStats)(e):Object(S.logError)(new Error("NetworkStatCollector: invalid event."))},e}();!function(e){e.TYPE_NETWORK_AUDIO_ITEM="type_network_audio_item"}(In||(In={})),function(e){e.FRAGMENT_LOADED="fragment_loaded",e.FRAGMENT_STALLED="fragment_stalled"}(Mn||(Mn={}));var Ln=function(){function e(e){this.networkStatCollector=e}return e.prototype.logEvent=function(e,t,n){var i,a=((i={network_type:t,network_effective_type:n,type:In.TYPE_NETWORK_AUDIO_ITEM})[In.TYPE_NETWORK_AUDIO_ITEM]=e,i);this.networkStatCollector.logEvent(a)},e}();function Bn(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection}function Rn(){var e=Bn();return e&&e.type||"unknown"}function Dn(){var e=Bn();return e&&e.effectiveType||"unknown"}var Nn={getConnection:Bn,getConnectionType:Rn,getConnectionEffectiveType:Dn,getConnectionTypeID:function(){return{unknown:0,bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7}[Rn()]||0},getConnectionEffectiveTypeID:function(){return{unknown:0,"slow-2g":1,"2g":2,"3g":3,"4g":4}[Dn()]||0}};function Hn(e,t){var n="";return e.forEach((function(i,a){var o="/audio?performer=1&q="+encodeURIComponent(i.name),r=window.getWebHost?window.getWebHost():"";i.id&&(o="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+r+o+'">'+i.name+"</a>":i.name,a<e.length-1&&(n+=", ")})),n}function Vn(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[Bt]||"").split("/"),n=(e[Rt]||"").split(","),i=function(e,t){void 0===t&&(t=!0);var n="",i=!Zt(e)&&t;if(isArray(e[Ht])&&(n=Hn(e[Ht],i)),isArray(e[Vt])&&(n+=" feat. ",n+=Hn(e[Vt],i)),!n){var a=e[jt]?e[jt].replace(/<\/?em>/g,""):"";if(i)n='<a class="artist_link" data-performer="'+a+'" href="'+("/audio?performer=1&q="+encodeURIComponent(a))+'">'+a+"</a>";else n=a}return n}(e,!1);return{id:intval(e[St]),owner_id:intval(e[kt]),ownerId:e[kt],fullId:e[kt]+"_"+e[St],title:e[Ct]||"",subTitle:e[Nt],performer:i,mainArtists:e[Ht],featArtists:e[Vt],authorLink:e[It],duration:intval(e[Et]),lyrics:intval(e[Mt]),url:e[Ot],flags:e[Pt],context:e[xt],extra:e[Lt],accessKey:e[qt],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[Pt]&Qt,canAdd:!!(e[Pt]&Yt),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[Pt]&Gt),isExplicit:!!(e[Pt]&Jt),isUMA:!!(e[Pt]&Kt),isReplaceable:!!(e[Pt]&Xt),ads:e[Dt],album:e[Ut],albumId:intval(e[Tt]),albumPart:intval(e[Wt]),trackCode:e[Ft],restrictionStatus:e[$t],chartInfo:e[zt]}}var Un,Fn=function(){function e(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode();var t=new xn;this._audioNetworkStatCollector=new Ln(t)}var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t.getCurrentTime=function(){return this._currentAudioEl.currentTime},t.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode(bn)},t._setAudioNodeUrl=function(e,t){var n=jn(t);domData(e,"setUrlTime",n===bn?0:vkNow()),e===this._currentAudioEl&&this._currentHls&&(this._currentHls.destroy(),this._currentHls=null);var i=browser.version.split(".")[0],a=browser.safari||browser.msie_edge&&i>11&&i<78;return this._isHlsUrl(n)&&!a&&"function"==typeof window.MediaSource?this._initHls(e,n):(e.src=n,Promise.resolve())},t._isHlsUrl=function(e){return/\.m3u8/.test(jn(e))},t._loadHls=function(){return new Promise((function(e,t){window.Hls&&e(),window.isMVK?Object(yt.loadScript)("/js/lib/hls.min.js",{onLoad:e}):stManager.add("hls.min.js",e)}))},t._initHls=function(e,t){var n=this;return this._loadHls().then((function(){return new Promise((function(i){var a=!1,o=!!(window.isMVK?window.lsGet("_audio_hls_debug"):ls.get("_audio_hls_debug")),r=new window.Hls({debug:o,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});r.on(Hls.Events.ERROR,(function(e,t){t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(a=!0),(o||t.fatal)&&console.log("audio hls error",e,t),t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(r.stopLoad(),r.startLoad()),t.fatal&&(n._hlsError={type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0},n.opts.onFail&&n.opts.onFail())})),r.on(Hls.Events.FRAG_BUFFERED,(function(e,t){var i=function(){try{return window.isMVK?window.audio.getCurrent():Vn(window.getAudioPlayer().getCurrentAudio())}catch(e){return{id:0,ownerId:0}}}(),o={owner_id:i.ownerId,audio_id:i.id,fragment_id:t.frag.sn.toString(),fragment_duration:Math.ceil(1e3*t.frag.duration).toString(),time_to_first_byte:Math.ceil(t.stats.tfirst-t.stats.trequest).toString(),time_to_first_frame:Math.ceil(t.stats.tload-t.stats.trequest).toString(),buffering_time:Math.ceil(t.stats.tbuffered-t.stats.trequest).toString()};a&&n._audioNetworkStatCollector.logEvent(Object(E.default)({},o,{event_type:Mn.FRAGMENT_STALLED}),Nn.getConnectionType(),Nn.getConnectionEffectiveType()),a=!1,Object(ie.partConfigEnabled)("network_audio_fragment_loaded")&&n._audioNetworkStatCollector.logEvent(Object(E.default)({},o,{event_type:Mn.FRAGMENT_LOADED}),Nn.getConnectionType(),Nn.getConnectionEffectiveType())})),r.loadSource(t),r.attachMedia(e),n._currentHls=r,n._hlsError=null,i()}))}))},t._createAudioNode=function(e){var t=this,n=new Audio;return this.opts.onBufferUpdate&&(addEvent(n,"pause",this.opts.onpause),addEvent(n,"play",this.opts.onplay),addEvent(n,"progress",(function(){t._currentAudioEl===n&&t.opts.onBufferUpdate(t.getCurrentBuffered());var e=n.buffered;1===e.length&&0===e.start(0)&&e.end(0)===n.duration&&(n._fullyLoaded=!0)}))),this.opts.onProgressUpdate&&addEvent(n,"timeupdate",(function(){t._currentAudioEl===n&&t.opts.onProgressUpdate(t.getCurrentProgress(),t.getPlayedTime(),t.getCurrentTime())})),this.opts.onEnd&&addEvent(n,"ended",(function(){t._currentAudioEl===n&&n.src!==bn&&t.opts.onEnd()})),this.opts.onSeeked&&addEvent(n,"seeked",(function(){t._currentAudioEl===n&&t.opts.onSeeked()})),this.opts.onSeek&&addEvent(n,"seeking",(function(){t._currentAudioEl===n&&t.opts.onSeek()})),addEvent(n,"error",(function(){t._prefetchAudioEl===n?t._prefetchAudioEl=t._createAudioNode():t._currentAudioEl===n&&n.src!==bn&&t.opts.onFail&&t.opts.onFail()})),addEvent(n,"canplay",(function(){var e=domData(n,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),domData(n,"setUrlTime",0)),t._currentAudioEl===n&&t.opts.onCanPlay&&t.opts.onCanPlay(),domData(n,"canplay",!0)})),addEvent(n,"durationchange",(function(){t._currentAudioEl===n&&t._seekOnReady&&isFinite(n.duration)&&(t.seek(t._seekOnReady),t._seekOnReady=!1)})),n.crossOrigin="anonymous",e&&this._setAudioNodeUrl(n,e).then((function(){n.preload="auto",n.volume=t.hasOwnProperty("_volume")?t._volume:.4761515102104643,n.load()})),this._audioNodes.push(n),this._audioNodes.length>10&&this._audioNodes.splice(0,5),n},t.onReady=function(e){e()},t.prefetch=function(e){this._isHlsUrl(e)||(this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,bn),this._prefetchAudioEl=this._createAudioNode(e))},t.seek=function(e){var t=this._currentAudioEl;isFinite(t.duration)&&t.src&&t.src!==bn?t.currentTime=t.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t.setPlaybackRate=function(e){this._currentAudioEl.playbackRate=e},t.getCurrentProgress=function(){var e=this._currentAudioEl;return isNaN(e.duration)?0:Math.max(0,Math.min(1,e.currentTime/e.duration))},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.getDuration=function(){return this._currentAudioEl&&isFinite(this._currentAudioEl.duration)?this._currentAudioEl.duration:0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(e,t){var n,i=this;if(void 0===t&&(t=function(){}),!e)return t&&t(!1);var a=jn(e),o=this._currentAudioEl;if(o.src&&o.src!==bn&&(this._seekOnReady=!1),o.src===a||this._currentHls&&this._currentHls.url===a)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));this._prefetchAudioEl&&this._prefetchAudioEl.readyState>0&&(this._prefetchAudioEl.src===a?(this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,bn),this._prefetchAudioEl.readyState>=3&&setTimeout((function(){return i.opts.onCanPlay&&i.opts.onCanPlay()})),this._currentAudioEl=this._prefetchAudioEl,o=this._currentAudioEl,this._prefetchAudioEl=!1,t&&t(!0)):this._prefetchAudioEl.src&&(n=this._setAudioNodeUrl(o,a),this._setAudioNodeUrl(this._prefetchAudioEl,bn))),o.src!==a&&(n=this._setAudioNodeUrl(o,a).then((function(){o.load(),domData(i._currentAudioEl,"canplay",null),i._stopFrequencyAnalise()}))),n?n.then((function(){return t(!0)})).catch((function(){return t(!1)})):t(!0)},t.playAudioEl=function(e){return Tn(e).catch((function(e){switch(e.code){case e.NOT_SUPPORTED_ERR:case e.ABORT_ERR:break;default:throw e}}))},t.play=function(e){this._stopFrequencyAnalise(),this._prefetchAudioEl.src===jn(e)&&this._prefetchAudioEl.readyState>0&&(this._setAudioNodeUrl(this._currentAudioEl,bn),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var t=this._currentAudioEl;if(t.src){var n=this.playAudioEl(t);return this._startFrequencyAnalise(),n}return Promise.resolve()},t.preparePlay=function(){if(browser.safari){var e=this._currentAudioEl;return this.playAudioEl(e)}},t._startFrequencyAnalise=function(){var e=this;function t(e,t,n,i){return(n-t)*e/i+t}function n(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,o=null;this._freqUpdateInterval=setInterval((function(){var r;e._currentAudioEl.paused||!domData(e._currentAudioEl,"canplay")?r=[0,0,0,0]:(++i>3&&(i=0,a=o,o=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)],a||(a=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)])),r=[t(i,a[0],o[0],3),t(i,a[1],o[1],3),t(i,a[2],o[2],3),t(i,a[3],o[3],3)]),e.opts.onFrequency&&e.opts.onFrequency(r)}),50)},t._stopFrequencyAnalise=function(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])},t.pause=function(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()},t.stop=function(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t,n){var i=this;e=Math.max(0,Math.min(1,e));var a=this._currentAudioEl,o=0;if(t){var r=e-a.volume;o=r/(t/20||1)}else o=e<a.volume?-.06:.001;if(Math.abs(e-a.volume)<=.001)return this._setFadeVolumeInterval(),n&&n();var s=a.volume;this._setFadeVolumeInterval((function(){!t&&o>0&&(o*=1.35),s+=o;if(o<0?s<=e:s>=e)return i.setVolume(e),i._setFadeVolumeInterval(),n&&n();i.setVolume(s)}))},t.getErrorData=function(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentHls?1:0,url:this._currentHls?this._currentHls.url:this._currentAudioEl.currentSrc,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},e}();!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(Un||(Un={}));var $n=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var n,i,a=new Promise((function(e,t){n=e,i=t}));return this.tasks.push({name:e,fn:function(){return t().then(n).catch(i)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),a},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter((function(t){return t.name!==e}))},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then((function(){return t.fn()})).then((function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null})))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise((function(t){return e.impl.onReady(t)}))},e.prototype.delay=function(e){return this.newTask(Un.DELAY,(function(){return new Promise((function(t){return function(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}(t,e)}))}))},e.prototype.setUrl=function(e){var t=this;return this.newTask(Un.URL,(function(){return new Promise((function(n){return t.impl.setUrl(e,n)}))}))},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(Un.SEEK),this.newTask(Un.SEEK,(function(){return new Promise((function(n){t.seekImmediate(e),n()}))}))},e.prototype.pause=function(){var e=this;return this.newTask(Un.PAUSE,(function(){return new Promise((function(t){e.impl.pause(),t()}))}))},e.prototype.play=function(e){var t=this;return window.browser.safari&&this.impl.play(bn),this.newTask(Un.PLAY,(function(){return new Promise((function(n,i){t.impl.play(e).then(n).catch(i)}))}))},e.prototype.setVolume=function(e,t,n){var i=this;if(void 0===n&&(n=null),t){var a=e?Un.VOL_UP:Un.VOL_DOWN;return this.newTask(a,(function(){return new Promise((function(t){return i.impl.fadeVolume(e,n,(function(){return t()}))}))}))}return this.newTask(Un.VOL_SET,(function(){return new Promise((function(t){i.impl.setVolume(e),t()}))}))},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(Un.PLAYBACK_RATE,(function(){return new Promise((function(n){t.impl.setPlaybackRate(e),n()}))}))},e}();function Wn(e){return Object(i.geByClass)("audio_item_"+e)}function qn(e){return Wn(e)[0]}function zn(e){var t=qn(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=Object(i.gpeByClass)("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var a=n.dataset.playlistId;return a||(console.log("no playlist Id found"),null)}var Yn=n("iwo4"),Gn=window.audio||function(){var e={onpause:function(){Object(z.statlogsValueEvent)("mvk_audio_player_listening",h[m].id,Gn.getCurrentProgress()),b&&(b=!1,ssSet("audio_play","0"),clearTimeout(S));o.emit(wt.events.PAUSE,T())},onplay:function(){b||(b=!0,ssSet("audio_play","1"),clearTimeout(S),S=setTimeout(M,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void Gn.pause();o.emit(wt.events.PLAY,T())},onBufferUpdate:function(e){o.emit(wt.events.BUFFERED,T(),e,Gn.duration())},onEnd:function(){if(c>0)return;o.emit(wt.events.ENDED,T()),w?(w=!1,Gn.next()):y=!0},onProgressUpdate:function(e,t,i){if(Qn.isPlaying())return;if(!e&&i)try{e=i/Gn.duration()}catch(e){}o.emit(wt.events.PROGRESS,T(),e,Gn.duration(),t),e>.01&&(C=t);ssSet("audio_pos",e),!w&&n.getDuration()-n.getCurrentTime()<.5&&(w=!0);y&&(y=!1,Gn.next())}},t=!(browser.safari||browser.chrome&&browser.version<50),n=new Fn(e),a=new $n(n),o=new kn,r=Object(i.ssGet)("audio_vol"),s="number"==typeof r?r:.8,c=0,u=null,d={},_=new An,f=!1,p=srand(),h=[],m=null,v={},g="",A=null,b=!1,y=!1,w=!1,S=null,k=!1,O=!1,C=0;function j(e,t){if(void 0===t&&(t=!1),!Gn.support)return!1;var n;if(b&&Gn.pause(),o.emit(wt.events.DESELECT,E()),(n=Gn.canRepeat!==Yn.audioRepeat.ONE||t?m+e:m)>=h.length||n<0){if(Gn.canRepeat!==Yn.audioRepeat.ALL&&Gn.canRepeat!==Yn.audioRepeat.ONE)return!1;n=n>=h.length?0:Math.max(0,h.length-1)}Object(z.statlogsValueEvent)("mvk_audio_player_listening",h[m].id,Gn.getCurrentProgress());var i=h[n];Gn.play(i.fullId).then((function(t){t||j(e>0?e+1:e-1)})).catch((function(){}))}function E(){return h[m]||!1}function T(){return E().fullId||!1}function I(e){return function(e){return new Promise((function(t,n){u&&u(),u=n;var i=[];if(d=d||{},e)if(e.url)t(e);else{var a=v[e.fullId];if(a>=0)for(var o=a;o<a+3;o++){var r=h[o];r&&!r.url&&!d[r.fullId]&&r.urlHash&&(i.push(r.fullId+"_"+r.actionHash+"_"+r.urlHash),d[r.fullId]=!0)}ajax.post("/audio",{act:"reload_audio",ids:i.join(",")},{onDone:function(i){i?(i.forEach((function(n){var i=Vn(n),a=h[v[i.fullId]];a&&(a.url=i.url),Wn(i.fullId).forEach((function(e){try{var t=JSON.parse(e.dataset.audio);t[Ot]=i.url,e.dataset.audio=JSON.stringify(t)}catch(e){}})),i.fullId===e.fullId&&(e.url=i.url,t(e)),delete d[i.fullId]})),n()):n()},onFail:n})}else n()})).catch((function(){return d={}}))}(e).then((function(e){a.clearTask(Un.URL);var t=e.url;return a.setUrl(t).then((function(t){t?c=0:(a.clearAllTasks(),o.emit(wt.events.FAILED),b&&c<2&&(e.pause(),e.next(),c++))}))})).catch((function(){return Promise.reject()}))}function M(){if(b){var e=lsGet("audio_current_player");p!=e?Gn.pause():S=setTimeout(M,100)}}function P(e){ssSet("audio_query",e),k&&Object(_n.setCookie)(k+"q",encodeURIComponent(e),1)}return{support:!0,canRepeat:Yn.audioRepeat.ALL,shuffled:!1,onInit:Object(l.default)(),init:function(e){!O&&Gn.support&&(O=!0,e.cookie&&(k=e.cookie,e.cookie_path||"/"),onDOMReady((function(){!function(e){var t=Object(i.ssGet)("audio_id"),n=Object(i.ssGet)("audio_pos"),a=Object(_n.getCookie)(k+"_playlist");a&&Gn.setPlaylistId(a);var o=s;e.playlist&&e.playlist.length&&Gn.playlist((e.playlist||[]).map(Vn),{q:e.playlist_q||""}),t&&Gn.select(t).then((function(){n<1&&Gn.setPosition(n,!0),Gn.volume(o)})).catch((function(){}))}(e),Gn.onInit()})))},subscribe:function(e,t){return o.subscribe(e,t)},unsubscribe:function(e,t){return o.unsubscribe(e,t)},notify:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];o.emit.apply(o,[e].concat(n))},getCurrent:E,getCurrentId:T,operate:function(e){if(!Gn.support)return!1;!e||h[m]&&e===T()?b?Gn.pause():Gn.play():(Object(z.statlogsValueEvent)("mvk_audio_player_listening",E().id,Gn.getCurrentProgress()),Gn.play(e))},setPlaylistId:function(e){e!==A&&(A=e,o.emit(wt.events.PLAYLIST_CHANGED))},playing:function(){return b},select:function(e){if(!Gn.support)return Promise.reject();if(!e)return Promise.reject();h.length||o.emit(wt.events.EMPTY_PLAYLIST,e);var t=h[v[e]];return t?I(t).then((function(){T()&&o.emit(wt.events.DESELECT,E()),m=v[e],o.emit(wt.events.SELECT,h[m]);var t,n=zn(e);n&&A!==n&&Gn.setPlaylistId(n),t=T(),ssSet("audio_id",t),k&&(Object(_n.setCookie)(k,t,1),Object(_n.setCookie)(k+"_playlist",A,1))})):(o.emit(wt.events.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){Gn.play(e)},getCurrentPlaylistId:function(){return A},play:function(e){var i=this;if(Gn.support)return new Promise((function(r){var s=e===T();return b&&s?(Gn.pause(),r(!0)):Qn.isPlaying()?(e&&!s?(Gn.select(e),Qn.resume()):b?Qn.pause():Qn.resume(),r(!0)):(b=!0,!e||s?(i._play(),r(!0)):(n.setUrl(bn),void Gn.select(e).then((function(){if(o.emit(wt.events.PLAY_REQUESTED,e),!Object(ie.partConfigEnabled)("mvk_audio_ads")||!t)return i._play(),r(!0);a.clearAllTasks(),Qn.startPlay(h[v[e]],(function(){return i._play(),r(!0)}))})).catch((function(){return r(!1)}))))}))},_play:function(){var e=E();e&&(a.play(e.url).then((function(){ssSet("audio_play","1"),_.connect()})).catch((function(){b=!1,o.emit(wt.events.PAUSE)})),lsSet("audio_current_player",p))},clearCurrentPlaylist:function(){if(!Gn.support)return!1;b&&!Qn.isPlaying()&&Gn.pause(),E()&&o.emit(wt.events.DESELECT,E()),h=[],g="",m=null,Gn.setPlaylistId(null),v={},P(g)},pause:function(){if(!Gn.support)return!1;b&&(Qn.isPlaying()?Qn.pause():n.pause(),b=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=wn()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return Gn.isAdsPlaying()?Qn.getCurrentProgress()*Qn.getDuration():n.getCurrentTime()},getCurrentProgress:function(){return Gn.isAdsPlaying()?Qn.getCurrentProgress():n.getCurrentProgress()},setPosition:function(e,t){if(!Gn.support)return!1;var n=0;t?n=e:e&&Gn.duration()&&(n=e/Gn.duration()),a.seek(n).then((function(){ssSet("audio_pos",n),o.emit(wt.events.SEEK,T(),n,Gn.duration())}))},volume:function(e){if(!Gn.support)return!1;if(void 0===e)return s;var t=Math.min(1,Math.max(0,e));s=t,a.setVolume(s),ssSet("audio_vol",s),Qn.updateVolume(),o.emit(wt.events.VOLUME,T(),s)},loaded:function(){return n.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return Qn.getDuration();var e=n.getDuration(),t=h[m]&&h[m].duration;return e||t||0},played:function(){return n.getPlayedTime()},getListenedTime:function(){return C},next:function(e){return void 0===e&&(e=!1),j(1,e)},prev:function(e){return void 0===e&&(e=!1),j(-1,e)},shuffle:function(){var e=Gn.isPlaying()&&!Gn.isAdsPlaying(),t=Gn.getPosition(),n=Gn.getCurrentId();Gn.pause(),Gn.shuffled=!Gn.shuffled,Gn.shuffled?(h.forEach((function(e,t){return e.position=t})),h.sort((function(){return Math.random()-.5}))):h.sort((function(e,t){return e.position-t.position})),v=h.reduce((function(e,t,n){return e[t.fullId]=n,e}),{}),n&&(Gn.select(n),Gn.setPosition(t),e&&requestAnimationFrame((function(){return Gn.play()})))},repeat:function(){switch(Gn.canRepeat){case Yn.audioRepeat.NONE:Gn.canRepeat=Yn.audioRepeat.ALL;break;case Yn.audioRepeat.ALL:Gn.canRepeat=Yn.audioRepeat.ONE;break;case Yn.audioRepeat.ONE:Gn.canRepeat=Yn.audioRepeat.NONE;break;default:Gn.canRepeat=Yn.audioRepeat.NONE}},playlist:function(e,t){return!!Gn.support&&(void 0===e?h:(b&&!Qn.isPlaying()&&Gn.pause(),E()&&o.emit(wt.events.DESELECT,E()),h=e,g=t&&t.q||"",m=null,v={},each(e,(function(e,t){return v[t.fullId]=e})),void P(g)))},addToPlaylist:function(e,t){var n={},i=t||h.length;h.forEach((function(e){return n[e.fullId]=!0})),e.forEach((function(e){n[e.fullId]||(t?h.splice(i,0,e):h.push(e))}))},playlist_q:function(){return g},setIsPlaying:function(e){b=e},isAdsPlaying:function(){return Qn.isPlaying()},isPlaying:function(){return b},initSplash:function(){f||(window.audioRestrictionSplash=new ln,f=!0)},playNothing:function(){n.setUrl(bn,(function(){}))},events:wt.events}}();window.Artist=At,window.Curator=bt;var Qn=new en(new nn(Gn),null,!0);Gn.ads=Qn,window.audio=Gn,window.AudioBackgroundRestriction=fn,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",(function(){Object(ie.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new fn)})),document.addEventListener("DOMContentLoaded",(function(){"audio"===cur.module&&Gn.initSplash()})),window.page.onChange((function(){"audio"===cur.module?Gn.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()}));var Kn,Xn,Jn=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,(function(i,a){if(a.event===e&&a.listener===t)return n=i,!1})),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(wt.events.PLAY,e,t)},t.listenPause=function(e,t){this.listen(wt.events.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(wt.events.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(wt.events.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(wt.events.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(wt.events.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(wt.events.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(wt.events.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(wt.events.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}(),Zn=n("BJj/"),ei=n("Xrg9"),ti=((Kn={}).start=1,Kn.stop=2,Kn.volume=3,Kn.rewind=4,Kn.play_further=5,Kn.added=6,Kn.removed=7,Kn.recommendation_removed=8,Kn.show_album=9,Kn.share_audio=10,Kn.broadcast=11,Kn),ni=((Xn={}).default=1,Xn.next_track=2,Xn.prev_track=3,Xn.auto=4,Xn.interruption=5,Xn.pause=6,Xn.new=7,Xn.close_app=8,Xn.queue=9,Xn.pause=10,Xn.upload=11,Xn.on=12,Xn.off=13,Xn),ii=function(){function e(e){if(this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,vk.id)this.uniqueUserId=null;else{var t=ei.default.get("audio_unique_unauth_id");t?this.uniqueUserId=t:(this.uniqueUserId=wn()(),ei.default.set("audio_unique_unauth_id",this.uniqueUserId))}this.debug=e.isDebug(),this.onVolume=Object(Zn.debounce)(this.onVolume.bind(this),300),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return"auto";var e=this.playerAdapter.getSequence();if(e)return e>0?"next_track":"prev_track";var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?"pause":"new"},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.currentAudioId!==this.pausedAudioId,a=this.playerAdapter.getListenedTime();!n&&i&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,a=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=a,this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition,listened:a}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this,t=this.playerAdapter.getAudioId();if(this.canOperate()&&t){var n=this.collectListenedData();this.sendListenedDataDelayed(1e3,n),setTimeout((function(){if(!(e.currentAudio&&t!==e.currentAudio.fullId||vkNow()-e.playedTime<150)){e.pausedAudioId=t;var n=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:"stop",subtype:n?"queue"===n?"queue":"interruption":"pause"})}}),100)}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:"volume",subtype:"default"})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent(Object(E.default)({type:"rewind",subtype:"default"},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason="session_end"),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:"stop",subtype:"auto"}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],a=n[1];this.sendAudioEvent({type:"play_further",subtype:"default",ownerId:i,audioId:a})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n="new",i=this.playerAdapter.getSequence(),a=e.fullId.split("_"),o=a[0],r=a[1];this.playerAdapter.isAutoPlayed()?n="auto":i&&(n=i>0?"next_track":"prev_track"),this.sendCurrentAudioEvent({type:"stop",subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:o,audioId:r}),this.wasEnded=!0,this.collectListenedData(),this.collectListenedDataSwitch();var s=this.listenedData;this.listenedData=null,this.sendListenedData(s)}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:"stop",subtype:"close_app"}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if("session_end"===this.listenedData.end_stream_reason)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(){if(this.canOperate()&&this.currentAudio){var e=this.currentAudio.fullId,t=this.playerAdapter.getAudioTrackCode(),n=this.getListenedTime(),i=this.currentAudio.urlHash;if(i||console.log("no url hash"),n&&i){var a={audio_id:e,listened:n,context:this.playerAdapter.getContext(),hash:i};return window.cur&&vk.widget&&(a.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(a.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(a.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(a.shuffled=1)),t&&(a.track_code=t),this.playerAdapter.isRepeatCurrentAudio()?a.repeat="one":this.playerAdapter.isRepeatAll()&&(a.repeat="all"),this.playerAdapter.isAutoPlayed()&&(a.auto=1),this.playerAdapter.hasPrevAudio()&&(a.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(a.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(a.end_stream_reason="stop_btn"),a.state=document.hidden?"background":"app",this.listenedData=a,this.sendListenedDataDelayed(1e4,a),a}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&(this.uniqueUserId&&(t.unique_id=this.uniqueUserId),this.playerAdapter.sendListenedData(t))},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout((function(){return n.sendListenedData(t)}),e)},t.serializeEvent=function(e){var t=[ti[e.type],ni[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(""),e.targetOwnerId?t.push(e.targetOwnerId):t.push(0),this.uniqueUserId?t.push(this.uniqueUserId):t.push(""),e.positionTo?t.push(e.positionTo):t.push(null),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),z.statlogsValueEvent.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent(Object(E.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),{},this.getCurrentAudioParams(),{},e))},t.sendAudioEvent=function(e){var t=Object(E.default)({},e,{},this.getEnvParams());!vk.id&&this.uniqueUserId&&(t.uniqueUnauthId=this.uniqueUserId),this.sendEvent(t)},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}(),ai=n("dI71"),oi=function(e){function t(){return e.apply(this,arguments)||this}Object(ai.default)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?2:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return zn(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],a=t[2],o=t[3];return n&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+o:a:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);"other"===t&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context="other"},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?"search":"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?"group_list":"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?"search":0===e.indexOf("wall")?"group_list":0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":"other"},n.getContext=function(){return this.context||"other"},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,playlist_id:e.playlist_id,end_stream_reason:e.end_stream_reason,auto:e.auto,unique_user_id:e.unique_id})},t}(Jn),ri=n("jE6c");function si(e){var t="ai_controls";e.position&&(t+=" ai_has_position");var n=e.can_del?"true":"false",i="return window.audioplayer.morePopup(event, '"+e.audio_id+"', '"+e.access_key+"', "+n+");",a=e.is_authenticated?"audioplayer.setPosition(this, event);":null,o=e.is_authenticated?"audioplayer.sliderMove(event);":null,r=e.is_authenticated?"audioplayer.sliderUp(event);":null,s="aic_line";return e.is_authenticated||(s+=" aic_line_blocked"),{inner:[{inner:[li(e),e.has_actions_menu?{inner:[{class:"i_pointer",tag:"i"},{class:"ai_menu_toggle_button",onClick:i,"aria-label":Object(F.getLang)("mobile_more"),tag:"button"}],class:"ai_menu_wrap",tag:"div"}:null,{inner:[e.position?{inner:[e.position],class:"ai_position",tag:"div"}:null,e.duration?{inner:[e._duration_title],class:"ai_dur","data-dur":e.duration,onClick:"audioplayer.switchTimeFormat(this, event);",tag:"time"}:null,{inner:[{inner:[Wd.wrap(e.title),e.subtitle?{inner:[Wd.wrap(e.subtitle)],class:"ai_subtitle",tag:"span"}:null],class:"ai_title",tag:"span"},e.title?{inner:[Wd.wrap(" &ndash; ")],class:"divider",tag:"span"}:null,{inner:[Wd.wrap(e.artist)],class:"ai_artist",tag:"span"}],class:"ai_label",tag:"div"},{type:"hidden",value:e.url,tag:"input"}],class:"ai_body",tag:"div"}],class:"ai_info",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{class:"aic_ln aic_load_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:s,onTouchStart:e.is_mobile?a:null,onMouseDown:e.is_mobile?null:a,onTouchMove:e.is_mobile?o:null,onTouchEnd:e.is_mobile?r:null,onTouchCancel:e.is_mobile?r:null,onMouseMove:e.is_mobile?null:o,onMouseUp:e.is_mobile?null:r,onClick:"cancelEvent(event);",tag:"div"}],class:"aic_progress_wrap",tag:"td"},{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_line",onTouchStart:e.is_mobile?"audioplayer.setVolume(this, event);":null,onMouseDown:e.is_mobile?null:"audioplayer.setVolume(this, event);",onTouchMove:e.is_mobile?"audioplayer.sliderMove(event);":null,onTouchEnd:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onTouchCancel:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onMouseMove:e.is_mobile?null:"audioplayer.sliderMove(event);",onMouseUp:e.is_mobile?null:"audioplayer.sliderUp(event);",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_volume_wrap",tag:"td"}],tag:"tr"}],class:"row_table",tag:"table"}],class:t,tag:"div"}],tag:"div"}}function li(e){var t=e.is_playlist_forced?", true":"",n="audioplayer.playPause(event, '"+e.audio_id+"'"+t+");",i="",a=e.has_cover?Object(T.default)("audio","play_on_cover_24"):Object(T.default)("audio","play_24"),o=e.has_cover?Object(T.default)("audio","pause_on_cover_24"):Object(T.default)("audio","pause_24");return e.has_cover&&!e.cover_style&&(i={inner:[Object(T.default)("audio","song_outline_28")],class:"ai_cover_placeholder",tag:"span"}),{inner:[i,{inner:[a],class:"i_play",tag:"span"},{inner:[o],class:"i_pause",tag:"span"}],class:"ai_play",style:e.cover_style,onClick:n,tag:"button"}}var ci=function(e){var t=e.is_playlist_forced?", true":"",n=e.is_disabled?"":"audioplayer.playPause(event, '"+e.audio_id+"'"+t+")",i=e.classes||[],a={};a[e.audio_id]=!0;var o=[s.default.class("audio_item",a),e.is_no_progress&&"ai_noProgress",e.is_focus&&"ai_focus",e.is_explicit&&"audio_item_explicit",e.is_disabled&&"audio_item_disabled",(e.can_add||e.can_del)&&"ai_has_btn",!e.has_actions_menu&&"ai_no_menu",e.has_cover&&"ai_has_cover"];e.is_attachment&&o.push("ai_select");var r=Object(F.mergeArrays)(o,i).filter((function(e){return e})).join(" ");return e.is_attachment?{inner:[si(e)],"data-id":e.audio_id,class:r,"data-audio":e.serialized,href:e.attachment_action,tag:"a"}:{inner:[si(e)],"data-id":e.audio_id,"data-playlist-id":e.playlist_id,class:r,onClick:n,"data-audio":e.serialized,tag:"div"}},ui=window.audio,di=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},i=!1,a=!1,r=!1,s=[],u=null;function d(e){if(e){$$("#lm_player").forEach((function(e){show(e)})),$$("#lm_audio").forEach((function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),ui.isAdsPlaying()&&U(e,!0)}));var t=Wn(e.fullId);t&&each(t,(function(t,n){ui.isAdsPlaying()?(V(e,!0),addClass("ai_playing",n)):(O(n,0),j(n,0),k(n,P(0,ui.duration()))),T(n,ui.volume()),addClass("ai_current",n)}))}else $$("#lm_player").forEach((function(e){hide(e)}))}function _(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}));var a=Wn(t);a&&(each(a,(function(e,t){k(t,I(i)),removeClass("ai_playing",t),removeClass("ai_current",t)})),n[t]&&delete n[t],ui.isAdsPlaying()&&V(e,!1))}function f(e,t,i,a){var o=Wn(e);if(o.length){var r=t*(i||0);each(o,(function(e,n){m||j(n,t),k(n,di.getFormatedTime(r,i))})),r>1&&(n[e]=1)}}function p(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(n){if(n){var i=n.map((function(e){return Vn(e)}));ui.playlist(i),ui.setPlaylistId(e),t&&t(i)}}})}function h(e,t){void 0===t&&(t=!1);var n=qn(e),i=gpeByClass("audios_list",n)||gpeByClass("AudioBlock",n),a=geByClass("audio_item",i),o=[],r=!1;each(a,(function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var a=Vn(i);o.push(a),a.fullId===e&&(r=!0)}})),ui.playlist(o,{q:attr(i,"data-query")}),t&&r&&r&&ui.play(e)}onDOMReady((function(){window.playerAdapter=new oi(ui);new ii(window.playerAdapter)})),ui.subscribe(wt.events.PLAY,(function(e){var t=ui.getCurrent();t&&ui.playing()&&!ui.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:ui.getDeviceId()});e,$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}));var n=Wn(e);if(!n)return;each(n,(function(e,t){addClass("ai_playing",t),addClass("ai_current",t)})),s[s.length-1]!==e&&s.push(e);r?r=!1:(a=i,i=!1,di.onPlay(e));D()})),ui.subscribe(wt.events.PLAY_REQUESTED,(function(e){H(e)})),ui.subscribe(wt.events.PAUSE,(function(e){$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)})),D();var t=Wn(e);if(!t.length)return;each(t,(function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)})),r||(di.onPause(e),D())})),ui.subscribe(wt.events.SELECT,d),ui.subscribe(wt.events.DESELECT,_),ui.subscribe(wt.events.PROGRESS,f),ui.subscribe(wt.events.SEEK,f),ui.subscribe(wt.events.BUFFERED,(function(e,t,n){H(e,t,n)})),ui.subscribe(wt.events.AD_STARTED,(function(e){V(e,!0),U(e,!0)})),ui.subscribe(wt.events.AD_COMPLETED,(function(e){V(e,!1),U(e,!1),f(e.id,0,0)})),ui.subscribe(wt.events.NOT_FOUND_PLAYLIST,h),ui.subscribe(wt.events.EMPTY_PLAYLIST,h),ui.subscribe(wt.events.ENDED,(function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,(function(e,t){j(t,1)})),i=!0,di.onEnded(e))})),ui.subscribe(wt.events.VOLUME,(function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,(function(e,n){T(n,t)})),di.onVolume(e,t))}));var m=null,v=null,g=!1,A=!1,b=!1;function y(e){if(m){b||(addEvent(document,C.isTouch?"touchmove":"mousemove",y),addEvent(document,C.isTouch?"touchend touchcancel":"mouseup",w),b=!0);var t=gpeByClass("audio_item",m),n=S(m,e);e&&cancelEvent(e);var i=Wn(attr(t,"data-id"));each(i,(function(e,t){g&&j(t,n),A&&(T(t,n),ui.volume(n))})),v=n}}function w(e){if(m){b=!1,removeEvent(document,C.isTouch?"touchmove":"mousemove",y),removeEvent(document,C.isTouch?"touchend touchcancel":"mouseup",w);var t=gpeByClass("audio_item",m),n=S(m,e)||v;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,(function(e,i){g&&(j(i,n),ui.setPosition(n,!0)),A&&T(t,n)})),g&&(r=ui.playing(),di.onSeek(n)),m=v=null,g=A=!1}}function S(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,a=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,o=e.offsetWidth-i;return o?Math.max(0,Math.min(a/o,1)):0}function k(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function O(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function j(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function T(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function I(e){var t,n,i,a=e<0;return t=(n=(e=Math.round(a?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),a&&(t="-"+t),t}function P(e,n){return I(t&&n?e-n:e)}function x(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function L(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function B(e,t,n){void 0===n&&(n=null),t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),o=geByClass1("ai_add",a);val(o,t?lang.global_delete_audio:lang.global_add_to_audio),$[e]=t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function R(e,t,n){void 0===n&&(n=null),t?x(e):L(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),o=geByClass1("ai_del",a);val(o,t?lang.global_add_to_audio:lang.global_delete_audio),$[e]=!t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function D(){var e=window.audio.getCurrentId(),t=Wn(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach((function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)})),each(geByClass("_AudioPlayStatus"),(function(e,t){var n=i&&t.dataset.playlistId===ui.getCurrentPlaylistId();toggleClass(t,"playing",n)}))}function N(e,t,n){if(window.isArticleWebView)return Article.audioPlay(ui.getCurrentId(),ui.playlist()),cancelEvent(e),!1;var i=window.lang;if(ui.support){var a=qn(t);if(a&&hasClass("ai_deleted",a)&&!hasClass("ai_current",a))return!0;n&&t!==ui.getCurrentId()||zn(t)!==ui.getCurrentPlaylistId()?h(t,!0):ui.operate(t)}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function H(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=Wn(e);ui.playing()?(each(i,(function(e,t){addClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}))):(each(i,(function(e,t){removeClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}))),null!==t&&null!==n&&each(i,(function(e,i){O(i,t/n),addClass("ai_current",i)}))}function V(e,t){var n=qn(e.fullId);toggleClass("ad_mode",n,t);var i=geByClass1("ai_title",n);val(i,t?Object(F.getLang)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t)}function U(e,t){geBySel(".audio_item.al_player").forEach((function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?Object(F.getLang)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t),toggleClass("ad_mode",n,t),toggle(geByClass1("ai_artist"),!t)}}))}var $={},W={};return page.onChange((function(){$={},W={}})),{init:function(t){e||(e=!0,onDOMReady((function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&ui.playlist().length&&di.openPlayer(geByClass1("AudioPlayerMini"),!0)})))},initAudio:function(){each(geByClass("ai_current"),(function(e,t){_(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return Vn(t)}(t))}));var e=ui.loaded(),t=ui.getPosition(),n=ui.duration(),i=n?t/n:0;H(ui.getCurrentId(),e,n),d(ui.getCurrent()),f(ui.getCurrentId(),i,n),setTimeout((function(){D()}),1)},getDOMFromAudio:function(e,t,n,i){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var a=Vn(e);if(!a)return"";var o=Object(ri.htsc)(a.ownerId+"_"+a.id),r=a.coverUrl_p||a.coverUrl_s,s=e,l=[];if(function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(o)){if(n)return"";l.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(o)&&l.push("ai_added"),o===ui.getCurrentId()&&(ui.playing()&&l.push("ai_playing"),l.push("ai_current"));var u=!!vk.id&&(!a.isClaimed||a.canDelete);vk.id||l.push("ai_no_menu");var d=new ci({is_playlist_forced:t,is_disabled:a.isClaimed,audio_id:o,is_authenticated:!!vk.id,login_redirect_url:"",is_explicit:a.isExplicit,can_add:a.canAdd,can_del:a.canDelete,serialized:JSON.stringify(s),classes:l,has_cover:i,cover_style:r?"background-image: url("+r+")":"",has_actions_menu:u,position:a.chartInfo?a.chartInfo.position:"",duration:a.duration,is_mobile:C.isTouch,_duration_title:I(a.duration),title:a.title,subtitle:a.subtitle,artist:a.performer,url:a.url});return c.default.html(d)},morePopup:function(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),null===t){var a=ui.getCurrent()||{};t=a.fullId,n=a.accessKey,i=a.canDelete,W[t]=a}var o="";o=void 0!==$[t]?$[t]?Object(F.getLang)("global_delete_audio"):Object(F.getLang)("global_add_to_audio"):i?Object(F.getLang)("global_delete_audio"):Object(F.getLang)("global_add_to_audio"),K.default.open(c.default.elem(Object(K.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[{tag:"ul",class:"ContextMenu__list",inner:[!i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:o,onclick:"return audioplayer.add('"+t+"', '"+n+"', event, this);"}]},i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:o,onclick:"return audioplayer.del('"+t+"', event, this);"}]}]}]})),!0),e&&cancelEvent(e)},add:function(e,t,n,i){void 0===t&&(t=null),void 0===i&&(i=null);var a=qn(e);if(!hasClass("ai_ajax",a)){var o=a?Vn(JSON.parse(a.dataset.audio)):W[e]||{};W[e]||(W[e]=Object(E.default)({},o));var r=!1;a?(r=hasClass("ai_added",a),W[e].deleteid=attr(a,"data-deleteid"),W[e].deleteHash=attr(a,"data-delete-hash")):void 0!==$[e]&&(r=$[e]),o.deleteid=o.deleteid||W[e].deleteid,o.deleteHash=o.deleteHash||W[e].deleteHash,o.restoreHash=o.restoreHash||W[e].restoreHash,B(e,!r,i),addClass("ai_ajax",a),di.onAdd(),i&&(i.disabled=!0),ajax.post("/audio",{_ajax:1,act:r?"delete":"add",audio:r?o.deleteid:o.fullId,hash:r?o.deleteHash:o.addHash,access_key:t,track_code:o.trackCode,source_playlist_id:zn(o.fullId)},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",a),t?(W[e].deleteid=t,W[e].deleteHash=n,attr(a,"data-deleteid",t),attr(a,"data-delete-hash",n)):B(e,r,i),i&&(i.disabled=!1)},onFail:function(){removeClass("ai_ajax",a),B(e,r,i);var n=Array.prototype.slice.call(arguments),s=n.shift();switch(s){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(r?o.deleteHash:o.addHash)+"&access_key="+t)}i&&(i.disabled=!1)}}),n&&cancelEvent(n)}},del:function(e,t,n){void 0===n&&(n=null);var i=qn(e),a=!1;i?a=hasClass("ai_deleted",i):void 0!==$[e]&&(a=!$[e]),R(e,!a,n);var o=i?Vn(JSON.parse(i.dataset.audio)):W[e]||{};W[e]||(W[e]=Object(E.default)({},o)),a?L(e):x(e),di.onDel(),n&&(n.disabled=!0),o.deleteid=o.deleteid||W[e].deleteid,o.deleteHash=o.deleteHash||W[e].deleteHash,o.restoreHash=o.restoreHash||W[e].restoreHash,ajax.post("/audio",{_ajax:1,act:a?"restore":"delete",audio:e,playlist_id:zn(e),hash:a?o.restoreHash:o.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||R(e,a,n),n&&(n.disabled=!1)},onFail:function(){R(e,a,n);var t=Array.prototype.slice.call(arguments),i=t.shift();switch(i){case 2:nav.go("/audio?act="+(a?"restore":"delete")+"&audio="+e+"&hash="+(a?o.restoreHash:o.deleteHash))}n&&(n.disabled=!1)}}),t&&cancelEvent(t)},playPause:N,getFormatedTime:P,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),k(qn(ui.getCurrentId()),P(ui.getPosition(),ui.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){m||ui.isAdsPlaying()||(m=e,g=!0,y(t))},setVolume:function(e,t){m||(m=e,A=!0,y(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,a=n.getCurrentPlaylistId(),o=nav.params;a&&!o.includes("playlist_id")&&(o=(o?o+"&":"")+"playlist_id="+a);var r=i+(o?"?":"")+o+"#player";return nav.al_go(r,null,{local:!0,target:e,nav:{push:r,path:i,params:o,hash:"#player"},no_push:t})},getCurrentElem:function(){return Object(M.$)(".ai_current")},playFirst:function(e,t){e&&cancelEvent(e);var n=ui.getCurrent(),i=gpeByClass("_audioPlaylist",t),a=n?n.fullId:null;if(!a||!geByClass1("ai_current",i)){var o=(i||ge("mcont")).$(".audio_item");a=o&&o.getAttribute("data-id")}a&&N(e,a)},hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return s},isAutoPlayed:function(){return a},playBlock:function(e,t,n){ui.getCurrentPlaylistId()!==e?p(e,(function(t){if(t.length){var i=t[0].fullId;ui.select(i).then((function(){ui.play(i),n.classList.add("playing"),n.dataset.playlistId=e}))}})):ui.operate()},playShuffledBlock:function(e,t){e.preventDefault(),p(t.dataset.blockId,(function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}}))},openModal:function(e,t){var n=t.parentElement.querySelector(".Popup");return K.default.open(n,!0),u=Object(o.expandPopup)(t),cancelEvent(e),!1},closeModal:function(e){K.default.close(e),u&&u()},onAdd:Object(l.default)(),onDel:Object(l.default)(),onPlay:Object(l.default)(),onPause:Object(l.default)(),onProgress:Object(l.default)(),onVolume:Object(l.default)(),onSeek:Object(l.default)(),onPlaylistChanged:Object(l.default)(),onEnded:Object(l.default)(),sliderMove:y,sliderUp:w}}();window.audioplayer=di,window.Section=he;var _i=function(e){var t=e.y<.5,n=100*e.x,i=100*e.y;return{class:"Photo__marketTag",attrs:{"data-url":e.url,style:"left: "+n+"%; top: "+i+"%"},inner:[{class:"Photo__marketTagInner "+(t?"Photo__marketTagInner--down":""),inner:[{class:"Photo__marketTagTitle",inner:e.title},{class:"Photo__marketTagPrice",inner:Wd.wrap(e.price)},{class:"Photo__marketTagIcon",inner:Object(T.default)("market","goto_arrow_black")}]},{class:"Photo__marketTagArrow "+(t?"Photo__marketTagArrow--down":"")}]}};var fi=function(e){return{class:"Photo__marketShowMoreButton",attrs:{"data-items-json":e.items},inner:[{class:"Photo__marketShowMoreButtonIcon",inner:Object(T.default)("market","market_16")},getLang("mobile_photos_show_market_items")]}};var pi=function(e){return{tag:"a",attrs:{"data-is-fave":e.isFave?"fave":""},class:"PhotoMarketItem__fave "+(e.isFave?"PhotoMarketItem__fave--added":""),onclick:["ItemsList._toggleFave","event","this",e.type,e.typeInt,e.ownerId,e.itemId,e.href,e.faveHash]}};var hi=function(e){return{class:"PhotoMarketItem",attrs:{"data-item-id":e.item_id},inner:[{class:"PhotoMarketItem__thumb",tag:"img",src:e.thumb},{class:"PhotoMarketItem__title",inner:e.title},{class:"PhotoMarketItem__price",inner:Wd.wrap(e.price)},pi({type:e.type,typeInt:e.type_int,isFave:e.is_fave,itemId:e.item_id,ownerId:e.owner_id,href:e.href,faveHash:e.fave_hash})]}};function mi(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return vi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vi(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var gi=function e(t){for(var n,i=[],a=mi(JSON.parse(unescape(t.itemsJSON)));!(n=a()).done;){var o=n.value,r=e._faveCache[o.item_id];void 0===r&&(r=o.is_fave),i.push({onclick:["ItemsList._goToItem",o],class:"PhotoItemsList__item",inner:hi(Object.assign({},o,{is_fave:r}))})}for(var s=0;s<10;s++)i.push({class:"PhotoItemsList__item PhotoItemsList__item--filler"});return{class:"PhotoItemsList",inner:[{class:"PhotoItemsList__header",inner:[{class:"PhotoItemsList__closeIcon",onclick:t.onClose},getLang("mobile_photos_market_items_title")]},{class:"PhotoItemsList__body",inner:i}]}};gi._faveCache={},gi._onClose=function(){gi._itemsPopup&&(cn.default.close(gi._itemsPopup),delete gi._itemsPopup)},gi._goToItem=function(e){-1===cur.destroy.indexOf(gi._onClose)&&cur.destroy.push(gi._onClose),nav.go(e.url)},gi._toggleFave=function(e,t,n,i,a,o,r,s){e.stopPropagation();var l=t.dataset.isFave;ajax.post("/bookmarks.php",{_ajax:1,item_type:i,act:l?"bookmark_remove":"bookmark_add",hash:s,item_oid:a,item_id:o,link_url:r},{onDone:function(e){e&&(gi._faveCache[o]=!l,Object(M.$)(".PhotoItemsList").$$(".PhotoMarketItem").forEach((function(e){e.dataset.itemId===o.toString()&&(e.$(".PhotoMarketItem__fave").outerHTML=Wd.html(pi({type:n,typeInt:i,isFave:!l,ownerId:a,itemId:o,href:r,faveHash:s})))})))}})},gi._openItemsPopup=function(e){var t=Object(K.default)({class:"Photo__marketItemsModal",body:gi({itemsJSON:e,onClose:["ItemsList._onClose"]})});gi._itemsPopup=cn.default.open(Wd.elem(t),!0)},window.ItemsList=gi;var Ai=gi,bi=n("29dZ"),yi=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,wi=!yi&&!!r.default.getFlag(r.FLAG_MP4);onDOMReady((function(){ki.onUpdate(),page.onChange((function(){ki.onUpdate()}))}));var Si={gifs:[],currentAutoplayElement:null,ignore:[]},ki={isBadBrowser:yi,isMp4Supports:function(){return wi},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var a=function(e){return Object(i.ceFromString)(c.default.html(Object(an.default)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[Object(bi.default)({onClick:'Gif.confirm(this, "'+e.raw+'")',use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:c.default.wrap(getLang("mobile_continue"))}),Object(bi.default)({onClick:"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"secondary",inner:c.default.wrap(getLang("mobile_cancel"))})]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(a,t),void an.default.open(a,!0)}var o=Object(E.default)({},nav.getQuery(),{z:"doc"+n.raw+"/"+(n.hash||"")});nav.path,Object(i.obj2qs)(o),nav.hash;photo.zopen(null,null,n.raw,"",{no_push:!1,isDoc:!0,hasVideo:n.hasVideo,hash:n.hash})},init:function(e){zlayer.create(Oi()),zlayer.open()},close:function(){var e=Object(E.default)({},nav.getQuery());delete e.z;var t=nav.path+Object(i.obj2qs)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,an.default.close(e),Object(i.geBySel1)('[data-media="'+t+'"]').click()},autoplayTest:function(){r.default.detectAutoplay().then((function(e){wi=r.default.getFeatures().mp4&&e&&r.default.getFlag(r.FLAG_MP4)&&!yi}))},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from(Si.gifs||[]).forEach((function(a){var o=getXY(a)[1],r=o>=e&&o<=t,s=Math.abs(n-o);r&&(i[s]=a)}));var a=i[Math.min.apply(Math,Object.keys(i))];a?a.classList.contains("current_gif")||-1===Si.ignore.indexOf(a)&&(post.toggleGif(a,!1,!1,!0),Si.currentAutoplayElement=a):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){r.default.getFlag(r.FLAG_GIF_AUTOPLAY)&&(Si.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll(Object(i.throttle)(ki.activateGIF,200)))},getState:function(){return Si},setState:function(e,t){Si[e]=t}};function Oi(e){void 0===e&&(e=!1);var t='<img class="zpv_img" alt="">';return e&&(t='<video class="zpv_img" alt="" autoplay preload="metadata" crossorigin="anonymous" poster="/images/blank.gif" webkit-playsinline playsinline controls loop muted>'),'\n    <div id="z_photoview">\n      <div class="zpv_siblings">\n        <div id="zpv_left" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n        <div id="zpv_right" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n      </div>\n      <div class="zpv_body">\n        <div id="zpv_center" class="zpv_thumb_item">\n          '+t+'\n        </div>\n      </div>\n      <div class="zpv_close_msg_wrap">\n        <div class="zpv_close_msg"> '+lang.mobile_zphoto_move_to_close+'</div>\n      </div>\n      <div class="zpv_controls">\n        <div class="mhead zpv_header">\n          <a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a>\n          <div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div>\n        </div>\n      </div>\n      <div class="zpv_tags"></div>\n      <div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div>\n    </div>\'\n  '}window.Gif=ki;function Ci(e){return void 0===e&&(e={}),Object(cn.default)({on_overlay_click_native:"QRPhotoPosting.back();",class:"QRPhotoPosting",content:[{class:"QRPhotoPosting__img",inner:Wd.wrap(e.svg)},{class:"QRPhotoPosting__title",inner:Wd.wrap(e.title)}]})}function ji(){return{inner:[Object(T.default)({sprite:"common",name:"qr_24"})],class:"QRPhotoPosting__button",onclick:"QRPhotoPosting.show();",tag:"div"}}var Ei,Ti=n("wZQE"),Ii=n.n(Ti);function Mi(e){var t=/photo(-?\d+)_(\d+)/i.exec(e||nav.cur);return Object(F.isArray)(t)||(t=["",0,0]),{album:Object(i.intval)(t[1]),photo:Object(i.intval)(t[2])}}function Pi(e){return-86529522===Mi(e).album&&Object(ie.partConfigEnabled)("mvk_photo_fest_qr_sharing")?ji():""}function xi(e){var t=Object(M.$)("#z_photoview .zpv_values"),n=c.default.elem(Pi(e));Object(i.append)(n,t)}window.QRPhotoPosting=Ci,Object(i.extend)(Ci,{show:function(){var e=Mi(),t="https://vk.com/fest?publish_photo="+e.photo,n=Ii.a.createQR(t,271,"QRPhotoPosting__svg",{isShowLogo:!0});Ei=cn.default.open(c.default.elem(Ci({svg:n,title:window.lang.mobile_photo_qr_popup_title})),!0),nav.go(nav.path+"?z=publish_photo"+e.photo,null,{push_only:!0,nav_init:!1,nav_incr:!0})},close:function(){Ei&&cn.default.close(Ei)},back:function(){window.history?window.history.back():window.location="/"},getQRPhotoButton:Pi,QRPhotoPosting:Ci,QRPhotoPostingButton:ji,appendQRPhotoButton:xi});var Li=n("he4e"),Bi=window.ajax,Ri=window.thover,Di=window.nav,Ni=(window.page,window.PhotoLike),Hi=window.zlayer,Vi=window.photo,Ui=function(){var e=!1,t=!1,n=!1,i=!1,a=!1,o=!1,r=!1,s=!1,u=!1,d=!1,_=!1,f=!1,p=!1,h=!1,m=!1,v=!1,g=!1,A=!1,b=!1,y=!1,w=!1,S=!1,k=!1,O=!0,C=!1,j={},T=1,I=3,M=1.5,P=20,x=250,L=0;function B(e){var t=getCw()/2,n=getCh()/2;if(e.touches){for(var i=0,a=0,o=0,r=Math.min(2,e.touches.length);i<r;i++)a+=e.touches[i].pageX,o+=e.touches[i].pageY;return r?{pageX:a/r-t,pageY:o/r-n}:{pageX:-t,pageY:-n}}return{pageX:e.pageX-t,pageY:e.pageY-n}}function R(e,t){var n=null,i=(domData(e,"fake-size")+"").split(",");if(i[0]>0&&i[1]>0)return{width:i[0],height:i[1]};var a=t?attr(_,"data-original-src")||_.src:e.src;if(j[a])return j[a];if(t&&(e=function(){var e=ce("img");return e.src=attr(_,"data-original-src")||_.src,e}()),void 0!==e.naturalWidth)n={width:e.naturalWidth,height:e.naturalHeight};else if("VIDEO"===e.tagName)n={width:e.clientWidth,height:e.clientHeight};else{(new Image).src=e.src,n={width:e.width,height:e.height}}return n.width&&n.height&&(j[a]=n),n}function D(e){var t=attr(e,"data-id");return N((tn(Qt).tags||{})[t]||[])}function N(e){return e[0]?{coords:{x:e[0][0],y:e[0][1],w:e[0][2],h:e[0][3]},name:e[1],href:e[2],al:e[3]}:{}}function H(e){setStyle(t,"overflow",e?"visible":"hidden")}var V=null,U=null;function F(e,n,i,o,r,s,l,c,u){if(!L||u){var d=!1,f=!!c&&function(){d||(d=!0,c())};s?(t&&setStyle.animate(t,"transform",{duration:s,func:l},f),_&&setStyle.animate(_,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),h&&setStyle.animate(h,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),m&&setStyle.animate(m,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),v&&setStyle.animate(v,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),a&&setStyle.animate(a,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),De=!0):De&&(t&&setStyle.animate(t),_&&setStyle.animate(_),h&&setStyle.animate(h),m&&setStyle.animate(m),v&&setStyle.animate(v),a&&setStyle.animate(a),De=!1),setStyle.transform(t,{translate:[n,0]}),setStyle.transform(_,e,[i,o]),Bt(e,i,o),!1!==r&&(setStyle(_,"opacity",r),be||ye?(setStyle(h,"opacity",r),we=!0):(setStyle(m,"opacity",r),Oe=!0),setStyle(v,"opacity",r),function(e,t){var n=window.lang;if(e){var i=Hi.height,o=i/5,r=i/3.5,s=Math.abs(e),l=s>20?e+(e>0?20-e:-20-e)/M:e,c=0===t?0:Math.max(0,Math.min((s-20)/o,.75));t>0&&setStyle.transform(a,{translate:[0,l]}),setStyle(a,"opacity",c);var u=s>r,d=u?"":e>0?" zpv_close_move_down":" zpv_close_move_up",_=u?n.mobile_zphoto_release_to_close:n.mobile_zphoto_move_to_close;val(a,'<div class="zpv_close_msg'+d+'">'+_+"</div>"),(a.is_down&&e<0||!a.is_down&&e>0)&&Mt(e>0)}else setStyle.transform(a,{translate:[0,0]}),setStyle(a,"opacity",0)}(o,r)),It(e)}else V=[e,n,i,o,r,s,l,c,!0],U||$()}function $(){V&&(F.apply(window,V),V=null),clearTimeout(U),U=L?setTimeout($,1e3/L):null}function W(e,t,n){ft(!0),F(re,ee,ae,oe,Ne,e,t,n),Ne=!1}function q(e,t,n,i){F(e.currentScale,e.curBodyX,e.currentX,e.currentY,!1,t,n,i)}function z(e){e=function(e){if(!e)return e;var t={width:_.width||_.clientWidth,height:_.height||_.clientHeight},n=t.width/2,i=t.height/2;return[e[0]+n,e[1]+i]}(e||[0,0]),setStyle.transformOrigin(_,e)}function Y(){(C=Xt.max_src&&re>2)?_.src!==Xt.max_src&&(attr(_,"data-original-src",Xt.src),attr(_,"data-src",Xt.max_src),an(Xt.max_src)):C||_.src===Xt.src||!_||S||k||(attr(_,"data-src",Xt.src),on(Xt.src),_.style.width="")}var G,Q,K,X,J,Z,ee,te,ne,ie,ae,oe,re,se,le,ue,de,_e,fe,pe,he,me,ve,Ae,be,ye,we,Se,ke,Oe,Ce,je,Ee,Te,Ie,Me,Pe,xe,Le,Be,Re,De,Ne,He=!1,Ve=!1,Ue=null;function Fe(e){var t=e[1].pageX-e[0].pageX,n=e[1].pageY-e[0].pageY;return{distance:Math.sqrt(t*t+n*n),angle:180*Math.atan2(n,t)/Math.PI}}function $e(e){var t=Fe(e);if(He){var n=t.distance/He.scale,i=t.angle-He.rotation;i<-180&&(i+=360),i>180&&(i-=360),extend(He,{startDistance:n,startAngle:i})}else He={startDistance:t.distance,startAngle:t.angle,scale:1,rotation:0}}function We(e){return extend({originalEvent:e},e,function(e){if(!He)return{scale:1,rotation:0};if(e.length<2)return{scale:He.scale,rotation:He.rotation};var t=Fe(e),n=t.distance/He.startDistance,i=t.angle-He.startAngle;i<-90&&(i+=360),i>270&&(i-=360);var a={scale:n,rotation:i};return extend(He,a),a}(e.touches),B(e))}function qe(e){var t=e.touches;t&&(t.length>5||t.length<2?He&&(Tt(We(e)),He=!1):(He||jt(We(e)),$e(t)))}function ze(e){var t=e.touches;t&&(t.length>5||t.length<2?He&&(Tt(We(e)),He=!1):He&&Et(We(e)))}function Ye(e){var t=e.touches;t&&((t.length>5||t.length<2)&&He&&(Tt(We(e)),He=!1),He&&$e(t))}function Ge(e){preventEvent(e);var t=(e.detail?e.detail:e.wheelDelta)>0?1.05:.95,n=extend({originalEvent:e},e);Ve||(Ve=1,kt(e),jt(extend(n,{scale:Ve}))),Ve*=t,Et(extend(n,{scale:Ve})),clearTimeout(Ue),Ue=setTimeout((function(){Tt(extend(n,{scale:Ve})),Ct(e),Ve=!1}),200)}function Qe(){G=0,Q=0,K=0,X=0,J=1,Z=!0,ee=0,te=0,ne=0,ie=1,ae=0,oe=0,re=1,se=!1,le=!1,ue=!1,de=!1,_e=!1,fe=!1,pe=!1,he=!1,me=!1,we=!1,Se=!1,ke=!1,Oe=!1,Ce=!1,je=!1,Ee=!1,!1,xe=!1,Le=!1,Be=!1,Re=!1}function Ke(){return{lastScale:J,deltaX:G,deltaY:Q,pointX:K,pointY:X,curScale:ie,currentScale:re,curX:te,curY:ne,currentX:ae,currentY:oe,curBodyX:ee}}function Xe(e,t,n){n=n||Ke(),e=e||{};var i=extend({},n,e);if(isUndefined(e.deltaX)||isUndefined(e.deltaY)?isUndefined(e.pointX)||isUndefined(e.pointY)?isUndefined(e.lastScale)?isUndefined(e.currentScale)?isUndefined(e.curScale)||(i.currentScale=i.lastScale*i.curScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=i.currentScale/i.lastScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=1,i.currentScale=i.curScale*i.lastScale):(i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.pointX=i.curX+i.deltaX*i.curScale,i.pointY=i.curY+i.deltaY*i.curScale),isUndefined(e.curX)||(i.curX=e.curX,i.currentX=i.curX/i.currentScale),isUndefined(e.curY)||(i.curY=e.curY,i.currentY=i.curY/i.currentScale),t)return i;G=i.deltaX,Q=i.deltaY,K=i.pointX,X=i.pointY,J=i.lastScale,ie=i.curScale,re=i.currentScale,te=i.curX,ne=i.curY,ae=i.currentX,oe=i.currentY,ee=i.curBodyX}function Je(){var e=Hi.width||getCw(),t=Hi.height||getCh();if(k)var n=e,i=Math.min(x,n-2*P),a=i,o=i;else a=e,o=t;return{width:a,height:o}}function Ze(e){var t=Je().width,n=((_.width||_.clientWidth)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function et(e){var t=Je().height,n=((_.height||_.clientHeight)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function tt(){var e=1,t=I;if(k){e=1,t=(Yt?Yt[0]:{max_scale:I}).max_scale}else{var n=R(_,!0);e=T,t=Math.max(I,n.width/getCw(),(n.height||n.clientHeight)/getCh())}return Xt.restriction&&(e=1,t=1),{min:e,max:t}}function nt(e){var t=Hi.height||getCh(),i=Math.abs(Kt)>=10,a=Math.abs(e)>1,o=t/3.5,r=Math.abs(ne);return ne*e<0&&(i=!0),e=e||0,r>o||!i&&a?(function(e){var t=Hi.height||getCh(),i=2*Math.abs(oe)>t?.85:1.7;Xe({curY:(e>1?t:e<-1?-t:ne>0?t:-t)/i}),Ne=0,W(150,"ease-in",at),setStyle(n,"width",0),Me=!0}(e),!0):(wt()&&(Ne=1,W(300),de=!1,ye&&(ye=!1,Dt(!0))),!1)}function at(){y&&Ui.close()}function ot(){!1!==Te&&(H(!1),cn(Te),setStyle.transform(f),setStyle.transform(p),F(1,0,0,0,1),z(),Te=!1)}function rt(){var e=1.05*(Hi.width||getCw());ae-=(e+ee)/re,ee=-e,Te=Qt+1,Kt--,W(300,"ease-out",ot),$t(!1,!0),ye=!1,Ui.onPhotoChange&&Ui.onPhotoChange(Qt+1,{no_open:!0,local:w,crop:k})}function st(){var e=1.05*(Hi.width||getCw());ae+=(e-ee)/re,ee=e,Te=Qt-1,Kt++,W(300,"ease-out",ot),$t(!1,!0),ye=!1,Ui.onPhotoChange&&Ui.onPhotoChange(Qt-1,{no_open:!0,local:w,crop:k})}function lt(){if(!Le)return!1;var e=function(){if(!Le||Le.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=Le.pop(),i=Le.length-1;i>=0;i--){if((a=e-Le[i][0])>150)break;t=Le[i]}if(!t||!n)return[0,0,0];var a,o=n[1].pageX-t[1].pageX,r=n[1].pageY-t[1].pageY,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}(),t=e[0],n=e[1],i=e[2];if(ut(),!t)return!1;var a=ue||de?5.1:4.7,o=t/a,r=n*o-a*o*o/2,s=i*o-a*o*o/2;if(o*=530,r*=140,s*=140,t<.1||!r&&!s)return!1;if(!de){var l={};ue||(l.curX=te+r,l.curY=ne+s),Xe(l);var c=Ze(re);l={},te<c.min?l.curBodyX=Z?te-c.min:0:te>c.max&&(l.curBodyX=Z?te-c.max:0),Xe(l)}return ue?4.7*n:de?4.7*i:o}function ct(e){Le||(Le=[]),Le.push([vkNow(),e]),Le=Le.slice(-20)}function ut(){Le=!1}function dt(e,t){var n,i,a,o,r,s,l,c,u,d=(n=[e.curX,e.curY],i=e.currentScale,a=[t.curX,t.curY],o=t.currentScale,r=n[0],s=n[1],l=a[0],c=a[1],1!=(u=o/i)&&[r+(r-l)/(u-1),s+(s-c)/(u-1)]);if(!d)return!1;var _=d[0],f=d[1];return e.deltaX=_-e.curX,e.deltaY=f-e.curY,e.currentX=e.curX/e.currentScale+_-_/e.currentScale,e.currentY=e.curY/e.currentScale+f-f/e.currentScale,t.deltaX=_-t.curX,t.deltaY=f-t.curY,t.currentX=t.curX/t.currentScale+_-_/t.currentScale,t.currentY=t.curY/t.currentScale+f-f/t.currentScale,d}function _t(e,t,n){var i,a,o,r,s,l,c,u,d,f,p,h,m,v,g,A=Hi.width||getCw(),b=Hi.height||getCh(),y=!1,w=(Math.min(50,A/7),R(_)),S=A/w.width,k=b/w.height,O=Math.min(1,S,k),C=D(e).coords,j=geByClass1("zpv_tl",e),E=getW(j),T=getH(j),I=(Math.min((A-30)/Math.max(C.w*w.width*O/100,E),(b-30)/(C.h*w.height*O/100+T+5)),function(){a=w.width*O*n.currentScale,o=w.height*O*n.currentScale,r=A/2-a/2+n.currentX*n.currentScale,s=b/2-o/2+n.currentY*n.currentScale,u=r+C.x*a/100,d=s+C.y*o/100,l=C.w*a/100,c=C.h*o/100,i=u+l/2-E/2,d+c+5,p=Math.min(u,i),f=Math.max(l,E),m=p+f,v=(h=d)+(c+T+5),g={}});return n=(n=Xe(g,t,n))||Ke(),I(),p<15?(g.curX=n.curX+(15-p),y=!0):m>A-15&&(g.curX=n.curX-(m-A+15),y=!0),h<15&&(g.curY=n.curY+(15-h),y=!0),n=(n=Xe(g,t,n))||Ke(),I(),v>b-15&&(g.curY=n.curY-(v-b+15),y=!0),n=Xe(g,t,n),t?n:y}function ft(e){Re&&(Re=!1,z(),e||W(),Pt(be,!0),xt(!be,!0),setTimeout((function(){Y()}),300))}function pt(e,t,n){var i={};return n=n||Ke(),i.lastScale=e,n=Xe(i,t,n),!!t&&n}function ht(e,t,n){var i={};if(n=n||Ke(),!St())return!!t&&n;i.curScale=e,n=(n=Xe(i,t,n))||Ke();var a=tt();return i={currentScale:n.currentScale},n.currentScale<a.min?i.currentScale=n.currentScale+(a.min-n.currentScale)/M:n.currentScale>a.max&&(i.currentScale=n.currentScale+(a.max-n.currentScale)/M),n=Xe(i,t,n),!!t&&n}function mt(e,t){if(!St())return!1;var n=!1,i={};t=t||Ke();var a=tt();return t.currentScale<a.min?(i.currentScale=a.min,n=!0):t.currentScale>a.max&&(i.currentScale=a.max,n=!0),t=Xe(i,e,t),e?t:n}function vt(e){if(!St())return!1;var t={pageX:0,pageY:0},n=Ke(),i=null,a=dt(n,i=wt(!0,i=yt(t,!0,i=mt(!0,i=ht(e=1==e?1/J:e,!0,i=bt(t,!0,n))))));a&&(z(a),q(n),Re=!0),Re&&(Pt(!1,!0),xt(!1,!0)),bt(t),ht(e),mt(),yt(t),wt(),Re?q(i,300,!1,ft):W(300),pt(re)}function At(e){if(!St())return!1;var t=Ke(),n=null,i=dt(t,n=wt(!0,n=mt(!0,n=_t(e,!0,t))));i&&(z(i),q(t),Re=!0),_t(e)&&(ke||(ke=t)),Re&&(Pt(!1,!0),xt(!1,!0)),mt(),wt(),Re?q(n,300,!1,ft):W(300),pt(re)}function bt(e,t,n){var i={};return n=n||Ke(),i.deltaX=(e.pageX-n.curX)/n.curScale,i.deltaY=(e.pageY-n.curY)/n.curScale,n=Xe(i,t,n),!!t&&n}function yt(e,t,n){var i={};n=n||Ke(),i.pointX=e.pageX,i.pointY=e.pageY;var a=Ze(n.currentScale),o=et(n.currentScale),r=(!se&&!o.max&&!o.min||ue||!St())&&!de;(de||k&&!se&&!a.max&&!a.min)&&(i.curX=0),r&&(i.curY=n.curY),n=Xe(i,t,n),i={};var s=!1;return(n=n||Ke()).curX<=a.min?_e?(s=!0,i.curBodyX=n.curX-a.min):(i.curX=n.curX+(a.min-n.curX)/M,i.curBodyX=Z?i.curX-a.min:0):n.curX>=a.max&&(fe?(s=!0,i.curBodyX=n.curX-a.max):(i.curX=n.curX+(a.max-n.curX)/M,i.curBodyX=Z?i.curX-a.max:0)),n.curY<o.min?r?i.curY=o.min:de||(i.curY=n.curY+(o.min-n.curY)/M):n.curY>o.max&&(r?i.curY=o.max:de||(i.curY=n.curY+(o.max-n.curY)/M)),n=Xe(i,t,n),t?n:s}function wt(e,t){var n=!1,i={},a=Ze((t=t||Ke()).currentScale),o=et(t.currentScale),r=!se&&!o.max&&!o.min||ue||!St()&&!de;return de&&(i.curX=0),r&&(i.curY=t.curY),t.curX<a.min?(i.curX=a.min,i.curBodyX=0,n=!0):t.curX>a.max&&(i.curX=a.max,i.curBodyX=0,n=!0),t.curY<o.min?(i.curY=o.min,n=!0):t.curY>o.max&&(i.curY=o.max,n=!0),t=Xe(i,e,t),e?t:n}function St(){return!b&&(!!k||!Xt.restriction&&Gt[Xt.src])}function kt(e){if(scrollTop()||scrollTop(0),!Me){if(e&&"mousedown"==e.type&&preventEvent(e),e.touches&&e.touches.length||!g){if(ot(),!le&&!se){xe=B(e);var t=Ze(re);te<=t.min&&(_e=!1!==tn(Qt+1)),te>=t.max&&(fe=!1!==tn(Qt-1))}if(le||b)pe=he=me=!1,ve=!1;else{clearTimeout(Ae);var n=B(e);pe&&vkNow()-pe<500&&he&&(i=n,o=(a=he).pageX-i.pageX,r=a.pageY-i.pageY,Math.sqrt(o*o+r*r)<50)?(me=vkNow(),ve=!1):(pe=vkNow(),he=n,ve=vkNow())}b||(le=!0)}var i,a,o,r;se||(Z=!0,H(!0)),je=B(e),ut(),ct(je),bt(je)}}function Ot(e){if(!Me&&(preventEvent(e),le)){if(pe=he=me=!1,ve=!1,ct(je=B(e)),Be){if(!(Be<vkNow()))return void ut();Be=!1,bt(je),W()}if(xe&&!ue&&!de){var t=Math.abs(je.pageX-xe.pageX),n=Math.abs(je.pageY-xe.pageY),i=et(re);if(!(n>5||t>5))return;n>5&&t<=5&&(1!=re||se||b||k?(i.max||i.min)&&(_e=fe=!1):(de=!0,be&&(ye=!0),Dt(!1),Mt(je.pageY-xe.pageY>0))),xe=!1,bt(je)}!yt(je)||ue||de||b||(ue=!0,je.pageX),function(){if(!de)return;var e=Math.abs(ne),t=Hi.height/2;Ne=1-.5*e/t}(),W(),ue&&Math.abs(ee)>getCw()&&Ct(extend({originalEvent:e},e,{touches:[]}))}}function Ct(e){if(!Me)if(Pe)Pe=!1;else{if(preventEvent(e),e.touches&&!e.touches.length||!g){var t=lt();if(ue)l=t,c=(Hi.width||getCw())/2,l=l||0,((ee<-c||l<-1)&&_e?(rt(),1):(ee>c||l>1)&&fe?(st(),1):(wt()&&W(300),0))&&(Qe(),H(!0));else if(de)nt(t);else if(me&&vkNow()-me<1e3){!function(e){if(!St())return!1;var t=tt(),n={pageX:K,pageY:X},i=(re>1?1:t.max)/J,a=Ke(),o=null;o=wt(!0,o=yt(n,!0,o=ht(i,!0))),e&&(o=wt(!0,o=_t(e,!0,o)));var r=dt(a,o);r&&(z(r),q(a),Re=!0),Re&&(Pt(!1,!0),xt(!1,!0)),ht(i),yt(n),wt(),e&&(_t(e),wt()),Re?q(o,300,!1,ft):W(300),pt(re),Nt()}(o=e&&we&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target))),pe=he=me=!1}else wt()?W(300):t&&(wt(),W(t,"cubic-bezier(0, 1, 1, 1)"));if(setTimeout((function(){Y()}),300),ve)if(vkNow()-ve>700||e&&"touchcancel"==e.type)ve=!1;else{if(ve=!1,e)var n=hasClass("zpv_header",e.target)?e.target:gpeByClass("zpv_header",e.target),i=hasClass("zpv_zoom_btns",e.target)?e.target:gpeByClass("zpv_zoom_btns",e.target),a=hasClass("zpv_bottom_body",e.target)?e.target:gpeByClass("zpv_bottom_body",e.target),o=we&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target)),r=Oe&&e.target.closest(".Photo__marketTag"),s=we&&e.target.closest(".Photo__marketShowMoreButton");e&&(n||i||a||o||r||s)?o?function(e,t){if(!Ie)return!1;if(!we)return!0;D(e);if(hasClass("zpv_tag_selected",e))return hasClass("zpv_tl_wrap",t.target)||gpeByClass("zpv_tl_wrap",t.target)?Di.go(e,t):(At(e),cancelEvent(t),!1);Se&&(pe=he=me=!1),removeClass("zpv_tag_selected",Se),Se=e,Rt(e),addClass("zpv_tag_selected",Se);be&&(ye=!0);Dt(!1),At(e),cancelEvent(t)}(o,e):i?(pe=he=me=!1,hasClass("zpv_zoomin",e.target)||gpeByClass("zpv_zoomin",e.target)?function(e){!!Ie&&(Ri.highlight=!1,Ri.end(e),se||ue||tt().max<=re||(cancelEvent(e),vt(k?1.25:1.45)))}(e):function(e){!!Ie&&(Ri.highlight=!1,Ri.end(e),se||ue||tt().min>=re||(cancelEvent(e),vt(k?.8:1)))}(e)):r?Di.go(r.dataset.url):s&&Ai._openItemsPopup(s.dataset.itemsJson):Se?$t(e):k||(Ae=setTimeout((function(){Dt(),Pt(be),xt(!be)}),500))}le=!1,ue=_e=fe=!1,ut()}var l,c;e.touches&&(e.touches.length>1||1==e.touches.length&&ue)&&bt(je=B(e)),(e.touches&&!e.touches.length||!g)&&(xe=!1)}}function jt(e){if(!Me&&(preventEvent(e),pe=he=me=!1,ve=!1,ut(),!ue&&!de)){ie=1,J=re,se=!0,_e=fe=!1;var t=Ze(re);(t.min>=-5||t.max<=5)&&(Z=!1,H(!1)),bt(B(e)),Pt(!1,!0),xt(!1,!0)}}function Et(e){Me||(preventEvent(e),pe=he=me=!1,ve=!1,ut(),ue||de||(Ee=B(e),ht(e.scale),yt(Ee),W(),Nt()))}function Tt(e){Me||(preventEvent(e),pe=he=me=!1,ve=!1,ut(),ue||de||(mt()&&((e.touches&&e.touches.length||!g)&&yt(Ee),wt(),W(100),Be=vkNow()+100),se=!1,Pt(be,!0),xt(!be,!0)))}function It(e){var t=tt(),n=e<t.max,i=e>t.min;toggleClass("zpv_zb_disabled",u,!n),toggleClass("zpv_zb_disabled",d,!i)}function Mt(e){e?setStyle(a,{top:-35,bottom:"auto"}):setStyle(a,{top:"auto",bottom:-35}),a.is_down=e}function Pt(e,t){var n=we;if(e){if(!St())return;if(!be&&!ye||se)return}we=e,e&&Bt(re,ae,oe,t||n!==e),n!==e&&(e&&Rt(Se),Lt(h,e,t))}function xt(e,t){var n=Oe;Xt.restriction&&(e=!1,t=!0),Oe=e,e&&Bt(re,ae,oe,t||n!==e),Lt(m,e,t)}function Lt(e,t,n){e&&setStyle.animate(e,!n&&"opacity",{duration:200,func:"linear"},(function(){setStyle(e,"visibility",t?"visible":"hidden")})),e&&setStyle(e,"visibility",t||!n?"visible":"hidden"),e&&setStyle(e,"opacity",t?1:0)}function Bt(e,t,n,i){if(!se){var a=Hi.width||getCw(),o=Hi.height||getCh(),r=R(_),s=a/r.width,l=o/r.height,c=Math.min(1,s,l),u=r.width*c*e,d=r.height*c*e,f=a/2-u/2+t*e,p=o/2-d/2+n*e;we&&(i&&h&&setStyle.animate(h),setStyle(h,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(h,{translate:[Math.round(f),Math.round(p)]})),Oe&&(i&&m&&setStyle.animate(m),setStyle(m,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(m,{translate:[Math.round(f),Math.round(p)]}),Ce||(!function(){function e(e,t){var n=e.getBoundingClientRect(),i=m.getBoundingClientRect();n.left<i.left+t?e.style.left=i.left-n.left+t+"px":n.right>i.left+i.width-t&&(e.style.left=i.left+i.width-n.right-t+"px")}m&&Array.from(m.children).forEach((function(t){if(t.classList.contains("Photo__marketTag")){var n=t.$(".Photo__marketTagInner"),i=t.$(".Photo__marketTagArrow");e(n,10),e(i,20)}}))}(),Ce=!0)),i&&v&&setStyle.animate(v),setStyle(v,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(v,{translate:[Math.round(f),Math.round(p)]})}}function Rt(e){if(e){var t=R(_),n=Hi.width||getCw(),i=Hi.height||getCh(),a=n/t.width,o=i/t.height,r=Math.min(1,a,o),s=t.width*r*re,l=t.height*r*re,c=D(e).coords,u=geByClass1("zpv_tl",e),d=getW(u),f=getH(u),p=c.x*s/100,h=c.y*l/100,m=c.w*s/100,v=c.h*l/100,g=p+m/2-d/2,A=h+v+5,b=n>s?0-(n-s)/2:0,y=n>s?s+(n-s)/2:s,w=i>l?l+(i-l)/2:l,S=0,k=0;g<b+2?S=b+2-g:g+d>y-2&&(S=y-2-g-d),A+f>w-5&&(k=v>3*f?w-5-A-f:-v-f-10),setStyle.transform(u,{translate:[Math.ceil(S),Math.ceil(k)]})}}function Dt(e){if(void 0!==e){if(be===e)return;be=!e}else ye=!1;setStyle(n,"width","auto"),n&&setStyle.animate(n,"opacity",{duration:200,func:"linear"},(function(){setStyle.animate(n),setStyle(n,"width",be?"auto":0)})),be?(setStyle(n,"opacity",0),be=!1):(setStyle(n,"opacity",1),be=!0)}function Nt(){Hi.height<604&&!Se&&!k&&(re>1.25?(be&&(ye=!0),Dt(!1)):ye&&(ye=!1,Dt(!0)))}function Ht(e){Ie&&(le||se||ue||e&&e.touches&&e.touches.length>1||(cancelEvent(e),Ui.close()))}function Vt(e){if(!(le||se||ue||!e||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=Ze(re);37==e.keyCode?(cancelEvent(e),te>=t.max&&!1!==tn(Qt-1)&&(H(!0),st())):39==e.keyCode?(cancelEvent(e),te<=t.min&&!1!==tn(Qt+1)&&(H(!0),rt())):27==e.keyCode&&Ht(e)}}function Ut(){k?dn():(sn(),cn(Qt),Ft())}function Ft(){Pt(we,!0),xt(Oe,!0),Bt(re,ae,oe)}function $t(e,t){return!(!Ie&&!t)&&(!Se||(removeClass("zpv_tag_selected",Se),Se=!1,ye&&re<=1.25&&(ye=!1,Dt(!0)),cancelEvent(e),!1))}function Wt(e){"touchstart"==e.type?Ie=!e.touches||1==e.touches.length:"touchmove"==e.type?(Ie=!1,preventEvent(e)):"click"==e.type&&(Ie||(cancelEvent(e),Ie=!0))}function qt(e){"touchstart"==e.type?Me=!0:"touchmove"==e.type?(Me=!0,preventEvent(e)):(Me=e.touches&&e.length,Pe=!Me)}function zt(){Yt&&Yt[Qt]&&Yt[Qt].restriction&&"blur"===Yt[Qt].restriction.type&&delete Yt[Qt].restriction,Ut()}var Yt=!1,Gt={},Qt=!1,Kt=!1,Xt=!1,Jt=!1,Zt=!1;function en(e,t,n,i){var a=t||len(e);if(e&&!n||(Yt=null),Yt||(Yt=new Array(a)),Yt.length!=a){var o=Yt;Yt=new Array(a),extend(Yt,o)}e=e.map((function(e){return e&&e.restriction&&"block"===e.restriction.type&&(e.src="/images/mobile/blank.gif"),e})),extend(Yt,e);var r=function(e){for(var t in Yt)if(Yt[t].id==e)return+t;return-1}(Xt.id);-1==r&&(r=Qt),i||cn(r)}function tn(e){return!(e>=Yt.length)&&(!(e<0)&&(Yt[e]||{src:!0}))}function nn(e,t,n){var i=R(e),a=Je();k&&(Yt[0].loaded=t,t&&(i.width>i.height?setStyle(e,{height:a.height}):setStyle(e,{width:a.width}),setStyle(e,{minWidth:0,maxWidth:"none"})),dn(!0));if(ln()){if(2*i.width>=a.width){var o=a.width/(i.width||i.clientWidth);if(i.height*o>=a.height)return;ie=o,J=o,re=o,setStyle.transform(_,o)}"VIDEO"===e.tagName&&e.play()}show(e),_===e&&(Pt(t,!t),xt(t&&!be,!t))}function an(e,t){if(void 0===t&&(t=!1),Gt[e])on(e);else if(t){var n=ce("video",{src:e}),i=!1,a=function(){i||(i=!0,Gt[e]=!0,on(e),n=null)};addEvent(n,"canplay",a),addEvent(n,"onload",a),n.load()}else{var o=new Image;o.addEventListener("load",(function t(){Gt[e]=!0,on(e),sn(),Ft(),o.removeEventListener("load",t),o=null}),!1),o.src=e}}function on(e){[_,f,p].forEach((function(t){var n=gpeByClass("zpv_thumb_item",t),i=attr(t,"data-src");i===e&&(t.src=i,nn(t,!0),"VIDEO"!==t.tagName&&removeClass("zpv_ti_loading",n),attr(t,"data-src",!1),ln()&&statlogsValueEvent("gif_play",0,"VIDEO"===t.tagName?"mp4":"gif"))}))}function rn(e,t,n,i){void 0===i&&(i=!1);var a=gpeByClass("zpv_thumb_item",e);i&&(addClass("zpv_ti_loading",a),setTimeout((function(){setStyle(_,{display:"block"})}))),i&&(n=!1),t?!0!==t?e.src===t?nn(e,!0):Gt[t]?(e.src=t,nn(e,!0)):(n?(e.src=n,nn(e,!1)):hide(e),attr(e,"data-src",t),an(t,i),addClass("zpv_ti_loading",a)):(n?(e.src=n,nn(e,!1)):hide(e),addClass("zpv_ti_loading",a)):hide(e)}function sn(){if(y){!function(){window.lang;var e="";if(ln())e=getLang("mobile_gif_popup_title");else{e=getLang("mobile_photos_photoview_header")||"";var t=!1!==Te?Te:Qt;e=(e=e.replace("%s",t+1)).replace(/%s|{count}/,Yt.length)}val("zpv_summary",e)}(),It(re);var e=tn(!1!==Te?Te:Qt);if(k||S||e&&!0!==e.src){if(!k&&!S){var t="";each(e.tags,(function(e,n){if(!e||0==e)return!0;var i=N(n),a=i.coords,o=i.href?' data-href="'+i.href+'" data-name="'+escapeAttr(i.name)+'"':"",r=i.al?(i.href?" al"+i.al:"")+" "+i.al:"";t+='<div class="zpv_tag'+r+'" style="left: '+a.x+"%; top: "+a.y+"%; width: "+a.w+"%; height: "+a.h+'%;" data-id="'+e+'"'+o+'><div class="fill"></div><div class="zpv_tl_wrap" id="zpv_tl_wrap"><div class="zpv_tl'+(i.href?"":" zpv_tl_plain")+'">'+htsc(i.name)+"</div></div></div>"}));var n,a="",s=e.market_tags&&e.market_tags.tags,l=s&&s.length&&!e.restriction,u="";l&&(u=c.default.html(fi({items:escape(JSON.stringify(s))})),s.forEach((function(e){a+=c.default.html(_i(e))})));var d=R(_);e.restriction&&"blur"===e.restriction.type&&!Object(Li.isCleared)("photo"+e.id)?(Pt(!1,!0),xt(!1,!0),n=Object(gt.default)(Object(E.default)({},e.restriction,{raw:"photo"+e.id,width:d.width,height:d.height}))):e.restriction&&"block"===e.restriction.type&&(n=Object(gt.default)(e.restriction)),val(h,t),val(m,a),val(v,n?c.default.html(n):null),val(o,'<div class="zpv_photo_desc">'+(e.caption||"")+"</div>"+u+'<div class="zpv_bottom_bg"></div>'),toggle(o,!!e.caption||!!l);var f="";if(w||Di.getQuery("community")||!O)f="";else{var p=e.tags&&e.tags[0]||0;f="<tr>"+('<td class="row_table_column"><a href="'+e.like_url+'" class="item_button item_like'+(e.likes_me?" item_likes_me":"")+'" onclick="return photoview.likePhoto(this, \''+e.id+'\');"><i class="i_icon i_like"></i>'+(e.likes_cnt?'<b class="v_value v_like">'+formatNum(e.likes_cnt)+"</b>":"")+"</a></td>")+('<td class="row_table_column"><a href="'+e.photo_url+'#comments" class="item_button item_replies al_photo" onclick="return photoview.openPhoto(this, event, true);"><i class="i_icon i_replies"></i>'+(e.replies_cnt?'<b class="v_value v_replies">'+e.replies_cnt+"</b>":"")+"</a></td>")+('<td class="row_table_last_column"><a href="'+e.photo_url+'" class="item_button item_tags al_photo" onclick="return photoview.openPhoto(this, event);"><i class="i_icon i_tags"></i>'+(p?'<b class="v_value v_tags">'+p+"</b>":"")+"</a></td>")+"</tr>"}val(r,f),xi(e.photo_url),show(i)}}else hide(i)}}function ln(){return Xt.isDoc}function cn(e){if(y){Qt=Math.max(0,Math.min(e||0,Yt.length)),Xt=tn(Qt),Zt=tn(Qt-1),Jt=tn(Qt+1),_.classList.toggle("zpv_img--blur",!!Xt.restriction&&"blur"===Xt.restriction.type&&!Object(Li.isCleared)("photo"+Xt.id)),p.classList.toggle("zpv_img--blur",!!Jt.restriction&&"blur"===Jt.restriction.type&&!Object(Li.isCleared)("photo"+Jt.id)),f.classList.toggle("zpv_img--blur",!!Zt.restriction&&"blur"===Zt.restriction.type&&!Object(Li.isCleared)("photo"+Zt.id));var t=Je();[_,p,f].forEach((function(e,n){var i;0===n?i=Xt:1===n?i=Jt:2===n&&(i=Zt);var a=i.restriction&&"blur"===i.restriction.type&&(!window.CSS||!CSS.supports("filter: blur(20px) brightness(0.75) contrast(1.25)"));e.classList.toggle("zpv_img--blurUnsupported",!a),e.classList.toggle("zpv_img--block",i.restriction&&"block"===i.restriction.type);var o,r,s=domData(e,"fake-size");i.restriction&&"block"===i.restriction.type?(r=Math.max(Math.min(t.width,600),400),o="600,600"):(s||i.restriction&&"blur"===i.restriction.type)&&(r=Math.max(Math.min(t.width,600),400),o=t.width+","+r),i.restriction&&"block"===i.restriction.type||i.restriction&&!Object(Li.isCleared)("photo"+i.id)||(o=null,r=null),setStyle(e,{"min-height":r||null}),domData(e,"fake-size",o||null)})),rn(_,Xt.src,"/images/mobile/blank.gif",Xt.hasVideo),rn(p,Jt.src),rn(f,Zt.src),sn(),Ft(),Ui.onUpdate&&Ui.onUpdate()}}function un(){if(y&&S&&Yt){var e=Yt[0];if(!e.loaded&&e.progress){var t=geByClass1("zpvu_progress","zpv_center");setStyle(t,{width:100*e.progress+"%",visibility:"visible"})}if(!e.read&&e.thumb){e.read=!0;var n=geByClass1("zpv_upload_box","zpv_center"),i=geByClass1("zpv_upload_img",n);setStyle(i,{backgroundImage:"url("+e.thumb+")"}),removeClass("zpv_thumb_uploading",n)}}}function dn(t){if(y&&k&&Yt){var n=Yt[0],i=!!n.saving;if(toggleClass("item_disabled","zpv_save_button",i||!n.loaded),toggleClass("item_disabled","zpv_cancel_button",i),toggleClass("zpv_crop_saving",e,i),b=i,t||rn(_,n.src,"/images/mobile/blank.gif"),n.loaded&&n.rect&&!n.rect_inited){n.rect_inited=!0;var a=Je(),o=n.rect[0],r=n.rect[1],s=n.rect[2],l={};l.currentScale=1/s,Xe(l),mt(),wt(),l={};var c=(_.width||_.clientWidth)*re,u=(_.height||_.clientHeight)*re,d=o*c,f=r*u;l.curX=(c-a.width)/2-d,l.curY=(u-a.height)/2-f,Xe(l),wt(),W(0)}}}function _n(l,c){void 0===l&&(l=!1),void 0===c&&(c=!1),y||(ve=!1,Ae=!1,be=!0,ye=!1,Te=!1,Ie=!0,Me=!1,Pe=!1,De=!1,Ne=!1,b=!1,w=!1,S=!1,k=!1,Qe(),function(l,c){void 0===l&&(l=!1),void 0===c&&(c=!1);var g=window.lang,A="";A=l?Oi(c):'<div id="z_photoview" scheme="space_gray"><div class="zpv_siblings"><div id="zpv_left" class="zpv_thumb_item"><img class="zpv_img" alt=""></div><div id="zpv_right" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_body"><div id="zpv_center" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_close_msg_wrap"><div class="zpv_close_msg">'+g.mobile_zphoto_move_to_close+'</div></div><div class="zpv_controls"><div class="mhead zpv_header"><a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a><div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div></div><div class="zpv_zoom_btns"><a class="zpv_zoom_btn zpv_zoomin"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a><a class="zpv_zoom_btn zpv_zoomout"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a></div><div class="zpv_bottom"><div class="zpv_photo_desc_wrap"></div><div class="zpv_bottom_body"><table class="zpv_values like_box row_table"></table></div></div></div><div class="zpv_restriction"></div><div class="zpv_tags"></div><div class="zpv_market_tags"></div><div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div></div>';var b="/images/mobile/zpv_icons"+(hasClass("x2",window.bodyNode)?"_2x":"")+".png?2";(new Image).src=b,Hi.create(A,fn),e=ge("z_photoview"),geByClass1("zpv_body",e),t=geByClass1("zpv_siblings",e),n=geByClass1("zpv_controls",e),s=geByClass1("zpv_zoom_btns",e),a=geByClass1("zpv_close_msg_wrap",e),i=geByClass1("zpv_bottom",e),o=geByClass1("zpv_photo_desc_wrap",e),r=geByClass1("zpv_values",i),u=geByClass1("zpv_zoomin",s),d=geByClass1("zpv_zoomout",s),h=geByClass1("zpv_tags",e),m=geByClass1("zpv_market_tags",e),v=geByClass1("zpv_restriction",e),geByClass1("zpv_crop",e),_=geByClass1("zpv_img","zpv_center"),f=geByClass1("zpv_img","zpv_left"),p=geByClass1("zpv_img","zpv_right"),"VIDEO"===_.tagName&&(_.controls=!1)}(l,c),function(){if(g=void 0!==document.ontouchmove,A=!1,gt.default.onClear(zt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);addEvent(t,"touchstart touchmove touchend touchcancel",qt),addEvent(n,"touchstart touchmove touchend touchcancel",qt),addEvent(e,"touchstart touchmove click",Wt),addEvent(e,"touchstart",kt),addEvent(e,"touchmove",Ot),addEvent(e,"touchend touchcancel",Ct),A?(addEvent(e,"gesturestart",jt),addEvent(e,"gesturechange",Et),addEvent(e,"gestureend",Tt)):(addEvent(e,"touchstart",qe),addEvent(e,"touchmove",ze),addEvent(e,"touchend touchcancel",Ye),addEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else addEvent(e,"mousedown",kt),addEvent(e,"mousemove",Ot),addEvent(window,"mouseup",Ct),addEvent(window,"mousewheel",Ge),addEvent(window,"keydown",Vt)}(),y=!0,reflow(e),scrollTop()||scrollTop(0))}function fn(){y&&(!function(){if(gt.default.onClear("__clear",zt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);removeEvent(t,"touchstart touchmove touchend touchcancel",qt),removeEvent(n,"touchstart touchmove touchend touchcancel",qt),removeEvent(e,"touchstart touchmove click",Wt),removeEvent(e,"touchstart",kt),removeEvent(e,"touchmove",Ot),removeEvent(e,"touchend touchcancel",Ct),A?(removeEvent(e,"gesturestart",jt),removeEvent(e,"gesturechange",Et),removeEvent(e,"gestureend",Tt)):(removeEvent(e,"touchstart",qe),removeEvent(e,"touchmove",ze),removeEvent(e,"touchend touchcancel",Ye),removeEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else removeEvent(e,"mousedown",kt),removeEvent(e,"mousemove",Ot),removeEvent(window,"mouseup",Ct),removeEvent(window,"mousewheel",Ge),removeEvent(window,"keydown",Vt)}(),e=t=n=a=!1,i=r=!1,s=u=d=!1,_=f=p=h=!1,v=!1,y=!1,Yt=null)}return{onShow:Object(l.default)(),onHide:Object(l.default)(),likePhoto:function(e,t){return!!Ie&&(Ri.highlight=!1,Ri.end(),Xt.likes_me?(Xt.likes_me=!1,--Xt.likes_cnt):(Xt.likes_me=!0,++Xt.likes_cnt),sn(),Bi.click(e,extend({photo_id:t},Ni)))},openPhoto:function(e,t,n){var i=window.cur;if(!Ie)return!1;var a=i.replyNames,o=it.default.getStickerPanel(),r=it.default.getStickers(),s=Di.go(e,t,{local:!0,fast:!0,beforeAppend:function(e){val(geByClass1("mcont",e),'<div class="pcont"><div class="media_view photo_view"><div class="pv_summary"><div class="summary_loading" style="display: none;"><i class="i_loading"></i></div></div><div class="pv_tag_wrap"></div><div class="pv_body pv_touch pv_touch_full pv_hidden_icons"><a class="thumb_item"><div class="pv_photo_wrap" id="pv_photo_tags" onclick="return photo.closeTags(event);"><img src="/images/mobile/blank.gif" class="ph_img" alt="" /></div></a><div class="pv_nav"><table class="row_table pv_nav_cont"><tr><td class="pv_nav_left"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_z"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_right"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td></tr></table></div></div><div class="pv_footer"></div></div></div>'),val("m",e.innerHTML)}});if(extend(i,{replyNames:a,sticker_panel:o,stickers:r,processNav:function(e){var t;if(t=/^\/photo(-?\d+_\d+)$/i.exec(e.nav.path)){var n=qs2obj(e.nav.params),i=qs2obj(Di.params);if(n.act)return!1;if(n.offset!=i.offset)return!1;if(n.list!=i.list&&!i.z)return!1;if(n.reply!==i.reply)return!1;if(n.reply_to!==i.reply_to)return!1;e.onPreNav&&e.onPreNav();var a=n.list||"",o=n.rev?"/rev":"";return!Vi.open(t[1],a+o,null,n.from,!0)}return!1}}),i.destroy.push((function(){Vi.clear()})),window.lang,!s&&!(s=Di.go(e,t,{force:!0}))){if(Hi._lastNav){var l=Hi._lastNav,c=qs2obj(l.params);delete c.z,l.path+obj2qs(c)+l.hash}Vi.showIcons()}return!0},closePhoto:Ht,savePhoto:function(e,t){if(!Ie)return!1;if(Ri.highlight=!1,Ri.end(),hasClass("item_disabled",e))return!1;if(!k||!Yt)return!1;var n=Yt[0],i=Je(),a=_.width*re,o=(_.height||_.clientHeight)*re,r=(a-i.width)/2-te,s=(o-i.height)/2-ne,l=1/re,c=r/a,u=s/o;return n.onSelect&&n.onSelect(c,u,l),!1},cancelPhoto:function(e,t){return!!Ie&&(Ri.highlight=!1,Ri.end(),!hasClass("item_disabled",e)&&Ht())},onClose:null,onUpdate:null,onPhotoChange:null,saveSource:en,_toggleTouches:function(e){Ui.opened()&&(b=!e,e||(le=!1))},opened:function(){return y},openCrop:function(t,n){n=n||{};var a=!y;S?S=!1:_n(),k=!0,b=!1,Yt=[t],a&&(Hi.open(),Hi.onResize=Ut),function(){if(y&&k){var t=window.lang;val("zpv_summary",t.mobile_zphoto_owner_crop_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_crop",e),It(re),_.parentNode||(val("zpv_center",""),append(_,"zpv_center"));var n='<tr><td class="row_table_column"><a class="item_button" id="zpv_save_button" onclick="return photoview.savePhoto(this);"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" id="zpv_cancel_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),r.classList.add("zpv_values--upload"),show(i),dn()}}()},updateCrop:function(e){if(!Yt)return!1;e=extend(Yt[0]||{},e),Yt=[e],dn()},openUpload:function(t,n){n=n||{},_n(),S=!0,b=!0,Yt=[t],Hi.open(),Hi.onResize=Ut,function(){if(y&&S){var t=window.lang;val("zpv_summary",t.mobile_zphoto_upload_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_upload",e);remove(_),val("zpv_center",'<div class="zpva zpv_upload_box zpv_thumb_uploading"><div class="zpv_upload_img"></div><div class="zpvu_progress_wrap"><div class="zpvu_progress"></div></div></div>');var n='<tr><td class="row_table_column" width="50%"><a class="item_button item_disabled" onclick="return false;"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),r.classList.add("zpv_values--upload"),show(i),un()}}()},updateUpload:function(e){if(!Yt)return!1;e=extend(Yt[0]||{},e),Yt=[e],Xt=!1,un()},open:function(e,t,n){var i,o;Ui.onShow(),_n((n=n||{}).isDoc,n.hasVideo),w=n.local||!1,O=!1!==n.showControls,t&&en(t,!1,!1,!0),cn(e),Kt=0,Hi.open(),Hi.onResize=Ut,i=geByClass1("zpv_close_msg",a),o=getW(i),setStyle(a,{width:o||250})},close:function(){Ui.onHide(),Ui.onClose&&Ui.onClose({local:w})||Hi.close()}}}();window.photoview=Ui;n("ldCb");window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,a){var o=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:a},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(o)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,a,o,r,s,l){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i,a,o,r,s){var l={_ajax:1,act:"hide_internal_notification",reason:i,id:t,hash:n},c={},u=gpeByClass("_block",e),d=!0;if("decline"==i){var _=this.webActionsDeclineHandlers[o];d=this.runActionHandler(_,e,l,c,r,n),hide(u)}else{var f=this.webActionsAcceptHandlers[o];d=this.runActionHandler(f,e,l,c,r,n),lockButton(e),"add_custom_newsfeed"==o&&(Object(_n.setCookie)("remixcustom_feed_added",r),l.action=o,l.action_section=r.section,l.action_hash=r.hash)}return c.onDone=function(){"compact"===s&&"accept"===i||cur.destroy.push((function(){return remove(u)})),~this.withoutNavActions.indexOf(o)||nav.go(e,a)}.bind(this),c.onFail=function(){unlockButton(e)},Promise.resolve(d).then((function(e){(e||isUndefined(e))&&ajax.post("/index.php",l,c)})),!1})),runActionHandler:function(e,t,n,i,a,o){return!isFunction(e)||e(t,n,i,a,o)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}},function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?Object(_n.setCookie)("remixm_tabs_expanded","",-1):Object(_n.setCookie)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}(),window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",a=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!a,hash:n,audio_id:t,ref:cur.module}),attr(e,"aria-label",a?lang.mobile_bookmarks_actions_add:lang.mobile_bookmarks_actions_remove),a?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),i="";cur&&cur.module?i=cur.module:nav&&"/feed"===nav.cur?i="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(i="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,i),cn.default.open(n,!0)}};var Fi=n("p5n7");function $i(e,t){var n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option"),o=$(".Btn__text",a);e?(n.style.display="inline-block",n.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},a.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},o.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):(a.onclick=function(n){return posting.openCopyright(n,!1,t,encodeURIComponent(e))},setStyle(a,"display","table"),o.innerHTML=getLang("mobile_wall_post_copyright_add_button"),hide(n)),val(i,e),post.checkCopyright()}var Wi={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var a=new RegExp("{link}(.*){/link}"),o=a.exec(getLang("mobile_wall_post_copyright_mb_text"))[1],r="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),s=getLang("mobile_wall_post_copyright_mb_text").replace(a,"<a onclick=\"Popup.close(this); nav.go('"+r+'\', null)" href="'+r+'">'+o+"</a>"),l=Object(an.default)({class:"AddCopyrightPopup",header:{title:e?getLang("mobile_wall_post_copyright_mb_title_text_edit"):getLang("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(s)},Object(Fi.default)({class:"AddCopyrightPopup__input",placeholder:getLang("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:e?getLang("mobile_wall_post_copyright_edit_button"):getLang("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?Btn({class:"Popup__button",inner:getLang("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});an.default.open(Wd.elem(l),!0);var c=$(".AddCopyrightPopup__input input");c&&Object(i.elfocus)(c)},submit:function(e,t,n){var i=$(".Btn",n.parentNode);i.disabled=!0,ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(a){var o=$(".AddCopyrightPopup__error");a.status?(n.classList.remove("TextInput_error"),hide(o),$i(e,t),an.default.close(n)):(n.classList.add("TextInput_error"),show(o),val(o,a.error)),post.saveDraft(null,t),i.disabled=!1}})},remove:function(e,t){t&&an.default.close(t),$i("",e),e&&post.saveDraft(null,e)}};window.AddCopyrightPopup=Wi;var qi=Wi,zi={getHash:function(){var e=Object(M.$)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,i){cancelEvent(e);var a=!1;if("BUTTON"===e.target.tagName)a=e.target.disabled;else if("LABEL"===e.target.tagName){a=Object(M.$)("button",e.target).disabled}a||qi.open(t,n,i)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=Object(M.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),i=n.querySelector("input");qi.submit(i.value,e,n)},deleteSource:function(e,t,n){var i=Object(M.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),qi.remove(n,i)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,zi.getHash(),""+nav.path+obj2qs(n))}};window.posting=zi;n("wyHI");var Yi={},Gi=function(e,t,n,i){delete Yi[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var Qi,Ki={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(window.showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var a=attr(e,"data-sticker-id"),o=attr(e,"data-hash");return!(!a||!o)&&(!Yi[a]&&(Yi[a]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:a,hash:o},{onDone:Gi.pbind(n,a,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};if(window.isMVK){var i=String(t);return a.colorScheme.isDarkScheme()&&(i=i.replace(/b$/,"")+"b"),rs(window.store.stickers.url_template,{id:e,size:i})}return getTemplate("stickers_sticker_url",n)}},Xi=function(){var e,t,n,i=!1,a=!1,o={},r={},s={},l={};function c(e){var t=_(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function a(o){n++;var r=!0;i>=n&&(r=!1),r&&(d(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",a),t.stop())}))}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function d(e,t){l[u(e)]=t}function _(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=r[t];return n||!1}function f(e,t){var i=_(e);if(i)"function"==typeof t&&t(i);else{var a=attr(e,"data-uniq-id");if(!l[u(e)]){d(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),f=!1;if(c&&(f=(o[c]||s)&&h(e)),f){var p={container:e,renderer:"svg",loop:!0,autoplay:!1,name:a,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};o[c]?p.animationData=o[c]:p.path=s;var m=geByClass1("svg_sticker_animation",e);if(m&&re(m),i=n.loadAnimation(p),!o[c])return void i.addEventListener("data_ready",(function(){o[c]=i.animationData,r[a]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(r[a]=i,"function"==typeof t&&t(i))}}}function p(){return t().then((function(e){return n=e,e}))}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);Xi.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");Xi.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(n));Xi.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){f(t,(function(){c(t)}))})),i=!1}}else p().then((function(){Xi.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame((function(){f(e,(function(){c(e)}))})):p().then((function(){Xi.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!s[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(s[e]=setTimeout((function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(Xi.loadAndPlaySticker(n),clearTimeout(s[e]),s[e]=!1)}),t))}},reloadStickers:function(){r={}},touchStartSticker:function(t){t.addEventListener("contextmenu",Xi.preventContextMenu,!1),e=setTimeout((function(){Xi.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function h(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}(),Ji={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return Ji.autoplay}};function Zi(){return qs2obj(nav.params)}function ea(e){return"dialogs"===e.tab||!e.q}function ta(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function na(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,a){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(a?'<div class="si_slabel">'+a+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:C.default.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}Xi.init({animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.Stickers=Ki,window.StickersAnimation=Xi,window.StickersSettings=Ji,window.StickersCache=it.default,im.clearSearchInput=function(e){if(preventEvent(e),ea(Zi())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+ta(!0))},im.onFilterKeyDown=function(e){setTimeout((function(){var t=window.lang,n=encodeURIComponent(e.value),i=Zi();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+ta():"/mail"+ta(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+ta()),ea(i)){var a,o=ge("mail_tabs"),r=ge("ma_search_items"),s=ge("dialogs"),l=i.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),Qi&&clearTimeout(Qi),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(o),show(r),hide(s),Qi=setTimeout((function(){a="/mail?tab=dialogs&q="+n+(l?"&offset="+l:"")+ta(),"/mail"!==nav.path||Zi().act||nav.go(a,null,{push_only:!0})}),200);else{if(hide(o),hide(r),show(s),!nav.getQuery("community")){var c=geByClass1("mhb_back"),u=geByClass1("mh_header");val(u,t.mobile_mail_head_title),removeClass("mhi_back",u),c.outerHTML=c.outerHTML.replace("<a","<div").replace("</a>","</div>")}a="/mail"+(l?"?offset="+l:"")+ta(!l),nav.go(a,null,{push_only:!0})}}}),40)},mail.onShowWritePageFromCache(na),mail.onShowDialogsPageFromCache(na);var ia=n("vuIU"),aa="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",oa=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(!('audio/mpeg; codecs="mp3"'!==(e=e||'audio/mpeg; codecs="mp3"')||!browser.safari&&!browser.safari_mobile||!browser.version.toString().startsWith("14"))||!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==aa?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",(function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)})),addEvent(t,"stalled",(function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))})),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",(function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())})),this.opts.onEnd&&addEvent(t,"ended",(function(){n._currentAudioEl==t&&n.opts.onEnd()})),this.opts.onSeeked&&addEvent(t,"seeked",(function(){n._currentAudioEl==t&&n.opts.onSeeked()})),this.opts.onSeek&&addEvent(t,"seeking",(function(){n._currentAudioEl==t&&n.opts.onSeek()})),addEvent(t,"error",(function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()})),addEvent(t,"canplay",(function(){if(window.data){var e=window.data(t,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),window.data(t,"setUrlTime",0))}n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))})),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,aa),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,aa);var a=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout((function(){a.opts.onCanPlay&&a.opts.onCanPlay()})),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,aa);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,aa),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;n.src&&Tn(n).catch((function(){debugLog("Audio: url set failed (html5 impl)")}))},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,aa)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var a=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),a+=i;if(i<0?a<=e:a>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(a)}.bind(this))},Object(ia.default)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();oa.STATE_HAVE_NOTHING=0,oa.STATE_HAVE_FUTURE_DATA=3,oa.HAVE_ENOUGH_DATA=4,oa.AUDIO_EL_ID="ap_audio";var ra=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout((function(){n._checkFlashLoaded()}),50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout((function(){i._checkFlashLoaded()}),100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},Object(ia.default)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=ra,ra.PLAYER_EL_ID="flash_voice";void 0===window.isTouch&&(window.isTouch=!1);var sa,la=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var o=e.classList,r=0,s=o.length;r<s;r++)addClass(this._el,o[r]);else this._el.className=e.className;each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=Object(Zn.debounce)(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),a=this._width;if((i=t?Math.min(Math.max(0,i),a):i)>=0&&i<=a){var o=i/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,o):o;var r=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var a=n?e:this._unlogf(e);a=100*a+"%",setStyle(this._amountEl,{width:a}),setStyle(this._handlerEl,{left:a}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},Object(ia.default)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}(),ca=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window;var ua=!1,da=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var i={onEnd:function(){t.detach()},onFail:function(){i.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};sa=!1,oa.isSupported()?(oa.isSupported('audio/ogg;codecs="opus"')&&!oa.isSupported('audio/ogg;codecs="codec_check"')&&(sa=!0),this._impl=new oa(i)):browser.flash&&window.renderFlash&&(this._impl=new ra(i)),this.onPlayPause=function(e){return cancelEvent(e),t._clearMediaSession(),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new la(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var t=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(t.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(t.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.appendChild(this._el),this._clearMediaSession()},t._clearMediaSession=function(){var e=this;ca&&(navigator.mediaSession.setActionHandler("play",(function(){return e.play()})),navigator.mediaSession.setActionHandler("pause",(function(){return e.pause()})),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise((function(n,i){t._impl.onReady((function(){t._impl.setUrl(attr(e,sa?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})}))}));this._impl.setUrl(attr(e,sa?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&Object(z.statlogsValueEvent)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval((function(){var t=e._impl.getCurrentProgress();e._updateProgress(t)}),100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[wt.events.PLAY_REQUESTED,wt.events.PLAY],(function(){delete window.ap.pausedByMsg,e.pause()})):window.audio&&window.audio.subscribe([wt.events.PLAY_REQUESTED,wt.events.PLAY],(function(){delete window.audio.pausedByMsg,e.pause()})),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",(function(){e.pause()})),window.Notifier.addRecvClbk("video_start","audio_msg",(function(){e.pause()})))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(ua=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&ua&&(ua=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&(Tn(window.audio).catch((function(){})),delete window.audio.pausedByMsg)},Object(ia.default)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!ei.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==ei.default.get("audio_time_left")},set:function(e){window.AudioPlayer?ei.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):ei.default.set("audio_time_left",e?"1":"0")}}]),e}(),_a={avg:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}(),peak:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}(),quad:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},fa=function(){function e(e){this._normalizeAlgorithm=!1,_a[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new _a[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,_a[e.algorithm]||(e.algorithm="peak"),this._algorithm=new _a[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var a=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),a>0)for(var o=0;o<n.length;o++)n[o]=n[o]/a,this._truncateTo>0&&(n[o]=Math.min(this._truncateTo,Math.abs(n[o])))}return n},e}();var pa=null;function ha(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=0,i=0;i<t.length;i++){try{n=parseInt(window.getComputedStyle(t[i],null).getPropertyValue("width"))}catch(e){n=parseInt(t[i].currentStyle.width)}if(n>0)break}return n}function ma(e,t){var n,i,a;t=Math.round(t),e.length!=t&&(i=t,void 0===a&&(a="peak"),e=new fa({srcSampleRate:(n=e).length,dstSampleRate:i,normalizeAlgorithm:a,truncateTo:0}).push(n));for(var o="",r=0,s=0;s<e.length;s++)0===(r=Math.floor(8*e[s]*.95))&&(r=.5),o+="M"+(4*s+1)+","+(10-r)+"v"+2*r+"Z";return'<svg class="audio-msg-track--wave" width="'+4*e.length+'px"><path d="'+o+'"></path></svg>'}function va(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=Object(i.attr)(e[t],"data-wave");Object(i.hasClass)(e[t],"audio-msg-player")&&t>0&&(n=Object(i.attr)(e[t-1],"data-wave"));var a=ha(e[t]);if(n&&a){n=n.split(",");for(var o=geByClass("audio-msg-track--wave",e[t]),r=ma(n,a/4),s=0;s<o.length;s++){var l=Object(i.ce)("div",{innerHTML:r}).firstChild;o[s].parentNode.replaceChild(l,o[s])}}}}function ga(){return pa||(pa=new da({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),pa}addEvent(window,"orientationchange",(function(){return setTimeout(va,500)})),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(va),window.mail.onMessagesRepainted(va)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t){var n=ga(),i=n.attachTo(e);!0===i?n.play():i.then((function(){n.play()}))},detachPlayer:function(e){ga().detach(e)},pauseGlobalMedia:function(){da.pauseGlobalMedia()},resumeGlobalMedia:function(){da.resumeGlobalMedia()},redrawWaves:va,getWave:ma};var Aa=n("hw56"),ba=Array.isArray,ya={mail:{}},wa={injectStore:function(e){ya.mail={};var t=e.mail,n=t.cur,i=t.rolls,a=t.reached;t.msgs,t.queue;ba(e.mail.msgs)&&(e.mail.msgs={}),ba(e.mail.replies)&&(e.mail.replies={}),i&&ba(i.peer)&&(i.peer={}),i&&ba(i.search.peers)&&(i.search.peers={}),i&&ba(i.search.msgs)&&(i.search.msgs={}),a&&ba(a.search.peers)&&(a.search.peers={}),a&&ba(a.search.msgs)&&(a.search.msgs={}),a&&ba(a.peer.before)&&(a.peer.before={}),a&&ba(a.peer.after)&&(a.peer.after={}),ya.mail=e.mail,ya.mail.pendingReplies={},ya.mail.presend={},n&&(n.msgSelected={},n.msgRemoved={},n.msgAttached={},n.msgReply={},n.keyboards={},n.typings={},n.peerMembers={}),"notificationsCount"in ya||(ya.notificationsCount=e.notificationsCount),"menuNotifications"in ya||(ya.menuNotifications=e.menuNotifications),Array.isArray(n.drafts)?n.drafts={}:n.drafts&&(Object(Aa.loadDrafts)(n.viewerId),Object.keys(n.drafts).forEach((function(e){var t=n.drafts[e];Object(Aa.setPeerDraft)(n.viewerId,e,t)})))},injectMail:function(e){var t=ya.mail,n=e,i=isObject(t.peers)&&isObject(n.peers)&&Object.assign({},t.peers);isObject(n.msgs)&&Object.assign(t.msgs,n.msgs),isObject(n.peers)&&Object.assign(t.peers,n.peers),isObject(n.members)&&Object.assign(t.members,n.members),isObject(n.replies)&&Object.assign(t.replies,n.replies),isObject(n.forwards)&&Object.assign(t.forwards,n.forwards),t.page=n.page,n.mrs&&(t.cur.countMR=n.mrs.count,t.rolls.mrs=n.mrs.rolls,t.reached.mrs=n.mrs.reached,t.scraps.mrs=n.mrs.rolls,Object.keys(n.msgs).forEach((function(e){var i=n.msgs[e],a=i.peerId;t.rolls.peer[a]=[i.id],t.reached.peer.after[a]=!0})),t.mrs=n.mrs),i&&Object.keys(i).forEach((function(e){t.peers[e]&&(t.peers[e].peerProfileData=i[e].peerProfileData)}))},injectMsg:function(e){var t;wa.injectMail({msgs:(t={},t[e.id]=e,t)})},resetMail:function(){ya.mail={}}};window.storeMethods=wa,window.store=ya;n("Mc5h");var Sa=n("O5lf"),ka=n("9y81"),Oa=(n("AXyT"),n("gy8s"),n("KMpi"),n("AgBx"),{_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),Object(i.remove)(Object(i.geByClass1)(Oa.class.btn))},class:{btn:"FloatBtn"}});Oa.class=Object(E.default)({},Oa.class,{open:Oa.class.btn+"_open"});var Ca=Oa,ja={addContent:function(e,t){t&&Object(M.$$)(Ea(e)).forEach((function(e){var n=e.$(Ta)||e;e.classList.remove(Ia),n.insertAdjacentHTML("beforeend",t)}))}};window.Pad=ja;var Ea=function(e){return'.Pad[data-id="'+e+'"]'},Ta=".Pad__content",Ia="Pad_empty";var Ma=Object(i.need)("scrollToEl");Object(i.need)("page").onChange(xa);var Pa=function(e){return".Anchor#"+e};function xa(){var e=window.nav&&window.nav.cur;if(e){var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&Object(M.$)(Pa(t));n&&Ma(n)}}window.Select={},Select._onChange=Ba;var La=function(e){return'.Select__option[value="'+e+'"]'};function Ba(e,t){var n=e.value,i=e.form,a=e.$(La(n));c.default.handle(t,{$select:e,$option:a,$form:i,value:n,name:e.name,label:a.textContent})}var Ra=n("Q8gl");window.LoadMore={setUrl:Ua,destroy:Fa},LoadMore._strategy={replace:{onFail:Xa,onSuccess:function(e){var t=e.response;Ha.outerHTML=t,Fa()}},padsExtend:{onFail:Xa,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach((function(e){var t=n[e];ja.addContent(e,t)})),i?Ua(i):Fa()}}},LoadMore._onButtonClick=$a,onDOMReady(Wa),page.onChange(Wa);var Da=".LoadMore",Na=".LoadMore__button",Ha=null,Va=null;function Ua(e){Va.setAttribute("href",e)}function Fa(e){Ha.remove(),Ha=null,Va=null,za()}function $a(){Ka()||Ya()}function Wa(){if(Ha=Object(M.$)(Da)){var e=window.cur;Va=Ha.$(Na),qa(0),Object(i.onBodyScroll)(qa),e.destroy.push(za)}}function qa(e){if(Ha&&!Ka()){var t=Object(i.getY)(Ha),n=Object(i.getCh)();t-(e+n)<2*n&&Ya()}}function za(){Object(i.onBodyScroll)("__clear",qa)}function Ya(){Qa(!0);var e=Va.getAttribute("href");j.default.post(e,{_ajax:1},{onDone:function(e){return Ga(e,!0)},onFail:function(e){return Ga(e,!1)}})}function Ga(e,t){if(Qa(!1),Ha){var n=t?"data-success-handler":"data-fail-handler";n=Ha.getAttribute(n),Wd.handle(n,{$loadMore:Ha,response:e}),Ha=null,Va=null,za(),Wa()}}function Qa(e){Va&&Ha&&(bi.default.setLoading(Va,e),Ha._loadMore_loading=e)}function Ka(){return Ha&&Ha._loadMore_loading}function Xa(e){console.error("LoadMore: failed to load more",e)}var Ja=n("v+Uj");window.SliderTabs={},SliderTabs._onClick=co,onDOMReady(lo),page.onChange(oo),page.onRestore(ro);var Za="SliderTabs",eo="Slider__scroll",to="SliderTabs__tab_selected",no={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+eo,container:"."+Za},io="",ao=0;function oo(){var e=Object(i.ge)(io),t=Object(M.$)(no.container);e?Object(M.$)(no.scroll,e).scrollLeft=ao:t?so():(io="",ao=0)}function ro(){setTimeout((function(){var e=Object(i.ge)(io);if(e){var t=Array.from(Object(M.$$)(no.tab,e));if(t)t.some((function(e){return e.getAttribute("href")===nav.cur}))&&t.forEach((function(e){e.getAttribute("href")===nav.cur?e.classList.add(to):e.classList.remove(to)}))}}))}function so(){var e=Object(M.$$)(no.container),t=Math.min(Object(i.getCw)(),882);e.forEach((function(e){var n=Object(M.$)(no.scroll,e),a=Object(M.$)(no.active,e);if(a){var o=a.offsetWidth,r=Object(i.getX)(a);r+o>t&&(n.scrollLeft=r-t+o,console.log("$scroll.scrollLeft scrollAllToActiveTab",n.scrollLeft))}}))}function lo(){so()}function co(e,t){var n=Object(i.gpeByClass)(Za,t),a=Object(i.gpeByClass)(eo,t),o=Object(M.$)(no.active,n);return o&&o.classList.remove(to),t.classList.add(to),ao=a.scrollLeft,io=Object(i.attr)(n,"id"),!0}window.SearchPanel={setQuery:function(e,t){var n=Object(M.$)(po(e));t=t||"",n.value!==t&&(n.value=t,go(n,t))}},SearchPanel._onInput=mo,SearchPanel._onClearClick=vo,SearchPanel._onFocus=ho;var uo="SearchPanel_hasQuery",_o=".SearchPanel",fo=".SearchPanel__input",po=function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'};function ho(){}function mo(e,t){var n=e.value;go(e,n),c.default.handle(t,{query:n})}function vo(e,t){var n=e.closest(_o).$(fo);n.value="",n.oninput(),c.default.handle(t)}function go(e,t){e.closest(_o).classList.toggle(uo,!!t)}window.TabRow={setSelectedTab:function(e,t){var n=Object(M.$)(bo(e)),i=Object(M.$)(wo,n),a=Object(M.$)(yo(t),n);i&&i.classList.remove(Ao),a&&a.classList.add(Ao)},setTabUrl:function(e,t,n){var i=Object(M.$)(bo(e)),a=Object(M.$)(yo(t),i);a&&a.setAttribute("href",n)}};var Ao="TabRow__tab_selected",bo=function(e){return'.TabRow[data-id="'+e+'"]'},yo=function(e){return'.TabRow__tab[data-id="'+e+'"]'},wo=".TabRow__tab_selected";window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=Eo,SwitcherConfirm._onConfirmClick=To,SwitcherConfirm._onCancelClick=function(e){return Io(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return Io(e.$popup)};var So=function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")},ko=".SwitcherConfirm",Oo=".SwitcherConfirm__popup",Co=".SwitcherConfirm__confirm",jo=".SwitcherConfirm__cancel";function Eo(e){var t=e.$control,n=t.closest(ko),i=Object(M.$)(Oo,n);cn.default.open(i),n.$popup=i,n.$control=t,n.checked=e.checked}function To(e,t){var n=t.$btn.closest(ko),i=Object(M.$)(Co,n),a=Object(M.$)(jo,n),o=n.checked;n.isSaving=!0,bi.default.setLoading(i,!0),bi.default.setDisabled(a,!0),Wd.handle(e,{checked:o,onSuccess:function(){n.isSaving=!1,cn.default.close(n.$popup),bi.default.setLoading(i,!1),bi.default.setDisabled(a,!1),n.classList.toggle(So(!0),o),n.classList.toggle(So(!1),!o)}})}function Io(e){var t=e.closest(ko);t.isSaving||(Ra.default.setChecked(t.$control,!t.checked),cn.default.close(t.$popup))}var Mo=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,i=e.title?e.title:"",a=e.subtitle?e.subtitle:"",o=e.verified?e.verified:"",r=e.mix?e.mix:"",l=e.type||null,c=e.online?e.online:"",u=!!e.actions&&e.actions,d=!!e.attrs&&e.attrs,_=!!e.linkAttrs&&e.linkAttrs,f=!!e.icon&&e.icon,p="artist"!==l||t?null:{class:"OwnerRow__placeholderWrapper",inner:Object(T.default)("audio","music_mic_outline_28")};return{attrs:d,class:[s.default.class("OwnerRow",{actions:!!u}),r],inner:[{class:"OwnerRow__content",href:n,attrs:_,inner:[{class:"OwnerRow__left",inner:f||{style:f?null:t?"background-image: url('"+t+"')":null,class:"OwnerRow__img",inner:[c?[c.mobile?{inner:[{inner:[Object(T.default)({sprite:"base",name:"online_mobile_composite_16"})],class:"mlvi_default",tag:"span"},{inner:[Object(T.default)({sprite:"base",name:"online_mobile_composite_muted_16"})],class:"mlvi_muted",tag:"span"}],class:"lvi mlvi OwnerRow__online OwnerRow__online--mobile","aria-label":Object(F.getLang)("mobile_accessibility_profile_online"),tag:"b"}:{class:"lvi OwnerRow__online","aria-label":Object(F.getLang)("mobile_accessibility_profile_online"),tag:"b"}]:null,p]}},{class:"OwnerRow__right",inner:[{class:s.default.class("OwnerRow__header",{verified:o}),inner:[{class:"OwnerRow__title",inner:i},o?{class:"OwnerRow__verified"}:null]},{class:"OwnerRow__subtitle",inner:a}]}]},u?{class:"OwnerRow__actions",inner:u}:null]}};var Po=Mo;window.OwnerRow=Mo;var xo=function(e){var t=e.items?e.items:[];return{inner:[(t=t.filter((function(e){return e}))).map((function(e){var t=s.default.class("OwnerInfo__row",{extraMargin:e.extraMargin,gray:e.gray,black:e.black},"--");return{inner:[e.href?{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],href:e.href,class:"OwnerInfo__rowInfo",tag:"a"}:{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],class:"OwnerInfo__rowInfo",tag:"div"},e.right?{inner:[e.right],class:"OwnerInfo__rowRight",tag:"div"}:null],class:t,tag:"div"}}))],class:s.default.class("OwnerInfo",{noMargin:e.noMargin},"--"),tag:"div"}};window.OwnerInfo=xo;var Lo=function(e){return{inner:[{inner:[{inner:[(e.items?e.items:[]).map((function(e){return{inner:[Wd.wrap(e)],class:"OwnerPhotoGallery__item",tag:"div"}}))],class:"OwnerPhotoGallery__table",tag:"div"}],class:"OwnerPhotoGallery__wrap",tag:"div"}],class:"OwnerPhotoGallery",tag:"div"}};window.OwnerPhotoGallery=Lo;n("tlMv"),n("UWnA");var Bo=function(){function e(){}return e.findButtonInEvent=function(e){return e.target.closest(".Btn")},e.onChange=function(t,n){if(void 0===n&&(n=""),"file"===n){var a=t.target.files;if(a&&a[0]){var o=Object(ri.replaceEntities)(a[0].name),r=e.findButtonInEvent(t),s=Object(M.$)(".MobileInput__text",r);Object(i.val)(s,o)}}},e}();window.MobileInput=Bo;n("QQoL"),n("rKUZ");var Ro=Object(i.need)("ajax"),Do=Object(i.need)("onDOMReady"),No=Object(i.need)("onBodyResize");window.CookiePolicy={},Do(Fo),CookiePolicy._onHideClick=Wo;var Ho="body",Vo="._hfixed",Uo=".CookiePolicy";function Fo(){Object(M.$)(Uo)&&($o(),No($o))}function $o(){if(Object(M.$)(Vo)){var e=Object(M.$)(Ho),t=Object(M.$)(Uo).offsetHeight,n=parseInt(getComputedStyle(e).paddingBottom,10);e.style.paddingBottom=n+t+7+"px"}}function Wo(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(Uo).style.display="none",No("__clear",$o),Ro.post(n,{_ajax:1})}var qo=Object(i.need)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=Yo;var zo=".PrivacyPolicy__submit";function Yo(e){var t=e.checked,n=Object(M.$)(zo);qo.setDisabled(n,!t)}n("nj7l");onDOMReady((function(){window.page.onChange((function(){Object(M.$$)(".ConfirmPopup").forEach((function(e){return cn.default.close(e)}))}))})),window.ConfirmPopup={onOverlayClick:function(e,t){var n=e.closest(".Popup");Object(M.$)('[data-key="no"]',n).click()},onButtonClick:function(e,t){t.preventDefault(),t.stopPropagation();var n=Object(dt.parseURL)(e.href),a=n.pathname+n.search,o=Object(dt.parseURL)(nav.prev_cur),r=o.pathname+o.search;if("no"===Object(i.domData)(e,"key")&&a===r&&"1"!==Object(i.domData)(e,"force")){var s=e.closest(".Popup");return history.back(),cn.default.close(s)}nav.go(a)}};var Go=function(){function e(){}return e.hideDisclaimerAndPlay=function(){Object(M.$)(".VideoRestriction__boxWrap").remove(),Object(M.$)(".VideoRestriction__thumb").remove(),Object(M.$)(".vv_inline_video").play(),Object(M.$)(".VideoRestriction").setAttribute("class","")},e}();window.VideoRestriction=Go;n("Qg0H");var Qo=function(e){var t=e.bcg,n=t.type;return{class:s.default.class("VotingBcg",{type:n}),style:"photo"===n?Ko(t):"gradient"===n?Xo(t):"tile"===n?Jo(t):null,inner:"photo"===n?Zo(e):null}};function Ko(e){return er({"background-color":e.color})}function Xo(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var a=e.points[t];n.push(a.color+" "+a.percent+"%")}return er({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function Jo(e){return er({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function Zo(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:er({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:er({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:er({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function er(e){var t,n=[],i=Object.keys(e),a=i.length;for(t=0;t<a;t++){var o=i[t],r=e[o];n.push(o+": "+r+";")}return n.join(" ")}var tr=Qo;window.VotingBcg=Qo;var nr=function(e,t){return{tag:"label",class:s.default.class("VotingForm__bcg",{light:"default"===t.type}),inner:[{class:"VotingForm__bcgPreview",inner:[tr({bcg:t,photoHeight:48}),{class:s.default.class("VotingForm__bcgTextGhost",{0:!0})},{class:s.default.class("VotingForm__bcgTextGhost",{1:!0})},{class:s.default.class("VotingForm__bcgTextGhost",{2:!0})},{class:s.default.class("VotingForm__bcgTextGhost",{3:!0})},{class:s.default.class("VotingForm__bcgTextGhost",{4:!0})},{class:s.default.class("VotingForm__bcgTextGhost",{5:!0})}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}};var ir=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[Object(Fi.default)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:c.default.wrap(Object(ka.default)({icon:"close16"}))}]}};var ar=Object(i.need)("Slider");window.VotingForm={},VotingForm._onInit=Ar,VotingForm._onAddOptionClick=gr,VotingForm._onExpireChange=yr,VotingForm._onOptionRemoveClick=wr,VotingForm._onTitleKeyDown=hr,VotingForm._onTitleInput=mr,VotingForm._onOptionKeyDown=vr,mediaUpload.onComplete(Or),mediaUpload.onStart(Cr),mediaUpload.onError(jr);var or="VotingForm_uploading",rr="VotingForm_withExpire",sr="VotingForm_maxOptions",lr=".VotingForm",cr=".VotingForm_maxOptions",ur=".VotingForm__option",dr=".VotingForm__options",_r=".VotingForm__upload",fr=".VotingForm__bcg",pr=".VotingForm__bcgRadio:checked";function hr(e){13===e.keyCode&&e.preventDefault()}function mr(e){var t=+attr(e,"maxlength"),n=Object(M.$)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function vr(e){if(hr(e),13===e.keyCode){if(!Object(M.$)(cr))if(Object(M.$)(".VotingForm__option:last-child input")===document.activeElement)return br(),void Object(M.$)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(8===e.keyCode){if(1===Object(M.$$)(".VotingForm__option").length)return;var i=e.target;i.value||setTimeout((function(){var e=i.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",kr(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}}))}}function gr(){br(),Object(M.$)(".VotingForm__option:last-child input").focus()}function Ar(){var e=Object(M.$)(pr).closest(fr);ar.scrollToElem(e)}function br(){var e=Object(M.$)(dr),t=ir({});e.insertAdjacentHTML("beforeend",Wd.html(t)),Sr(),kr()}function yr(e){var t=e.$control,n=e.checked;t.closest(lr).classList.toggle(rr,n)}function wr(e){e.closest(ur).outerHTML="",Sr(),kr()}function Sr(){Array.from(Object(M.$$)('.VotingForm__option[data-created="0"] input')).forEach((function(e,t){e.setAttribute("name","answers["+t+"]")}))}function kr(){var e=Object(M.$)(lr),t=Number(e.getAttribute("data-max-options")),n=Object(M.$$)(ur).length;e.classList.toggle(sr,n===t)}function Or(e){if(Object(M.$)(lr)){var t=Object(M.$)(_r),n=Wd.html(nr("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),Er()}}function Cr(){var e=Object(M.$)(_r);e&&e.classList.add(or)}function jr(e){var t=Object(M.$)(lr);if(t){var n=t.getAttribute("data-upload-error-msg");Er(),alert(n)}}function Er(){var e=Object(M.$)(lr);Object(M.$)(_r).outerHTML=e.getAttribute("data-upload-html")}window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=Mr;var Tr=".VotingStatsFilters__section_country",Ir=".VotingStatsFilters__section_city";function Mr(e){var t=e.$option,n=Object(M.$)(Tr),i=Object(M.$)(Ir),a=t.getAttribute("data-city-section-html");i&&(i.outerHTML=""),a&&n.insertAdjacentHTML("afterend",a)}var Pr=window.Popup,xr=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=Nr,AuthCheck._onResetSessionSubmit=Hr,AuthCheck._onCurBrowserDropClick=Vr;var Lr=function(e){return".AuthCheck__popup_index_"+e},Br=function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},Rr=".AuthCheck__dropConfirmationSubmit",Dr="AuthCheck__dropConfirmation_success";function Nr(e){var t=Object(M.$)(Lr(e));Pr.open(t)}function Hr(e,t){e.preventDefault();var n=e.target,i=Object(M.$)('iframe[name="'+e.target.target+'"]'),a=n.$(Rr);n.submit(),xr.setLoading(a,!0),addEvent(i,"load",(function(){Object(M.$)(Br(t)).classList.toggle(Dr),Pr.close(),xr.setLoading(a,!1)}))}function Vr(e){var t=e.$btn;xr.setLoading(t,!0),ajax.click(t,{onDone:function(){Object(M.$)(Br("0")).classList.toggle(Dr),Pr.close(),xr.setLoading(t,!1)}})}function Ur(){var e=Object(M.$)(Fr.intro),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push((function(){return t.destroy()}))}window.AppPasswords=new function(){this.showPopup=function(){return Popup.open(Object(M.$)(".AppPasswordsPopup"))},this.hidePopup=function(){return Popup.close(Object(M.$)(".AppPasswordsPopup"))}},window.AuthCheckIntro={},AuthCheckIntro._onMount=Ur;var Fr={intro:".AuthCheckIntro"};function $r(){Object(M.$)(Wr.self).classList.toggle(qr.restCodesShown)}window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=$r;var Wr={self:".ReservedCodes"},qr={restCodesShown:"ReservedCodes_restCodesShown"};window.Settings={_privacy:{}},Settings._privacy.onRadioChange=Jr;var zr=function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},Yr=".Settings__privacySubmitRow",Gr=".Settings__privacyForm",Qr=".Settings__privacySelectForbiddenLink",Kr="Settings__privacyPad_visible",Xr="Settings__privacySubmitRow_visible";function Jr(e,t){if("none"===e)Zr("allowed",!1),Zr("forbidden",!1),es(!0);else if("allowed"===e)Zr("allowed",!0),Zr("forbidden",!1),es(!1);else if("forbidden"===e){Zr("allowed",!1),Zr("forbidden",!0),es(!0);var n=Object(M.$)(Gr),i=Object(M.$)(Qr),a=t.name,o=t.value,r=n.getAttribute("action")+"&"+a+"="+o+"&forbid";i.setAttribute("href",r)}}function Zr(e,t){Object(M.$)(zr(e)).classList.toggle(Kr,t)}function es(e){Object(M.$)(Yr).classList.toggle(Xr,e)}window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("LoginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",(function(){return nav.go(n,null,{isForm:!0})}))},showResetSessionModal:function(e,t,n){var i=Object(K.default)({close:!0,items:[Object(X.ModalMenuBtn)({class:"ai_add",inner:getLang("mobile_settings_activity_session_reset_title"),onclick:"LoginHistory.resetSession('"+e+"', '"+t+"', '"+n+"');Popup.close(this);"})]});return K.default.open(c.default.elem(i),!0),!1},resetSession:function(e,t,n){ajax.post(e,{reset_data:t,hash:n})}},window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),Object(i.statlogsValueEvent)("settings_menu_click",e),t?ae.default.hard_go(e):ae.default.go(e),!1}};n("vOib");window.Subscriptions={editSubscription:function(e,t){if(t.context_actions){var n=Wd.html(t.context_actions.map((function(e){return Object(le.ContextMenuItem)({title:e.title,href:e.href})}))),i=Wd.elem(Object(le.ContextMenu)({list:n}));i.parentNode.id="container",le.ContextMenu.open(i,"#container",{appendToBody:!0})}}};var ts,ns,is=function(){function e(e){var t=e.selector,n=e.className;this.element=Object(M.$)(t),this.className=n}var t=e.prototype;return t.show=function(){this.element.classList.add(this.className)},t.hide=function(){this.element.classList.remove(this.className)},e}(),as=function(e){function t(){return e.call(this,{selector:".Appearance__fixedSchemes",className:"Appearance__fixedSchemes--active"})||this}return Object(ai.default)(t,e),t}(is),os=function(e){function t(){return e.call(this,{selector:".Appearance__autoSwitcher",className:"Appearance__autoSwitcher--active"})||this}return Object(ai.default)(t,e),t}(is);function ss(e){var t=e.mode;a.ColorScheme.isSchemesAutoSwitchingSupported()?ns.show():ts.show(),t===a.ColorSchemeMode.Auto&&a.ColorScheme.isSchemesAutoSwitchingSupported()?ts.hide():ts.show();var n=Object(M.$)("[name='mode'][value='"+t+"']");n&&(n.checked=!0)}function cs(e,t){var n={mode:t,_ajax:1};j.default.post(e,n),a.colorScheme.setMode(t),ss({mode:t})}window.Appearance={init:function(){if(a.ColorScheme.isSchemesSupported()){ts=new as,ns=new os;var e=a.colorScheme.getMode();a.ColorScheme.isSchemesAutoSwitchingSupported()||e!==a.ColorSchemeMode.Auto||(e=a.ColorSchemeMode.Light),ss({mode:e})}},switchOnChange:function(e,t){var n=t.checked,i=a.colorScheme.isDarkScheme()?a.ColorSchemeMode.Dark:a.ColorSchemeMode.Light;cs(e,n?a.ColorSchemeMode.Auto:i)},radioOnChange:function(e,t){cs(e,t.value)}};n("yVza"),n("0hva");var us=n("EXR0"),ds=n("GtpT"),_s=n("k+Df"),fs=n("g3t9");var ps=function(e){var t=window.lang,n=(e.albums||[]).map((function(e){var t=Object(dt.makeUrl)(e.url,{act:"add"});return Object(ds.default)({onClick:["AddPhotoModal.go",t,"this"],album:e})}));return{inner:[Object(us.default)({inner:[t.mobile_photos_choose_album_modal_title],onClose:"AddPhotoModal.close(this)"}),n.length?Object(X.ModalMenuContent)({inner:[e.link.createAlbum?Object(bi.default)({inner:[t.mobile_photos_choose_album_modal_create_album],class:"AddPhotoModal__createAlbum",theme:"secondary",stretch:!0,onClick:["AddPhotoModal.go",e.link.createAlbum]}):null,{inner:[n],class:"ScrollView",tag:"div"}],class:"AddPhotoModal__content"}):Object(_s.default)({separator:!0,separator_desktop:!0,text:t.mobile_photos_choose_album_modal_empty_text,more_type:"primary",more_text:e.link.createAlbum?t.mobile_photos_placeholder_album_action:null,more_url:e.link.createAlbum,more_onclick:["AddPhotoModal.go",e.link.createAlbum]})],class:"AddPhotoModal",tag:"div"}},hs="AddPhotoModal";function ms(e){var t=e.closest("."+hs);K.default.close(t)}window.AddPhotoModal={open:function(){var e=Object(F.getState)("upload_albums"),t=Object(F.getState)("AddPhotoModal"),n=Object(K.default)({on_overlay_click:"AddPhotoModal.close(this)",class:hs,attached:!0,body:ps({link:{createAlbum:t.owner_id>0&&"/photos?act=select_album"},albums:e})});return K.default.open(Wd.elem(n),!0,"",{expandable:!0})},close:ms,go:function(e,t){void 0===t&&(t=null),nav.go(e),t&&t.hasOwnProperty("$btn")?ms(t.$btn):ms(t)}},window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";Object(i.statlogsValueEvent)("lovina_promotion",t?1:0),window.nav.hard_go(n)}},window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=Object(M.$)(vs.special);t&&t.classList.toggle(gs,e)}};var vs={special:window.AudioSpecialForYou.selector},gs="AudioSpecialForYou_playing";var As=function(){function e(e){this.store=Stories.getStore(),this.data=e,this.raw_id=e.raw_id,this.can_remove=e.can_remove,this.can_report=e.can_report,this.can_bookmark=e.can_bookmark,this.canMarkNotInterested=e.canMarkNotInterested,this.is_bookmarked=e.is_bookmarked,this.is_narrative=!!e.narrative,this.reportUrl=this.getReportUrl()}var t=e.prototype;return t.needMenu=function(){return this.can_remove||this.can_report||this.can_bookmark||this.canMarkNotInterested},t.getReportUrl=function(){return"/reports?act=add&object="+Stories.getHistoryURL(this.raw_id)+"&refrom="+Stories.getFrom()},t.render=function(){return Wd.html({inner:[{inner:[{class:"Story__icon Story__icon_menu",tag:"div"}],class:"StoryMenu__trigger",onClick:"Stories.showMenu();",tag:"div"},{inner:[this.can_bookmark?{inner:[{inner:[this.is_bookmarked?Object(F.getLang)("mobile_stories_menu_bookmarked_title"):Object(F.getLang)("mobile_stories_menu_bookmark_title")],class:"StoryMenu__button",onClick:"Stories.toggleBookmark(this);",tag:"div"}],class:"StoryMenu__row",tag:"div"}:null,this.can_remove?{inner:[{inner:[this.is_narrative?Object(F.getLang)("mobile_stories_menu_remove_narrative_title"):Object(F.getLang)("mobile_stories_menu_remove_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStory();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.can_report?{inner:[{inner:[Object(F.getLang)("mobile_stories_menu_report_title")],class:"Btn Btn_theme_none StoryMenu__button",href:this.reportUrl,onClick:"return nav.go(this, event);",tag:"a"}],class:"StoryMenu__row",tag:"div"}:null,this.canMarkNotInterested?{inner:[{inner:[Object(F.getLang)("mobile_stories_menu_not_interested_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.markCurrentStoryNotInterested();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null],class:"StoryMenu__container",tag:"div"}],class:"StoryMenu",tag:"div"})},e}(),bs=function(){function e(e,t,n,i){if(this.store=Stories.getStore(),this.state={authorIndex:n,storyIndex:i},this.date=e.date,this.preview=e.preview_url,this.type=e.type,this.photo_url=e.photo_url,this.video_url=e.video_url,this.first_frame=e.first_frame,this.loaded=!1,this.videoSupport=!!window.HTMLVideoElement,this.views=e.views,this.replies=e.replies,this.link=e.link,this.unread=e.unread,this.raw_id=e.raw_id,this.is_expired=e.is_expired,this.isPrivate=e.is_private,this.isDeleted=e.is_deleted,this.isAds=e.isAds,this.isPromo=e.isPromo,this.promoCaption=e.promoCaption,this.track_code=e.track_code,this.can_comment=e.can_comment,this.canLike=e.canLike,this.can_share=e.can_share,this.can_remove=e.can_remove,this.can_report=!e.can_manage,this.can_ask=e.can_ask,this.can_ask_anonymous=e.can_ask_anonymous,this.canPause="video"!==this.type,this.seeking=!1,this.progress=0,this.needShowEmptyStats=e.needShowEmptyStats,this.accessKey=e.accessKey,this.isNewQuestions=e.isNewQuestions,this.isLiked=e.isLiked,this.name=t.name,this.authorId=t.id,this.firstName=t.firstName,this.avatar=t.photo,this.href=t.href,this.prometheus=t.verify.includes("page_top_author"),this.verified=t.verify.includes("page_verified"),this.authorIcon=this.prometheus||this.verified,this.content=null,this.paused=!0,this.stats=e.stats,this.narrative=e.narrative,this.app=e.app,this.isMetaStory=!!e.is_groups_meta_story||!!e.is_apps_meta_story,this.isGroupsMetaStory=!!e.is_groups_meta_story,this.isAppsMetaStory=!!e.is_apps_meta_story,this.isOneTime=e.isOneTime&&t.id!==vk.id,this.isOneTimeSeen=e.isOneTimeSeen,this.seenProgress=this.isOneTime?e.seenProgress:null,this.onAutoPlay=Object(l.default)(),this.onDestroy=Object(l.default)(),this.onVideoBuffering=Object(l.default)(),this.onVideoData=Object(l.default)(),this.onVideoPlayEvent=Object(l.default)(),this.onVideoPauseEvent=Object(l.default)(),this.onVideoEndedEvent=Object(l.default)(),this.reply=e.reply_to,this.reply){var a=this.reply.list;this.reply=extend(this.reply,{onclick:'Stories.openReplies("'+a+'");'})}this.duration=8e3,this.bookmark_add_hash=e.bookmark_add_hash,this.is_bookmarked=e.is_bookmarked,this.clickable_stickers=e.clickable_stickers,this.stickers=[],this.narrative&&(this.bookmark_add_hash=this.narrative.bookmark_hash,this.is_bookmarked=this.narrative.is_bookmarked),this.StoryMenu=new As(extend(e,{can_report:this.can_report,can_bookmark:!!this.bookmark_add_hash,is_bookmarked:this.is_bookmarked})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=Stories.getCurrentStoryIndex(),n=Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),Stories.setHistory(this.raw_id)):(this.destroy(),val(e,""))},t.setStartTime=function(){this.seenProgress&&(this.startTime=+(this.seenProgress/100*this.getDuration()).toFixed(1))},t.getStartTime=function(){return this.startTime||0},t.getProgressPercentByLeftTime=function(e){return 100-Math.min(Math.max(e,0)/this.getDuration()*100,100)||0},t.getDuration=function(){return this.duration},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=Stories.getFrom(!1);return dt.default.make(e,{from:t})},t.cantSee=function(){return this.isPrivate||this.is_expired||this.isOneTimeSeen||this.isDeleted},t.loadContent=function(e){var t=window.lang;if(this.cantSee()){Stories.hideLoading();var n="";this.is_expired?n=c.default.wrap(t.mobile_stories_error_expired):this.isDeleted?n=c.default.wrap(t.mobile_stories_error_deleted):this.isPrivate&&(n=c.default.wrap(t.mobile_stories_error_private));var i={class:"Story__contentError",inner:this.isOneTimeSeen?[Object(T.default)("stories","bomb_outline_56"),{tag:"span",class:"Story__contentErrorText Story__contentErrorText--oneTimeSeen",inner:n}]:n},a=Stories.getCurrentAuthorEl();addClass(a,Ss),val(e,c.default.html(i)),Stories.restoreAudio()}else if("photo"===this.type){this.isMetaStory||Stories.showLoading(),this.img=new Image,this.onLoadImgBind=this.onLoadImg.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.img,"load",this.onLoadImgBind),addEvent(this.img,"load",this.onLoadStory),this.img.src=this.photo_url;var o={style:"background-image: url("+this.photo_url+")",class:"Story__content_image"};this.isGroupsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",c.default.html(this.renderGroupsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):this.isAppsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",c.default.html(this.renderAppsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):val(e,c.default.html(o)),Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&Stories.isAutoplaySupport())Stories.showLoading(),this.video=ce("video",{src:this.video_url,className:"Story__content_video"}),attr(this.video,"playsinline","playsinline"),attr(this.video,"webkit-playsinline","webkit-playsinline"),attr(this.video,"muted",!0),this.video.muted=!0,this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoFirstDataLoadedBind=this.onVideoFirstDataLoaded.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),this.onVideoSeekingBind=this.onVideoSeeking.bind(this),this.onVideoSeekedBind=this.onVideoSeeked.bind(this),addEvent(this.video,"ended",this.onVideoEndedBind),addEvent(this.video,"play",this.onVideoPlayBind),addEvent(this.video,"pause",this.onVideoPauseBind),addEvent(this.video,"canplaythrough",this.onCanPlayBind),addEvent(this.video,"waiting",this.onVideoWaitingBind),addEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),addEvent(this.video,"loadeddata",this.onVideoFirstDataLoadedBind),addEvent(this.video,"canplaythrough",this.onLoadStory),addEvent(this.video,"playing",this.onVideoPlayingBind),addEvent(this.video,"seeking",this.onVideoSeekingBind),addEvent(this.video,"seeked",this.onVideoSeekedBind),append(this.video,e),this.video.load(),Stories.restoreAudio(),Stories.pauseAudio();else{var r=Stories.getAuthorElems()[this.state.authorIndex];this.renderError(r,e,t.mobile_stories_inline_video_error)}},t.onLoadStory=function(){if(this.loaded=!0,this.clickable_stickers){var e=geByClass1("Story",this.authorElem);e&&this.renderStickersLayer.call(this,e)}if(this._loadingStartTime){this.loadingTime=Date.now()-this._loadingStartTime,Stories._sendViewerStartTime(this.raw_id,this.loadingTime),this._loadingStartTime=0;var t=this.isMetaStory?"group_feed_view":"view_story";Stories.sendAnalyticsEvent(t,{preloading_duration:this.loadingTime})}this.isMetaStory||this.isOneTime||Stories.markSeenStory()},t.isLoaded=function(){return this.loaded},t.onVideoSeeking=function(){this.seeking=!0,Stories.showLoading(),this.onVideoBuffer()},t.onVideoSeeked=function(){this.seeking=!1,this.onVideoPlay()},t.markSeen=function(){this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){!this.paused&&this.canPause&&(this.paused=!0,this.video&&!this.video.paused&&this.video.pause())},t.play=function(){this.paused&&(this.paused=!1,this.video&&this.video.play())},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.buffering=!1,Stories.hideLoading(),this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onLoadImg=function(){Stories.hideLoading(),this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoBuffer=function(){this.buffering=!0,Stories.showLoading(),this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoFirstDataLoaded=function(){var e=+(this.getStartTime()/1e3).toFixed(1);this.video.currentTime<e&&(this.video.currentTime=e)},t.onCanPlay=function(){Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var i=this,a={class:"Story__content_expired",inner:c.default.wrap(n)};val(t,c.default.html(a)),Stories.hideLoading(),this.type="broken",addClass(e,Ss),requestAnimationFrame((function(){i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})}))},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(F.isArray)(t))&&t.some((function(t){return t.type===e}))},t.getSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(F.isArray)(t))&&t.find((function(t){return t.type===e}))},t.render=function(){var e,t,n=window,i=n.lang,a=n.winToUtf;addEvent(window,"resize",this._onResizeHandle.bind(this));var o=C.isTouch?"ontouchstart":"onmousedown",r=C.isTouch?"ontouchend":"onmouseup";this._onLoadingStart();var s=this.hasSticker(ks.storyReply),l=this.date;return this.isPromo?l=this.promoCaption:this.isAds?l=i.mobile_stories_is_promo_title:this.narrative&&(l=i.global_type_narrative+" · "+this.narrative.title),c.default.html({class:"Story",inner:[{class:"Story__header",inner:[this.reply&&!s?{class:"Story__reply",inner:this.reply.is_deleted||this.reply.is_private||this.reply.is_expired?{class:"Story__replyDeleted",inner:{class:"Story__replyDeletedContainer",inner:[{class:Bem.class("Story__icon",{deleted:this.reply.is_deleted,private:this.reply.is_private||this.reply.is_expired})},{class:"Story__replyDeletedTitle",inner:this.reply.is_deleted?i.mobile_stories_reply_deleted_title:this.reply.is_expired?i.mobile_stories_reply_expired_title:i.mobile_stories_reply_private_title}]}}:{class:"Story__replyPreview",onclick:this.reply.onclick,style:"background-image: url("+this.reply.photo_url+")",inner:{class:"Story__replyTitle",inner:a(this.reply.name)}}}:null,{class:"Story__table",inner:[this.isGroupsMetaStory?null:{class:"Story__cell Story__cell_header",inner:[{class:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[{class:"Story__cell Story__cell_avatar",inner:{class:"Story__avatar",src:this.avatar,tag:"img"}},{class:"Story__cell Story__cell_title",inner:[{class:"Story__title",inner:[{class:"Story__name",inner:a(this.name)},this.authorIcon?{class:"Story__verified",inner:{class:Bem.class("Story__icon",{verified:this.verified,prometheus:this.prometheus})}}:null]},{class:"Story__date",inner:l}]}]}]},this.isGroupsMetaStory?{class:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:i.mobile_stories_groups_grid_title}:null,{class:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{class:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{class:"Story__icon Story__icon_close"}}}]}]},this.renderStoryFooter(),this.can_comment?{class:"Story__form Story__form_comment",inner:[(e={class:"Story__formOverlay"},e[o]="cancelEvent(event);",e[r]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:this.narrative?i.mobile_stories_comment_narrative_title:i.mobile_stories_comment_title},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:i.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{class:"Story__formFooter",inner:[{class:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:i.mobile_stories_comment_ok},{class:"Story__formCancel",inner:i.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={class:"Story__overlay"},t[o]="cancelEvent(event);",t[r]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{class:"Story__stickers"}:null,{class:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderStoryFooterStatsReplies=function(){return{class:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_replies Story__repliesIcon"}},{class:"Story__cell Story__repliesText",inner:this.replies}]}},t.renderStoryFooterStatsViews=function(){return{class:"Story__views Story__cell",onclick:"Stories."+(this.needShowEmptyStats?"showEmptyStats":"showViews")+'("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_views Story__viewsIcon"}},this.views?{class:"Story__cell Story__viewsText",inner:this.views}:null]}},t.renderStoryFooterStats=function(){return{class:Bem.class("Story__cell",{empty:Boolean(this.link)&&!this.replies&&!this.views,hidden:!(this.replies||this.views||this.link||this.needShowEmptyStats),stats:!0}),inner:this.replies||this.views||this.needShowEmptyStats?{class:Bem.class("Story__stats",{new_questions:this.isNewQuestions,new_hint:!this.isNewQuestions&&this.needShowEmptyStats}),inner:[this.replies?this.renderStoryFooterStatsReplies():null,this.views||this.needShowEmptyStats?this.renderStoryFooterStatsViews():null]}:null}},t.renderStoryFooterComments=function(){return{class:"Story__cell Story__cell_comment",inner:{class:"Story__commentButton",inner:{class:"Story__commentButtonText",inner:lang.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}},t.renderStoryFooterMoreLink=function(){return{class:"Story__cell Story__cell_moreLink",inner:{class:"Story__moreLink",inner:[{class:"Story__moreLinkText",inner:winToUtf(this.link.text)},{class:"Story__icon Story__icon_topArrow"}],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}},t.renderStoryFooterShare=function(){return{class:"Story__cell Story__cell_share",inner:{class:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.owner_id+"_"+this.narrative.id:this.raw_id)+'", '+!!this.narrative+");",inner:{class:"Story__icon Story__icon_share","data-skiponclick":1}}}},t.renderStoryFooterVerticalButtons=function(e){return{class:"Story__verticalButtons",inner:[e?{class:"Story__verticalButton Story__app "+(e.hasNewInteractions?"has_new":""),onclick:"Stories.clickToApp();",inner:Object(T.default)("stories","services_48")}:null,this.canLike?{class:"Story__verticalButton Story__like"+(this.isLiked?" Story__like--set":""),onclick:"Stories.toggleLikeForCurrentStory(this)",inner:Object(T.default)("stories",this.isLiked?"like_shadow_48":"like_outline_shadow_48")}:null]}},t.renderStoryFooter=function(){var e=this.getSticker(ks.app);return{class:"Story__footer",inner:this.isMetaStory||this.is_expired?null:{class:"Story__table",inner:[this.renderStoryFooterStats(),this.link&&this.link.text?this.renderStoryFooterMoreLink():this.can_comment?this.renderStoryFooterComments():null,this.can_share?this.renderStoryFooterShare():null,this.needMenu?{class:"Story__cell Story__cell_menu",inner:c.default.wrap(this.storyMenuHTML)}:null,e||this.canLike?this.renderStoryFooterVerticalButtons(e):null]}}},t.renderAskForm=function(){var e,t=window.lang,n=C.isTouch?"ontouchstart":"onmousedown",i=C.isTouch?"ontouchend":"onmouseup";return{class:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={class:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:{class:"Story__formHeaderInner",inner:[{tag:"button",class:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_author_only,onclick:"Stories.changeAskAnonymous(event);","data-selected":1},{class:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{class:"QuestionSupport__tooltip"}}]}},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{class:"Story__formFooter",inner:[Object(bi.default)({class:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),Object(bi.default)({class:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,a=n.original_height,o=e.top,r=e.left,s=e.width,l=e.height,c=e.rotate,u=getSize(t),d=u[0],_=u[1],f=d,p=_;return _/d>1.77?f=i*_/a:p=a*d/i,"\n      top: "+(o*p-(p-_)/2)+"px;\n      left: "+(r*f-(f-d)/2)+"px;\n      width: "+s*f+"px;\n      height: "+l*p+"px;\n      transform: rotate("+c+"deg);\n    "},t.renderStickersLayer=function(e){var t,n,a=this,o=geByClass1("Story__stickers",e),r=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers,s=C.isTouch?"ontouchstart":"onmousedown",l=C.isTouch?"ontouchend":"onmouseup";o&&(o.innerHTML=""),o.appendChild(c.default.elem(((t={class:"Story__stickersDisableArea Story__stickersDisableArea--left"})[s]="Stories.onTouchStart(event);",t[l]="Stories.onTouchEnd(event, true);",t.ontouchcancel="Stories.onTouchEnd(event, true);",t))),o.appendChild(c.default.elem(((n={class:"Story__stickersDisableArea Story__stickersDisableArea--right"})[s]="Stories.onTouchStart(event);",n[l]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n))),r.forEach((function(t){var n,r=t.id,u=t.type,d=t.style;if([ks.hashtag,ks.mention,ks.question,ks.place,ks.music,ks.storyReply,ks.owner,ks.link,ks.marketItem,ks.post,ks.poll,ks.app].includes(u)){var _=c.default.elem(((n={class:"Story__sticker"})[s]="Stories.onTouchStart(event);",n[l]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n.style=""+a._getStickerStyle(t,e),n));switch(Object(i.domData)(_,"id",r),Object(i.domData)(_,"type",u),d&&Object(i.domData)(_,"style",d),u){case ks.hashtag:Object(i.domData)(_,"hashtag",t.hashtag);break;case ks.mention:Object(i.domData)(_,"mentioned_photo_url",t.mentionedPhotoUrl),Object(i.domData)(_,"mentioned_owner_href",t.mentionedOwnerHref),Object(i.domData)(_,"mentioned_text",t.mentionedText);break;case ks.question:Object(i.domData)(_,"question",t.question);break;case ks.place:if(a.store.list==="place"+t.placeId)return;Object(i.domData)(_,"place_id",t.placeId);break;case ks.music:var f=Stories.getCurrentStory(),p=t.audioId,h=t.audioData,m=t.audioRestriction;if(m){var v=a.getVideo();if(v&&f.needMute){var g=Stories.getAuthorElems()[a.state.authorIndex];removeClass(g,ws),v.muted=!0}o.appendChild(c.default.elem({class:"StoryRestriction",inner:{class:"StoryRestriction__inner",inner:[{class:"StoryRestriction__title",inner:m.title},m.buttonUrl?{class:"StoryRestriction__link",href:m.buttonUrl,inner:m.buttonText}:null]}})),Object(i.domData)(_,"disabled",1)}addClass(_,"audio_item"),addClass(_,"audio_item_"+p),Object(i.domData)(_,"id",p),Object(i.domData)(_,"audio",h);try{Object(i.domData)(_,"track-code",JSON.parse(h).track_code)}catch(e){}_.setAttribute("id","audio"+p);break;case ks.storyReply:Object(i.domData)(_,"owner-id",t.ownerId),Object(i.domData)(_,"story-id",t.storyId),Object(i.domData)(_,"link",t.link);break;case ks.owner:Object(i.domData)(_,"owner-id",t.ownerId),Object(i.domData)(_,"link",t.link);break;case ks.link:Object(i.domData)(_,"link",t.link),Object(i.domData)(_,"tooltip-text",t.tooltipText);break;case ks.marketItem:Object(i.domData)(_,"photoUrl",t.photoUrl),Object(i.domData)(_,"link",t.link),t.isRestricted&&Object(i.domData)(_,"isRestricted","isRestricted");break;case ks.post:Object(i.domData)(_,"post-owner-id",t.postOwnerId),Object(i.domData)(_,"post-id",t.postId);break;case ks.poll:Object(i.domData)(_,"pollId",t.pollId),Object(i.domData)(_,"pollOwnerId",t.pollOwnerId);break;case ks.app:Object(i.domData)(_,"app-id",t.appId),Object(i.domData)(_,"app-ref",t.appRef),Object(i.domData)(_,"app-hash",t.appHash)}o.appendChild(_),a.stickers.push(_)}}))},t._onResizeHandle=function(){var e=this,t=geByClass1("Story",this.authorElem),n=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers;Object(F.isArray)(n)&&n.forEach((function(n,i){e.stickers[i]&&setStyle(e.stickers[i],e._getStickerStyle(n,t))}))},t._createStickerLink=function(e,t){void 0===t&&(t={});var n=intval(Object(i.domData)(e,"disabled"));if(t.type&&!n){var a,o,r,s="a",l=!0,u="Stories__tooltipLink",d=function(){},_={type:t.type,style:Object(i.domData)(e,"style")};switch(t.type){case ks.hashtag:var f=Object(i.domData)(e,"hashtag")||"",p=f.replace("#","%23");a="/feed?section=search&q="+p,o=lang.mobile_stories_show_hashtag_link,r="search",_.text=f;break;case ks.mention:var h=Object(i.domData)(e,"mentioned_photo_url"),m=Object(i.domData)(e,"mentioned_owner_href"),v=Object(i.domData)(e,"mentioned_text");u+=" Stories__tooltipLink--mention",a=m,o=c.default.html([{class:"StoriesTooltipMention",inner:[{class:"StoriesTooltipMention__avatar",style:"background-image: url("+h+")"},{class:"StoriesTooltipMention__text",inner:v}]}]),r="profile";break;case ks.place:var g=Object(i.domData)(e,"place_id"),A=Stories.getFrom();a="/place"+g,o=lang.mobile_stories_go_to_place,this.store.list.includes("place")?l=!0:(a+="?from="+A,d=function(){s="div",l=!1,Stories._hideTooltips(!0),Stories.showLoading(),nav.go(a)}),r="place";break;case ks.music:s="div",o=lang.mobile_stories_music_more,d=function(){var t=Object(i.domData)(e,"id"),n=Object(i.domData)(e,"audio");Stories.openMusicStickerActions(t,n)};break;case ks.storyReply:case ks.owner:var b=this.reply,y=b.is_expired,w=b.list;if(t.type===ks.owner||y)o=Object(i.domData)(e,"owner-id")>0?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,a=Object(i.domData)(e,"link"),r="profile";else s="div",o=lang.mobile_stories_go_to_story,d=function(){Stories.openReplies(w)};break;case ks.link:o=Object(i.domData)(e,"tooltip-text"),a=Object(i.domData)(e,"link");break;case ks.marketItem:var S=Object(i.domData)(e,"photoUrl"),k=!!Object(i.domData)(e,"isRestricted");k&&(d=function(e){e.preventDefault(),window.AlertBox(getLang("mobile_stories_market_access_error_text"),getLang("mobile_stories_market_access_error_title"))}),o=c.default.html([S&&!k?{class:"Stories__marketItemThumb",tag:"img",src:S}:{class:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:Object(T.default)("market","item_stub")},{class:"Stories__marketItemText",tag:"span",inner:getLang("mobile_stories_market_item_more")}]),a=Object(i.domData)(e,"link");break;case ks.post:var O=Object(i.domData)(e,"post-owner-id"),C=Object(i.domData)(e,"post-id");o=lang.mobile_stories_go_to_post,a="/wall"+O+"_"+C}return Stories._requestStickerStat("click",_),ce(s,{href:"a"===s?a:null,target:l?"_blank":null,innerHTML:o+c.default.html({inner:[Object(T.default)({sprite:"stories",name:"goto_arrow_8"})],class:"Stories__tooltipLinkIcon",tag:"span"}),className:u,onclick:function(e){d&&d(e),r&&Stories._requestStickerStat(r,_),[ks.hashtag,ks.mention,ks.place,ks.storyReply,ks.post,ks.link].includes(t.type)&&Stories.sendAnalyticsEvent("click_to_tooltip",{clickable_sticker:{id:t.id,type:Os[t.type]}})}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderAppsMetaStory=function(){var e="apps";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),a=!!n.length,o=t.items[0];a&&(o=n[0]);var r={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'")',inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(r)}))),{class:"MetaStory MetaStory--apps",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{tag:"a",href:this.app.url,target:"_blank",class:"MetaStory__appWrapper",inner:[{class:"MetaStory__appIcon",style:"background-image: url("+this.app.photoUrl+")"},{class:"MetaStory__appName",innerHTML:this.app.name},{class:"MetaStory__separator"},{tag:"span",class:"MetaStory__appLink",innerHTML:lang.mobile_stories_go_to_app}]}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.renderGroupsMetaStory=function(){var e="groups";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),a=!!n.length,o=t.items[0];a&&(o=n[0]);var r={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'")',inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(r)}))),{class:"MetaStory MetaStory--groups",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{class:"MetaStory__infoTitle",inner:lang.mobile_stories_groups_grid_title},{class:"MetaStory__infoDescription",inner:lang.mobile_stories_groups_grid_text}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.handleRecommendationsScroll=function(){event.stopPropagation&&event.stopPropagation(),event.stopImmediatePropagation&&event.stopImmediatePropagation();var e=geByClass1("MetaStory__recommendations"),t=geByClass1("MetaStory__recommendations-inner");if(t&&e){var n=Math.min(t.scrollTop/(this.scrollOffset/100),70)/100;setStyle(e,{backgroundColor:"rgba(0, 0, 0, "+n+")"}),t.scrollTop?(addClass(e,"scroll"),Stories.pauseStory()):(Stories.playStory(),removeClass(e,"scroll")),this.isGroupsMetaStory&&(this.blockHeaderEl||(this.blockHeaderEl=geByClass1("Story__gridTitle")),t.scrollTop>this.metaStoryGridMarginTop?removeClass(this.blockHeaderEl,"Story__gridTitle--hide"):addClass(this.blockHeaderEl,"Story__gridTitle--hide"))}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&removeEvent(this.video,"load",this.onLoadImgBind),this.video&&(removeEvent(this.video,"ended",this.onVideoEndedBind),removeEvent(this.video,"play",this.onVideoPlayBind),removeEvent(this.video,"pause",this.onVideoPauseBind),removeEvent(this.video,"canplaythrough",this.onCanPlayBind),removeEvent(this.video,"waiting",this.onVideoWaitingBind),removeEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),removeEvent(this.video,"playing",this.onVideoPlayingBind),removeEvent(this.video,"seeking",this.onVideoSeekingBind),removeEvent(this.video,"seeked",this.onVideoSeekedBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),Stories._hideTooltips()},e}(),ys=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval((function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)}),this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}(),ws="StoryAuthor_videoMuted",Ss="StoryAuthor--error",ks={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,app:13},Os=Object.entries(ks).reduce((function(e,t){return e[t[1]]=t[0],e}),{}),Cs=function(){function e(e,t){var n=this;this.store=Stories.getStore(),this.data=t,this.state={authorIndex:e};var i=this.getCurrentStoryIndex();this.setCurrentStoryIndex(i),this.story=new bs(this.data.items[i],this.data.author,e,i),this.authorStoriesHTML=c.default.html(this.story.render()),this.progressItemElems=null,Stories.onRender((function(){n.updateStory()}))}var t=e.prototype;return t.getCurrentStory=function(){if(this.story)return this.story},t.destroy=function(){this.story&&this.story.destroy()},t.update=function(){var e=this.data.index;this.destroy(),this.story=new bs(this.data.items[e],this.data.author,this.state.authorIndex,e),this.authorStoriesHTML=c.default.html(this.story.render())},t.updateHeader=function(){this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.progressItemElems=Array.from(geByClass("StoryAuthor__progressItem",this.authorElem)),this.drawFilledProgressItems()},t.updateStory=function(){var e=this;this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var t=geByClass1("Story__body",this.authorElem);this.story.update(t),this.story.onVideoData((function(n){n.authorIndex,n.storyIndex;var i=e.story.getDuration(),a=e.story.getType(),o=e.store.isStopped,r=e.story.getStartTime(),s=e.story.getProgressPercentByLeftTime(i-r);if(e.drawCurrentProgress(s),removeClass("StoryAuthor__progress--hide",$(".StoryAuthor__progress",e.authorElem)),e.countdown=new ys(i-r,{tick:13,onTick:function(t){var n=e.story.getProgressPercentByLeftTime(t);e.drawCurrentProgress(n)},onEnd:function(){"video"!==a&&(e.drawCurrentProgress(100),Stories.nextStory(!0),removeClass(e.authorElem,"StoryAuthor_paused"))},onPause:function(){e.story.pause(),addClass(e.authorElem,"StoryAuthor_paused")},onStart:function(){e.story.play(),removeClass(e.authorElem,"StoryAuthor_videoHold"),removeClass(e.authorElem,"StoryAuthor_paused")}}),"photo"!==a&&"broken"!==a||o){if("video"===a){var l=e.story.getVideoState(),c=e.story.getVideo();addClass(t,"Story__body_video"),4!==l||o||c.paused||e.countdown.start()}}else e.countdown.start()})),this.story.onVideoEndedEvent((function(){e.drawCurrentProgress(100),e.story.progress=100,Stories.nextStory(!0)})),this.story.onVideoPauseEvent((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoBuffering((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoPlayEvent((function(){e.countdown&&!e.store.isStopped&&e.countdown.start()})),this.story.onAutoPlay((function(){var t=window.lang,n=e.story.getVideo();Stories.pauseAudio();var i=geByClass1("Story__body",e.authorElem),a=Stories.isGoodBrowser(),o=n.play();o?o.then((function(){e.story.canPause=!0})):e.story.canPause=!0,n.paused&&!a?e.story.renderError(e.authorElem,i,t.mobile_stories_inline_video_error):!e.countdown||e.store.isStopped||n.paused||e.story.buffering?a&&n.paused&&addClass(e.authorElem,"StoryAuthor_videoHold"):e.countdown.start(),n.muted&&addClass(e.authorElem,ws),Stories._showFeatureTooltipIfNeeded()})),this.story.onDestroy((function(){e.countdown&&(e.countdown.stop(),e.countdown=null)})),Stories._showFeatureTooltipIfNeeded()},t.getCountDown=function(){if(this.countdown)return this.countdown},t.getFirstUnreadStoryIndex=function(){if(Stories._hasContext("all"))return 0;var e=this.data.items.findIndex((function(e){return!0===e.unread}));return-1!==e?e:0},t.getCurrentStoryIndex=function(){if(!this.data.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.data.index},t.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.data.index],n=geByClass1("StoryAuthor__progressItemCurrent",t),i=geByClass1("StoryAuthor__wick",t),a=e/100*t.clientWidth;setStyle.transform(n,void 0,[a,0]),this.story.isOneTime&&setStyle.transform(i,void 0,[a,0])}},t.drawFilledProgressItems=function(){var e=this.data.index;if(this.progressItemElems)for(each(this.progressItemElems,(function(e,t){removeClass(t,"StoryAuthor__progressItem_filled")}));e>=0;)addClass(this.progressItemElems[--e],"StoryAuthor__progressItem_filled")},t.setCurrentStoryIndex=function(e){this.data.index=e,this.drawFilledProgressItems()},t.renderEmpty=function(){var e=this.story.getPreview(),t=Stories.getWidth();return c.default.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},t.render=function(){var e,t,n,i=this,a=window.lang,o=Stories.getWidth(),r=C.isTouch?"ontouchstart":"onmousedown",s=C.isTouch?"ontouchend":"onmouseup";return c.default.html({class:"StoryAuthor StoryAuthor_inited",style:"width: "+o+"px;",inner:[{class:"StoryAuthor__header",inner:{class:"StoryAuthor__progress"+(this.story.isOneTime?" StoryAuthor__progress--isOneTime StoryAuthor__progress--hide":""),inner:this.data.items.map((function(){return{class:"StoryAuthor__progressItem",inner:[{class:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}},i.story.isOneTime?{class:"StoryAuthor__wick"}:null]}}))}},(e={class:"StoryAuthor__muted"},e[r]="Stories.unMute(this, event);",e.inner=[{class:"Story__icon_unmute",inner:Object(T.default)("stories","volume_unmuted_24")},{class:"StoryAuthor__muted_text",inner:a.mobile_stories_unmute}],e),(t={class:"StoryAuthor__next"},t[r]="Stories.onTouchStart(event);",t[s]="Stories.onTouchEnd(event);",t.ontouchcancel="Stories.onTouchEnd(event);",t),(n={class:"StoryAuthor__prev"},n[r]="Stories.onTouchStart(event);",n[s]="Stories.onTouchEnd(event, true);",n.ontouchcancel="Stories.onTouchEnd(event, true);",n),{class:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}();var js=function(e){void 0===e&&(e={});var t=e.mode||"tint",n=e.size||"s",i=e.imageTheme||"dark",a="image"===t&&"dark"===i,o=s.default.class("Banner",{md:t,sz:n,aside:e.asideMode,inverted:a},"--");return{inner:[{inner:["image"===t&&e.background?{inner:[e.background],class:"Banner__bg",tag:"div"}:null,e.before?{inner:[e.before],class:"Banner__before",tag:"div"}:null,{inner:[e.header?{inner:[e.header],class:"Banner__header",tag:"div"}:null,e.subheader?{inner:[e.subheader],class:"Banner__subheader",tag:"div"}:null,e.text?{inner:[e.text],class:"Banner__text",tag:"div"}:null,e.actions?{inner:[e.actions],class:"Banner__actions",tag:"div"}:null],class:"Banner__content",tag:"div"},"expand"===e.asideMode?{inner:[Object(T.default)({sprite:"base",name:"chevron_24"})],class:"Banner__expand Btn Btn_theme_none",onClick:e.onExpand,tag:"button"}:null,"dismiss"===e.asideMode?{inner:[Object(T.default)({sprite:"base",name:"dismiss_24"})],class:"Banner__dismiss Btn Btn_theme_none",onClick:e.onDismiss,tag:"button"}:null],class:"Banner__in",tag:"div"}],onClick:e.onClick,class:o,tabindex:"0",role:"button",tag:"div"}},Es=function(){function e(e){var t=window.lang;this.store=Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[],this.poll=this.store.polls[e],this.extendedStats=this.store.extendedStats[e];var n=this.viewersState,i=n.count,a=n.repliesCountText,o=n.authorCountText,r=n.hiddenReason,s=n.privacyHint;this.raw_id=e,this.count=i,this.countText=langNumeric(this.count,t.mobile_stories_views_title),this.hiddenReason=r,this.repliesCountText=a,this.repliesAuthorCountText=o,this.privacyHint=s||{},this.questions.length||this.privacyHint.showEmptyStatsPrivacyHint||this.extendedStats?this.title=t.mobile_stories_views_title_interactions:this.count&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.count?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}var t=e.prototype;return t.render=function(){var e=this,t=window.winToUtf,n=this.store.questions[this.raw_id]||[],i=this.needShowOnlyHiddenViewersInfo(),a=this.viewersState.privacyHint||{};return c.default.html({class:Bem.class("Views",{short:!(this.viewers.length||!this.replies.length||this.hiddenReason)}),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView"+(i?" Views__body--centerAlign":""),onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.extendedStats?this.renderExtendedStatsBanner():null,a.showEmptyStatsPrivacyHint?{class:"ViewsEmptyStatsBlock",inner:[{class:"ViewsEmptyStatsBlock__icon",inner:Object(T.default)("stories","hide_outline_56")},{class:"ViewsEmptyStatsBlock__text",inner:lang.mobile_stories_feedback_empty_stats_hint},{class:"ViewsEmptyStatsBlock__link",inner:{tag:"a",class:"link",inner:lang.mobile_stories_go_to_privacy_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]}}]}:null,a.showPrivacyHint?{class:"ViewsPrivacyHint",inner:js({subheader:lang.mobile_stories_feedback_privacy_hint,asideMode:"dismiss",before:Object(T.default)("stories","lock_outline_28"),actions:{tag:"a",class:"link",inner:lang.mobile_stories_go_to_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]},onDismiss:["Stories.hidePrivacyHint",this.raw_id]})}:null,this.replies.length?{class:"Views__replies StoryViewsSeparator",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map((function(n){return{class:"Views__reply "+(n.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+n.owner_id+"/"+n.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:n.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:n.name?t(n.name):lang.mobile_stories_reply_you}]}}))}}]}:null,this.poll?{class:"Views__poll StoryViewsSeparator",inner:[{class:"Views__pollHeader",inner:lang.mobile_wall_poll_head_title},{class:"Views__pollBody",inner:{class:"StoryFeedbackPoll"+("default"===this.poll.background.type?" StoryFeedbackPoll--default":""),inner:[this.getBackgroundElementForPoll(this.poll),{class:"StoryFeedbackPoll__question",inner:this.poll.question},{class:"StoryFeedbackPoll__countVoters",inner:this.poll.votersCountText},{class:"StoryFeedbackPoll__showResult",onclick:"Stories.openPoll("+this.poll.ownerId+", "+this.poll.pollId+", "+this.raw_id+")",inner:lang.mobile_voting_show_result}]}}]}:null,n.length?{class:"Views__questions StoryViewsSeparator",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:lang.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:lang.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:n.slice(0,10).map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}}]}:null,{class:"Views__viewers",inner:[this.count&&(n.length||this.replies.length||this.extendedStats)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:[this.viewers.map((function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",inner:[{class:"Views__avatarPhoto",src:e.photo,tag:"img"},e.isLiked?c.default.wrap(Object(ka.default)({mix:"Views__avatarBadgeIcon",icon:"notify_mini_like"})):null]}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}})),this.hiddenReason?{class:"Views__viewersHiddenReason",inner:[{class:"Views__viewersHiddenReasonIcon",inner:Object(T.default)("stories","hide_outline_56")},{class:"Views__viewersHiddenReasonText",inner:this.hiddenReason}]}:null]}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},t.renderExtendedStatsBanner=function(){return{inner:[{inner:[Object(T.default)({sprite:"stories",name:"statistic_28"})],class:"ViewsExtendedStatsBanner__before",tag:"div"},{inner:[{inner:[lang.mobile_stories_feedback_extended_stats],class:"ViewsExtendedStatsBanner__title",tag:"div"},{inner:[this.extendedStats.preview],class:"ViewsExtendedStatsBanner__subtitle",tag:"div"}],class:"ViewsExtendedStatsBanner__content",tag:"div"},{inner:[Object(T.default)({sprite:"base",name:"chevron_16"})],class:"ViewsExtendedStatsBanner__after",tag:"div"}],class:"ViewsExtendedStatsBanner StoryViewsSeparator",onClick:["Stories.showExtendedStats",this.raw_id],tag:"button"}},t.needShowOnlyHiddenViewersInfo=function(){var e=this.store.questions[this.raw_id]||[];return this.count&&this.hiddenReason&&!this.viewers.length&&!this.replies.length&&!e.length},t.getBackgroundElementForPoll=function(e){var t=e.background,n=null,i="";if("photo"===t.type)n={class:"StoryFeedbackPoll__photo",style:"background-image: url("+t.photoUrl+")"},i="background: #"+t.backgroundColor;else if("gradient"===t.type){i="background: linear-gradient("+(t.angle-90)+"deg, "+t.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return{class:"StoryFeedbackPoll__background",style:i,inner:n}},e}(),Ts=function(){function e(e){this.store=Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){return c.default.elem({class:Bem.class("Questions",{}),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:lang.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}]}]})},e}(),Is=function(){function e(e){this.store=Stories.getStore(),this.extendedStats=this.store.extendedStats[e]}var t=e.prototype;return t.render=function(){var e=this;return c.default.elem({inner:[{inner:[{inner:[{inner:[{inner:[lang.mobile_stories_extended_stats_title],class:"StoryExtendedStats__title",tag:"div"}],class:"StoryExtendedStats__cell",tag:"div"}],class:"StoryExtendedStats__table",tag:"div"},{inner:[Object(T.default)({sprite:"base",name:"back_outline_28"})],class:"StoryExtendedStats__back Btn Btn_theme_none",onClick:"Stories.hideExtendedStats();",tag:"button"}],class:"StoryExtendedStats__header",tag:"div"},{inner:[{inner:[this.extendedStats.achievement?{inner:[{inner:[Object(T.default)({sprite:"stories",name:"statistic_grow_28"})],class:"StoryExtendedStatsAchievement__before",tag:"div"},{inner:[{inner:[this.extendedStats.achievement],class:"StoryExtendedStatsAchievement__label",tag:"div"},{inner:[this.extendedStats.achievementSubtitle],class:"StoryExtendedStatsAchievement__subtitle",tag:"div"}],class:"StoryExtendedStatsAchievement__content",tag:"div"}],class:"StoryExtendedStatsAchievement StoryViewsSeparator",tag:"div"}:null,this.extendedStats.categories.map((function(t){return e.renderCategory(t)}))],class:"StoryExtendedStats__inner",onTouchMove:"event.stopPropagation();",tag:"div"}],class:"StoryExtendedStats__body",tag:"div"}],class:"StoryExtendedStats",tag:"div"})},t.renderCategory=function(e){var t=this;return{inner:[{inner:[e.title],class:"StoryExtendedStatsCategory__title",tag:"div"},{inner:[e.lines.map((function(e){return t.renderCategoryLine(e)}))],class:"StoryExtendedStatsCategory__lines",tag:"div"}],class:"StoryExtendedStatsCategory StoryViewsSeparator",tag:"div"}},t.renderCategoryLine=function(e){return{inner:[{inner:[e.name],class:"StoryExtendedStatsCategoryLine__name",tag:"div"},{inner:[e.counter],class:"StoryExtendedStatsCategoryLine__counter",tag:"div"}],class:"StoryExtendedStatsCategoryLine",tag:"div"}},e}();function Ms(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}var Ps=[];var xs=[];var Ls=n("mMuO"),Bs=0,Rs=1,Ds=3,Ns={opened:!1,init:function(e,t){var n=this;void 0===t&&(t={}),this.params=extend({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0},t);var i=this._parseList(e).split("/"),a=i[0],o=i[1],r=i[2],s=a.split("_")[0];t&&t.id?s=t.id:t&&t.narrativeId&&(s=t.narrativeId),this.initRaw=e,this.storyOwner=s,this.storyRaw=a,this.storyExtra=r,this.storyList=o,this.extra=this.parseExtra(this.storyExtra),this.needAudioRestore=audio.playing(),this.Views={},this.popoutOpen=!1,this.slideTimer=null,this.createLayer(),this._initStore(),this.detectAutoplay().then((function(){n.isRestored?n._init():n._checkPreloadedList()?(n._initPreloadedList(),n._init()):n._requestList().then((function(e){var t=e.items,i=e.list;t&&(n.store.authors=t,n.store.listLoaded=!0,n.store.list=i,n.store.inited=!0,n._init())}),(function(){}))}))},parseExtra:function(e){var t={},n=String(e).split(";");for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].split(":"),o=a[0],r=a[1];o&&r&&(t[o]=r)}return t},_checkPreloadedList:function(){return!!(window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList])},_initPreloadedList:function(){var e=window.store.storiesLists[this.storyList];e&&(this.store.authors=e,this.store.listLoaded=!0,this.store.list=this.storyList,this.store.inited=!0)},pushPreloadedList:function(e){var t=Object(i.parseJSON)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),extend(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach((function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]}))},_init:function(){var e=this;this.createAuthors();var t=this.getFirstStoryIndex();this.setCurrentStory(t);var n=this.getCurrentStory();this.params.restore||this.setHistory(n.raw_id,{nav_init:!0,replace:this.params.replace}),this.sliderEl=ge("StoriesSlider"),this.slider=sn(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(t){t=e.slider&&Object(i.intval)(e.slider.getCurrentPos());var n=e.getCurrentAuthorIndex(),a=e.getCurrentAuthor().data;clearTimeout(e.slideTimer),void 0!==t&&t!==n&&(e.markSeenAllOwners(),!1===e.isTap&&(t>n?e.sendAnalyticsEvent("go_to_next_author"):e.sendAnalyticsEvent("go_to_previous_author"),a.is_groups||a.is_apps||e.markSeenStory(!0)),e.setCurrentAuthor(t),e.slideTimer=setTimeout((function(){e.renderStory()}),300)),delete e.isTap},onSetup:function(){Object(i.addClass)(e.layer,"Stories_inited"),e.renderStory()}}),this.Authors&&1===this.Authors.length&&(Object(i.addClass)(this.layer,"Stories_inited"),this.renderStory()),this.store.showViews&&this.showViews(n.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},_initStore:function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},_requests:[],viewers:{},questions:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:this.params.reply,replyTo:this.params.replyTo,inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},_initViewerSource:function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=cur.module;break;default:this.viewerSource=e}},_sendOpeningEvents:function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=(this.getCurrentStory()||{}).narrative||{},a=n.owner_id,o=n.id;if(!a||!o)return;Object(i.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:Object(i.intval)(a),item_id:Object(i.intval)(o),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}},_abortRequests:function(){Object(F.isArray)(this.store._requests)&&Object(i.each)(this.store._requests,(function(e,t){t.abort()})),this.store._requests=[]},_saveRequest:function(e){this.store._requests.push(e)},getStore:function(){return this.store},setAllAuthorStoriesReaded:function(e){var t=this;this.store.authors[e].items.forEach((function(e){if(e.unread){var n=e.raw_id;e.track_code&&(n+="_"+e.track_code),t.store.readedStories[n]=!0}}))},markSeenAllOwners:function(){var e=this.getCurrentAuthor().data;if(e.is_groups||e.is_apps){var t=window.store.stories[e.is_groups?"groups":"apps"];if(t){t.authors.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))}));var n=t.authors.map((function(e){return e.author.id}));ajax.post("stories.php",{_ajax:1,act:"mark_owners_seen",hash:this.store.authors[0].read_hash,owners_ids:n.join(",")}),this._needFeedUpdate=!0}}},createAuthors:function(){var e=this,t="";this.Authors=[];var n=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(n=this.getFirstAuthorIndex());var a=this.store.authors[n],o=a.items[a.items.length-1].unread;if(this.extra)switch(this.extra.context){case"new":o=!0;break;case"all":o=!1}Object(i.each)(this.store.authors,(function(n,i){var a=i.items;if(!n||!o||a[a.length-1].unread){var r=new Cs(n,i);e.Authors.push(r),t+=r.renderEmpty()}})),Object(i.val)(Object(i.geByClass1)("Stories__authors",this.layer),t),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),Object(i.each)(this.Authors,(function(e,t){t.updateHeader()})),this.setCurrentAuthor(n)},getFirstStoryIndex:function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex((function(t){return t.raw_id===e.storyRaw}));return-1!==n?n:0}return this.getCurrentStoryIndex()},getFirstAuthorIndex:function(){var e=this,t=this.store.authors.findIndex((function(t){var n=t.author.id;return t.is_narrative&&(n=t.items[0].narrative.id),t.id&&(n=t.id),String(n)===String(e.storyOwner)}));return-1!==t?t:0},getCurrentAuthorIndex:function(){return this.store.authorIndex},getCurrentStoryIndex:function(){return this.store.authors[this.getCurrentAuthorIndex()].index},getCurrentStory:function(){return this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()]},setCurrentAuthor:function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},setCurrentStory:function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},drawSiblingPreview:function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},drawPreview:function(e){setStyle(e,"background-image","url("+attr(e,"data-src")+")")},updateCurrentAuthor:function(){var e=this.authors[this.store.authorIndex];Object(i.each)(this.authors,(function(e,t){Object(i.removeClass)(t,"StoryAuthor_current")})),Object(i.addClass)(e,"StoryAuthor_current")},getSizes:function(){var e,t,n=window.innerHeight,a=window.innerWidth;return a<540?(e=a,t=n,zlayer.open(),zlayer.onResize=this.onResize.bind(this)):(e=Math.floor(Math.min(540,Math.max(320,.563*n))),t=Math.floor(1.78*e),Object(i.addClass)(document.body,"vk__story_open")),[e,t]},createLayer:function(){window.innerWidth<540?(zlayer.open(),zlayer.onResize=this.onResize.bind(this)):Object(i.addClass)(document.body,"vk__story_open"),Ns.opened=!0;var e=this.getSizes(),t=e[0],n=e[1];this.storyW=t;var a=c.default.html({id:"StoriesView",class:"Stories__layer _preventMenuOpen",style:"max-width: "+t+"px; max-height: "+n+"px",inner:[{class:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",class:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{class:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{class:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=Object(i.append)(Object(i.ce)("div",{className:"Stories",innerHTML:a}),document.body),attr(this.layer,"ontouchmove","event.preventDefault();"),this.loader=Object(i.geByClass1)("Stories__loading",this.layer),this.popout=Object(i.geByClass1)("Stories__popout",this.layer),this.swipeTextTop=Object(i.geByClass1)("Stories__swipeText_top",this.layer)},onResize:function(){var e=ge("StoriesView"),t=this.getSizes(),n=t[0],i=t[1];attr(e,"style","max-width: "+n+"px; max-height: "+i+"px"),this.storyW=n,this.authors.forEach((function(e){setStyle(e,"width",n+"px")})),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},getWidth:function(){return this.storyW},renderStory:function(){var e=this.store.authorPrevIndex,t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var a=this.Authors[e],o=this.authors[e];a.update();var r=a.renderEmpty(),s=ceFromString(r);replace(s,o)}var l=ceFromString(i.render());replace(l,n),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.extra.replies&&this.showViews(this.getCurrentStory().raw_id)},getCurrentAuthor:function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},getCurrentAuthorEl:function(){return this.getCurrentAuthor().authorElem},getAuthorElems:function(){return this.authors},prevStory:function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame((function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()}))},nextStory:function(e){var t=this;this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,this.markSeenStoryIfNeeded(),requestAnimationFrame((function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),a=t.getCurrentAuthorIndex(),o=n.items.length;if(t.Authors){var r=t.Authors.length;o-1<=i?r-1<=a?requestAnimationFrame((function(){t.sendAnalyticsEvent("close_auto_by_time"),t.close()})):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(a+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())}}))},stopStory:function(){this.store.isStopped=!0,this.pauseStory()},pauseStory:function(e){var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();e&&Object(i.addClass)(this.layer,"Stories_paused"),n&&n.pause()}},playStory:function(e){this.store.isStopped=!1;var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();Object(i.removeClass)(this.layer,"Stories_paused"),n&&n.start()}},pauseAudio:function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},restoreAudio:function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},showMenu:function(){this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),Object(i.addClass)(this.layer,"Stories_menuOpened")},hideMenu:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_menuOpened"),e&&this.playStory()},showLoading:function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout((function(){show(e.loader)}),100))},hideLoading:function(){this.loader&&(clearTimeout(this.loaderTimer),hide(this.loader))},onRepliesScroll:function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},goToSettingsFromPrivacyHint:function(e,t,n){var i=this.store.viewersState[e]||[];return this.sendAnalyticsEvent("go_to_settings",{nav_screen:i.count?"feedback":"feedback_without_viewers"}),nav.go(t,n)},showEmptyStats:function(e){this.sendAnalyticsEvent("open_empty_feedback"),this.showViews(e)},showViews:function(e,t){var n=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){var a=this.Views[e].render();this.popoutOpen=!0,Object(i.val)(this.popout,a);var o=Object(i.geByClass1)("Views__repliesBody",this.popout);o&&(o.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var r=this.store.viewersState[e],s=this.store.viewers[e];if(r&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then((function(){n.markQuestionsAsViewed(),n.createViews(e,t),n.hideLoading()}))}},showExtendedStats:function(e){var t=new Is(e).render();this.popout.appendChild(t),this.sendAnalyticsEvent("open_advanced_statistic")},hideExtendedStats:function(){re(Object(i.geByClass1)("StoryExtendedStats",this.popout))},markQuestionsAsViewed:function(){(this.getCurrentStory()||{}).isNewQuestions=!1,Object(i.removeClass)(Object(i.geByClass1)("Story__stats"),"Story__stats_new_questions")},createViews:function(e,t){void 0===t&&(t=!1);var n=this.store.viewersState[e],a=new Es(e),o=a.render();this.popoutOpen=!0,Object(i.val)(this.popout,o),this.Views[e]=a;var r=Object(i.geByClass1)("Views__repliesBody",this.popout);r&&(r.scrollLeft=n.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},hideViews:function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,Object(i.val)(this.popout,"")},loadViews:function(e){var t=this,n=this.store.viewersState[e],a=n.loading,o=n.nextFrom;!a&&o&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,o).then((function(){var a=new Es(e),o=a.render();t.popoutOpen=!0;var r=Object(i.geByClass1)("Views__body",t.layer).scrollTop;Object(i.val)(t.popout,o),Object(i.geByClass1)("Views__body",t.layer).scrollTop=r,t.Views[e]=a,t.hideLoading(),n.loading=!1})))},showComment:function(){var e=this,t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentTextarea",t);this.store.showComment=!0,this.stopStory(),Object(i.addClass)(this.layer,"Stories_commentOpened"),this._hideTooltips(),requestAnimationFrame((function(){e.sendAnalyticsEvent("comment_tap"),n&&n.focus()}))},hideComment:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_commentOpened"),e&&this.playStory()},onInputComment:function(e){var t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentSend",t),a=Object(i.val)(e);Object(i.toggleClass)("Story__commentSend_active",n,!!a)},sendComment:function(){var e=this.authors[this.store.authorIndex],t=Object(i.geByClass1)("Story__commentTextarea",e),n=Object(i.geByClass1)("Story__commentSend",e),a=Object(i.val)(t);if(hasClass("Story__commentSend_active",n)){Object(i.val)(t,""),Object(i.removeClass)(n,"Story__commentSend_active");var o,r=this.getCurrentAuthorIndex(),s=this.getCurrentStory(),l=s.raw_id,c=s.narrative,u=this.store.authors[r],d=u.send_hash,_=u.author.id;o=c?"narrative"+c.owner_id+"_"+c.id:"story"+l,this._sendMessage(d,o,a,_),this.hideComment()}},showFlashPopup:function(e,t){var n=this;void 0===t&&(t=!0);this.stopStory();var a=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.val)(Object(i.geByClass1)("Stories__flashText",a),e),setTimeout((function(){Object(i.addClass)(a,"Stories__flash_show")})),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout((function(){Object(i.removeClass)(a,"Stories__flash_show"),n.flashHideTimer=setTimeout((function(){n.hideFlashPopup(t)}),1500)}),1500)},hideFlashPopup:function(e){e&&this.playStory(),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer);var t=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.removeClass)(t,"Stories__flash_show")},removeCurrentStory:function(){var e=this,t=window.lang,n=this.getCurrentAuthor();if(n){var i=n.getCurrentStory(),a=i.narrative?t.mobile_stories_delete_narrative:t.mobile_stories_delete_story;if(confirm(a.replace(/(<([^>]+)>)/gi,"\n"))){var o=n.data.remove_hash,r=i.can_remove,s=i.raw_id;if(r){this.pauseStory();var l=function(){e._requestFeedBlock(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};if(i.narrative){var c=i.narrative,u=c.owner_id+"_"+c.id;this._requestRemoveNarrative(u,o).then((function(){l()}),(function(){}))}else this._requestRemoveStory(s,o).then((function(){e.sendAnalyticsEvent("delete"),l()}),(function(){}))}}}},onScrollViews:function(e,t){var n=this.store.viewersState[t],i=n.loading,a=n.nextFrom;if(!i&&a){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},unMute:function(e,t){var n=this.getCurrentAuthor().story.getVideo();Object(i.cancelEvent)(t),n&&n.muted&&(n.muted=!1,Object(i.removeClass)(gpeByClass(ws,e),ws))},onTouchStart:function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var a=n.getVideo();if(a&&a.paused)return void(this.preventedTap=!0)}this.isTap=!0,clearTimeout(this.isTapTimer),n.isOneTime||(this.pauseStory(!0),"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),this.isYmove=null,Object(i.removeClass)(this.layer,"Stories_touchMove"),this.isTapTimer=setTimeout((function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")}),200))},onTouchMove:function(e){var t=0,n=0;"touchmove"===e.type&&(t=this.tapStartX-e.changedTouches[0].clientX,n=this.tapStartY-e.changedTouches[0].clientY),null===this.isYmove&&(this.isYmove=Math.abs(t)<Math.abs(n),this.isYmove&&Object(i.addClass)(this.layer,"Stories_touchMove")),this.isYmove?this.onVerticalSwipe(-n/1.5):this.onVerticalSwipe(0)},onTouchEnd:function(e,t){clearTimeout(this.isTapTimer);var n=this.getCurrentAuthor();if(n){var a=n.story;this.isTap||this.sendAnalyticsEvent("resume_release");var o,r;"touchend"===e.type?(o=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY):(o=e.clientX,r=e.clientY),(Math.abs(this.tapStartX-o)>20||Math.abs(this.tapStartY-r)>20)&&(this.isTap=!1),Object(i.removeClass)(this.layer,"Stories_touchMove"),setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]);var s=e.target&&e.target.classList.contains("Story__sticker"),l=Object(i.domData)(e.target,"id"),c=Number(Object(i.domData)(e.target,"type"));if(s&&this.sendAnalyticsEvent("click_on_clickable_sticker",{clickable_sticker:{id:l,type:Os[c]}}),this.needGoToLink){var u=this.getCurrentAuthor().story;if(this.needGoToLink=!1,u&&u.hasLink())return void this.openCustomButton(e)}if(this.needClose)return this.sendAnalyticsEvent("close_swipe_down"),void this.close();if(this.featureTooltip)this._hideFeatureTooltip();else if(this.tooltip)this._hideTooltips();else{if(this.isTap){var d=this.getCurrentAuthor();if(!d)return;var _=d.getCurrentStory();if(s){var f=Object(i.domData)(e.target,"app-id"),p=Object(i.domData)(e.target,"pollId"),h=Object(i.domData)(e.target,"pollOwnerId");if(Object(i.removeClass)(this.layer,"Stories_paused"),Object(i.domData)(e.target,"question"))this.askQuestionBox(e);else if(f)Ns.clickToApp();else if(p&&h)Ns.openPoll(h,p,a.raw_id);else{var m=a._createStickerLink(e.target,{id:l,type:c});this.tooltip?this._hideTooltips():this._showTooltip(e,m)}return}if(t){if(_.isOneTime)return;this.sendAnalyticsEvent("go_to_previous_story"),this.prevStory()}else{if(this.sendAnalyticsEvent("go_to_next_story_tap"),_.isOneTime)return this.close(),void Object(i.cancelEvent)(e);this.nextStory()}}this._hideTooltips(!0),this.hideMenu()}}},openCustomButton:function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var a={ownerId:i[1],narrativeId:i[2]},o=a.ownerId,r=a.narrativeId;if(!o||!r)return!1;this.openNarrative(o+"/narrative"+o+"_"+r,{source:"narrative_story"})}else if(this.stopStory(),this.showLoading(),t.stats&&t.stats.url_view){var s=t.stats.url_view,l=s.event_type,c=s.rhash,u=t.raw_id;this._requestClickStat(u,l,c,(function(){nav.go(n)}))}else nav.go(n);return!1},onVerticalSwipe:function(e){var t=window.lang;if(this.needClose=!1,this.needGoToLink=!1,e){var n=e>0,a=this.sliderEl.offsetHeight,o=a/3.5,r=Math.abs(e)>o;if(n){var s=r?t.mobile_zphoto_release_to_close:t.mobile_zphoto_move_to_close,l=r?"":n?"zpv_close_move_down":"zpv_close_move_up",c=Math.max(1-.75*e/a,.6);Object(i.val)(this.swipeTextTop,'<div class="zpv_close_msg '+l+'">'+s+"</div>"),setStyle(this.sliderEl,"opacity",c),setStyle.transform(this.sliderEl,1,[0,e/1.5]),setStyle(this.swipeTextTop,"opacity",Math.abs(c-1-.6)),setStyle.transform(this.swipeTextTop,1,[0,e/1.5*.85]),this.needClose=r}else{var u=Math.min(1-.5*e/a,1.1);setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),u,[0,Math.max(e/(1.5*1.6),-90)]),this.needGoToLink=r}}else setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},preventScroll:function(){return this.popoutOpen},_requestRemoveStory:function(e,t){return new Promise((function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestRemoveNarrative:function(e,t){return new Promise((function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestList:function(){var e=this;return new Promise((function(t,n){var i={storyOwner:e.storyOwner,list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra};if(!e.storyRaw)return n();var a=ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra},{onDone:function(e){i.items=e,t(i)},onFail:function(){n()}});e._saveRequest(a)}))},_removeList:function(){window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList]&&delete window.store.storiesLists[this.storyList],window.store&&window.store.stories[this.storyList]&&delete window.store.stories[this.storyList]},_forceSetStore:function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},_requests:[],questions:{},viewers:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:!1,inited:!0}},_requestFeedback:function(e,t){var n=this;void 0===t&&(t=0);var i=this.store;return new Promise((function(a,o){var r=ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,o,r,s,l,c,u,d,_,f){r&&r.length&&(i.replies[e]=r),i.viewers[e]=[].concat(i.viewers[e]||[],t).filter((function(e,t,n){return t===n.findIndex((function(t){return t.viewerId===e.viewerId}))})),i.viewersState[e]?extend(i.viewersState[e],{count:n,nextFrom:o}):i.viewersState[e]={count:n,nextFrom:o,repliesCountText:s,authorCountText:l,repliesScrollLeft:0,hiddenReason:u},c.length&&(i.questions[e]=c),s&&(i.viewersState[e].repliesCountText=s),l&&(i.viewersState[e].authorCountText=l),d&&(i.polls[e]=d),_&&(i.extendedStats[e]=_),i.viewersState[e].privacyHint=f,a({viewers:t,count:n,nextFrom:o,repliesCountText:s,authorCountText:l,questions:c})},onFail:function(){o()}});n._saveRequest(r)}))},markSeenStoryIfNeeded:function(e){var t=this.getCurrentAuthor();t&&(t.getCurrentStory().isOneTime&&this.markSeenStory(e))},markSeenStory:function(e){var t,n,a=this.getCurrentAuthor(),o=this._getSource(),r=a.getCountDown(),s=a.getCurrentStory(),l=0;!r||this.store.readedStories[s.raw_id]&&!e||(s.isOneTime&&(l=s.progress?s.progress:Math.max(Math.round(s.getProgressPercentByLeftTime(r.left)),1)),ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:this.store.authors[0].read_hash,story_id:s.raw_id,track_code:s.track_code?s.track_code:"",access_key:s.accessKey,all:Object(i.intval)(e),source:o,progress:l,navigation_stats:(n=Ps.map((function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")})).join(";"),Ps=[],n),loading_stats:(t=xs.map((function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")})).join(";"),xs=[],t),connection_type:Ms()}),this.store.readedStories[s.raw_id]=!0,e?this.setAllAuthorStoriesReaded(this.getCurrentAuthorIndex()):this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()].unread=!1)},_requestUpdateFeedBlock:function(){var e=this.store,t=Object.keys(e.readedStories),n=this._getSource();(t.length||this._needFeedUpdate)&&"feed"===n&&(this._needFeedUpdate=!1,setTimeout((function(){Ns._requestFeedBlock()})))},_getSource:function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},_sendNavigationStatEvents:function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;n&&function(e){var t=e.storyRawId,n=e.source,i=e.action,a=t.split("_");"reply"===n&&(n="replies_list");var o={ownerId:a[0],storyId:a[1],source:n,action:i};Ps.push(o)}({storyRawId:n,source:this._getSource(),action:e})},_sendViewerStartTime:function(e,t){!function(e){var t=e.storyRawId,n=e.source,i=e.time,a=t.split("_"),o={ownerId:a[0],storyId:a[1],source:n,time:i};xs.push(o)}({storyRawId:e,source:this.viewerSource,time:t})},_requestFeedBlock:function(){var e=nav.getQuery();if(!window.store.storiesLayers.length)ajax.post("stories.php",{_ajax:1,act:"feed_block",q:e.q},{onDone:function(e,t){var n=ge("StoriesFeedBlock");n&&replace(ceFromString(e),n),Ns.pushPreloadedList(t)}})},_requestClickStat:function(e,t,n,i){ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n},{onDone:function(){i&&i()}})},_requestStickerStat:function(e,t){var n=this.getCurrentStory(),i=n.raw_id,a=n.clickable_stickers;i&&a&&ajax.post("stories.php",extend({act:"stickers_stat",story_raw_id:i,action:e,hash:a.hash},t))},_sendMessage:function(e,t,n,i){var a=ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:e,media:t,message:n,to:i},{onDone:function(){var e=window.lang;Ns.showFlashPopup(e.mobile_stories_comment_success),Ns.sendAnalyticsEvent("comment_send")}});this._saveRequest(a)},_requestFave:function(e,t,n,i){ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:cur.module})},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=t[1],i=t[2],a=t[4],o=t[6],r=n+"_"+i;return e.match(/from_feed\=1/)?a="feed":e.match(/profile\=1/)?a="profile":a||(a=r),r+"/"+a+"/"+o}return e},setHistory:function(e,t){void 0===t&&(t={nav_init:!1,replace:!0});var n=window.nav,i=this.getHistoryURL(e),a=n.getQuery();if(i.match(/narrative(-?\d+_\d+(?:_\d+)?)$/)){var o=this.getCurrentStory(),r=o.narrative,s=o.raw_id.split("_")[1];i="narrative"+r.owner_id+"_"+r.id+"_"+s}a.z=i;var l=n.path+obj2qs(a)+n.hash,c={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};n.go(l,null,c)},getFrom:function(e){void 0===e&&(e=!0);var t=window.nav,n=this.store.list,i=t.getQuery(),a="z="+i.z,o="";return"/write"===t.path.substr(0,6)?o="write"+t.path.substr(0,6)+"?"+a:"/mail"===t.path?o="write"+i.peer+"?"+a:"/feed"===t.path?o=i.section&&"notifications"===i.section?"feed?section=notifications&"+a:"feed?"+a:n.startsWith("archive")?o=t.path+"?act=stories":i.from&&(o=i.from),e?encodeURIComponent(o):o},getHistoryURL:function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},getParams:function(){return this.params||{}},toggleBookmark:function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor();if(n){var a=n.getCurrentStory(),o=a.bookmark_add_hash,r=window.store,s=(a.narrative?a.narrative:a).is_bookmarked;Object.keys(r.stories).forEach((function(e){var t=r.stories[e];if(t.authors){var n=!1;t.authors.forEach((function(e){n||(n=e.items.find((function(e){return!!e.narrative&&(e.narrative.bookmark_hash===o&&e.raw_id===a.raw_id)})))})),n&&(n.narrative?n.narrative.is_bookmarked=!s:n.is_bookmarked=!s)}})),Object(i.val)(e,s?lang.mobile_stories_menu_bookmark_title:lang.mobile_stories_menu_bookmarked_title);var l=s?"bookmark_remove":"bookmark_add",c=a.narrative,u=c.owner_id,d=c.id;t||this._requestFave(l,u,d,o),a.narrative&&Share.setBookmarkState(u+"_"+d,!s)}},share:function(e,t){var n=this,i=this.getCurrentAuthor();if(i){var a=i.getCurrentStory(),o=a.bookmark_add_hash,r=(a.narrative?a.narrative:a).is_bookmarked;this.stopStory();this.getFrom();var s=t?"narrative":"story";this.stopStory(),Share(e,{mail_hash:this.getCurrentStory().share_hash,object:s+e,is_bookmarked:r,bookmark_hash:o,bookmark_type:31,can_bookmark:t,can_to_own:t,can_to_club:t}),cur.share.onClose((function(){n.playStory()}))}},markCurrentStoryNotInterested:function(){var e=this,t=this.getCurrentStory();t?(I.init({text:Object(F.getLang)("mobile_stories_thanks_feedback"),type:I.SNACKBAR_TYPE_SUCCESS}),this.hideMenu(),ajax.post("stories.php",{act:"mark_not_interested",story_raw_id:t.raw_id,track_code:t.track_code,hash:t.canMarkNotInterestedHash},{onDone:function(){e.sendAnalyticsEvent("mark_not_interested")}})):Object(S.logError)(new Error("Fail: markNotInterested"),{environment:"mobile_stories"})},openReplies:function(e,t){void 0===t&&(t=!1),this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,{reply:!0,replyTo:t});else this.close()},hidePrivacyHint:function(e){var t=this.store.viewersState[e];if(t&&t.privacyHint){var n=t.privacyHint.privacyHintHash;t.privacyHint=null,n&&window.ajax.post("stories.php",{act:"hide_privacy_hint",privacy_hint_hash:n})}var i=Object(M.$)(".ViewsPrivacyHint");i&&i.remove(),this.sendAnalyticsEvent("hide_privacy_block")},openNarrative:function(e,t){this.playStory(),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,t);else this.close()},clickClose:function(){var e=this;requestAnimationFrame((function(){e.sendAnalyticsEvent("close_tap"),e.close()}))},close:function(e){if(void 0===e&&(e={}),extend({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var t=window.nav,n=t.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var i=window.store.storiesLayers[window.store.storiesLayers.length-1-1],a=window.store.stories[i],o=a.authorIndex,r=a.authors[o].index,s=a.authors[o].items[r];n.z=this.getHistoryURL(s.raw_id)}else delete n.z;var l=t.path+obj2qs(n)+(t.hash||"");t.go(l,null,{push_only:!0})}if(this.destroy(),e.isPopState&&e.storyRaw){var c=this._parseList(e.storyRaw).split("/")[1];this.store?this.restore(this.store.storyList,c,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,!1,!1,e)},hideAllViews:function(){var e=window.store;e&&(e.storiesLayers=[],e.stories&&Object.keys(e.stories).forEach((function(t){e.stories[t].showViews=!1,e.stories[t].isStopped=!1})))},restore:function(e,t,n,a){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===a&&(a={}),window.store.storiesLayers){var o=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(o,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var r=window.store.stories[e],s=window.store.stories[t];if(r&&s){var l=Object.keys(r.readedStories);Object(i.each)(l,(function(e,t){var n=t.split("_"),i=n[0],a=(n[1],n[2],s.replies[r.replyTo]);if(a){var o=a.filter((function(e){return e.owner_id==i}))[0];o&&(o.has_new=!1)}})),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();a.closeAll&&window.store.storiesLayers.length&&this.close(a)},clearStore:function(){this.store=this._initStore()},destroy:function(){var e=this;if(this.restoreAudio(),this.store){this.slider=null,this.hideMenu(!1),this.markSeenStoryIfNeeded(),this._abortRequests(),Object(i.removeClass)(this.layer,"Stories_inited");var t=this.getCurrentAuthorIndex(),n=this.getCurrentAuthor(),a=n&&n.getCurrentStory();if(a&&a.isOneTime&&this._removeList(),void 0!==t&&this.Authors)this.Authors[t].destroy();this.onRender.off(),Object(i.remove)(this.layer),this._requestUpdateFeedBlock(),Object.keys(this).forEach((function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])})),zlayer.close(),Object(i.addClass)(ge("StoriesFeedBlock"),"StoriesFeedBlock_been-open"),Object(i.removeClass)(document.body,"vk__story_open"),Ns.opened=!1;var o=Object(i.geByClass1)("Question__popup"),r=Object(i.geByClass1)("Popup__overlay",o);r&&X.default.close(r)}},isAutoplaySupport:function(){return this.supportAutoplay},isGoodBrowser:function(){return C.default.ios&&C.default.safari_mobile&&parseInt(C.default.version,10)>=10},detectAutoplay:function(){var e=this;return new Promise((function(t){if(e.supportAutoplay)t();else{if(e.isGoodBrowser())return e.supportAutoplay=!0,void t();e.supportAutoplay=!1;var n=Object(i.ce)("video"),a=Object(i.ce)("source");a.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var o=Object(i.ce)("source");o.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",Object(i.append)(o,n),Object(i.append)(a,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),n.muted=!0,attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),Object(i.append)(n,document.body);var r=ge("base64testvideo");if(C.default.android&&C.default.chrome)return e.supportAutoplay=!0,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(C.default.mobile&&C.default.ios&&C.default.ios<10)return e.supportAutoplay=!1,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(!C.default.safari_mobile||C.default.safari_mobile&&parseInt(C.default.version,10)>=10){var s=n.play();void 0!==s&&s.then((function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)})).catch((function(e){}))}r.onplay=function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout((function(){r.paused||(e.supportAutoplay=!0),Object(i.remove)(n),t()}),250)}}))},narrativeReply:function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},narrativeGoToStories:function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},_showTooltip:function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n=this.getCurrentAuthorEl();this.tooltip=Object(i.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=Object(i.ce)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),n.appendChild(this.tooltip);var a=0,o=0;"touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY);var r=n.getBoundingClientRect(),s=r.top,l=r.left,c=r.width,u=getSize(this.tooltip),d=u[0],_=o-(s+u[1]+10),f=a-(l+d/2);setStyle(this.tooltip,{top:Math.max(_,2),left:Math.min(Math.max(f,2),c-d-2)}),setStyle(this.tooltipArrow,{left:Math.max(Math.min(a-l-Math.min(Math.max(f,0),c-d),d-15),15)}),this.pauseStory()}else this.playStory()},_showFeatureTooltipIfNeeded:function(){var e=this,t=window.store.storiesLists;if(t&&t.needShowFeatureTooltip){var n=Ns.getCurrentAuthorEl(),a=Object(i.geByClass1)("StoriesFeatureTooltip",n);if(a){var o=setTimeout((function(){e.pauseStory(),Object(i.addClass)("StoriesFeatureTooltip--show",a),e.featureTooltip=a,e.featureTooltipHash=t.needShowFeatureTooltipHash}),2e3);t.needShowFeatureTooltip=!1,cur&&Object(F.isArray)(cur.destroy)&&cur.destroy.push((function(){clearTimeout(o)}))}}},_hideFeatureTooltip:function(e){if(this.featureTooltip){var t=Ns.getCurrentAuthorEl(),n=Object(i.geByClass1)("StoriesFeatureTooltip",t);n&&(e||this.playStory(),Object(i.removeClass)("StoriesFeatureTooltip--show",n),this.featureTooltip=null,ajax.post("stories.php",{_ajax:1,act:"hide_feature_tooltip",type:"stories_pin",hash:this.featureTooltipHash}),this.featureTooltip=null,this.featureTooltipHash=null)}},_hideTooltips:function(e){this._hideFeatureTooltip(e),this.tooltip&&(e||this.playStory(),Object(i.remove)(this.tooltip),delete this.tooltip)},_hasContext:function(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)},sendAnalyticsEvent:function(e,t){void 0===t&&(t={});var n=Ns.getCurrentStory(),a=Ns.getCurrentAuthor(),o=Ns.getCurrentStoryIndex(),r=Ns._getSource(),s=n.is_groups_meta_story,l=n.raw_id.split("_"),c=l[0],u=l[1],d=0;s&&(c=0,u=0),"groups"===this.storyList&&(d=1);var _={event_type:e,story_owner_id:c,story_id:u,time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3),view_entry_point:r,nav_screen:cur.module,story_type:s?"group_feed":"",is_grouped:d,track_code:n.track_code};if(a){var f=a.data,p=a.getCountDown();p&&f&&extend(_,{stories_author_before:o,stories_author_after:f.items.length-o,view_event_timeline_position:p.initialTime-p.left})}Object.assign(_,t),Object(ie.partConfigEnabled)("web_stats_transport_story_view")?Object(Ls.saveStoryViewStats)(_):Object(i.statlogsValueEvent)("story_product_analytics",_)},clickAuthor:function(){this.sendAnalyticsEvent("go_to_author")},askQuestionBox:function(e){Object(i.cancelEvent)(e);var t=this.getCurrentStory().can_ask;if(this.hideFlashPopup(!1),this._hideTooltips(),!t)return Ns.showFlashPopup(lang.mobile_stories_ask_question_forbidden),!1;this.stopStory(),Object(i.addClass)(this.layer,"Stories_questionOpened");var n=this.authors[this.store.authorIndex],a=Object(i.geByClass1)("Story__questionTextarea",n);requestAnimationFrame((function(){a&&a.focus()}))},changeAskAnonymous:function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+Object(i.domData)(t,"selected"),a=this.getCurrentStory();if(a){var o=[Object(X.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",Rs],class:n===Rs?"selected":""}),Object(X.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",Bs],class:n===Bs?"selected":""})];a.can_ask_anonymous&&o.splice(1,0,Object(X.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",Ds],class:n===Ds?"selected":""}));var r=Object(X.default)({class:"Story__questionSelectModal",close:!0,closeText:lang.mobile_stories_ask_question_cancel,items:o});cn.default.open(c.default.elem(r),!0)}}},changeQuestionMode:function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case Bs:Object(i.val)(n,lang.mobile_stories_ask_question_public),Object(i.domData)(n,"selected",Bs);break;case Rs:Object(i.val)(n,lang.mobile_stories_ask_question_author_only),Object(i.domData)(n,"selected",Rs);break;case Ds:Object(i.val)(n,lang.mobile_stories_ask_question_anonymous),Object(i.domData)(n,"selected",Ds)}X.default.close(e)},hideAskQuestion:function(e){void 0===e&&(e=!0),Ns.store.showMenu=!1,Object(i.removeClass)(Ns.layer,"Stories_questionOpened"),e&&Ns.playStory()},onInputQuestion:function(e){Object(M.$)(".Story__questionSend").disabled=!Object(i.trim)(Object(i.val)(e))},sendQuestion:function(){var e=Ns.getCurrentAuthorEl();if(e){var t=Object(i.geByClass1)("Story__questionTextarea",e),n=Object(i.geByClass1)("Story__questionSend",e),a=Ns.getCurrentStory(),o=a.raw_id,r=a.askQuestionHash,s=a.accessKey,l=o.split("_"),c=l[0],u=l[1],d=Object(i.trim)(Object(i.val)(t)),_=document.querySelector(".Story__questionSelect"),f=+Object(i.domData)(_,"selected"),p=!1,h=!1;f===Bs?p=!0:f===Ds&&(h=!0),Object(i.val)(t,""),n.disabled=!0;var m=ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:u,question_text:d,is_anonymous:+h,with_mention:+p,hash:r,access_key:s},{onDone:function(e){if(!e)return Ns.showFlashPopup(lang.mobile_stories_question_error),!1;var t=Ns.getCurrentAuthor().data.author;switch(Ns.showFlashPopup(lang.mobile_stories_question_sent.replace("{name}",t.first_name_ins)),f){case Bs:Ns.sendAnalyticsEvent("question_reply_publish");break;case Rs:Ns.sendAnalyticsEvent("question_reply");break;case Ds:Ns.sendAnalyticsEvent("question_reply_anonymous")}}});Ns._saveRequest(m),Ns.hideAskQuestion()}},getQuestionById:function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find((function(t){return t.id===e}))},openQuestionActions:function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,o=[Object(X.ModalMenuBtn)({inner:lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(o.push(Object(X.ModalMenuBtn)({inner:i?lang.mobile_stories_question_unban:lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),o.push(Object(X.ModalMenuBtn)({inner:lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&o.unshift(Object(X.ModalMenuBtn)({inner:lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var r=Object(X.default)({class:"Question__popup",items:o});cn.default.open(c.default.elem(r),!0)}},removeQuestion:function(e,t){var n=this,a=this.getQuestionById(t),o=a.storyOwnerId,r=a.storyId,s=a.id,l=a.removeHash;ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:o,story_id:r,question_id:s,remove_hash:l},{onDone:function(a){var l=o+"_"+r;if(X.default.close(e),!a)return requestAnimationFrame((function(){return n.showFlashPopup(lang.mobile_stories_question_error)})),!1;$$('.Question[data-id="'+t+'"]').forEach((function(e){return re(e)})),n.store.questions[l]=n.store.questions[l].filter((function(e){return e.id!==t})),$$(".Question").length<1&&re(Object(i.geByClass1)("Views__questions")),Ns.sendAnalyticsEvent("question_delete",{questionId:s})}})},replyQuestionBox:function(e,t){var n=this.getCurrentStory(),i=this.getQuestionById(t),a=i.author,o=i.text,r=lang.mobile_stories_question_reply_title.replace("{name}",a.nameGen),s=c.default.elem({class:"QuestionReplyPopup",inner:[{class:"QuestionReplyPopup__inner",inner:[{class:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+n.small_preview+")"},{class:"QuestionReplyPopup__top",inner:[{class:"QuestionReplyPopup__title",inner:r},{class:"QuestionReplyPopup__question",inner:o}]}]},{class:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{class:"QuestionReplyPopup__footer",inner:[Object(bi.default)({class:"QuestionReplyPopup__send",theme:"regular",inner:lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",t],disabled:!0}),Object(bi.default)({class:"QuestionReplyPopup__cancel",theme:"link",inner:lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});this.popout.appendChild(s),X.default.close(e)},hideReplyQuestion:function(){re(Object(i.geByClass1)("QuestionReplyPopup",Ns.popout))},onInputReplyQuestion:function(e){Object(M.$)(".QuestionReplyPopup__send").disabled=!Object(i.trim)(Object(i.val)(e))},sendReplyQuestion:function(e){var t=Object(i.trim)(Object(i.val)(Object(i.geByClass1)("QuestionReplyPopup__textarea"))),n=Ns.getQuestionById(e),a=n.id,o=n.ownerId,r=n.storyOwnerId,s=n.storyId,l=n.sendHash,c="story"+r+"_"+s,u=t+"\n\n🗣 "+n.text,d=ajax.post("mail.php",{_ajax:1,act:"send",hash:l,media:c,message:u,to:o},{onDone:function(e){var t=e&&e.error?e.message:lang.mobile_stories_comment_success;Ns.showFlashPopup(t,!1),Ns.sendAnalyticsEvent("question_send_message",{questionId:a})}});Ns._saveRequest(d),Ns.hideReplyQuestion()},showQuestions:function(e){var t=new Ts(e).render();this.popout.appendChild(t),Ns.sendAnalyticsEvent("question_show_all")},hideQuestions:function(){re(Object(i.geByClass1)("Questions",this.popout))},banQuestion:function(e,t){var n=this.getQuestionById(t),i=n.storyOwnerId,a=n.storyId,o=n.banHash,r=n.isOwnerBlocked;ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:i+"_"+a,question_id:t,ban_hash:o,is_blocked:+r},{onDone:function(i){if(!i)return X.default.close(e),void Ns.showFlashPopup(lang.mobile_stories_question_error,!1);if(!r){var a="question_ban_author";n.isAnonymous&&(a="question_ban_anonymous_author"),Ns.sendAnalyticsEvent(a,{questionId:t})}X.default.close(e),n.isOwnerBlocked=!r,Ns.showFlashPopup(r?lang.mobile_stories_question_author_unblocked:lang.mobile_stories_question_author_blocked,!1)}})},reportQuestion:function(e,t){var n=this.getQuestionById(t),i=this.getFrom();X.default.close(e);var a="story_question"+n.storyOwnerId+"_"+n.id;nav.go("/reports?act=add&object="+a+"&refrom="+i)},toggleQuestionTooltip:function(e,t){var n=this.getCurrentAuthor().getCurrentStory(),a=Object(M.$)(".QuestionSupport"),o=Object(M.$)(".Story__questionSelect"),r=+Object(i.domData)(o,"selected");if(Object(i.cancelEvent)(e),a){var s=n.firstName;n.authorId<0&&(s=lang.mobile_stories_ask_question_group_owner);var l="";switch(r){case Bs:l=lang.mobile_stories_ask_question_public_tooltip;break;case Rs:l=lang.mobile_stories_ask_question_author_only_tooltip;break;case Ds:l=lang.mobile_stories_ask_question_anonymous_tooltip}Object(M.$)(".QuestionSupport__tooltip").innerText=l.replace("{name}",s),t?Object(i.removeClass)(a,"QuestionSupport--active"):Object(i.toggleClass)(a,"QuestionSupport--active")}},openMusicStickerActions:function(e,t){var n=ge("audio"+e),i=hasClass("ai_added",n),a=Object(X.default)({close:!0,items:[Object(X.ModalMenuBtn)({class:"ai_add",inner:i?lang.global_delete_audio:lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),Object(X.ModalMenuBtn)({class:"ai_add",inner:lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),o=c.default.elem(a);o.setAttribute("id","ai_menu_"+e),cn.default.open(o,!0)},addMusic:function(e,t,n){audioplayer.add(t),X.default.close(e),Ns._hideTooltips(!0),Ns.showFlashPopup(n?lang.mobile_stories_music_deleted:lang.mobile_stories_music_added)},nextMusic:function(e,t){var n=window,i=n.audio,a=n.audioplayer,o=Vn(t);if(i.getCurrentId()){var r=i.playlist().map((function(e){return e.id})).indexOf(i.getCurrentId())+1;i.addToPlaylist([o],r)}else a.playPause(!1,o.fullId,!0),i.pause();X.default.close(e),Ns._hideTooltips()},toggleLikeForCurrentStory:function(e){var t=Ns.getCurrentStory(),n=Ns.getCurrentAuthor().story,a=t.raw_id,o=t.isLiked,r=t.likeHash,s=t.accessKey,l={act:o?"delete_like":"like",hash:r,story_raw_id:a};n.isLiked=!o,t.isLiked=!o,o?e.innerHTML=c.default.html(Object(T.default)("stories","like_outline_shadow_48")):(Object.assign(l,{access_key:s}),e.innerHTML=c.default.html(Object(T.default)("stories","like_shadow_48"))),Object(i.toggleClass)("Story__like--set",e,t.isLiked),ajax.post("stories.php",l,{onDone:function(a){a&&(n.isLiked=o,t.isLiked=o,e.innerHTML=o?c.default.html(Object(T.default)("stories","like_shadow_48")):c.default.html(Object(T.default)("stories","like_outline_shadow_48")),Object(i.toggleClass)("Story__like--set",e,t.isLiked))}})},clickToApp:function(){var e=Ns.getCurrentStory(),t=e.raw_id,n=void 0===t?"":t,i=e.accessKey,a=e.clickable_stickers,o=a&&a.stickers.find((function(e){return e.type===ks.app}));if(o&&o.appId){var r=n.split("_"),s=r[0],l=r[1];o.hasNewInteractions&&ajax.post("stories.php",{act:"mark_app_notifications_seen",owner_id:s,story_id:l,sticker_id:o.id,access_key:i,hash:o.hash},{onDone:function(){o.hasNewInteractions=!1;var e=document.querySelector(".Story__app");e&&e.classList.contains("has_new")&&e.classList.remove("has_new")}}),this.pauseStory(),this.showLoading(),nav.go("/app"+o.appId+"?ref="+o.appRef+"&hash="+o.appHash)}},openPoll:function(e,t,n){var i="/poll"+e+"_"+t+"?from=story"+n+"&story_raw="+n;nav.go(i),Ns.showLoading()},onRender:Object(l.default)()};window.page&&page.onChange((function(){window.store.storiesLayers=[],window.store.stories={}})),window.Stories=Ns,window.showNarrative=function(e,t,n,i,a){void 0===n&&(n=0),void 0===i&&(i=""),void 0===a&&(a={});var o=""+e+(n=n?"_"+n:"")+"/"+(i=i||"narrative"+e+"_"+t);Object.assign(a,{narrativeId:t}),Ns.init(o,a)};var Hs,Vs={};function Us(e){var t=$$(".StoryThumb[data-time]",e);if(t)return t.forEach((function(e){var t=1e3*e.getAttribute("data-time"),n=new Date(t);if(Vs[n.toDateString()]&&Vs[n.toDateString()]!==t){var i=geByClass1("StoryThumb-date",e);re(i)}else Vs[n.toDateString()]=t})),e}window.initStoriesArchive=function(e){var t=0,n=!1,a=$(".StoriesArchive"),o=a.classList.contains("StoriesArchive--loaded");Us(a),Object(i.initAutoScroll)((function(){var e=$$(".StoryThumb");return t=e.length,e[e.length-1]}),(function(){if(n||o)return!1;var i=$(".StoriesArchive-stories");i.classList.add("_si_container_loading"),n=!0,ajax.post("/stories_archive",{offset:t,owner_id:e,_ajax:!0},{onDone:function(e){var t=ce("div");t.innerHTML=e.html,t=Us(t),i.innerHTML+=t.innerHTML,i.classList.remove("_si_container_loading"),e.more||(o=!0,a.classList.add("StoriesArchive--loaded")),n=!1}})}))},function(e){e.IMAGE="image",e.VIDEO="video"}(Hs||(Hs={}));var Fs=function(e){var t="width: "+e.artboardWidth+"px; height: "+e.artboardHeight+"px",n=e.background_type===Hs.IMAGE?{class:"StoryPublisher__canvasLayer",width:"1080",height:"1920",style:t,tag:"canvas"}:{inner:[{src:e.src,tag:"source"}],class:"StoryPublisher__video",preload:"metadata",controls:!0,controlsList:"nodownload",onContextMenu:"cancelEvent(); return false;",tag:"video"},i=c.default.wrap(Object(F.getLang)("mobile_apps_story_publisher_description").replace("{service_name}",e.miniAppName));return{inner:[{inner:[Object(bi.default)({inner:[Object(T.default)({sprite:"base",name:"cancel_outline_28"})],theme:"header",class:"StoryPublisher__headerButton",onClick:"StoryPublisher.closePopup()",use_native_onclick:!0,is_icon:!0})],class:"StoryPublisher__header",tag:"div"},{inner:[c.default.wrap(Object(Sa.default)({mix:"al_loading StoryPublisher__spinner",type:"pageLoader",isFixed:!0})),{inner:[n],class:"StoryPublisher__canvas",style:t,tag:"div"},{inner:[i],class:"StoryPublisher__description",tag:"div"},Object(bi.default)({inner:[c.default.wrap(Object(F.getLang)("mobile_apps_story_publisher_publish_btn_text"))],onClick:"StoryPublisher.save(this)",use_native_onclick:!0})],class:"StoryPublisher__content",tag:"div"}],class:"Popup StoryPublisher",tag:"div"}};Object.assign(Fs,{init:function(e,t,n){var i=this;void 0===t&&(t=L.noop),void 0===n&&(n=L.noop),this.successHandler=this.successHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),e.artboardHeight=e.artboardHeight||(window.innerHeight<357?window.innerHeight-100:357),e.artboardWidth=e.artboardWidth||e.artboardHeight/1.78,this.props=e,this.props.src=e.src||e.url||e.blob,this.onClickSave=t,this.cb=n,this.popup=cn.default.open(c.default.elem(Fs(this.props)),!0);var a=function(){return Sa.default.hide(document.querySelector(".StoryPublisher__spinner"))};switch(this.props.background_type){case Hs.IMAGE:Object(L.loadImage)(this.props.src).then((function(e){a(),i.drawImage(e)})).catch((function(){return i.errorHandler(new Error("Can't upload image"))}));break;case Hs.VIDEO:this.validateVideo(this.props).then(a).catch(this.errorHandler)}return this},drawImage:function(e){if(this.canvas=document.querySelector(".StoryPublisher__canvasLayer"),!this.canvas)return this.errorHandler();var t=this.canvas.getContext("2d");if(!t)return this.errorHandler();var n,i,a=+(e.height/e.width).toFixed(2);if(a>1.77?(i=this.canvas.height,n=this.canvas.height/a):(n=this.canvas.width,i=this.canvas.width*a),t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.filter="blur(135px)",t.drawImage(e,0,0,this.canvas.width,this.canvas.height),t.restore(),"none"!==t.filter){var o=Object(L.getAverageRGB)(t);t.fillStyle="rgb("+o.r+", "+o.g+", "+o.b+")",t.fillRect(0,0,this.canvas.width,this.canvas.height)}t.drawImage(e,this.canvas.width/2-n/2,this.canvas.height/2-i/2,n,i)},closePopup:function(e){void 0===e&&(e=!0),e&&this.cb(),cn.default.close(this.popup),this.popup=null},successHandler:function(e){this.cb(!0,e),this.isLoading=!1,this.closePopup(!1)},errorHandler:function(e){void 0===e&&(e={}),this.props.closeAfterError&&this.closePopup(!1),this.cb(!1,{error:e}),this.isLoading=!1,bi.default.setLoading(this.shareButton,!1),I.init({type:I.SNACKBAR_TYPE_ERROR,text:e.message||Object(F.getLang)("mobile_apps_story_publisher_unexpected_error")})},save:function(e){var t=this;if(!this.isLoading){this.onClickSave(),bi.default.setLoading(e,!0),this.shareButton=e,this.isLoading=!0;var n=this.props,i=n.background_type,a=n.miniAppId,o=n.entrypoint,r=n.storyUploadUrlHash,s=n.storySaveHash;Promise.all([this.getBlob(),Object(W.getStoryUploadUrl)({mini_app_id:a,story_type:i===Hs.IMAGE?W.StoryType.PHOTO:W.StoryType.VIDEO,hash:r,entry_point:o,ref:window.cur.module})]).then((function(e){var n=e[0],i=e[1];return t.uploadStoryBlobToServer(n,i)})).then((function(e){var t=e.response;return Object(W.saveStoryOnServer)(t&&t.upload_result,s)})).then(this.successHandler).catch(this.errorHandler)}},uploadStoryBlobToServer:function(e,t){return new Promise((function(n,a){var o=Object(L.getBlobType)(e),r=9e5*Math.random(),s=new FormData,l=encodeURIComponent("story_"+r+"."+o);s.append("file0",e,l);var c=Object(i.uploadFile)(t,s,{onComplete:function(){var e=Object(i.parseJSON)(c.response);e&&e.response&&e.response.upload_result||a(),n(e)},onError:a})}))},getBlob:function(){var e=this;return this.props.background_type===Hs.IMAGE?new Promise((function(t,n){try{e.canvas.toBlob(t,"image/jpeg")}catch(e){n()}})):Object(L.getMediaBlob)(this.props.src)},validateVideo:function(e){return new Promise((function(t,n){Object(L.getVideoDuration)(e.src).then((function(i){if(e.maxVideoDuration&&i>e.maxVideoDuration)return n(new Error("The duration of the video file must not exceed 15 seconds"));t(i)})).catch((function(){return n(new Error("Can't upload video"))}))}))}}),window.StoryPublisher=Fs;var $s={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var i=ge(n+"__message-archived");if(t){var a=n+"__message-rollback",o=ce("div",{className:["post_message_item",i.className].join(" "),innerHTML:t,id:a});hide(i),ge(o)||after(o,i)}else{var r=ge(n+"__message-rollback");show(i),remove(r)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&addClass(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,i=e.restored,a=e.rollback_hash,o=this.link;cur.restored||(cur.restored=0),i&&"profile"===cur.module&&cur.restored++,removeClass(o,"wia_item--loading");var r=ge(n),s=ge(n+"_replies");if(t){if(cur.restored>3){var l=r.id+"?act=rollback_archive&hash="+a;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:l,onclick:"return ajax.click(this, Archive.rollback)",inner:getLang("mobile_archive_restore_bulk")}})}var c=r.id+"__message-archived",u=ce("div",{className:["post_message_item",r.className].join(" "),innerHTML:t,id:c});hide(r),hide(s),ge(c)||after(u,r)}else if(n){var d=ge(n+"__message-archived"),_=ge(n+"_replies");show(n),show(_),remove(d)}}}};window.Archive=$s;var Ws=function(e,t){cancelEvent(e);var n=t.getAttribute("href"),i=getLang("mobile_wall_prometheus_edit_warn");Confirm(i,'Popup.close(this); nav.go("'+n+'");',"",{title:getLang("mobile_prometheus_edit_warn_popup_title")})};window.PrometheusEditConfirm=Ws,window.CopyrightPopup={open:function(e,t,n,i){var a=Object(an.default)({class:"CopyrightPopup",header:{title:getLang("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:getLang("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(i?1:0)+")"})]}]}});an.default.open(Wd.elem(a),!0)},go:function(e,t,n){var i;if(an.default.close(e),t.startsWith("/story"))Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(?:_(\d+))?(\/?([a-z0-9_-]+))?$/i.exec(t)){var a=i,o=a[0],r=a[1],s=a[2];window.showNarrative(o,r,s,{source:"view_source"})}else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}};var qs=n("UvyM");function zs(){var e=window.lang,t=Object(M.$)(".pcont .service_msg_box");if(t){var n=Object(M.$)(".service_msg",t).innerHTML;Object(i.remove)(t);var a=Object(an.default)({class:"CopyrightPopup",content:[{inner:c.default.wrap(n)},{class:"Popup__buttons",inner:[Object(qs.default)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});an.default.open(c.default.elem(a),!0)}}window.ZeroVKPopup={open:zs,init:function(){onDOMReady((function(){zs()}))}};n("B9v3");window.initSharePage=function(e,t){var n=ge("SharePageInput__to"),i="";n&&(i=n.value);var a={};if("mail"===e&&""!==n.value&&(a=i.split(",").reduce((function(e,t){return e[t]=!0,e}),{})),"club"===e){var o=Object(M.$)(".SharePage .qsearch_wrap"),r=Object(M.$)(".hp_block",o);show(o),show(r)}var s=Object(M.$)(".SharePage .SharePanel.MessagePanel"),l=Object(M.$)(".SharePage .SharePanel.ActionsPanel");extend(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),isUndefined(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=ge("club"+e):"mail"===t&&(a=ge("peer"+e));var o=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!o:o),cur.like_search.toggleAttach(e,!o),i&&(cur.selectedMap[e]=!o),n.value=Object.keys(cur.selectedMap).filter((function(e){return cur.selectedMap[e]})).join(","));var r=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some((function(e){return!!cur.selectedMap[e]}));return s.classList.toggle("SharePanel--active",r),l.classList.toggle("SharePanel--active",!r),!1},selectedMap:a,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(a).forEach((function(t){cur.refreshSelected(t,e,!1)}))};var Ys=function(e,t,n,i,a,o,r){n?Confirm(t,"ReportConfirm.submit('"+a+"', false, "+i+", '"+o+"', "+JSON.stringify(r)+")","",{title:e,id:"confirm-"+i}):Gs(a,!0,i,o,JSON.stringify(r))};function Gs(e,t,n,i,a){"string"==typeof a&&(a=JSON.parse(a));var o=$("#mcont");setStyle(o,{"pointer-events":"none"}),ajax.post(e,Object(E.default)({_ajax:1,reason:n,onDone:function(){alert(nav.cur),isVkWebView()&&history.back()}},a)),"story"===a.type&&Stories.sendAnalyticsEvent("claim"),Object(ie.partConfigEnabled)("mvk_new_info_snackbar")||Snackbar.init({text:getLang("mobile_msg_reported")}),$$(".Confirm").forEach((function(e){return an.default.close(e)}))}Object(i.extend)(Ys,{submit:Gs}),window.ReportConfirm=Ys;var Qs=function(e){return{class:"ModalMenuUserList",inner:Object(Ja.default)({inner:e.users})}};var Ks=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[Object(T.default)({sprite:"wall",name:"cancel_16"}),{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}};function Xs(){return window.vk&&window.vk.id?window.vk.id:0}function Js(e){window.vk&&window.vk.zero||window.__dev||(window._tmr=window._tmr||[],window._tmr.push(e))}function Zs(e,t){Js({id:"2579437",url:e,referrer:t,type:"pageView",start:(new Date).getTime(),pid:Xs(),userid:Xs()}),Object(_n.getCookie)("remixtmr_login")&&(Object(_n.setCookie)("remixtmr_login","",-1),Js({id:"2579437",type:"reachGoal",goal:"mt_login",userid:Xs()}))}window.Replies={init:function(e,t){void 0===t&&(t=0);!function(e){e&&function(){var e=Object(i.geByClass1)("wall_replies"),t=Object(i.domLC)(e);if(!t||!Object(i.hasClass)("RepliesThreadNext",t))return;var n=Object(i.geByClass1)("RepliesThreadNext__link",t);Object(i.autoScroll)((function(){if(Object(i.domPN)(t)&&!Object(i.hasClass)("RepliesThreadNext_loading",t))return n}),RepliesNext,{no_cache:!0})}();(function(){var e=Object(i.ge)("reply_field");if(!e||Object(i.hasClass)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t(Object(i.throttle)((function(t){var a=t+Object(i.getCh)(),o=Object(i.getH)(e),r=a<Object(i.getY)(e)+o;r&&!n?(Object(i.setStyle)(e,{height:o}),Object(i.addClass)("RepliesField_fixed",e)):!r&&n&&(Object(i.removeClass)("RepliesField_fixed",e),Object(i.setStyle)(e,{height:null})),n=r}),10)),Object(i.onBodyScrollForce)()})(),function(e){var t=Object(i.ge)("replies_to_last"),n=Object(i.geByClass1)("RepliesWrap");if(!t||!n)return;var a=Object(i.ge)("reply_field"),o=Object(i.hasClass)("RepliesField_static",a),r=Object(i.getY)(n),s=window.onBodyScroll,l=!1;nl(),s(Object(i.throttle)((function(e){var s=e+Object(i.getCh)(),c=a&&!o?Object(i.getY)(a)-50:r+Object(i.getH)(n)-50,u=r<e&&s<c;u!==l&&(Object(i.toggleClass)("Replies_last_shown",t,u),t.setAttribute("tabindex",u?0:-1),l=u)}),10))}()}(e);var n=Object(i.ge)("reply_field"),a=Object(i.ge)("reply_field_text");mediaUpload&&n&&(mediaUpload.onStart(il),mediaUpload.onRemove((function(){il(),a.focus()})));if(it.default.checkStickers(),n){var o=window.cur;o.onStickersToggleCallbacks=o.onStickersToggleCallbacks||[],o.onStickersToggleCallbacks.push((function(e){if(Object(i.onBodyScrollForce)(),tl(),e){var t=Object(i.geByTag1)("a","stickers_panel");t&&t.focus()}else a.focus()})),function(e){var t=Object(F.getState)("mention_items_"+e);t&&Mention.init({appendTo:$(".MentionContainer"),items:t})}(t),el()}post.stickersInit()},replyTo:function(e,t,n,a,o){void 0===o&&(o="wall_reply");if(Object(i.checkEvent)(e))return!0;if(window.cur.replyTo!==n&&ul)return gl(),!0;n=n||0,Object(i.geByClass)("ReplyItem_active").forEach((function(e){Object(i.removeClass)("ReplyItem_active",e)}));var r,s=Object(i.ge)("reply_field"),l=Object(i.ge)("reply_field_text"),c=Object(i.hasClass)("RepliesField_static",s),u=!!window.post&&window.post.replyNamesRE(),d=Object(i.val)(l),_="";if(n){if(r=Object(i.ge)(o+t+"_"+n))if(c||Object(i.addClass)("ReplyItem_active",r),!Object(i.hasClass)("ReplyItem_deleted",r)&&a){var f=window.cur.replyNames[a]||{},p=f[0]||"";_=f[1]||"",d=d?u?d.replace(u,p):d:p,window.post&&window.post.onReplyClick(!0,p)}else d=u?d.replace(u,""):d}else d=u?d.replace(u,""):d;Object(i.val)(l,replaceEntities(d));var h=Object(i.ge)("reply_field_to"),m=Object(i.geByClass1)("RepliesField__infoName",h);Object(i.val)(m,Object(i.htsc)(_)),Object(i.toggleClass)("RepliesField__infoItem_shown",h,n&&_),Object(i.toggleClass)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!_);var v=Object(i.ge)("reply_field_info"),g=Object(i.ge)("reply_field_from");if(Object(i.toggleClass)("RepliesField__info_shown",v,n||g),Object(i.toggleClass)("RepliesField__info_single",v,n&&!g||!n&&g),Object(i.val)("field_reply_to",n),Object(i.val)("field_reply_to_name",n&&_?"1":""),window.cur.replyTo=n,Object(i.val)("field_timestamp",pl()),c)if(r)Unfold.changePosition(Unfold.getByName("attaches"),!0,!1),domInsertAfter(s,r);else{Unfold.changePosition(Unfold.getByName("attaches"),!0,!0);var A=Object(i.geByClass1)("wall_replies");domInsertBefore(s,A)}return tl(),el(),elfocus(l),Object(i.cancelEvent)(e)},showMoreActions:function(e,t){var n=Object(i.ge)("reply_more_"+e);if(!n)return;var a=Object(i.geByClass)("ReplyItem__action",n),o=[];a.forEach((function(e){o.push(Object(X.ModalMenuBtn)({inner:Object(i.val)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))}));var r=Object(X.default)({close:!0,items:o}),s=Object(i.ceFromString)(c.default.html(r));s=cn.default.open(s,!0,{oncloseCallback:function(){var t=Object(i.ge)("reply_more"+e);t&&t.focus()}});var l=Object(i.geByClass1)("ModalMenu__btn",s);l&&l.focus();return Object(i.cancelEvent)(t)},onClickMoreAction:function(e,t){t&&cn.default.close(t.target);var n=Object(i.ge)(e);if(!n)return;n.click()},onFieldInput:el,toggleStickers:function(e,t){if(ul)return Object(i.cancelEvent)(t);return window.post.stickersToggle(e),Object(i.cancelEvent)(t)},replyAsShow:function(e,t,n){void 0===n&&(n=!1);var a,o=!!window.cur.replyAs;ml("editing"),o?a=sl(window.cur.replyAs):(a=c.default.wrap(Object(oe.default)({large:!0})),function(e,t){void 0===t&&(t=!1);if(window.cur.replyAsLoading)return;var n=window.ajax;window.cur.replyAsLoading=!0,n.post("/wall.php",{act:"get_reply_clubs_list",only_this_group:t?1:0,post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=Object(i.ge)("reply_as_users_list");if(t){var n=sl(e);Object(i.val)(t,c.default.html(n));var a=Object(i.geByClass1)("ModalMenuUserList__item",t);a&&a.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t,n));var r=Object(X.default)({title:Object(i.getLang)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:a}]}),s=Object(i.ceFromString)(c.default.html(r));if(cn.default.open(s,!0),o){var l=Object(i.geByClass1)("ModalMenuUserList__item",Object(i.ge)("reply_as_users_list"));l&&l.focus()}return Object(i.cancelEvent)(e)},replyAsChange:function(e,t,n,a){var o=Object(i.ge)("reply_field_from"),r=Object(i.geByClass1)("RepliesField__infoName",o);return Object(i.val)(r,Object(i.htsc)(a)),Object(i.val)("field_from_oid",n),X.default.close(t),Object(i["ge"])("reply_field_text").focus(),Object(i.cancelEvent)(e)},checkSendButton:function(e){if(!rl())return Object(i.cancelEvent)(e);window.cur.needTrackMyTracker&&(void 0===t&&(t={}),Js({id:"2579437",type:"reachGoal",goal:"comment_in_sport_broadcast",userid:Xs(),params:t}));var t},onClickLastReplies:function(e,t){var n=Object(i.geByClass1)("wall_replies"),a=Object(i.domLC)(n),o=a&&Object(i.hasClass)("RepliesThreadNext",a);if(o){var r=Object(i.geByClass1)("Loading",a);r||(r=Object(i.ceFromString)(Object(oe.default)({})),append(r,a)),Object(i.addClass)("RepliesThreadNext_loading",a)}if(Object(i.removeClass)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),o)return a.focus(),ajax.click(e,window.RepliesLast);a&&(Object(i.hasClass)("RepliesThread",a)&&(a=Object(i.domPS)(a)),Object(i.hasClass)("ReplyItem",a)&&Object(i.geByClass1)("ReplyItem__name",a).focus());return Object(i.cancelEvent)(t)},onSubmitForm:function(e,t){if(pl())gl();else{if(e.preventDefault(),dl)return;dl=!0;var n=$('textarea[name="message"]',t),a=n?n.value:"",o=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),r=o[1],s=o[2];ajax.post("/wall.php",{act:"check_comment",oid:r,post_oid:s,text:a},{onDone:function(e){dl=!1;var t=e.timestamp;if(e.delay){var n=1e3*e.delay;hl(t);var a,o=$("#reply_field");Object(i.hasClass)("RepliesField_fixed",o)?a=Object(i.getH)(o)+5:Object(i.hasClass)("RepliesField_static",o)||(a=Object(i.getH)($("body"))-Object(i.getY)(o)+5),cl=Snackbar.init({type:I.SNACKBAR_TYPE_BULLYING,text:e.description,bottom:a,duration:n}),ll=setTimeout((function(){vl(),gl()}),n),function(e){var t=$("#nc_submit"),n=$(".RepliesField__field"),a=c.default.elem({class:"RepliesField__action RepliesField__action_cancel",inner:Ks({duration:e/1e3}),onclick:["Replies.abortTimer","button"]});ul=!0;var o=$(".RepliesField__action_attach"),r=$(".RepliesField__action_smile");o&&o.classList.add("RepliesField__action_disabled"),r&&r.classList.add("RepliesField__action_disabled"),n.appendChild(a),Object(i.hide)(t)}(n)}else hl(t),gl()},onFail:function(){dl=!1,gl()}})}},abortTimer:ml,setCurrentTimestamp:hl};function el(){var e=Object(i.ge)("reply_field_text"),t=Object(i.ge)("reply_field_text_fake");if(e&&t){var n=e.value;t.innerText=n,"\n"===Object(i.last)(n)&&(t.innerHTML+="&nbsp;");var a=Object(i.getH)(t);Object(i.getH)(e)!==a&&(Object(i.setStyle)(e,{height:a}),tl()),ol(),ml("editing")}}function tl(){var e=Object(i.ge)("reply_field");Object(i.hasClass)("RepliesField_static",e)||Object(i.hasClass)("RepliesField_fixed",e)&&(Object(i.setStyle)(e,{height:Object(i.getH)(Object(i.geByClass1)("RepliesField_wrap",e))}),nl(),Object(i.onBodyScrollForce)())}function nl(){var e=Object(i.ge)("replies_to_last"),t=Object(i.ge)("reply_field");if(e&&t&&!Object(i.hasClass)("RepliesField_static",t)){var n=domData(e,"bottom");n||(n=parseInt(getStyle(e,"bottom"))||20,domData(e,"bottom",n)),Object(i.setStyle)(e,"bottom",Object(i.getH)(t)+parseInt(n))}}function il(){ol(),tl();var e=(mediaUpload?mediaUpload.getAttachesCount():0)<2;["photo_device","photo","video","audio","doc"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)}))}function ol(){var e=Object(i.ge)("nc_submit");e&&Object(i.toggleClass)("RepliesField__action_send_active",e,rl())}function rl(){var e=(Object(i.ge)("reply_field_text")||{}).value;return trim(e)||mediaUpload&&mediaUpload.getAttachesCount()}function sl(e){var t=[];return e.forEach((function(e){var n;t.push({class:"ModalMenuUserList__item",href:(n={href:e[2],image:e[1],name:e[3],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}).href,onclick:n.onclick?n.onclick:null,inner:[{tag:"img",class:"ModalMenuUserList__itemAvatar",src:n.image},{class:"ModalMenuUserList__itemName",inner:n.name}]})})),Qs({users:t})}var ll,cl,ul=!1,dl=!1,_l={};function fl(){ul=!1,clearTimeout(ll),Snackbar.close(cl),vl()}function pl(){return _l[""+window.cur.replyTo]}function hl(e){_l[""+window.cur.replyTo]=e,Object(i.val)("field_timestamp",e)}function ml(e){if(ul){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],a=pl();ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:a})}fl()}function vl(){var e=$("#nc_submit"),t=($(".RepliesField__field"),$(".RepliesField__action_cancel")),n=$(".RepliesField__action_attach"),a=$(".RepliesField__action_smile");n&&n.classList.remove("RepliesField__action_disabled"),a&&a.classList.remove("RepliesField__action_disabled"),Object(i.remove)(t),Object(i.show)(e)}function gl(){var e=$("#nc_submit");nav.go(e,event),hl(0)}nav.onBeforeGo((function(e,t){var n=location.pathname.substr(1,4);isString(e)&&e.substr(1,4)!==n&&"wall"===n&&(_l={})})),window.page&&page.onChange((function(e,t){fl()}));window.PostDraftReminder={openContextMenu:function(e,t,n){var i=window.lang;e.preventDefault(),e.stopPropagation();var a=Wd.html([Object(le.ContextMenuItem)({title:i.mobile_wall_draft_delete,href:n.remove_url,ref:"wall_draft_reminder"})]),o=Wd.elem(Object(le.ContextMenu)({list:a}));o.parentNode.id="post_draft_reminder_container",le.ContextMenu.open(o,"#post_draft_reminder_container",{appendToBody:!0})}};var Al=n("6Mr/");window.TextliveFeedBanner={close:function(e){return function(){var e=window.lang;if(!Object(Al.canShow)("feed:textlive_hide"))return;var t=Object(M.$)(".BottomMenu__cell:nth-child(4) .BottomMenu__icon"),n=Wd.elem(Object(Al.default)({pos:"top_right",theme:"accent",inner:e.mobile_textlive_notifications_tooltip,onboarding:!0,"tooltip-id":"feed:textlive_hide"}));t.appendChild(n)}(),ajax.click(e,window.Comment)},restore:function(e){return ajax.click(e,window.Comment)},onTextliveOpen:function(){Object(i.statlogsValueEvent)("textlive_banner_action",null,"open")}};var bl=n("VzJG");window.MainMenu={showMenuItems:bl.showMenuItems},Router.getRouter().addRoute(/^\/menu([\?#].*)?$/,bl.rebuildNotifications);window.PostAttachVideoLink={},PostAttachVideoLink._onInit=jl,PostAttachVideoLink._onPlayClick=Tl,PostAttachVideoLink._onReplayClick=Tl,PostAttachVideoLink._onSoundClick=El,PostAttachVideoLink._onVideoClick=Il,PostAttachVideoLink._onVideoPlay=function(e){return Ml(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return Ml(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return Ml(e.target,"end")};var yl="PostAttachVideoLink_muted",wl=function(e){return"PostAttachVideoLink_state_"+e},Sl=".PostAttachVideoLink",kl=".PostAttachVideoLink__video",Ol=window.MutationObserver,Cl=null;function jl(){Ol&&!Cl&&(Cl=new Ol(Pl)).observe(document.body,{childList:!0,subtree:!0})}function El(e){var t=e.closest(Sl),n=Object(M.$)(kl,t);n.muted=!n.muted,t.classList.toggle(yl,n.muted)}function Tl(e){var t=e.closest(Sl);Object(M.$)(kl,t).play()}function Il(e){e.paused||e.pause()}function Ml(e,t){var n=e.closest(Sl);n.classList.remove(wl("play")),n.classList.remove(wl("pause")),n.classList.remove(wl("end")),n.classList.add(wl(t))}function Pl(e){e.forEach((function(e){e.removedNodes.forEach((function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&Object(M.$$)(kl,e).forEach((function(e){e.src="",e.load()}))}))})),Object(M.$)(kl)||(Cl.disconnect(),Cl=null)}var xl,Ll,Bl,Rl,Dl;n("bRFj"),n("eyw1");window.FeedAssistanceStats=((xl={register:bc,forceRegister:function(e,t){e[Nl]=wc(e),e[Vl]=t,ic.push(e)},onScroll:throttle(kc,50),onStartViewElement:Object(l.default)("element"),onEndViewElement:Object(l.default)("element"),onStopTrackElement:Object(l.default)("element"),onViewedElement:Object(l.default)("element"),onBeforePageChange:Ec,onPageChanged:Tc,getElementType:wc,registerElements:gc,registerTrackingCls:function(e){hc.push(e)},unregisterTrackingCls:vc}).unregisterTrackingCls=vc,xl.setParenViewableX=function(e,t){e._feedAssistanceStatsParentViewableX=t},xl.forceProcessTrack=yc,xl.dispatchElementEvent=function(e,t){var n=function(e){return Zl[e]}(Zc(t[Nl]||wc(t),e));Pc({type:e,data:n(t)})},xl.dispatchEvent=function(e){Pc(e)},xl.serializeEventData=Sc,xl.clearElemsCache=function(){ic.forEach((function(e){e[Wl]=!1,e[ql]=!1}))},xl._debug=function(){return{started:ac,tracking:ic,events:pc,blindTop:rc,blindBottom:sc}},xl.getFromRef=lu,xl.getRoot=cu,xl.BLOCKS={},xl.EVENTS={},xl);var Nl="_feedAssistanceStatsType",Hl="_feedAssistanceStatsIdled",Vl="_feedAssistanceStatsModule",Ul="_feedAssistanceStatsStarted",Fl="_feedAssistanceStatsProcessed",$l="_feedAssistanceStatsEventTs",Wl="_feedAssistanceStatsCachedY",ql="_feedAssistanceStatsCachedX",zl="_feedAssistanceStatsLeft",Yl="_feedAssistanceStatsHeight",Gl="_feedAssistanceStatsWidth",Ql="_feedAssistanceStatsTop",Kl="_feedAssistanceStatsBottom",Xl=((Ll={}).BLOCK_TYPE_RECOMMENDED_SLIDER="view_block",Ll.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER="view_block",Ll.BLOCK_TYPE_PROMO_BUTTON="view_block",Ll.BLOCK_TYPE_EXPLORE_BAIT="explore_bait",Ll.BLOCK_TYPE_PROFILE_PHOTO="feed_assistance",Ll.BLOCK_TYPE_IMPORT_CONTACTS="feed_assistance",Ll.BLOCK_TYPE_PUSH_SWITCH="feed_assistance",Ll),Jl=((Bl={}).BLOCK_TYPE_RECOMMENDED_SLIDER=500,Bl.BLOCK_TYPE_EXPLORE_BAIT=500,Bl.BLOCK_TYPE_PROFILE_PHOTO=500,Bl.BLOCK_TYPE_IMPORT_CONTACTS=500,Bl.BLOCK_TYPE_PUSH_SWITCH=500,Bl),Zl=((Rl={})[Zc("BLOCK_TYPE_RECOMMENDED_SLIDER","view_block")]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code");return Sc("view_block","",e,domData(t,"ref"),n)},Rl[Zc("BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER","view_block")]=function(e){var t=e.querySelector(".Slider__scroll");return Sc("view_block","",e,"",domData(t,"code"))},Rl[Zc("BLOCK_TYPE_PROMO_BUTTON","view_block")]=function(e){return Sc("view_block",geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button",e)},Rl[Zc("BLOCK_TYPE_EXPLORE_BAIT","explore_bait")]=function(){return Sc("SUB_EXPLORE_BAIT","view")},Rl[Zc("BLOCK_TYPE_PROFILE_PHOTO","feed_assistance")]=function(e){return Sc("feed_assistance",e,"m_ph","seen")},Rl[Zc("BLOCK_TYPE_IMPORT_CONTACTS","feed_assistance")]=function(e){return Sc("feed_assistance",e,"m_mp","seen")},Rl[Zc("BLOCK_TYPE_PUSH_SWITCH","feed_assistance")]=function(e){return Sc("feed_assistance",e,"m_push_switch","seen")},Rl),ec=((Dl={}).view_block=function(e,t,n,i){return n=n||lu(t),[e,domChildIndex(t),uu(t),n,i].join("|")},Dl.SUB_EXPLORE_BAIT=function(e){return e},Dl.feed_assistance=function(e,t,n){return[t,n,lu(e)].join("|")},Dl.hide=function(e,t){return[e,uu(t),domChildIndex(t),lu(t)].join("|")},Dl.SUB_PROMO_BUTTON=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},Dl),tc="feedAssistanceStat.events",nc="feedAssistanceStat.idled",ic=[],ac=[],oc=Date.now(),rc=0,sc=0,lc=!1,cc=null,uc=null,dc=null,_c=null,fc=null,pc=[],hc=[],mc=!1;function vc(e){iu(hc,e)}function gc(){var e=[];each(hc,(function(){e=e.concat(geByClass(this))})),each(e,(function(){bc(this,"feed")}))}function Ac(){gc();var e=Qc();e.length&&(qc(e),Kc()),yc(),Nc()}function bc(e,t){!e[Nl]&&function(e){return!~ic.indexOf(e)}(e)&&(e[Nl]=wc(e),e[Vl]=t,ic.push(e))}function yc(){Ic(scrollGetY(),getCh())}function wc(e){return e[Nl]?e[Nl]:hasClass("feedAssistance_recommendedFriends",e)?"BLOCK_TYPE_RECOMMENDED_SLIDER":e.classList.contains("feedAssistance_recommendedGroups")?"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER":hasClass("post_exploreBait",e)?"BLOCK_TYPE_EXPLORE_BAIT":hasClass("feedAssistance_profilePhoto",e)?"BLOCK_TYPE_PROFILE_PHOTO":hasClass("feedAssistance_promoButton",e)?"BLOCK_TYPE_PROMO_BUTTON":hasClass("feedAssistance_importContacts",e)?"BLOCK_TYPE_IMPORT_CONTACTS":hasClass("feedAssistance_pushNotificationsSwitch",e)?"BLOCK_TYPE_PUSH_SWITCH":"BLOCK_TYPE_DEFAULT"}function Sc(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ec[e].apply(ec,n)}function kc(e,t){var n,i=kc;Ic(e||scrollGetY(),t||getCh()),lc||mc?(clearTimeout(i.timer),i.timer=setTimeout(Oc,150),mc=!1):(lc=!0,Dc(),n=ge("vk_head"),rc=n&&n.offsetHeight,sc=0)}function Oc(){Dc(),Rc(),lc=!1}function Cc(){Dc(),su(ac),qc(pc.concat(Jc(ac))),ou(ac),pc=[],ac=[],Hc()}function jc(){ac.forEach((function(e){e[Ul]=Date.now()})),zc(null),Yc(null),Rc(),Hc(),Nc()}function Ec(){Dc(),su(ac),pc=pc.concat(Jc(ac)),ou(ac),ac=[],mc=!0,Rc()}function Tc(){gc(),yc()}function Ic(e,t){var n=[];ic.forEach((function(i){nu(i)?n.push(i):!function(e,t,n){return!e[Ul]&&Lc(e,.5,t,n)&&Bc(e,.5)}(i,e,t)?!function(e,t,n){return e[Ul]&&(!Lc(e,.25,t,n)||!Bc(e,.25))}(i,e,t)?xc(i)&&(Mc(i),FeedAssistanceStats.onViewedElement(i)):(i[Hl]?delete i[Hl]:(Mc(i),FeedAssistanceStats.onEndViewElement(i)),delete i[Ul]):(i[Ul]=Date.now(),ac.push(i),FeedAssistanceStats.onStartViewElement(i))})),n.forEach((function(e){iu(ic,e),FeedAssistanceStats.onStopTrackElement(e)}))}function Mc(e){iu(ac,e),ru(e),Pc(tu(e)),au(e)}function Pc(e){e&&pc.push(e)}function xc(e){return!!e[Ul]&&Math.min(3e5,Date.now()-e[Ul])>function(e){var t=wc(e);return Jl[t]||500}(e)}function Lc(e,t,n,i){if(!e)return!1;e[Wl]||(e[Wl]=!0,e[Yl]=e.offsetHeight,e[Ql]=n+e.getBoundingClientRect().top,e[Kl]=e[Ql]+e[Yl]);var a=i-rc-sc,o=n+rc,r=n+i-sc,s=e[Yl],l=e[Ql],c=e[Kl];return(c>o&&l<r?Math.min(r,c)-Math.max(o,l):0)>=Math.min(a*t,s*t)}function Bc(e,t){var n=e._feedAssistanceStatsParentViewableX;n&&!n[ql]&&~ic.indexOf(n)&&(n[ql]=!0,n[Gl]=n.clientWidth,n[zl]=n.getBoundingClientRect().left+n.clientLeft),e[ql]||(e[ql]=!0,e[Gl]=e.offsetWidth);var i=n?n[Gl]||n.clientWidth:getCw(),a=n?n[zl]||n.getBoundingClientRect().left+0:0,o=i+a,r=e[Gl],s=e.getBoundingClientRect().left,l=r+s,c=r*t,u=r*Math.max(0,1-t);return s+c>=a&&l-u<=o}function Rc(){cc=setTimeout(Vc,2500),uc=setTimeout(Uc,1e4),dc=setTimeout(Fc,6e3),_c=setTimeout($c,2e4)}function Dc(){clearTimeout(cc),clearTimeout(uc),clearTimeout(dc),clearTimeout(_c)}function Nc(){fc=setInterval(Wc,3e4)}function Hc(){clearInterval(fc)}function Vc(){pc.length&&zc(pc)}function Uc(){qc(pc),pc=[],zc(null)}function Fc(){ac.length&&(Yc(Jc(ac)),dc=setTimeout(Fc,5e3))}function $c(){clearTimeout(dc),su(ac),qc(Jc(ac)),ou(ac),ac.forEach((function(e){e[Hl]=!0})),ac=[],Yc(null)}function Wc(){pc.length>=100&&Uc()}function qc(e){if(e&&e.length){var t={act:"assistance_stats"};t=extend(t,(n={},each(e,(function(){n[this.type]?n[this.type].push(this.data):n[this.type]=[this.data]})),n)),ajax.post("/feed",t)}var n}function zc(e){Gc(tc,e)}function Yc(e){Gc(nc,e)}function Gc(e,t){var n=lsGet(e)||{};t?n[oc]=t:delete n[oc],lsSet(e,n)}function Qc(){var e=Qc,t=[],n=lsGet(tc)||{},i=lsGet(nc)||{};return e.iterator||(e.iterator=function(e){return function(n){Xc(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function Kc(){var e=Kc,t=lsGet(tc)||{},n=lsGet(nc)||{};e.iterator||(e.iterator=function(e){return function(t){Xc(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(tc,t),lsSet(nc,n)}function Xc(e){var t=Number(e);return t!==oc&&Date.now()-t>=36e4}function Jc(e){var t=[];return e.forEach((function(e){var n=tu(e);n&&t.push(n)})),t}function Zc(e,t){return e+"_"+t}function eu(e,t){return(0,Zl[Zc(e[Nl],t)])(e)}function tu(e){if(nu(e))return null;if(!xc(e))return null;var t=function(e){return Xl[e[Nl]]}(e);return{type:t,data:eu(e,t)}}function nu(e){return e[Fl]||!document.body.contains(e)}function iu(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function au(e){nu(e)||xc(e)&&(e[Fl]=!0)}function ou(e){each(e,(function(){au(this)}))}function ru(e){e[$l]=Date.now()}function su(e){e.forEach(ru)}function lu(e){return(e=cu(e))&&domData(e,"from-ref")||"feed_other"}function cu(e){return hasClass(e,"feedAssistance")||(e=domCA(e,".feedAssistance")),e}function uu(e){var t=(new Date).getTime();return e&&(e[$l]||e[Ul])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:"BLOCK_TYPE_RECOMMENDED_SLIDER",BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER:"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER",BLOCK_TYPE_EXPLORE_BAIT:"BLOCK_TYPE_EXPLORE_BAIT",BLOCK_TYPE_PROFILE_PHOTO:"BLOCK_TYPE_PROFILE_PHOTO",BLOCK_TYPE_PROMO_BUTTON:"BLOCK_TYPE_PROMO_BUTTON",BLOCK_TYPE_IMPORT_CONTACTS:"BLOCK_TYPE_IMPORT_CONTACTS"},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:"explore_bait",EVENT_EXPLORE_BAIT_SUB:"SUB_EXPLORE_BAIT",EVENT_FEED_ASSISTANCE:"feed_assistance",SUB_EVENT_EXPLORE_BAIT_VIEW:"view",SUB_EVENT_EXPLORE_BAIT_LIKE:"like",SUB_EVENT_EXPLORE_BAIT_COMMENT:"comment",SUB_EVENT_EXPLORE_BAIT_OPENED:"opened",SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:"subscribe",SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:"unsubscribe",SUB_EVENT_EXPLORE_BAIT_OPEN_USER:"open_user",SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:"open_group",SUB_EVENT_EXPLORE_BAIT_HIDE:"hide",SUB_EVENT_EXPLORE_BAIT_REPORT:"report",SUB_EVENT_SEEN:"seen",SUB_EVENT_FILLED:"filled",EVENT_HIDE_BLOCK:"hide",SUB_EVENT_ENABLE_PUSH:"enable_push",SUB_EVENT_DECLINE_PUSH:"decline_push",EVENT_PROMO_BUTTON:"promo_button",EVENT_PROMO_BUTTON_SUB:"SUB_PROMO_BUTTON",SUB_EVENT_PROMO_BUTTON_CLICK:"clicked"},addEvent(window,"blur",Cc),addEvent(window,"focus",jc),onDOMReady((function(){setTimeout(Ac,500)})),addEvent(window,"scroll",(function(){kc(scrollGetY(),getCh())})),nav.onBeforeGo((function(){return Ec()})),page.onChange((function(){return Tc()}));n("yuVR");function du(e){return Object.keys(e).map((function(t){return t+":"+e[t]+";"})).join("")}function _u(e){return e+"-"+Date.now()+"-"+Math.round(999999*Math.random())}var fu=[];function pu(e){fu.push(e),hu()}var hu=Object(i.debounce)((function(){var e=fu.map((function(e){return Object(M.$)("#"+e)})).filter((function(e){return e})).map((function(e){var t=Math.round(e.getBoundingClientRect().left),n="skeleton-gradient-slide-"+t;return function(e,t){if(vu[e])return;var n=function(e,t){return["@"+mu()+"keyframes "+e+" {",t.map((function(e,n){return["\t"+n/(t.length-1)*100+"% {",Object.keys(e).map((function(t){return"\t\t"+t+": "+e[t]+";"})).join("\n"),"\t}"].join("\n")})).join("\n"),"}"].join("\n")}(e,t);vu[e]=n,gu.appendChild(document.createTextNode(n))}(n,[{"background-position-x":-600-t+"px"},{"background-position-x":window.innerWidth-t+"px"}]),{el:e,prop:n+" 1.2s infinite cubic-bezier(0.4, 0.0, 0.2, 1)"}}));requestAnimationFrame((function(){e.forEach((function(e){var t=e.el,n=e.prop;t.style[mu()+"animation"]=n})),fu=[]}))}),100);function mu(){var e="";document&&(e=null!=(document.documentElement||document.createElement("div")).style.animation?"":"-webkit-");return e}var vu={},gu=document.createElement("style");function Au(e){void 0===e&&(e={});var t=_u("skeleton-circle"),n=du({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",s.default.class("SkeletonCircle",{header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return pu(t),{id:t,class:i,style:n,tag:"div"}}document.head.appendChild(gu);function bu(e){void 0===e&&(e={});var t=_u("skeleton-line"),n=du({})+(e.style||""),i=["SkeletonComponent__item",s.default.class("SkeletonLine",{small:e.small,header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return pu(t),{id:t,class:i,style:n,tag:"div"}}function yu(e){void 0===e&&(e={});var t=[s.default.class("SkeletonRow",{justifyContent:e.justify,alignItems:e.align},"--"),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function wu(e){void 0===e&&(e={});var t=[s.default.class("SkeletonCol",{auto:e.auto,grow:e.grow,flexColumn:e.flexColumn},"--"),e.class].filter((function(e){return e})).join(" ");return{inner:[e.inner],class:t,tag:"div"}}function Su(e){void 0===e&&(e={});var t=[s.default.class("SkeletonOffset",{small:e.small},"--"),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function ku(e){void 0===e&&(e={});var t,n,a=du({opacity:e.opacity});return{inner:[yu({inner:[wu({inner:[Au({size:(t={s:32,modern:40,l:48},n=null,Object(i.getCw)()<=270&&null!=t.xs&&(n=t.xs),Object(i.getCw)()<=319&&null!=t.s&&(n=t.s),Object(i.getCw)()>=320&&null!=t.modern&&(n=t.modern),Object(i.getCw)()>=400&&null!=t.l&&(n=t.l),Object(i.getCw)()>=480&&null!=t.xl&&(n=t.xl),Object(i.getCw)()<=881&&null!=t.mobile&&(n=t.mobile),Object(i.getCw)()>=882&&null!=t.xxl&&(n=t.xxl),Object(i.getCw)()>=882&&null!=t.desktop&&(n=t.desktop),n),style:a})],auto:!0}),wu({inner:[yu({inner:[wu({inner:[bu({style:a})],grow:3}),wu({grow:4})]}),yu({inner:[wu({inner:[bu({small:!0,style:a})]}),wu({grow:3})]})],flexColumn:!0})]}),Su(),yu({inner:[wu({inner:[bu({style:a})],grow:4}),wu({inner:[bu({style:a})],grow:3})]}),Su(),yu({inner:[wu({inner:[bu({style:a})],grow:4}),wu({grow:1})]}),Su(),yu({inner:[wu({inner:[bu({style:a})],grow:4}),wu({grow:3})]}),Su(),Su(),yu({inner:[wu({inner:[Au({size:24,style:a})],auto:!0}),Su(),wu({inner:[Au({size:24,style:a})],auto:!0}),Su(),wu({inner:[Au({size:24,style:a})],auto:!0}),wu({grow:1}),wu({inner:[Au({size:24,style:a})],auto:!0})]})],class:"SkeletonWallBlock Post__rowPadding",tag:"div"}}function Ou(e){void 0===e&&(e={});var t=_u("skeleton-search"),n=du({})+(e.style||""),i=["SkeletonComponent__item",s.default.class("SkeletonSearch",{small:e.small,header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return pu(t),{id:t,class:i,style:n,tag:"div"}}function Cu(e){return{inner:[yu({inner:[wu({inner:[yu({inner:[wu({inner:[Ou({header:!0})]}),Su({small:!0}),wu({inner:[Au({class:"SkeletonSearchHeader__icon",header:!0,size:28})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonSearchHeader",tag:"div"}}function ju(e){for(var t=Math.ceil((window.innerHeight-56)/210),n=[],i=0;i<t;i++)n.push(ku());return{inner:[Cu(),Object(fs.Separator)(),n],class:"SkeletonComponent__page SkeletonRecommended Skeleton",tag:"div"}}function Eu(e){void 0===e&&(e={});var t=du({opacity:e.opacity});return{inner:[yu({inner:[wu({inner:[Au({size:50,style:t})],auto:!0}),wu({inner:[yu({inner:[wu({inner:[bu({style:t})],grow:3}),wu({grow:4}),wu({inner:[bu({style:t})]})],justify:"center"}),yu({inner:[wu({inner:[bu({style:t})]}),wu({inner:[bu({style:t})],grow:5}),wu({grow:3,style:t})]})],flexColumn:!0})]})],class:"SkeletonChatBlock Post__rowPadding",tag:"div"}}function Tu(e){void 0===e&&(e={});var t={};e.hideIcon&&(t.visibility="hidden");var n=du(t);return{inner:[yu({inner:[wu({inner:[yu({inner:[wu({inner:[bu({header:!0})],grow:5}),wu({grow:5}),wu({inner:[Au({class:"SkeletonHeader__icon",header:!0,size:28,style:n})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonHeader Post__rowPadding",tag:"div"}}function Iu(e){return{inner:[Ou()],class:"SkeletonSearchBlock Post__rowPadding",tag:"div"}}function Mu(e){for(var t=Math.ceil((window.innerHeight-56)/70),n=[],i=0;i<t;i++)n.push(Eu());return{inner:[Tu(),Iu(),n],class:"SkeletonComponent__page SkeletonMessages Skeleton",tag:"div"}}function Pu(e){void 0===e&&(e={});var t=du({opacity:e.opacity});return{inner:[Au({class:"SkeletonStory__avatar",size:56,style:t}),yu({inner:[Su({small:!0}),wu({inner:[bu({small:!0,style:t})]}),Su({small:!0})]})],class:"SkeletonStory",tag:"div"}}function xu(e){void 0===e&&(e={});for(var t=Math.ceil(window.innerWidth/76),n=[],i=0;i<t;i++)n.push(wu({inner:[Pu()],auto:!0}));return{inner:[yu({inner:[n]})],class:"SkeletonStoriesBlock Post__rowPadding",tag:"div"}}function Lu(e){return{inner:[yu({inner:[wu({inner:[Au({size:40})],auto:!0}),wu({inner:[Ou()]})],justify:"center"})],class:"SkeletonNewPostBlock Post__rowPadding",tag:"div"}}function Bu(e){for(var t=Math.ceil((window.innerHeight-56-180)/210),n=[],i=0;i<t;i++)n.push(ku());return{inner:[Tu({hideIcon:!0}),Lu(),xu(),n],class:"SkeletonComponent__page SkeletonFeed Skeleton",tag:"div"}}function Ru(e){void 0===e&&(e={});var t=_u("skeleton-line"),n=du({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",s.default.class("SkeletonSquare",{},"--"),e.class].filter((function(e){return e})).join(" ");return pu(t),{id:t,class:i,style:n,tag:"div"}}function Du(e){return{inner:[yu({inner:[wu({inner:[Au({size:48}),Au({size:20,class:"SkeletonNotificationBlock__badge"})],auto:!0,class:"SkeletonNotificationBlock__avatar"}),wu({inner:[Su({small:!0}),yu({inner:[wu({inner:[bu()]})]}),yu({inner:[wu({inner:[bu()],grow:2}),wu()]}),yu({inner:[wu({inner:[bu({small:!0})]}),wu({grow:5})]})],grow:6}),wu(),wu({inner:[Ru({size:48})],auto:!0})],align:"flex-start"}),Su(),Su(),yu({inner:[wu({inner:[Au({size:48})],auto:!0}),wu({inner:[Su({small:!0}),yu({inner:[wu({inner:[bu()]})]}),yu({inner:[wu({inner:[bu({small:!0})]}),wu({grow:5})]}),Su()],grow:4}),wu({inner:[Su()]})],align:"flex-start"})],class:"SkeletonNotificationBlock Post__rowPadding",tag:"div"}}function Nu(e){for(var t=Math.ceil((window.innerHeight-56)/170),n=[],i=0;i<t;i++)n.push(Du());return{inner:[Tu({hideIcon:!0}),Object(fs.Separator)(),{inner:[yu({inner:[wu({inner:[bu()],grow:3}),wu({grow:2}),wu({inner:[bu()],grow:2})]})],class:"SkeletonNotifications__info Post__rowPadding",tag:"div"},n],class:"SkeletonComponent__page SkeletonNotifications Skeleton",tag:"div"}}var Hu=function(){var e,t=Math.max(window.innerHeight,window.innerWidth),n=["feed","recommend","messages","notification","menu"],a="",o={},r=((e={}).feed=0,e.recommend=0,e.messages=0,e.notification=0,e.menu=0,e);function s(e){var t=geBySel1('[data-tabbar="'+e+'"]');return attr(t,"data-default")}function l(e){each(geBySel("[data-tabbar]"),(function(t,n){var i=geByClass1("_BottomMenu__icon_js",n),a=geByClass1("BottomMenu__counter",i),o=attr(n,"data-counter"),r=attr(n,"data-tabbar");e({i:t,tabId:r,counter:o,$link:n,$icon:i,$counter:a})}))}function c(){l((function(e){var t=e.$counter,n=e.$icon,i=(e.$link,e.tabId),a=r[i],o=n.outerHTML.includes("Tooltip");if(a&&0!==a||o)if(t&&!o)val(t,a);else{var s,l=ceFromString(n.outerHTML),c=ce("div",{className:"BottomMenu__counter",innerHTML:a});if(o)val(n,null==(s=$(".Tooltip",l))?void 0:s.outerHTML);a&&append(c,n)}else val(n,"")}))}function u(e){setTimeout((function(){d()}),0);var t=Wd.html({class:"pcont bl_cont",inner:{id:"al_loading",class:"BottomMenu__preloader"}});val(geByClass1("mcont",e),t)}function d(){var e=$(".BottomMenu__updateButton");remove(e)}return{setCurrentId:function(e){a=e},setHistory:function(e){o=extend({},e)},setCounter:function(e,t){r[e]=t?parseInt(t,10):0,c()},getCurrentId:function(){return a},getDefaultURL:s,getTabCounter:function(e){return r[e]?r[e]:0},drawUI:function(){l((function(e){var t=e.$icon,n=e.$link,i=e.tabId,r=o[i];if(r){var l=r.filter((function(e){return!0===e.current}))||[];l.length&&"messages"!==i&&attr(n,"href",l[0].a);var c=attr(n,"href");i!==a||!l.length||l[0].a!==c&&l[0].d!==c||attr(n,"href",s(i))}toggleClass("BottomMenu__icon_active",t,i===a)})),c()},drawUICounters:c,drawLoader:u,drawSkeletonLoader:function(e,t){if(hasClass(document.querySelector(".vk"),"vk_flex_yes"))switch(setTimeout((function(){d()}),0),t){case"feed":$(".mcont",e).innerHTML=Wd.html(Bu());break;case"messages":$(".mcont",e).innerHTML=Wd.html(Mu());break;case"notification":$(".mcont",e).innerHTML=Wd.html(Nu());break;case"recommend":$(".mcont",e).innerHTML=Wd.html(ju());break;case"menu":default:u(e)}else u(e)},showUpdateButton:function(e){var t=window.lang,n=Wd.html({class:"BottomMenu__updateButton",inner:{class:"BottomMenu__updateButton_container",inner:{class:"BottomMenu__updateButton_wrap",onclick:["nav.updateCurrentPage"],inner:[{class:"BottomMenu__updateButton_icon",inner:Object(T.default)("wall","up_update_16")},{class:"BottomMenu__updateButton_text",inner:t.mobile_menu_refresh_button}]}}}),i=hasClass("vk_custom_scroll",geByTag1("body")),a=e.$(i?".basis":".upanel");a.$(".BottomMenu__updateButton")||a.insertBefore(ceFromString(n),a.firstChild)},removeUpdateButton:d,onFocusIn:function(e){var t=geBySel1(".BottomMenu"),n=e&&e.target;if(n&&t&&browser.android){var i=!1;"textarea"===n.tagName.toLowerCase()&&(i=!0),"input"!==n.tagName.toLowerCase()||["checkbox","radio"].includes(n.type)||(i=!0),"select"===n.tagName.toLowerCase()&&(i=!0),i&&t.classList.add("vk_tabbar_hidden")}},onFocusOut:function(){var e=geBySel1(".BottomMenu");e&&e.classList.remove("vk_tabbar_hidden")},onResize:function(){var e=window.bodyNode;$(".Skeleton")&&($(".mcont").innerHTML='<div class="pcont bl_cont"><div id="al_loading"></div></div>',Object(i.alLoadingFix)()),e&&e.classList.contains("vk_tabbar_bottom")&&0===Math.abs(window.orientation)&&t-180>window.innerHeight?e.classList.add("vk_tabbar_hidden"):e&&e.classList.remove("vk_tabbar_hidden")},setDefaultCounters:function(){l((function(e){var t=e.tabId,n=e.counter;r[t]=n?parseInt(n,10):0})),c()},TAB_ID_FEED:"feed",TAB_ID_RECOMMEND:"recommend",TAB_ID_MESSAGES:"messages",TAB_ID_NOTIFICATION:"notification",TAB_ID_MENU:"menu",TAB_IDS:n}}();window.Tabbar=Hu;var Vu=Hu;window.page&&page.onRestore(Hu.drawUI),window.page&&page.onChange(Hu.drawUI),onDOMReady((function(){var e;Hu.setDefaultCounters(),addEvent(window,"resize",(function(){Hu.onResize(),clearTimeout(e),e=setTimeout((function(){Hu.onResize()}),300)}))}));var Uu=!1;page.onChange(qu),photoview.onHide(qu),photoview.onShow(zu),a.colorScheme.onInit((function(){Uu||Wu()})),a.colorScheme.subscribe((function(){Uu||Wu()}));var Fu,$u=Object(M.$)('meta[name="theme-color"]');function Wu(){a.colorScheme.isDarkScheme()?Yu("#050505"):Yu("#ffffff")}function qu(){Uu=!1,Wu()}function zu(){Uu=!0,Yu("#050505")}function Yu(e){Fu||(Fu=Object(M.$)("#theme_color_shim")),$u&&$u.setAttribute("content",e),Fu&&(Fu.style.backgroundColor=e)}n("U34x");var Gu,Qu,Ku,Xu,Ju,Zu=[".basis__header_unauthorized"],ed=!1;function td(){ed||(Gu={vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),headerFirstIcon:geByClass1("GroupCoverIcons__icon--back_outline_28",geByClass1("basis__header")),headerSecondIcon:geByClass1("GroupCoverIcons__icon--back_outline_white_28",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}).cover&&(ed=!0,addClass(Gu.vk,"groupCover-vk_animationYes"),Qu=!C.default.chrome||Number(C.default.version.split(".")[0])>50,Ku="fixed"===getStyle(Gu.header,"position"),Xu=getH(Gu.header),Ju=getH(Gu.cover),onBodyScroll(id),onBodyResize(ad),id(),window.cur.destroy=window.cur.destroy.filter((function(e){return e!==nd})),window.cur.destroy.push(nd))}function nd(){(!0||menu.opened())&&(removeClass(Gu.vk,"groupCover-vk_animationStep"),removeClass(Gu.vk,"groupCover-vk_animationYes")),onBodyScroll("__clear",id),onBodyResize("__clear",ad),ed=!1}function id(){var e=scrollTop();if(Ku)if(e<0)setStyle(Gu.header,"top",-e),rd(),setStyle(Gu.coverDimmer,"opacity",0),setStyle(Gu.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(Ju-Xu)),i=t&&t.classList.contains("vk_tabbar_top")&&!Gu.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle(Gu.header,"top",i),setStyle(Gu.headerTitle,"display","block"),setStyle(Gu.headerFirstIcon,"display","block"),setStyle(Gu.headerSecondIcon,"display","block"),n<=.9?(rd(),Qu&&setStyle(Gu.coverImage,"top",.5*e),setStyle(Gu.coverDimmer,"opacity",n/.9),setStyle(Gu.headerTitle,"opacity",0),setStyle(Gu.headerFirstIcon,"opacity",0),setStyle(Gu.headerSecondIcon,"opacity",1)):(setStyle(Gu.headerTitle,"opacity",1),setStyle(Gu.headerFirstIcon,"opacity",1),setStyle(Gu.headerSecondIcon,"opacity",0),od())}else Math.min(1,e/Ju)<1?(rd(),setStyle(Gu.coverDimmer,"opacity",0),Qu&&setStyle(Gu.coverImage,"top",.5*e),setStyle(Gu.headerTitle,"display","none"),setStyle(Gu.headerFirstIcon,"display","none"),setStyle(Gu.headerSecondIcon,"display","block")):od()}function ad(){nd(),td()}function od(){Zu.map((function(e){return $(e)})).some((function(e){return e}))||removeClass(Gu.vk,"groupCover-vk_animationStep")}function rd(){Zu.map((function(e){return $(e)})).some((function(e){return e}))||addClass(Gu.vk,"groupCover-vk_animationStep")}onDOMReady((function(){(C.default.chrome||C.default.safari&&C.default.ios>=9)&&(td(),page.onChange(td),zlayer.onClose((function(){setTimeout(td,0)})))}));n("l51W"),n("BLcx"),n("nXjO");var sd,ld,cd=function(){return Object(i.geByClass1)("tabs_block")},ud=function(){return Object(i.geByClass1)("tab_item_top")},dd=!0,_d=0;function fd(){ld&&ld(),sd&&sd()}function pd(e){Object(i.stopEvent)(e),Object(i.preventEvent)(e),_d=300,dd&&(Object(i.toggleClass)("TopMenu__switcher_on",Object(i.geByClass1)("TopMenu__switcher")),"touchstart"===e.type&&setTimeout((function(){nav.go(ud(),null)}),130))}function hd(e){Object(i.gpeByClass)("tabs_block",e.target)||Object(i.gpeByClass)("mhb_back",e.target)||(Object(i.stopEvent)(e),Object(i.preventEvent)(e),Object(i.removeClass)("TopMenu_open",cd()),md(),fd())}function md(){fd(),Object(i.removeEvent)(window,"touchstart mousedown click",hd)}window.TopMenu={onHeaderClick:function(e){if(!dd)return;var t=cd();Object(i.stopEvent)(e),Object(i.preventEvent)(e);var n=Object(i.geByClass1)("mhb_back");if(Object(i.hasClass)("TopMenu_open",t))Object(i.removeClass)("TopMenu_open",t),fd();else{var a=ud();Object(i.addClass)("TopMenu_open",t),Object(i.geByClass1)("_hfixed")&&Object(i.setStyle)(t,"max-height",window.innerHeight-70),Object(i.append)(t,n),Object(i.addEvent)(window,"touchstart mousedown click",hd),Object(i.addEvent)(a,"touchstart mousedown",pd),Object(i.addEvent)(a,"click",(function(e){Object(i.stopEvent)(e),Object(i.preventEvent)(e)})),ld=Object(o.expandPopup)(Object(i.geByClass1)("al_back")),(sd=Object(o.setMenuNavigation)(t))&&(sd.exitIntent=function(){Object(i.removeClass)("TopMenu_open",t),fd()}),cur.destroy.push(md),cur.destroy.push((function(){return Object(i.removeEvent)(a,"touchstart mousedown",pd)}))}}},nav.onBeforeGo((function(){dd=!1,setTimeout((function(){_d=0,dd=!0,fd()}),_d)}));var vd=function(){var e,t,n,i=!1;function a(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function r(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function s(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))a(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),r(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function l(e){e&&"A"===e.target.tagName&&requestAnimationFrame((function(){s()}))}function c(c){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(c),addClass("ai_menu_opened",e),append(t,document.body),(n=Object(o.setFocusTrap)(t))&&(n.exitIntent=function(){u()}),i=u,tooltip.addHandler(i),tooltip.show(e,t),addEvent(window,"resize",s),addEvent(t,"click",l);var d=geByClass1("i_pointer",e),_=a(d);_.isOverflowYContainer&&addEvent(_.cursor,"scroll",s);var f=r(d);f.isOverflowXContainer&&addEvent(f.cursor,"scroll",s),s()}function u(){removeClass("ai_menu_opened",e),append(t,e),tooltip.removeHandler(i),tooltip.hide(),n&&(n(),n=null),removeEvent(window,"resize",s),removeEvent(t,"click",s);var o=geByClass1("i_pointer",e),l=a(o);l.isOverflowYContainer&&removeEvent(l.cursor,"scroll",s);var c=r(o);c.isOverflowXContainer&&removeEvent(c.cursor,"scroll",s)}return{closeMenu:u,toggleMenu:function(t,n){cancelEvent(t),hasClass("ai_menu_opened",e)?u():c(n)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,(function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout((function(){removeClass("unhover",n)}),100)}))}}(),s()}}}();window.ActionMenu=vd;n("zHNa"),n("zouF"),n("wCFN");var gd=function(){var e=38,t=40,n=13,i=27,a={},o={},r=!1;function s(){a={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},o={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}s();var c=!0;function u(){c=!1}function d(){var e=val(a.input),t=Math.max(e.lastIndexOf("@"),e.lastIndexOf("*")),n=!1;if(t>-1){var i=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),a=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),a.appendChild(i.cloneContents()),val(a).replace(/\n$/,"").length}return 0}(a.input),r=e.substr(0,i);t=Math.max(r.lastIndexOf("@"),r.lastIndexOf("*"));var s=r.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);s&&"."!==s[2].substr(-1)&&(n=s[2])}!1===n&&delete a.ignoredTerm,void 0!==a.ignoredTerm&&n==a.ignoredTerm&&(n=!1),a.curValue=e,a.curTerm=n,a.curPos=t,o.text=n,!1===a.curTerm?p():(y(!1,a.curTerm),f(),function(){var e=ge("mhead").offsetHeight,t=o.container.getBoundingClientRect(),n=a.input.offsetHeight,i=parseInt(getStyle(o.scroll,"maxHeight"),10),r=!1;r=hasClass("Mention_openToBottom",o.container)?t.top-n-i<e:t.bottom-i<e,getXY(a.input)[1]>=e+i&&(r=!1),toggleClass("Mention_openToBottom",o.container,r),toggleClass("Mention_openToBottom",o.opts.appendTo,r)}())}function _(e){a.input=e}function f(){j(),document.addEventListener("click",h,!0),addClass("MentionContainer_opened",o.opts.appendTo),show(o.container),function(){if(!r){var e=browser.ipad?"touchend":"click";r=!0,addEvent(window,e,p),addEvent(window,"touchmove",u),nav.onBeforeGo(p)}}()}function p(e){!browser.ipad||c?e&&e.target&&gpeByClass("Mention_inited",e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass("MentionContainer_opened",o.opts.appendTo)&&(removeClass("MentionContainer_opened",o.opts.appendTo),hide(o.container),function(){if(r){var e=browser.ipad?"touchend":"click";removeEvent(window,e,p),removeEvent(window,"touchmove",u),nav.onBeforeGo.off(p),r=!1}}()):c=!0}function h(e){var t=e.target;t&&!gpeByClass("Mention_inited",t)&&(e.preventDefault(),e.stopImmediatePropagation(),p()),document.removeEventListener("click",h,!0)}function m(e){void 0===e&&(e={}),o.opts=extend(o.opts,e),v(),y(!0)}function v(){var e,t,n=o.opts.defaultItems,i=o.opts.items,a=[];for(e=0,t=n.length;e<t;++e)a.push(e);for(o.cache[""]=a,e=0,t=i.length;e<t;++e)g(e,i[e])}function g(e,t){var n,i,a,r="",s=o.opts.searchKeys,l={};for(n=0,a=s.length;n<a;++n)r+=" "+(t[s[n]]||"").replace(o.opts.delimeter," ").replace(/<[^>]*>/g,"");for(r+=(parseLat(r)||"")+(parseCyr(r)||""),r=trim(r.toLowerCase()).split(/\s+/),n=0;n<r.length;n++)for(i=1;i<=o.opts.wholeIndex;i++){var c=r[n].substr(0,i);l[c]||(o.index[c]||(o.index[c]=[]),o.index[c].push(e),l[c]=1)}}function A(){var e=trim(o.text);e&&ajax.post(o.opts.url,extend({str:e,mobile:1},o.opts.params||{}),{onDone:function(t){o.cache[e]=b(e).concat(t),w(o.cache[e],!0)}})}function b(e){if(!(e=trim(e.toLowerCase().replace(o.opts.delimeter," "))))return o.cache[""];var t=o.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return o.index[e]||[];var n,i,a=0,r="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var s=e[n].substr(0,t),l=o.index[s];if((!r||!l||l.length<a)&&(a=l?l.length:0,r=s),!a)return[]}var c=[],u=o.opts.searchKeys,d=u.length,_=e.length;for(n=0,i=o.index[r].length;n<i;++n){for(var f=o.index[r][n],p=o.opts.items[f],h=!1,m="",v=0;v<d;++v)m+=" "+(p[u[v]]||"").replace(o.opts.delimeter," ").replace(/<[^>]*>/g,"");m=(m+=(parseLat(m)||"")+(parseCyr(m)||"")).toLowerCase();for(var g=0;g<_;++g)if(-1===m.indexOf(" "+e[g])){h=!0;break}h||c.push(f)}return c}function y(e,t){if(o.cache[""])if(t=void 0!==t?t:trim(o.text),o.lastQ!==t||e){o.lastQ=t,clearTimeout(o.requestTimer);var n=o.cache[t];n?w(n,!0):(w(n=b(t),!o.opts.url),o.opts.url&&(o.requestTimer=setTimeout(A,o.opts.requestWait)))}else f()}function w(e,t){var n=[];o.shown=[];for(var i=e.slice(0,o.opts.maxItems),a=0,r=i.length;a<r;++a){var s=i[a];isArray(s)||(s=o.opts.items[s]),o.shown[s[0]]||(o.shown[s[0]]=s,n.push(S(s)))}o.container&&o.opts.appendTo.contains(o.container)||(o.container=ce("div"),addClass("Mention",o.container),o.scroll=ce("div"),addClass("ScrollView Mention__scroll",o.scroll),Object(Xe.setScrollView)(o.scroll,{topBanner:!1}),o.opts.appendTo.appendChild(o.container),o.container.appendChild(o.scroll),addEvent(o.scroll,"touchmove",(function(e){hasClass("Mention_noScroll",o.scroll)&&preventEvent(e)}))),toggleClass("Mention_empty",o.container,!n.length),val(o.scroll,n.join("")),o.scroll.scrollTop=0,O(),setTimeout((function(){toggleClass("Mention_noScroll",o.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(o.scroll.scrollHeight>o.scroll.offsetHeight)return!0;return!1}())}),0)}function S(e){var t=e[0],n=e[1],i=e[2];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                <img src="'+e[3]+'" class="MentionItem__img"/>\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function k(){var e=geByClass1("MentionItem_active",o.container),t=e.offsetTop;o.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(o.scroll,"paddingTop"),10)}function O(e){void 0===e&&(e=null);var t=geByClass("MentionItem",o.container);if(t.length){var n=t.find((function(e){return hasClass("MentionItem_active",e)}));e?(removeClass("MentionItem_active",n),addClass("MentionItem_active",e)):n||addClass("MentionItem_active",t[0])}}function C(e,t){setTimeout((function(){_(t),d()}),0)}var j=Object(l.default)();return{onKeyUp:function(n,i){n.keyCode!==e&&n.keyCode!==t&&(y(!0),_(i),d())},onKeyDown:function(a,r){var s;hasClass("MentionContainer_opened",o.opts.appendTo)&&(a.keyCode===e?(!function(){var e=geByClass1("MentionItem_active",o.container);if(e){var t=domPS(e);t&&(O(t),k())}else O(),k()}(),a.preventDefault()):a.keyCode===t?(!function(){var e=geByClass1("MentionItem_active",o.container);if(e){var t=domNS(e);t&&(O(t),k())}else O(),k()}(),a.preventDefault()):a.keyCode===n?(s=geByClass1("MentionItem_active",o.container))&&(s.click(),1)&&a.preventDefault():a.keyCode===i&&(p(),a.preventDefault()))},onFocus:C,onClick:C,onSelect:function(e){var t=o.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=a.curValue.substr(0,a.curPos),r=a.curValue.substr(a.curPos),s=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);o.opts.preferDomain&&e[9]&&(s=!0);s||(t=replaceEntities(e[8]||e[1]));var l=new RegExp("^(@|\\*)"+escapeRE(a.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");r=r.replace(l,(function(e,i,a){var o=i+n+" ";return s||(o+="("+t.replace(/[\(\)\]\[]/g,"")+") "),o})),s||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(r=" "+r);p(),val(a.input,i+r),elfocus(a.input),o.opts.afterInsert&&o.opts.afterInsert(a.input)}(t),p()},onItemHover:function(e){O(e)},onOpen:j,init:function(e){void 0===e&&(e={}),s(),o.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",o.opts.appendTo),o.scroll&&removeClass("Mention_noScroll",o.scroll),v()},update:m,addItems:function(e){if(o.opts.defaultItems){e=o.opts.defaultItems.concat(e);var t={};e.filter((function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)})),m({defaultItems:e,items:e})}}}}();window.Mention=gd;n("OGWK"),n("ciqL");var Ad={cachedProgress:{}},bd={init:function(e,t){return void 0===e&&(e=Object(i.srand)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,Ad.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);Ad.cachedProgress[e]=t;var o=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",o)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}},yd=(n("tqja"),n("aiw/")),wd=function(){function e(){window.isCustomScroll&&(document.body.classList.contains("vk__page_mail")||Xe.restoreDocumentScroll())}return{init:function(){if(window.isCustomScroll&&!document.body.classList.contains("vk__page_mail")){var t=ge("mcont");t&&t.classList.contains("ScrollView")?Xe.init():e(),yd.onClose()}},restore:e}}();onDOMReady((function(){wd.init(),page.onChange((function(){wd.init()}))})),window.ContentScrollView=wd;var Sd,kd,Od,Cd,jd,Ed,Td,Id=!1,Md=Object(i.scrollTop)(),Pd=56,xd=!1,Ld=!1,Bd=[];function Rd(e){void 0===e&&(e=Vd());var t=document.body;t&&"fixed"===Object(i.getStyle)(t,"position")||e.classList.remove("basis__header_hidden")}function Dd(){var e=Object(i.scrollTop)();if(Sd){Hd(Sd,e);var t,n=Object(i.ge)("mcont");if(n){var a=$(".BottomMenu__updateButton"),o=Math.max(n.scrollHeight,parseInt(Object(i.getStyle)(n,"height"),10));if(Ld&&e)return;if(Math.abs(Md-e)<=Pd)return;Sd.classList.contains("basis__header_nohide")||(e>Md+20&&e>Pd?(void 0===(t=Sd)&&(t=Vd()),t.classList.add("basis__header_hidden"),a&&a.classList.add("BottomMenu__updateButton_offset"),Ld=!0,setTimeout((function(){Ld=!1}),200)):e+window.innerHeight<o&&(Rd(Sd),a&&a.classList.remove("BottomMenu__updateButton_offset")))}var r=document.body;r&&"fixed"!==Object(i.getStyle)(r,"position")&&(Md=e)}}function Nd(){if(Id&&(clearInterval(jd),Object(i.onBodyScroll)("__clear",kd),removeEvent(window,"touchend",Od),Bd.forEach((function(e){removeEvent(e,"blur",Od)})),Id=!1),!Id){Sd=Vd(),Pd=parseInt(Object(i.getStyle)(Sd,"height"),10),Md=Object(i.scrollTop)();var e=$(".BottomMenu__updateButton");Sd&&(Sd.classList.add("basis__header_noTransition"),Rd(Sd),e&&e.classList.remove("BottomMenu__updateButton_offset")),Hd(Sd,Object(i.scrollTop)()),kd=function(){xd=!0},Od=function(){clearInterval(Cd),Cd=setTimeout((function(){var t=Object(i.ge)("mcont");if(t){var n=Math.max(t.scrollHeight,parseInt(Object(i.getStyle)(t,"height"),10));window.innerHeight>n&&n&&(Rd(Sd),e&&e.classList.remove("BottomMenu__updateButton_offset"))}}),100)},setTimeout((function(){xd=!1}),0),setTimeout((function(){Sd&&Sd.classList.remove("basis__header_noTransition")}),200),Id||(jd=setInterval((function(){xd&&(Dd(),xd=!1)}),250),Object(i.onBodyScroll)(kd),addEvent(window,"touchend",Od),(Bd=Array.from($$("input, textarea")||[])).forEach((function(e){addEvent(e,"blur",Od)})),Id=!0)}}function Hd(e,t){e&&e.classList.contains("basis__header_nohide")||(t<=5&&e&&e.classList.contains("basis__header_noshadow")?e.classList.add("basis__header_noshadowAnim"):e&&e.classList.remove("basis__header_noshadowAnim"))}function Vd(){return $(".basis__header")}function Ud(){(Sd=Vd())&&(Rd(Sd),Hd(Sd,Object(i.scrollTop)()))}onDOMReady((function(){Nd(),window.page.onChange(Nd),onBodyResize(Ud),addEvent(window,"orientationchange",Ud),addEvent(window,"blur",Ud)})),Ed="",Td=function(){var e=Ed,t=nav.cur;Ed=t,function(){if(Object(ie.partConfigEnabled)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],a="http"+("https:"==location.protocol?"s":""),o="vkgalv";if(window.vk&&window.vk.countryISO)switch(window.vk.countryISO){case"BY":o="vkgaby";break;case"MD":o="vkgamd";break;case"EE":o="vkgaee"}n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=a+"://"+o+".hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}();var n=e===t?"":e;window.vk.__dev||(function(e,t){for(var n=[new RegExp("(\\/login)(\\?).*$")],i=0;i<n.length;i++)if(e.match(n[i]))return;var a=[[new RegExp("(\\/(?:write|mail|im|al_im.php))(\\?[a-z0-9&=\\-_]*)?$"),"$1"],[new RegExp("(\\/write)(\\d*)(\\?[a-zA-Z0-9&=\\-_]*)?$"),"$1"]],o={referrer:t,url:e};Object(ri.each)(o,(function(e){Object(ri.each)(a,(function(){o[e]=o[e].replace(this[0],this[1])}))})),t=o.referrer,e=o.url;var r=location.protocol,s=window._tns&&(window._tns.tnsPixelSocdem||"83"),l=t.replace(/\*/g,"%2a").split("#")[0],c=window._tns&&window._tns.tnsPixelType;Object(ri.vkImage)().src=r+"//www.tns-counter.ru/V13a**clid:"+s+"*"+l+"*vk_com/ru/UTF-8/tmsec=vksite_total/"+Math.round(1e9*Math.random()),Object(z.statlogsValueEvent)("counters_check",1),"unauth"===c?Object(ri.vkImage)().src=r+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184674/"+Math.round(1e9*Math.random()):"has_rough"===c?Object(ri.vkImage)().src=r+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184675/"+Math.round(1e9*Math.random()):"not_has_rough"===c&&(Object(ri.vkImage)().src=r+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184677/"+Math.round(1e9*Math.random()))}(location.protocol+"//"+location.host+t,n?location.protocol+"//"+location.host+n:""),Zs(t,n))},onDOMReady((function(){Td(),window.page.onChange((function(){Ed!==nav.cur&&Td()}))}));var Fd={URL:"special-event",ACT:"getPopup",start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(Object(z.statlogsValueEvent)("special_event","click",this.platform,this.id),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.duration&&(this.hasPopup=Boolean(window.domData(e,"popup")),!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then((function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()}))):this._play())}},_getAnimation:function(){var e=this;return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET","/images/stickers/special/"+e.id+"/animation.json?v="+e.v,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}}))},_showPopup:function(){},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!1,autoplay:!0,animationData:this.animationData});0,this.timeoutHandle=setTimeout((function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,Object(z.statlogsValueEvent)("special_event","showed",e.platform,e.id),e._showPopup()}),this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n}};Fd.init({platform:"mvk",animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.SpecialEvent=Fd;var $d={onIframeReady:Object(l.default)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:Object(l.default)(),onAcceptCookieClick:Object(l.default)()};function qd(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&$d.onPostMessage(t.action,t.action_params)}}$d.onIframeReady((function(){addEvent(window,"message",qd),window.cur.destroy.push((function(){removeEvent(window,"message",qd)}))})),window.BasisMoneyTransfer=$d;var zd=$d;zd.onPostMessage((function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()}));zd.onPostMessage((function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)}));var Yd=["touchstart","touchend","touchmove","touchcancel"];zd.onIframeReady((function(e){e.is_api&&registeredEvents.forEach((function(e){var t=e[0],n=e[1],i=e[2];Yd.indexOf(n)>=0&&removeEvent(t,n,i)}))})),zd.onPostMessage((function(e){"resizeFrame"!==e&&"pageLoad"!==e||window.scrollTop(0)}));var Gd,Qd,Kd,Xd="pageMoneyTransfer",Jd="pageMoneyTransfer_error";zd.onIframeReady((function(e){e_(),Qd={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},n_(),window.cur.destroy.push(i_)})),zd.onPostMessage((function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1(Xd));else if("payError"===e)i_(),addClass(Jd,geByClass1(Xd)),val(geByClass1("pageMoneyTransfer__errorText"),t.descr);else if("session_fail"===e){if(Zd)return void t_();i_(),addClass(Jd,geByClass1(Xd)),addClass("pageMoneyTransfer_errorCookie",geByClass1(Xd))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;Object(i.isVkWebView)()&&(Object(i.isIosWebView)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),Object(i.statlogsValueEvent)("money_transfers",0,"iframe_loaded",n)}}));var Zd=0;function e_(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(e_,2e3)}function t_(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1(Xd).appendChild(t),ge("payment_form").submit()}else setTimeout(t_,2e3)}function n_(){var e=Qd,t=e.checkUrl,n=e.onSuccessUrl;Gd=setInterval((function(){Kd=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(i_(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(i_(),addClass(Jd,geByClass1(Xd)),val(geByClass1("pageMoneyTransfer__errorText"),t))}})}),2e3)}function i_(){Gd&&(clearInterval(Gd),Gd=null),Kd&&(Kd.abort(),Kd=null)}zd.onAcceptCookieClick((function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout((function(){e.close();var t=geByClass1("pageMoneyTransfer__iframe"),n=clone(t);removeClass(Jd,geByClass1(Xd)),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),n_()}),500),Zd++}));var a_={_onMouseDown:Object(l.default)(),_onCancelClick:Object(l.default)()};window.MoneyTransferButton=a_;var o_=a_;o_._onMouseDown((function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,"-webkit-tap-highlight-color","transparent"),setTimeout((function(){return function(e){setStyle(e,"-webkit-tap-highlight-color","initial")}(t)}),400))}));var r_,s_,l_=!1,c_=null;function u_(){c_&&Btn.setLoading(c_,!1),r_&&(clearInterval(r_),r_=null),s_&&(s_.abort(),s_=null)}o_._onCancelClick((function(e,t){var n,i;t?(l_=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(l_=!0,t=e.$btn,e=null,c_=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},i=n.cancelUrl,r_=setInterval((function(){s_=ajax.post(i,{_ajax:1},{onDone:function(e){if(1===e){if(l_){var t=arguments[1];return c_.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void u_()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push((function(){window.scrollTop(n)})),u_()}}})}),1500),window.cur.destroy.push(u_)}));need("attr"),need("geByClass1");var d_=need("preventEvent"),__=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=I_,SendMoneyForm._onSubmit=B_,SendMoneyForm._onRecommAmountChange=M_,SendMoneyForm._onAutoAcceptToggle=R_,SendMoneyForm._onNoAmountToggle=D_,SendMoneyForm._onChooseCardClick=T_,SendMoneyForm._onChooseCardCancelClick=E_,SendMoneyForm._onChooseCardContinueClick=C_,SendMoneyForm._onCardSelect=j_;var f_="sendMoneyForm_error_min",p_="sendMoneyForm_error_max",h_="sendMoneyForm_addCardVisible",m_="sendMoneyForm_requestedVisible",v_="sendMoneyForm_recommErrorMin",g_="sendMoneyForm_recommErrorMax",A_="sendMoneyForm_noAmount",b_="sendMoneyForm_autoAccept",y_=".sendMoneyForm",w_=".sendMoneyForm__cardsPopup",S_=".sendMoneyForm__input_amount",k_=".sendMoneyForm__recommAmountInput input",O_=".sendMoneyForm__amountNote_requestAmount";function C_(){var e=Object(M.$)('.Control__native[name="card"]:checked').value,t=Object(M.$)('.Control__native[name="card"]:checked ~ .Control__label').innerText;Object(M.$)('input[name="accept_card"]').value=e,Object(M.$)('input[name="accept_card"]').setAttribute("data-value",e),Object(M.$)(".sendMoneyForm__chooseCard").innerText=t,__.close()}function j_(e){var t="-1"===e.value;Object(M.$)(y_).classList.toggle(h_,t)}function E_(){__.close()}function T_(){var e=Object(M.$)(w_);__.open(e)}function I_(e){e||(e=Object(M.$)('input[name="amount"]')),x_(e),L_(e,6);var t=e.closest(y_),n="1"===t.getAttribute("data-is-chat-request"),i=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(f_),t.classList.remove(p_),n||i>a&&t.classList.add(p_),n){var o=P_(),r=Number(t.getAttribute("data-min-amount"))*(o?2:1),s=function(e,t){var n=Object(M.$)('input[name="amount"]').closest(y_),i=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),o=Number(n.getAttribute("data-chat-members-count")),r=Math.ceil(e/(o-(t?0:1)));return Math.min(a,Math.max(i,r))}(i,o);if(Object(M.$)(k_).value=s,t.classList.remove(g_),t.classList.remove(v_),!r||i>=r){var l=o?i-s:i;Object(M.$)(O_).innerText=l,t.classList.add(m_)}else t.classList.remove(m_)}}function M_(e){x_(e),L_(e,6);var t=e.closest(y_),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(g_),t.classList.remove(v_),n>i&&t.classList.add(g_)}function P_(){var e=Object(M.$)('input[name="participiate"]');return e&&e.checked}function x_(e){e.value=parseInt(e.value,10)||""}function L_(e,t){e.value=e.value.slice(0,t)}function B_(e,t){var n=t.$(S_).value,i=Number(n),a=Number(t.getAttribute("data-min-amount")),o=Number(t.getAttribute("data-max-amount")),r="1"===t.getAttribute("data-is-chat-request"),s=!1;(t.classList.remove(f_),t.classList.remove(p_),r&&(t.classList.remove(g_),t.classList.remove(v_)),Object(M.$)(y_).classList.contains(A_))||(i<a*(!!r&&P_()?2:1)||!n||n!==i.toString()?(t.classList.add(f_),s=!0):i>o&&!r&&(t.classList.add(p_),s=!0));if(r){var l=t.$(k_).value,c=Number(l);c<a||!l||l!==c.toString()?(t.classList.add(v_),s=!0):c>o&&(t.classList.add(g_),s=!0)}if(s)d_(e),stopEvent(e);else{d_(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var u=Object(M.$)("#submit");ajax.click(u)}}function R_(e){Object(M.$)(y_).classList.toggle(b_,e.checked),e.checked?Object(M.$)('input[name="accept_card"]').value=Object(M.$)('input[name="accept_card"]').getAttribute("data-value"):Object(M.$)('input[name="accept_card"]').value=""}function D_(e){Object(M.$)(y_).classList.toggle(A_,e.checked)}window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){var n=arguments,i=this;if(!MoneyLink.qrcode){var o,r,s=a.colorScheme.isDarkScheme();t?(o=geByClass1("snippet__icon",geByClass1(t)),r=s?128:80):(o=ge("money_link_qr"),r=200);var l={isShowLogo:!0};s&&(l.isShowBackground=!0,l.backgroundColor="#fff"),val(o,Ii.a.createQR(e,r,"qr-code",l));var c=a.colorScheme.subscribe((function(){c(),i.genQRCode.apply(i,n)}))}}};var N_=need("Voting"),H_=function(){var e,t,n=[],i=!1,a=!1,o={};function r(e){return function(){if(!i)return e.apply(this,arguments)}}function s(e){return"A"===e.tagName}function l(){a=n.length>0,toggleClass("vk_messages_actions_visible",document.body,a)}function c(){a&&(o={},each(n,(function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))})),i=!1,n=[],l())}function u(){return!!window.getSelection&&window.getSelection().toString().length>0}function d(e,t,a,o){void 0===o&&(o=!1),i=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:o?"spam":"delete",peer:t,hash:a,ids:n.join(","),community:V_()}})}function _(){return Boolean(e)}function f(){ge("dialogs")&&_()?addClass("vk_dialogs_forwarding",document.body):e="",c()}return page.onChange(f),mail.onShowDialogsPageFromCache(f),mail.onShowDialogFromCache(f),mail.onShowDialogsPageFromCache(Rd),mail.onShowDialogFromCache(Rd),mail.onMessagesRepainted((function(){each(n,(function(e,t){addClass("mi_selected",geByClass1("_msg"+t))}))})),{onMessageClick:r((function(e){var t=e.target,i=e.currentTarget,a=s(t)||s(t.parentNode);t.closest("."+N_.cls)?e.stopPropagation():(a&&c(),browser.uc_mini||u()||a||setTimeout((function(){var e,t,a;u()||(e=i,t=attr(e,"data-id"),(a=n.indexOf(t))>=0?(n.splice(a,1),removeClass("mi_selected",e),delete o[t]):(n.push(t),addClass("mi_selected",e),o[t]=hasClass("msg_item_important",e)),l(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())}),40))})),remove:r(d),reply:r((function(e,t,a){i=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:a,object:"mail"+n.join(";"),community:V_()}})})),forward:r((function(a,o){i=!0,lockButton(a),e="mail"+n.join(";"),t=o;var r=V_(),s=r?"?community="+r:"";nav.go(location.pathname+s,null,{ignore_cur_process:!0})})),spam:r((function(e,t,n){d(e,t,n,!0)})),close:r(c),toggleImportant:r((function(e){var t,i=n.length,a=0;for(t=0;t<i;t++)if(!o[n[t]]){a=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===a);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:a,hash:e}),c()})),hasFwdMessages:_,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:V_()}}),e=""}}}();function V_(){return nav.getQuery("community")}window.MessagesActions=H_;var U_=n("TxR4"),F_=n("S6+Z"),$_=Object.entries(F_.EMOJI_HINTS).map((function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+Object(ri.escapeRE)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]})),W_={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?W_["\\"]="ё":W_["`"]="ё";var q_=new RegExp("["+Object(ri.escapeRE)(Object.keys(W_).join(""))+"]","gi"),z_=function(e){return e.replace(q_,(function(e){return W_[e]}))},Y_=Object.entries(W_).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e})),G_=new RegExp("["+Object(ri.escapeRE)(Object.keys(Y_).join(""))+"]","gi"),Q_=function(e){return e.replace(G_,(function(e){return Y_[e]}))},K_=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=$_.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(n,(function(e,t,n,a){return(t||"")+Object(U_.emojiByteHexToSymbol)(i)+(a||"")}))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(U_.emojiRemoveSkinToneModifiers)(e)],a=0,o=[].concat(i);a<o.length;a++){var r=o[a];i.push(z_(r)),i.push(Q_(r))}for(var s=0,l=[].concat(i);s<l.length;s++){var c=l[s];i.push(c.replace(/ё/g,"е")),i.push(c.replace(/е/g,"ё"))}for(var u=0,d=[].concat(i);u<d.length;u++){var _=d[u];i.push(_.replace(/[.!?]+$/,""))}return Object.keys(i.reduce((function(e,t){return e[t]=1,e}),{}))},t.isBotLinkEnabled=function(){return Object(ie.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"},t.getBotLinkImageUrl=function(e,t){return void 0===t&&(t="light"),"/images/stickers_suggestions_bot_"+t+"_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return Object(ie.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();window.StickersHints=function(){var e,t,n,o,r,s,l=!0,c=0,u=new K_({mvk:!0});F_.EMOJI_HINTS;function _(e){var i=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),u.setConfig(e),n&&!n.initialized){var a=function(e){var t=n.value.length;t-c>1,c=t,f(),l&&(!function(){A()&&vkNow()-b()>864e5*(2+Math.random())&&p();e=function(e){e*=1e3,A()&&e>b()&&p()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),l=!1)};n.initialized=!0,r=geByClass1("stickersHints"),o=geByClass1("stickersHints__content"),addEvent(n,"focus",f),addEvent(n,"input",a),addEvent(document,"click",h),onBodyResize(m),onBodyResize(w),i.destroy.push((function(){r=null,o=null,n=null,removeEvent(n,"focus",f),removeEvent(n,"input",a),removeEvent(document,"click",h),onBodyResize("__clear",m),onBodyResize("__clear",w),t&&t.destroy(),c=0})),document.activeElement===n&&f()}}function f(){var i;n&&(e&&clearTimeout(e),i=function(i){var s=u.getQueries(n.value).find((function(e){return i.hasOwnProperty(e)})),l=s&&i[s];l?e=setTimeout((function(){var e,n,i=l.userStickers||[],c=l.promotedStickers||[];if(i.length>0||c.length>0){var _=[];each(i,(function(e,t){_.push(v({stickerId:t,query:s,isPromoted:!1}))})),each(c,(function(e,t){_.push(v({stickerId:t,query:s,isPromoted:!0}))})),u.isBotLinkEnabled()&&_.push((e=Object(d.getStickerSize)(),n="light",a.colorScheme.isDarkScheme()&&(n="dark"),Wd.html({inner:[{inner:[{class:"th_img",src:u.getBotLinkImageUrl(e,n),tag:"img"}],class:"sticker_thumb",href:u.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),o.innerHTML=_.join(""),show(r),m(),w(),(t=new Scroller(r)).init()}}),300):(t&&t.destroy(),hide(r))},s?i(s):A()?(s=lsGet("stickers_keywords").keywords,i(s)):g((function(e){s=e,y(e),i(e)})))}function p(){g((function(e){s=e,y(e),f()}))}function h(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(r),e&&clearTimeout(e))}function m(){attr(o,"style","")}function v(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(r,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",a=Stickers.getStickerUrl(e.stickerId,Object(d.getStickerSize)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,a).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function g(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,(function(e,n){var i=n.user_stickers,a=n.promoted_stickers;each(n.words,(function(e,n){t[n]={userStickers:i,promotedStickers:a}}))})),t}(t))}})}function A(){return Boolean(lsGet("stickers_keywords"))}function b(){return lsGet("stickers_keywords").time}function y(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function w(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-4,n=t/64,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var a=Math.round(t/n-8);each(geByClass("sticker_item",e),(function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",a),setStyle(t,"height",a),setStyle(n,"width",a),setStyle(n,"height",a),setStyle(i,"height",a)}))}}return onDOMReady((function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit((function(){_()})),geByClass1("stickersHints")&&_())})),ajax.onRedirect((function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&p()})),post.onReplyClick((function(e){var t=window.cur;e,setTimeout(f,10),t.destroy.push((function(){;""}))})),{actualizeVisibility:f,init:_,onStickerThumbClick:function(t,i,a,o){window.isNewMail&&preventEvent(t);var s=gpeByClass("sticker_item",i),l=geByClass1("th_img",s);return attr(s,"style",""),attr(i,"style",""),attr(l,"style",""),hide(r),n.value="",e&&clearTimeout(e),post.sendSticker(i,a,!0,o)},onCheckboxLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,p)}),0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,p)}),0)},onSuggestionsBotLinkClick:function(){i.statlogsValueEvent.apply(void 0,[u.getBotLinkClickStatName(),0].concat(u.getBotLinkClickStatKeys()))}}}();var X_=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return Object(M.$)(J_(e))}};var J_=function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'};function Z_(e,t){window.isNewMail?(e.preventDefault(),uMessenger.goToMsg(+t.parentNode.getAttribute("data-msg-id"))):X_.go(t,e)}PinnedMsg._onClick=Z_,PinnedMsg._onHideClick=PinnedMsg.onHideClick;n("98L6");window.SettingsRow_select={},SettingsRow_select._onChange=nf;var ef=".settingsRow",tf=".settingsRow__description";function nf(e,t){!function(e){var t=e.$select,n=e.label;t.closest(ef).$(tf).textContent=n}(t),c.default.handle(e,t)}n("MzAf"),n("Dh0N"),n("fYoA");var af=n("PovR");function of(e){pushNotifier.canBeEnabled().then((function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then((function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)})).catch((function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1})):n.checked=!1)}))}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=of;var rf=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,a=!1,o=!1,r=vkNow(),s=0,l=this.getTouchX(e),c=getW(this.wrap);function u(e){if(!o)if(!a&&Math.abs(i.getTouchY(e)-n)>20)o=!0;else{i.lock&&(a=!0,t=i.getTouchX(e),r=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||a)&&(cancelEvent(e),a||(t=i.getTouchX(e),d=0,a=!0),s=d,l=u,d=-(100+d/c*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",a=Math.abs(l-t)/(r/vkNow());a+=.2*a;var o=100*i.opts.shownSlidesNum;o="next"==n?100+o:o-100,setStyle(i.helper,{transition:"transform "+a+"ms",transform:"translateX(-"+o+"%)"});var c=i.items.length-1,_="prev"==n?i.pos-1:i.pos+1;_<0?_=c:_>c&&(_=0),i.opts.onStartChange&&i.opts.onStartChange(_,n),i.newPos=_,i.changeTimeout=setTimeout((function(){i.lock=0,i.changeSlide(_)}),a)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout((function(){i.lock=0}),200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",a=e,o=0;o<t;o++)--a<0&&(a=n),i=this.makeItem(this.items[a])+i;i+=this.makeItem(this.items[e]),a=e;for(var r=0;r<t;r++)++a>n&&(a=0),i+=this.makeItem(this.items[a]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var a="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+a+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var o=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout((function(){a="next"==t?-100:0,setStyle(o.helper,{transition:"transform 200ms",transform:"translateX("+a+"%)"}),o.toSlideTimer=setTimeout((function(){o.lock=0,o.changeSlide(e)}),200)}),10)},e}();window.landingsSlider=rf;n("03kU"),n("4qiT"),n("Tjn9");window.FriendsRecommendedSlider={init:function(){window.cur&&(_f($("."+lf)),cur.destroy.push((function(){cf=null,uf=null,df=null})))},hideRecommended:function(e,t,n,a){var o=gpeByClass("prettyCard",e);if(!o)return a&&Object(i.cancelEvent)(a);var r=hf(o),s=domData(o,"code")||domData(r,"code"),l=domData(r,"ref");!function(e){var t=hf(e);remove(e),df=null,uf=null,ff().length||pf(t)}(o);var c="/friends"+obj2qs({act:"hide_possible",hash:n,id:t,track_code:s,ref:l});return ajax.post(c,{_ajax:1}),a&&Object(i.cancelEvent)(a)},hideBlock:pf,acceptFriend:function(e,t,n,a){if(hasClass("prettyCard__button_accepted",e)||hasClass(e))return a&&Object(i.cancelEvent)(a);var o=gpeByClass("prettyCard",e),r=e.querySelector(".prettyCard__buttonText"),s=hf(e),l=domData(o,"code")||domData(s,"code"),c=domData(s,"ref");return addClass(sf,e),Friends.accept(t,n,"user_rec",0,c,l,(function(t,n){var a=t||getLang("mobile_friends_feed_recom_got_notification");removeClass(sf,e),addClass("prettyCard__button_accepted",e),r.innerHTML=a,function(e){var t=function(e){var t=domCA(e,".prettyCard");if(!t)return;return geByClass1("prettyCard__closeButton",t)}(e);addClass("prettyCard__closeButton_hidden",t)}(e);var o=Object(i.isObject)(null==n?void 0:n.friend_request_add_sent_message_nudge)?n.friend_request_add_sent_message_nudge:void 0;if(o){var s=o.url,l=o.text;Object(I.init)({text:a,type:I.SNACKBAR_TYPE_SUCCESS,vertical:!0,action:{text:l,url:s,callback:function(e,t){var n=t.id;Object(I.close)(n),Object(i.cancelEvent)(e),window.nav.go(s)}}})}}),(function(t,n){2===t&&nav.hard_go(n),removeClass(sf,e)})),a&&Object(i.cancelEvent)(a)},onOpenUser:function(e){var t=gpeByClass("prettyCard",e);if(!t)return;var n=hf(t),i=domData(t,"uid")||"",a=domData(t,"code")||domData(n,"code"),o=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:o,trackCode:a})},onScroll:throttle(_f,50)};var sf="prettyCard__button_loading",lf="friendsRecommendedSliderWrap",cf=null,uf=null,df=null;function _f(e){if(!cf&&e&&(cf=hf(e)),cf&&(cf._lastScroll=cf.scrollLeft,!e.ajaxIsRunning)){var t=cf.scrollLeft,n=function(){if(uf)return uf;if(!cf)return{};var e=getSize(cf)[0],t=getX(cf),n=ff(),i=getX(n[0])-t,a=getSize(n[0])[0],o=getX(n[1])-t-i-a,r=Math.floor(a/3);return uf={width:e,itemWidth:a+o,leftMargin:i,part:r,scrollWidth:cf.scrollWidth}}(),i=Math.max(0,Math.floor((t-n.leftMargin)/n.itemWidth)),a=Math.max(0,Math.floor((t+n.width-n.leftMargin)/n.itemWidth));i*n.itemWidth+n.itemWidth-n.part<t&&i++,a*n.itemWidth+n.part>t+n.width&&a--;var o=ff();i=Math.max(0,i),a=Math.min(o.length,a);for(var r=domData(cf,"ref"),s=domData(cf,"code"),l=i;l<=a;l++){var c=o[l];if(c&&!c.viewed){c.viewed=!0;var u=domData(c,"uid")||"",d=domData(c,"code")||s;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:u,pos:l,ref:r,trackCode:d})}}!e.allLoaded&&t+n.width>=n.scrollWidth/2&&function(e){(e=hf(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=3)return void(e.allLoaded=!0);var n=domData(e,"code")||"",i=domData(e,"ref")||"",a=intval(domData(e,"friend-id")),o="/friends"+obj2qs({act:"recommended_carousel",next:t,ref:i,friendId:a,track_code:n});e.ajaxIsRunning=!0,ajax.post(o,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1("Slider__line",e),a=cdf(t);append(a,i),uf=null,df=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout((function(){return e.ajaxIsRunning=!1}),500)}})}(e)}}function ff(){return df||(cf&&(df=geByClass("prettyCard",cf)),df||[])}function pf(e,t){var n=gpeByClass(lf,e);if(!n)return t&&Object(i.cancelEvent)(t);var a=cf;if(!a&&e&&(a=hf(n)),a){var o=domData(a,"code"),r=domData(a,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:r,trackCode:o})}if(remove(n)){var s=nav.getQuery();delete s.recs,nav.go(location.pathname+obj2qs(s),!1,{replace:!0,push_only:!0})}return t&&Object(i.cancelEvent)(t)}function hf(e){var t;return hasClass(e,"Slider__scroll")?t=e:(t=geByClass1("Slider__scroll",e))||(t=gpeByClass("Slider__scroll",e)),t}n("w1QQ"),n("DVnk"),n("cLcH"),n("uo4j"),n("Fhlr");var mf=n("myok");window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,o,r){var s=r.$btn,l=s.getAttribute("href"),c=s.nextElementSibling||s.previousElementSibling,u=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(mf.default.setLoading(s,!0),ajax.post(l,{_ajax:1},{onDone:function(){mf.default.setLoading(s,!1),c&&c.remove(),s.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+u+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n){e.preventDefault();var i=e.target,a=i.getAttribute("href"),o=a+"&action=hide",r=a+"&action=restore";(!n||confirm(n))&&ajax.post(o,{_ajax:1},{onDone:function(){var e=i.closest(".notificationList__items")||i.closest(".notificationList"),n=i.closest(".notification"),a=n.getAttribute("id"),o=e.closest(".notificationList");if(hide(n),NotifyItem._onBodyScroll(),o.classList.contains("notificationList_type_unread")){var s=o.$(".Pad__title"),l=parseInt(s.innerText,10)-1;s.innerText=langNumeric(l,lang.mobile_notifications_new)}var c=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(c=!1)})),c&&o.classList.add("Pad_empty");var u=window.Snackbar;u&&u.init&&u.init({text:t,action:{url:r,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",a]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,a=n.url;e.preventDefault();var o=ge(t);ajax.post(a,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=o.closest(".notificationList__items")||o.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var a=n.$(".Pad__title"),r=parseInt(a.innerText,10)+1;a.innerText=langNumeric(r,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(s=!1)})),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach((function(e){e.classList.remove("notification_actionsOpen")})),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach((function(e){e!==t&&e.classList.remove("notification_actionsOpen")})),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,i){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,o={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach((function(e){o["setting_"+e.name]=e.checked?1:0})),ajax.post("feed.php",Object(E.default)({gid:t,hash:n,unmuted:a,from:i},o,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}};var vf=n("H5mD");function gf(e,t,n){if(vf.isWKWebView){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var i=new Event("click");return t.dispatchEvent(i),void setTimeout((function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n}))}C.default.android?location.href="https://vk.com/write"+(2e9+e):vf.isIOS?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{_ajax:1},{onDone:function(e){gf(e,t,n)}}),!1},open:function(e,t,n){return setTimeout((function(){gf(e,t,n)})),!1}};n("wkhI"),n("DOEQ");var Af=10,bf={setMaxAttach:function(e){Af=e},checkAttaches:function(){bf.toggleEnableAttaches(mediaUpload.getAttachesCount()<Af)},toggleEnableAttaches:function(e){void 0===e&&(e=!0),Object(M.$$)(".cp_attach_btn",Object(M.$)("#feed_add_form")).forEach((function(t){t.classList.toggle("cp_disabled_btn",!e)})),["photo","video","audio","doc","poll"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})),["photo","audio"].forEach((function(t){var n=Object(M.$)(".CreatePostButtons__item--"+t);n&&n.classList.toggle("CreatePostButtons__item--disabled",!e)}));var t=Object(M.$)(".CreatePostButtons__item--photo .inline_upload");Object(i.attr)(t,"disabled",!e)}};window.CreatePost=bf;var yf="touchcancel touchend touchmove mouseout mouseup mousemove scroll";function wf(e,t,n){var a;void 0===t&&(t=350);var o=function(n){var o=n.target;Object(i.addEvent)(e,yf,r,{passive:!0}),(0===n.button||isUndefined(n.button))&&(a=setTimeout(s.bind(o,n),t))},r=function t(){clearTimeout(a),Object(i.removeEvent)(e,yf,t,{passive:!0})};function s(t){var o,s;t.touches?(o=t.touches[0].pageX,s=t.touches[0].pageY):(o=t.pageX,s=t.pageY),n({pageX:o,pageY:s}),Object(i.removeEvent)(e,yf,r,{passive:!0}),clearTimeout(a)}return Object(i.addEvent)(e,"touchstart mousedown",o,{passive:!0}),function(){clearTimeout(a),Object(i.removeEvent)(e,"touchstart mousedown",o,{passive:!0})}}!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var Sf="doc",kf="photo",Of="video",Cf="album",jf="market_album",Ef=window.isMVK?200:120,Tf=window.isMVK?604:537,If=window.isMVK?360:343;function Mf(e,t,n,i){var a=function(e){var t=0;return each(e,(function(e,n){t+=n})),t},o=function(e,t,n){return(t-(e.length-1)*n)/a(e)},r=(i=Hf(i)?i:{}).wide,s=[],l=0,c=[],u=[];each(n,(function(e,t){Df(t.type)&&(c[c.length]=t[t.type]),t.type===Of&&s.push(l),l++}));var d="",_=[],f=c.length;each(c,(function(n,i){var a=Bf(i,e,t);d+=a>1.2?"w":a<.8?"v":"q",_[_.length]=a}));var p,h,m=_.length>0?a(_)/_.length:1,v=5;window.isMVK&&(v=window.innerWidth>=480?6:3);var g=v;i.force?(p=e,h=t):(r?(p=Tf,h=If):e>=381?(p=381,h=1==f?361:237):(p=337,h=1==f?320:214),e<p&&(p=e,h=t),window.isMVK&&(p=Math.min(Tf,window.innerWidth),h=Math.min(If,p)));var A=p/h,b=0,y=0;if(1==f){var w={lastColumn:1,lastRow:1,single:1};c[0].thumb?(b=279,y=185):_[0]>=1*A?(b=p,y=Math.min(b/_[0],h)):(y=h,b=Math.min(y*_[0],p));var S=Pf(c[0],b,y,w);!S.unsized&&(S.image.width<b&&S.image.height<=h||S.image.height<y&&S.image.width<=p)&&(b=S.image.width,y=S.image.height,S=Pf(c[0],b,y,w)),u[0]=S}else if(2==f){var k,O;switch(d){case"ww":if(m>1.4*A&&_[1]-_[0]<.2){O=p,k=Math.min(O/_[0],O/_[1],(h-g)/2),u[0]=Pf(c[0],O,k,{lastColumn:1}),u[1]=Pf(c[1],O,k,{lastColumn:1,lastRow:1}),b=p,y=2*k+g;break}case"vv":case"qv":case"vq":case"qq":O=(p-v)/2,k=Math.min(O/_[0],O/_[1],h),u[0]=Pf(c[0],O,k,{lastRow:1}),u[1]=Pf(c[1],O,k,{lastRow:1,lastColumn:1}),b=p,y=k;break;default:var C=intval((p-v)/_[1]/(1/_[0]+1/_[1])),j=p-C-v;k=Math.min(h,C/_[0],j/_[1]),u[0]=Pf(c[0],C,k,{lastRow:1}),u[1]=Pf(c[1],j,k,{lastColumn:1,lastRow:1}),b=p,y=k}}else if(3==f)if((_[0]>1.2*A||m>1.5*A)&&"www"==d){var E,T=p,I=Math.min(T/_[0],.66*(h-g));if(u[0]=Pf(c[0],T,I,{lastColumn:1}),"www"==d){var M=intval(p-v)/2;E=Math.min(h-I-g,M/_[1],M/_[2]),u[1]=Pf(c[1],M,E,{lastRow:1}),u[2]=Pf(c[2],p-M-v,E,{lastColumn:1,lastRow:1})}else{var P=intval((p-v)/_[2]/(1/_[1]+1/_[2])),x=p-P-v;E=Math.min(h-I-g,P/_[2],x/_[1]),u[1]=Pf(c[1],P,E,{lastRow:1}),u[2]=Pf(c[2],P,E,{lastRow:1,lastColumn:1})}b=p,y=I+E+g}else{var L=h,B=intval(Math.min(L*_[0],.75*(p-v)));u[0]=Pf(c[0],B,L,{lastRow:1});var R=_[1]*(h-g)/(_[2]+_[1]),D=h-R-g,N=Math.min(p-B-v,intval(R*_[2]),intval(D*_[1]));u[1]=Pf(c[1],N,D,{lastColumn:1}),u[2]=Pf(c[2],N,R,{lastColumn:1,lastRow:1}),b=B+N+v,y=h}else if(4==f)if((_[0]>1.2*A||m>1.5*A)&&"wwww"==d){var H=p,V=Math.min(H/_[0],.66*(h-g));u[0]=Pf(c[0],H,V,{lastColumn:1});var U=(p-2*v)/(_[1]+_[2]+_[3]),F=intval(U*_[1]),$=intval(U*_[2]),W=H-F-$-2*v;U=Math.min(h-V-g,U),u[1]=Pf(c[1],F,U,{lastRow:1}),u[2]=Pf(c[2],$,U,{lastRow:1}),u[3]=Pf(c[3],W,U,{lastColumn:1,lastRow:1}),b=p,y=V+U+g}else{var q=h,z=Math.min(q*_[0],.66*(p-v)),Y=(h-2*g)/(1/_[1]+1/_[2]+1/_[3]),G=intval(Y/_[1]),Q=intval(Y/_[2]),K=q-G-Q-2*g;z+(Y=Math.min(p-z-v,Y))+v<p&&q*_[0]>z&&(z=Math.min(q*_[0],p-v-Y)),u[0]=Pf(c[0],z,q,{lastRow:1}),u[1]=Pf(c[1],Y,G,{lastColumn:1}),u[2]=Pf(c[2],Y,Q,{lastColumn:1}),u[3]=Pf(c[3],Y,K,{lastColumn:1,lastRow:1}),b=z+Y+v,y=h}else{var X=[],J=0;m>(s.length?1.3:1.1)?each(_,(function(e,t){X[X.length]=Math.max(1,t)})):each(_,(function(e,t){~s.indexOf(J)?X[X.length]=t:X[X.length]=Math.min(1,t),J++}));var Z,ee,te={};for(te[f+""]=[o(X,p,v)],Z=1;Z<=f-1;Z++)te[Z+","+(ee=f-Z)]=[o(X.slice(0,Z),p,v),o(X.slice(Z),p,v)];for(Z=1;Z<=f-2;Z++)for(ee=1;ee<=f-Z-1;ee++)te[Z+","+ee+","+(f-Z-ee)]=[o(X.slice(0,Z),p,v),o(X.slice(Z,Z+ee),p,v),o(X.slice(Z+ee),p,v)];var ne,ie=null,ae=0;for(var oe in te)if(te.hasOwnProperty(oe)){var re=te[oe],se=a(re)+g*(re.length-1),le=Math.abs(se-h);if(~oe.indexOf(",")){for(var ce=oe.split(","),ue=0;ue<ce.length;ue++)ce[ue]=intval(ce[ue]);(ce[0]>ce[1]||ce[2]&&ce[1]>ce[2])&&(le+=50,le*=1.5)}(null===ie||le<ae)&&(ie=oe,ae=le,ne=se)}for(var de=Nf(c),_e=Nf(X),fe=ie.split(","),pe=te[ie],he=fe.length-1,me=0;me<fe.length;me++){var ve=parseInt(fe[me]),ge=de.splice(0,ve),Ae=pe.shift(),be=ge.length-1,ye={};he==me&&(ye.lastRow=!0);for(var we=p,Se=0;Se<ge.length;Se++){var ke=ge[Se],Oe=_e.shift(),Ce=ye,je=void 0;be==Se?(je=Math.ceil(we),Ce.lastColumn=!0):we-=(je=intval(Oe*Ae))+v,u[u.length]=Pf(ke,je,Ae,Ce)}}b=p,y=ne}return{width:intval(b),height:intval(y),thumbs:u}}function Pf(e,t,n,i){var a={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:xf(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(a,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(a,{title:e.title,msize:e.msize}):e.type===Of&&e.name&&void 0!==e.name&&extend(a,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),a.unsized?a.ratio=1:a.ratio=a.image.width/a.image.height,a}function xf(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,o=window.devicePixelRatio||1;if(e.type===Of||e.type===Sf){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((function(i){e.sizes[i]&&(!a||t*o<=e.sizes[i][1]&&n*o<=e.sizes[i][2])&&(a=e.sizes[i])}))}else{var r=e.thumb?e.thumb.sizes:e.sizes,s=r.x||r[r.length-1],l=s?(s[1]||1)/(s[2]||1):1,c=0;l>t/n?(c=n,l>1&&(c*=l)):(c=t,l<1&&(c/=l)),n*=o,t*=o;var u=!i&&r.o,d="";d=r.temp?"temp":c<75?"s":c<130?"m":u&&r.o&&r.o[1]>=t&&r.o[2]>=n?"o":u&&r.p&&r.p[1]>=t&&r.p[2]>=n?"p":u&&r.q&&r.q[1]>=t&&r.q[2]>=n?"q":u&&r.r&&r.r[1]>=t&&r.r[2]>=n?"r":"x",a=r[d]||[]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function Lf(e,t,n){var i=t,a=n,o=0,r=0;if(!e.vid&&e.image.width&&e.image.height){var s=e.image.width/e.image.height;s<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(a=(i=t)/s)>n&&(r=-intval((a-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(a=n)*s)>t&&(o=-intval((i-t)/2)))}return{width:i,height:a,marginLeft:o,marginTop:e.orig&&(e.type===jf||e.type===Cf)&&e.single?0:r}}function Bf(e,t,n){var i;switch(e.type){case Sf:i=e.ratio;break;case Of:i=e.ratio||1.777;break;case Cf:case jf:i=1.5;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,o=a[1],r=a[2];o&&r&&(i=o/r)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,l=s[1],c=s[2];l&&c&&(i=l/c)}}return i||1}function Rf(e,t,n,i){var a=t.split("_"),o=a[0],r=a[1],s=Object(E.default)({owner_id:o,ownerId:o,itemId:r,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},i);switch(e){case Sf:s.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},s.doc=s.data;break;case kf:s.data={pid:r,sizes:n.sizes,restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.photo=s.data;break;case Of:s.data={vid:r,duration:n.duration,platform:n.platform,play_icon:n.play_icon,preview:n.preview,active_live:n.active_live,restriction:n.restriction,ratio:n.ratio,sizes:n.sizes,name:n.name},s.video=s.data;break;case Cf:s.data={aid:r,title:n.title,size:n.size,thumb:{sizes:n.sizes},restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.album=s.data;break;case jf:s.data={type:jf,aid:r,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},s.market_album=s.data}return s.data.type=e,s.data.id=s.temp?e+"temp_"+o:""+e+s.ownerId+"_"+s.itemId,s}function Df(e){return!!~[Sf,kf,Of,Cf,jf].indexOf(e.toString())}function Nf(e,t){var n=Hf(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=Nf(e[i]):n[i]=e[i]);return n}var Hf=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var Vf=function(e){var t=e.iconFilename+(e.canPreview?"":"_grey")+"_44",n=[{class:"VideoRestriction__boxWrap",inner:[{class:"VideoRestriction__box",inner:[Object(T.default)("video-restrictions",t),{class:"VideoRestriction__title",inner:e.title}]}]}];e.thumb&&n.push({class:"VideoRestriction__thumb",style:"background-image: url("+e.thumb+"); height: 100%; width: 100%;"});e.button&&n[0].inner[0].inner.push({class:"VideoRestriction__button",inner:e.button.text,onclick:["VideoRestriction.hideDisclaimerAndPlay"]});return n};var Uf={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady((function(){window.ThumbsEdit.init(!1),page.onChange((function(){window.ThumbsEdit.init(!1,"/wall")}))}))},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall")&&0!==t.indexOf("/board"))return this.initialized=!1,removeClass(document.body,"te_i"),void(Uf.destroyLongpress&&Uf.destroyLongpress());if(addClass(document.body,"te_i"),!geByClass1("ThumbsEdit",e)){var a=Object(i.ceFromString)(c.default.html({class:"ThumbsEdit",style:"width: 100%; height: 100%",id:"ThumbsEdit"})),o=Object(i.ceFromString)(c.default.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:a}));o.appendChild(a),e.insertBefore(o,e.firstChild),Uf=Object(E.default)({},Uf,{previews:[],loaders:{},attachEl:a});var r=this.parsePreviews(Object(i.getPreloadData)());this.initialized=!0,r.length&&(Uf.previews=r,this.draw(),Object(i.onBodyResize)((function(){return n.draw()})))}},parsePreviews:function(e){return e.map((function(e){return Rf.apply(void 0,e)})).filter((function(e){return Df(e.type)}))},draw:function(){var e=this,t=Uf,n=t.previews,i=t.attachEl,a=n[0]?Bf(n[0]):1.5,o={width:i.parentNode.offsetWidth,height:Math.min(Math.round(i.parentNode.offsetWidth/a),360),wide:!0},r=Mf(o.width,o.height,n,o),s=r.thumbs,l=r.height,c=r.width;Uf=Object(E.default)({},Uf,{thumbs:s,height:l,options:o});var u=document.createDocumentFragment();s.forEach((function(t,n){u.appendChild(e.createThumbEl(t,n))})),this.updateIds();var d=ce("div");d.id="ThumbsEdit-splitter",val(i,""),i.style.width=c+"px",i.parentNode.style.height=l+"px",i.appendChild(u),ge("ThumbsEdit-splitter")||i.parentNode.appendChild(d),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var a=e.id,o=ge(a),r=Uf.thumbs,s=Uf.height,l=Uf,u=l.options,d=l.drag,_=t[0]?Bf(t[0]):1.5,f=u.width,p=u.height;f&&p||(f=e.parentNode.offsetWidth,p=Math.min(Math.round(f/_),360)),u.width=f,u.height=p,u.wide=!0;var h=Mf(f,p,t,u),m=h.thumbs,v=h.height,g=h.width,A=Object(i.ceFromString)(c.default.html({class:"ThumbsEdit",style:"width: "+g+"px; height: "+v+"px; position: fixed; left: "+d.wpos[0]+"px; top: "+d.wpos[1]+"px; visibility: hidden"}));m.forEach((function(e,t){A.appendChild(n.createThumbEl(e,t,!0))})),document.body.appendChild(A);var b=this.getCoords(A,d.wpos);re(A),b.forEach((function(e,t){var n=Uf.drag.coords.find((function(t){return t.id===e.id}));if(n){var a=geByClass1("Thumb",n.node),o=$("img",a),s=r[n.index],l=m.find((function(e){return e.id===s.id}));Uf.drag.toIndex!==t&&i.setStyle.transform(a,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==Uf.drag.i||setTimeout((function(){i.setStyle.animate(a,"margin-left, margin-top, height, width, opacity, transform",{duration:Ef+"ms"}),Object(i.setStyle)(a,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),i.setStyle.transform(a,1,[e.x-n.x,e.y-n.y]),i.setStyle.animate(a.parentNode,"background",{duration:Ef+"ms"}),Object(i.setStyle)(a.parentNode,{func:"ease-in",background:"transparent"});var t=Lf(l,e.width,e.height);o&&(i.setStyle.animate(o,Object.keys(t).join(),Ef+"ms"),Object(i.setStyle)(o,t))}))}})),s!==v&&setTimeout((function(){[o,o.parentNode].forEach((function(e){i.setStyle.animate(e,"height",{duration:Ef+"ms"}),Object(i.setStyle)(e,{height:v})}))})),g>=f&&(i.setStyle.animate(o,"width",{duration:Ef+"ms"}),Object(i.setStyle)(o,{width:g})),setTimeout((function(){Object(i.setStyle)(o,{width:g}),Uf.thumbs=m,Uf.previews=t,Uf.height=v;var e=document.createDocumentFragment();m.forEach((function(t,i){e.appendChild(n.createThumbEl(t,i))})),o.innerHTML="",o.appendChild(e),Uf.drag.updating=!1,n.updatePhotos()}),Ef)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,a=e.width,o=e.height,r=e.type,s=Lf(e,a,o),l=["Thumb-wrap","Thumb-wrap--"+r],u=0===e.id.indexOf("phototemp_"),d=u||a<=30||o<=60,_=e.orig.restriction;u&&l.push("Thumb-wrap--temp"),e.lastColumn&&l.push("last_column"),e.lastRow&&l.push("last_row");var f=Uf.previews[t],p=null;f.label&&(p=c.default.wrap(f.label));var h=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var m=[{class:_?"VideoRestriction__thumb":"",inner:[{tag:"img",src:(h?h.src:n.src)||"/images/blank.gif",width:""+Math.round(s.width),height:""+Math.round(s.height),style:"margin-left: "+s.marginLeft+"px; margin-top: "+s.marginTop+"px;"}]},{class:"Thumb__overlay",inner:[!d&&{class:"Thumb__overlay-closeBtn",onclick:"ThumbsEdit.remove(null, "+t+")"},p]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:r},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(r.length,e.id.length)}];if(u){var v,g=Math.min(Math.min((s.width-24)/2,30),Math.min((s.height-24)/2,30));Uf.loaders[e.id]&&(v=Uf.loaders[e.id]);var A=bd.init(v,g),b=A.component,y=A.id;Uf.loaders[e.id]=y,m.push(b)}var w=["Thumb"];_&&(w.push("VideoRestriction"),w.push("VideoRestriction--onlyIcon"),e.orig.restriction.canPreview&&w.push("VideoRestriction--canPreview"),e.orig.restriction.needBlur&&w.push("VideoRestriction--blur"));var S=Object(i.ceFromString)(c.default.html({class:w.join(" "),style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px",inner:m})),k=Object(i.ceFromString)(c.default.html({class:l.join(" "),style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px","data-media":e.id,"data-index":t,"data-upload":f.upload}));if(Uf.destroyLongpress=wf(S,350,this.startDrag.bind(this,S)),addEvent(k,"click",this.showPopup.bind(this)),_){var O=c.default.html(Vf({canPreview:e.orig.restriction.canPreview,iconFilename:e.orig.restriction.icon,title:e.orig.restriction.title}));S.appendChild(Object(i.ceFromString)(O))}return k.appendChild(S),k},addTempPreview:function(e){var t;if(Uf.attachEl){var n=this.parsePreviews([e]);(t=Uf.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=Uf.previews.findIndex((function(t){return t.ownerId===e})),o=Uf.previews[a],r=t.split("_").ownerId,s=t.split("_").itemId;o.ownerId=r,o.owner_id=r,o.itemId=s,o.temp=!1,o.upload=e,o.list=n,o.photo.sizes=i,o.photo.id="photo"+t,o.photo.pid=s,o.data=o.photo,bd.ready(Uf.loaders["phototemp_"+e]),this.draw()},onUploadProgress:function(e,t){bd.update(Uf.loaders["phototemp_"+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains("Thumb")&&!e.classList.contains("Thumb--moving")){window.navigator.vibrate&&navigator.vibrate(50),Object(i.setStyle)(document.body,"overflow","hidden"),Object(i.setStyle)(document.body,"max-height","100%"),Object(i.setStyle)(document.body,"user-select","none");var n=this.onDrag.bind(this),a=this.onDrop.bind(this);addEvent(window,"mousemove touchmove",n),addEvent(window,"mouseup touchend touchcancel",a),statlogsValueEvent("mvk_thumb_edit_interaction",""),Uf.drag=Object(E.default)({},Uf.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:a});var o=e.offsetWidth>=40&&e.offsetHeight>=80,r=e.parentNode.parentNode,s=$("img",e),l=intval(e.parentNode.getAttribute("data-index")),c=Uf.thumbs[l],u=getXY(r),d=getXY(e.parentNode),_=this.getCoords(r,u);Uf.drag.id=r.id,Uf.drag.i=l,Uf.drag.toIndex=l,Uf.drag.x=(t.pageX||t.detail.pageX)-d[0],Uf.drag.y=(t.pageY||t.detail.pageY)-d[1],Uf.drag.t=c,Uf.drag.w=c.width,Uf.drag.h=c.height,Uf.drag.pos=d,Uf.drag.wpos=u,Uf.drag.crop=Lf(c,c.width,c.height),Uf.drag.coords=_,Uf.drag.needScale=o;var f=o?function(e,t,n,i){n=intval(n),i=intval(i)||n;var a=e,o=t;return e>=t&&e>n?(a=intval(n),o=intval(t/(e/n))):e<t&&t>i&&(o=intval(i),a=intval(e/(t/i))),[a,o]}(c.width,c.height,.9*e.offsetWidth,.9*e.offsetHeight):[c.width,c.height],p=f[0],h=f[1],m=intval((c.width-p)*(browser.android?.5:Uf.drag.x/c.width)),v=intval((c.height-h)*(browser.android?.5:Uf.drag.y/c.height));addClass(e,"Thumb--moving"),Object(i.setStyle)(e,{zIndex:100}),Object(i.setStyle)(e.parentNode,{zIndex:100});var g=Lf(c,p,h);Object(i.setStyle)(e,{opacity:.75,width:p,height:h,marginLeft:m,marginTop:v}),s&&Object(i.setStyle)(s,g),Uf.drag.state=!0}},onDrag:function(e){var t=Uf.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),a=n.x,o=n.y,r=Uf.drag,s=a-(r.pos[0]+r.x),l=o-(r.pos[1]+r.y);i.setStyle.transform(t,1,[s,l]);var c=r.wpos;s=r.pos[0]+intval(t.style.marginLeft)+s-c[0],l=r.pos[1]+intval(t.style.marginTop)+l-c[1];var u=s,d=l,_=(t.offsetWidth,t.offsetHeight,r.i),f=!1,p=r.i,h=-1,m=window.innerWidth>=480?6:3,v={};if(r.coords.forEach((function(e,t){if(t!==r.i&&t!==h){e.offsetX=e.node.offsetWidth+m,e.offsetY=e.node.offsetHeight+m;var n=r.coords[t-1],a=r.coords[t+1],o=u+r.x,s=d+r.y,l=e.x+e.offsetX/2,c=e.y+e.offsetY/2,g=e.x+e.offsetX,A=e.y+e.offsetY,b=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||a&&a.x===e.x&&a.y!=e.y)&&0!=e.x,y=o>=l&&(a&&(o<=a.x+a.offsetX/2&&(a.offsetY===e.offsetY||o<g)||a.y!=e.y)||!a&&u<=g)&&s>e.y&&s<A,w=o<l&&o>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!a))&&s>e.y&&s<A,S=b&&s>=c&&s<A&&o>e.x&&o<g,k=b&&s<c&&s>=e.y&&o>e.x&&o<g;y=y&&!b,w=w&&!b&&!y,(y||w||S||k)&&(f=!0,p=e.index<r.i&&(y||S)?e.index+1:_<e.index&&(k||w)?e.index-1:e.index),p!==r.i?(i.setStyle.transform(e.node,1,[y?-5:w?5:0,S?-5:k?5:0]),y?(v.side="right",v.toIndex=e.index):w&&(v.side="left"),S?(v.side="down",v.toIndex=e.index):k&&(v.side="up")):i.setStyle.transform(e.node,1,[0,0]),y&&a&&a.y===e.y&&a.x>e.x&&_>e.index&&(i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(a.node,1,[5,0]),h=t+1,v.side="left",v.toIndex=p),S&&a&&a.x===e.x&&a.y>e.y&&s<=c&&(i.setStyle.transform(a.node,1,[0,0]),h=t+1),k&&n&&n.x===e.x&&n.y<e.y&&s<=c&&(i.setStyle.transform(n.node,1,[0,-5]),i.setStyle.transform(e.node,1,[0,0]),v.side="down",v.toIndex=n.index),p===t&&"number"!=typeof v.toIndex&&(v.toIndex=e.index)}})),v&&(!r.split||r.split.toIndex!==v.toIndex||r.split.side!==v.side)){var g=ge("ThumbsEdit-splitter");if(Object(i.setStyle)(g,{opacity:0}),r.split=v,"number"==typeof v.toIndex){var A=r.coords[v.toIndex].node,b=3===m;"left"===r.split.side&&Object(i.setStyle)(g,{left:Math.max(0,A.offsetLeft-(b?0:1)),top:A.offsetTop+8,height:A.offsetHeight-16,width:"2px",opacity:1}),"right"===r.split.side&&Object(i.setStyle)(g,{left:Math.min(A.offsetLeft+A.offsetWidth-(b?2:1),Uf.options.width-2),top:A.offsetTop+8,height:A.offsetHeight-16,width:"2px",opacity:1}),"up"===r.split.side&&Object(i.setStyle)(g,{left:A.offsetLeft+8,top:A.offsetTop,height:"2px",width:A.offsetWidth-16,opacity:1}),"down"===r.split.side&&Object(i.setStyle)(g,{left:A.offsetLeft+8,top:A.offsetTop+A.offsetHeight-1,height:"2px",width:A.offsetWidth-16,opacity:1})}}return r.toIndex=f?p:r.i,cancelEvent(e)},onDrop:function(e){var t=Uf.drag;t.state=!1,t.updating=!0;var n=t.curEl,a=$("img",n),o="touchcancel".split(" ").includes(e.type);if(removeEvent(window,"mousemove touchmove",t.dragListener),removeEvent(window,"mouseup touchend touchcancel",t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if(Object(i.setStyle)(document.body,"overflow",null),Object(i.setStyle)(document.body,"max-height",null),Object(i.setStyle)(document.body,"user-select",null),i.setStyle.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge("ThumbsEdit-splitter").removeAttribute("style");if(!hasClass(n,"Thumb--moving"))return t.updating=!1,cancelEvent(e);if(o){var r=t.coords[t.toIndex].node;i.setStyle.transform(r,1,[0,0])}if(t.toIndex===t.i||o){var s=t.crop;i.setStyle.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"},(function(){removeClass(n,"Thumb--moving")})),i.setStyle.animate(a,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"});var l=Uf.thumbs[t.i];i.setStyle.transform(n,1,[0,0]),Object(i.setStyle)(n,{"margin-top":0,"margin-left":0,width:l.width,height:l.height,opacity:1,zIndex:null}),Object(i.setStyle)(n.parentNode,{zIndex:null}),a&&Object(i.setStyle)(a,s)}else{var c=Uf.previews;c=function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}(c,t.i,t.toIndex),this.update(t.id,c)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach((function(e,i){var a=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(a[0]-t[0]),y:intval(a[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}})),n},remove:function(e,t){var n=Uf.previews[t];e&&cn.default.close(e.target),mediaUpload.reset(null,null,n.remove,(function(){Uf.previews=Uf.previews.filter((function(e,n){return n!==t})),ThumbsEdit.draw()}))},showPopup:function(e){var t=e.target;if(!Uf.drag.state&&!t.classList.contains("Thumb--moving")&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),a=Object(i.ceFromString)(c.default.html(this.getPopup(n)));X.default.open(a,!0)}},getPopup:function(e){var t=Uf.previews[e],n=null;switch(t.type){case"doc":t.is_gif&&(n='\n            Gif.openPopup(null, null, {\n              raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n              hasVideo: '+Gif.isMp4Supports()+"\n            });\n            Popup.close(this);\n          ");break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=Object(X.ModalMenuBtn)({inner:getLang("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),a=null;return n&&!t.temp&&(a=Object(X.ModalMenuBtn)({inner:getLang("mobile_open"),onclick:""+n})),Object(X.default)({class:"ThumbsEdit__modal",close:!0,items:[a,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,Uf.cachedPhoto[e]){var a=Uf.cachedPhoto[e].find((function(e){return e.src===t}));a?n&&n(a.src):i.onload=function(){Uf.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),Uf.cachedPhoto[e].sort((function(e,t){return e.width>t.width?-1:e.width<t.width?1:0})),n&&n(t)}}else Uf.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;Uf.thumbs.forEach((function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,(function(e){n.src=e}))}))},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:Uf.cachedPhoto[e]&&0!==Uf.cachedPhoto[e].length?Uf.cachedPhoto[e].find((function(e){var t=e.src,n=ce("img");return n.src=t,n.complete})):null},getThumbsCount:function(){return(Uf.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach((function(e,n){var i=$$("input",e),a=t+n;i[0].name="attach"+a+"_type",i[1].name="attach"+a}))}};var Ff=need("Btn"),$f=need("Control"),Wf=window.Join||(window.Join={});Wf._onCountryChange=Jf,Wf._onPhoneChange=Zf,Wf._onTermsAcceptChange=Zf,Wf._onSuccess=Xf;var qf="Join_eu",zf=".Join",Yf=".Join__phone",Gf=".Join__accept",Qf=".Join__submit",Kf=!1;function Xf(){Kf||(Kf=!0,Js({id:"2579437",type:"reachGoal",goal:"mt_registration",userid:Xs()}))}function Jf(e){var t=e.$option,n=Object(M.$)(zf),i="1"===t.getAttribute("data-eu");n.classList.toggle(qf,i);var a=Object(M.$)(Yf),o=t.value;Fi.default.setPrefix(a,o),cur.calledPhoneExcludeCountries&&val(Object(M.$)(".join_desc"),getLang(-1==indexOf(cur.calledPhoneExcludeCountries,t.getAttribute("data-id"))?"mobile_join_about_phone_with_call":"mobile_join_about_phone")),Object(M.$$)(Gf).forEach((function(e){return $f.setChecked(e,!1)})),Zf()}function Zf(){var e=Array.prototype.slice.call(Object(M.$$)(Gf)),t=Object(M.$)(Yf),n=Object(M.$)(Qf);if(n){var i=e.some($f.isChecked)&&Fi.default.getValue(t).trim().length>0;Ff.setDisabled(n,!i)}else(n=Object(M.$)('.button[type="submit"]')).disabled=!$f.isChecked(e[0])}n("XLP4");onDOMReady(ep),window.page&&page.onChange(ep);function ep(){window.pushNotifier&&pushNotifier.canBeEnabled().then((function(e){return e&&PushNotifier.getPermission()===af.PUSH_NOTIFIER_PERMISSION_DEFAULT})).then((function(e){if(e){FeedNotifications.addWebActionAcceptHandler("enable_browser_notifications",tp),FeedNotifications.addWebActionDeclineHandler("enable_browser_notifications",np);var t=geByClass1("feedAssistance_pushNotificationsSwitch");if(!t)return;FeedAssistanceStats.registerTrackingCls("feedAssistance_pushNotificationsSwitch"),FeedAssistanceStats.register(t,"feed")}}))}function tp(e){return pushNotifier.requestPermission().then((function(t){var n,i=!0;return unlockButton(e),t===af.PUSH_NOTIFIER_PERMISSION_DEFAULT?i=!1:(n=t===af.PUSH_NOTIFIER_PERMISSION_GRANTED?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,ap(e,n),ip(),i)}),(function(){return np(e)}))}function np(e){return unlockButton(e),ap(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),ip(),!0}function ip(){var e=geByClass1("feedAssistance_pushNotificationsSwitch");remove(e)}function ap(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,"m_push_switch",t)})}window.closePostSuggest=function(e,t){return suggestionEvent(e,t,!1),stopEvent(t)},window.suggestionEvent=function(e,t,n){void 0===n&&(n=!1);var a=Object(i.geByClass1)("post_suggest");return ajax.post("wall.php",{_ajax:1,act:"suggestion_event",event_type:e,suggest_id:a.getAttribute("data-suggest-id"),not_hide_by_click:intval(n)}),n||Object(i.re)(a),stopEvent(t)};n("zRDV");var op=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],r=0,s=o.length;r<s;r++,a++)i[a]=o[r];return i},rp=function(){function e(e,t){this.sendLogsTimeout=null,this.sendLogsProcess=!1,this.localStorageKey="recommended_groups",this.logsDataDelimiter="|",this.location=e,this.act=t}return e.prototype.sendLogs=function(){this.sendLogsTimeout&&clearTimeout(this.sendLogsTimeout),this.sendLogsTimeout=setTimeout(this.sendLogsAccept.bind(this),1e4)},e.prototype.sendLogsAccept=function(){var e=this;if(!this.sendLogsProcess){var t=this.getLogs(!0);t.length&&(this.sendLogsProcess=!0,this.clearLogs(),window.ajax.post(this.location,{act:this.act,logs:t},{onDone:function(){e.sendLogsProcess=!1},onFail:function(){return e.restoreLogs(t),e.sendLogsProcess=!1,!0}}))}},e.prototype.restoreLogs=function(e){var t=this,n=this.getLogs(),i=e.map((function(e){return e.split(t.logsDataDelimiter)})),a=op(i,n);ei.default.set(this.localStorageKey,a)},e.prototype.getLogs=function(e){var t=this,n=ei.default.get(this.localStorageKey)||[];return e&&(n=n.map((function(e){return e.join(t.logsDataDelimiter)}))),n},e.prototype.addLog=function(e){var t=this.getLogs(),n=e.eventType,i=e.trackCode,a=e.groupId,o=a?[n,i,a]:[n,i];t.push(o),ei.default.set(this.localStorageKey,t),this.sendLogs()},e.prototype.clearLogs=function(){ei.default.remove(this.localStorageKey)},e}(),sp=function(){function e(){this.onScroll=Object(i.throttle)(this.onScroll,50)}return e.prototype.init=function(){this.gallery=document.querySelector(".groupsRecommendedSlider"),this.sliderSizes=null,this.allLoaded=!1,this.ajaxIsRunning=!1,this.gallery&&(this.block=document.querySelector(".GroupsRecommendedSlider"),this.sliderScrollNode=this.gallery.querySelector(".Slider__scroll"),this.sliderLineNode=this.gallery.querySelector(".Slider__line"),this.eventLog=new rp("/groups","stats"))},e.prototype.subscribe=function(e,t,n){var a=e.closest(".prettyCard").dataset,o=a.groupId,r=a.trackCode;if(o&&r&&!e.classList.contains("prettyCard__button_accepted"))return this.eventLog.addLog({eventType:"group_subscribed",groupId:o,trackCode:r}),window.ajax.post("/groups",{act:"subscribe_from_recomm_groups",hash:t,oid:-o,track_code:r},{onDone:function(t){e.classList.add("prettyCard__button_accepted"),e.innerHTML=t,e.onclick=null},onFail:function(){return!1},showProgress:function(){Object(i.lockButton)(e),e.classList.add("prettyCard__button_loading")},hideProgress:function(){Object(i.unlockButton)(e),e.classList.remove("prettyCard__button_loading")}}),n&&Object(i.cancelEvent)(n);Object(i.cancelEvent)(n)},e.prototype.closeGroup=function(e,t,n){var a=e.closest(".prettyCard"),o=a.dataset,r=o.groupId,s=o.trackCode;if(r&&s)return this.eventLog.addLog({eventType:"group_hidden",groupId:r,trackCode:s}),Object(i.remove)(a),this.slides=null,window.ajax.post("/groups",{act:"hide_recomm_groups_block_group",hash:t,track_code:s,group_id:r}),n&&Object(i.cancelEvent)(n)},e.prototype.hideBlock=function(){var e=Object(i.domData)(this.sliderScrollNode,"code")||"";this.eventLog.addLog({eventType:"block_hidden",trackCode:e}),Object(i.remove)(this.block)},e.prototype.clickOnGroup=function(e){var t=e.dataset,n=t.groupId,i=t.trackCode;n&&i&&this.eventLog.addLog({trackCode:i,groupId:n,eventType:"group_opened"})},e.prototype.clickOnViewAll=function(){var e=Object(i.domData)(this.sliderScrollNode,"code")||"";e&&this.eventLog.addLog({trackCode:e,eventType:"block_expanded"})},e.prototype.viewBlock=function(e){this.eventLog.addLog({trackCode:e,eventType:"block_seen"})},e.prototype.onScroll=function(){if(this.gallery&&this.sliderScrollNode){var e=this.getScrollSizeValues();if(!this.ajaxIsRunning&&e){var t=this.sliderScrollNode.scrollLeft,n=Math.max(0,Math.floor((t-e.leftMargin)/e.itemWidth)),a=Math.max(0,Math.floor((t+e.width-e.leftMargin)/e.itemWidth));n*e.itemWidth+e.itemWidth-e.part<t&&n++,a*e.itemWidth+e.part>t+e.width&&a--;var o=this.getSlides();if(o){n=Math.max(0,n),a=Math.min(o.length,a);for(var r=n;r<=a;r++){var s=o[r];if(s&&!s.viewed){s.viewed=!0;var l=s.dataset,c=l.groupId;(d=l.trackCode)&&c&&this.eventLog.addLog({trackCode:d,groupId:c,eventType:"group_seen"})}}if(!this.allLoaded&&t+e.width>=e.scrollWidth/2){var u=Object(i.domData)(this.sliderScrollNode,"next")||"",d=Object(i.domData)(this.sliderScrollNode,"code")||"";if(!u)return void(this.allLoaded=!0);this.ajaxIsRunning=!0;var _=this;window.ajax.post("/groups",{act:"recommended_carousel",next:u,track_code:d},{onDone:function(e,t){if(e){var n=window.cdf(e);Object(i.append)(n,_.sliderLineNode),_.sliderSizes=null,_.slides=null}Object(i.domData)(_.sliderScrollNode,"next",t||null),_.allLoaded=!t,_.ajaxIsRunning=!1},onFail:function(){return setTimeout((function(){return _.ajaxIsRunning=!1}),500),!1}})}}}}},e.prototype.getScrollSizeValues=function(){var e;if(this.sliderSizes)return this.sliderSizes;var t=this.getSlides(),n=Object(i.getSize)(this.sliderScrollNode)[0],a=Object(i.getX)(this.sliderScrollNode),o=Object(i.getX)(t[0])-a,r=Object(i.getSize)(t[0])[0],s={width:n,itemWidth:r+(Object(i.getX)(t[1])-a-o-r),leftMargin:o,part:Math.floor(r/3),scrollWidth:null===(e=this.sliderScrollNode)||void 0===e?void 0:e.scrollWidth};return this.sliderSizes=s,this.sliderSizes},e.prototype.getSlides=function(){var e;return this.slides||(this.slides=null===(e=this.gallery)||void 0===e?void 0:e.querySelectorAll(".prettyCard")),this.slides},e}();window.RecommendedGroupsSlider=new sp;n("mPGc"),n("STl5");function lp(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find((function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t}))}var cp,up=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function dp(){cp&&cp.classList.remove(Ca.class.open)}function _p(){cp&&cp.classList.add(Ca.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),Object(i.isIosWebView)()||Object(i.isAndroidWebView)()||Object(i.isVkWebView)()||(n||(cp=Object(i.geByClass1)(Ca.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&dp(),lp(t,up)||nav.getQuery("z")?(dp(),setTimeout(dp)):_p())}(null,!1)}));var fp={_onCloseClick:function(e){Ca._onCloseClick(e),Object(_n.setCookie)("remixregbtn",0,0)},show:_p,hide:dp};window.uRegisterFloatBtn=fp;var pp,hp=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function mp(){pp&&pp.classList.remove(Ca.class.open)}function vp(){pp&&pp.classList.add(Ca.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),n||(pp=Object(i.geByClass1)(Ca.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:ae.default.path,!/^\/photo/.test(t)&&mp(),lp(t,hp)||ae.default.getQuery("z")?mp():vp()}(null,!1)}));var gp={_onCloseClick:function(e){Ca._onCloseClick(e)},show:vp,hide:mp,processOpenInNativeApp:function(e,t,n,a,o){void 0===o&&(o={}),o=o||{},ae.default.onMenuItemClick(n),ae.default.openInNativeApp(a,t,e),Object(i.statlogsValueEvent)("utm_open_in_native_app_button","clicked",o.utm_source,o.utm_param,o.utm_medium,o.utm_time)}};window.uOpenInNativeAppFloatBtn=gp;var Ap=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(T.default)({sprite:"common",name:"cancel_outline_24"})],class:"Covid19Banner__close",role:"button","aria-label":e.aria_label_close,onClick:["Covid19Banner.close","event","this"],tag:"div"},{inner:[{inner:[Object(T.default)({sprite:"common",name:"covid_19_64"})],class:"Covid19Banner__icon",tag:"div"},{inner:[{inner:[e.title],class:"Covid19Banner__title",tag:"h4"},{inner:[e.text,{inner:[e.more],class:"Covid19Banner__link",href:e.url,onClick:"event.preventDefault()",tag:"a"}],class:"Covid19Banner__text",tag:"p"}],class:"Covid19Banner__content",tag:"div"}],class:"Covid19Banner__wrapper",tag:"div"}],class:"Covid19Banner",role:"complementary",onClick:["Covid19Banner.open","event",e.url,e.statlogsEventOpen],tag:"div"}};function bp(){Object(i.throttle)(yp,66)()}function yp(){var e=Object(M.$)(".Covid19Banner__offset");if(e){var t=Object(M.$)(".Covid19Banner").clientHeight;e.style.height=t+"px"}}onDOMReady((function(){!function(){var e=Object(M.$)(".Covid19Banner");if(e){var t=Object(M.$)(".layout"),n=e.clientHeight,i=(a=n,(o=document.createElement("div")).classList.add("Covid19Banner__offset"),o.style.height=a+"px",o);t.appendChild(i)}var a,o}(),window.addEventListener("resize",bp)}));window.Covid19Banner=Ap,Object(i.extend)(Ap,{open:function(e,t,n){e.preventDefault(),e.stopPropagation(),Object(i.statlogsValueEvent)(n),nav.hard_go(t)},close:function(e,t){var n;e.preventDefault(),e.stopPropagation(),j.default.post("/stats?act=covid_19_banner_close"),t.parentElement.remove(),n=Object(M.$)(".Covid19Banner__offset"),window.removeEventListener("resize",bp),n.remove()}});window.ProfileImageModal={open:function(e,t,n,a,r){var s=Object(K.default)({id:"profile-photo-modal",close:!0,on_overlay_click:"ProfileImageModal.closeModal(this);",items:[Object(X.ModalMenuBtn)({"aria-label":Object(F.getLang)("mobile_profile_photo_modal_album"),inner:Object(F.getLang)("mobile_profile_photo_modal_album"),onclick:"ProfileImageModal.openAlbum('"+decodeURIComponent(e)+"');"}),Object(X.ModalMenuBtn)({"aria-label":Object(F.getLang)("mobile_profile_photo_modal_change"),class:"ModalMenu__btn_overflow",inner:[{tag:"input",type:"file",class:"inline_upload","data-upload-url":decodeURIComponent(t),"data-static-url":decodeURIComponent(a),"data-base-url":decodeURIComponent(n),onclick:"ownerPhotoUpload.prepareInput(this);",onchange:"return ownerPhotoUpload.start(this, event);",accept:decodeURIComponent(r)},Object(F.getLang)("mobile_profile_photo_modal_change")],onclick:"ProfileImageModal.selectImage();"})]});K.default.open(c.default.elem(s),!0),Object(i.statlogsValueEvent)("mvk_profile_image_modal","open");var l=Object(M.$)(".profile_photo_modal_expand");Object(o.expandPopup)(l).exitIntent=function(){Object(i.statlogsValueEvent)("mvk_profile_image_modal","close"),K.default.close()}},openAlbum:function(e){Object(i.statlogsValueEvent)("mvk_profile_image_modal","album"),K.default.close(),nav.go(e)},selectImage:function(){Object(i.statlogsValueEvent)("mvk_profile_image_modal","upload"),K.default.close(),Object(M.$)(".inline_upload").click()},closeModal:function(e){Object(i.statlogsValueEvent)("mvk_profile_image_modal","close"),K.default.close(e)}};var wp=Object(i.need)("page"),Sp=Object(i.need)("audio"),kp=Object(i.need)("onDOMReady"),Op=Object(i.need)("audioplayer"),Cp=Object(i.need)("AudioSpecialForYou");function jp(){Tp(),Sp.subscribe([Sp.events.INIT,Sp.events.SELECT,Sp.events.PAUSE],Tp),wp.onChange(Tp)}function Ep(e){var t=e.$btn;Mp()?Op.playPause():Op.playFirst(null,t),Op.onPlay(Tp),Op.onPause(Tp)}function Tp(){Cp.setPlaying(Sp.playing()&&Mp())}window.uAudioBlock={},kp(jp),window.uAudioBlock._onSpecialPlayAllClick=Ep;var Ip=null;function Mp(){var e=Sp.getCurrentPlaylistId();if(!Ip){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(Ip=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!Ip&&e===Ip}var Pp={_onMorePopupClose:function(e){return this.expand&&this.expand(),K.default.close(e)},morePopup:function(e,t){var n=parseInt(Object(i.attr)(t,"data-owner_id"),10),a=parseInt(Object(i.attr)(t,"data-playlist_id"),10),r=Object(i.attr)(t,"data-publish_href"),s="true"===Object(i.attr)(t,"data-is_followed"),l=Object(i.attr)(t,"data-follow_hash"),u=l?"/audio?act=follow_playlist&playlist_owner_id="+n+"&playlist_id="+a+"&hash="+l:"";K.default.open(c.default.elem(Object(K.default)({id:"more-"+n+"-"+a,on_overlay_click:["return AudioPlaylist._onMorePopupClose","this"],close:!0,onClose:["return AudioPlaylist._onMorePopupClose","this"],items:[l&&Object(K.ModalMenuBtn)({url:u,class:s?" audioPlaylist__add_added":"",inner:[{inner:s?Object(F.getLang)("mobile_playlist_unfollow"):Object(F.getLang)("mobile_playlist_follow"),tag:"span",class:"audioPlaylistSnippet__buttonText"}],attrs:{"data-playlist_owner_id":n,"data-playlist_id":a,"data-hash":l,"data-follow_text":Object(F.getLang)("mobile_playlist_follow"),"data-unfollow_text":Object(F.getLang)("mobile_playlist_unfollow")},onclick:"return AudioPlaylist.followPlaylist(event, this);"}),Object(K.ModalMenuBtn)({url:r,inner:Object(F.getLang)("mobile_like_publish_title"),onclick:'return AudioPlaylist._onMorePopupClose(this) || nav.go("'+r+'");'})]})),!0),this.expand=Object(o.expandPopup)(e.target)},playPause:function(e,t){Object(i.preventEvent)(e);var n=Object(i.gpeByClass)("_audioSnippet",t),a=Object(i.geByClass1)("audio_item",n);window.audioplayer.playPause(e,Object(i.attr)(a,"data-id")),Object(i.toggleClass)("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){Object(i.preventEvent)(e);var n=Object(i.attr)(t,"data-playlist_owner_id"),a=Object(i.attr)(t,"data-playlist_id"),o=Object(i.attr)(t,"data-hash"),r=Object(i.geByClass1)("_audioPlaylistsPage__item"+n+"_"+a),s=t.querySelector(".audioPlaylistSnippet__buttonText"),l=Object(i.hasClass)("audioPlaylist__add_added",t);s&&(s.innerText=l?Object(i.attr)(t,"data-follow_text"):Object(i.attr)(t,"data-unfollow_text")),Object(i.toggleClass)("audioPlaylistsPage__item_removed",r,l),Object(i.toggleClass)("audioPlaylist__add_added",t),function(e){j.default.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:Object(i.attr)(e,"data-playlist_owner_id"),playlist_id:Object(i.attr)(e,"data-playlist_id"),hash:Object(i.attr)(e,"data-hash")},{redirectToLoginPage:!0})}(t);for(var c=document.querySelectorAll('button[data-owner_id="'+n+'"][data-playlist_id="'+a+'"][data-follow_hash="'+o+'"]'),u=0;u<c.length;u++)Object(i.attr)(c[u],"data-is_followed",l?"false":"true")},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <button class="ai_menu_toggle_button" onclick="AudioPlaylist.morePopup(event, this);" data-owner_id="'+e.owner_id+'" data-playlist_id="'+e.id+'" data-publish_href="'+e.publish_href+'" data-is_followed="'+e.is_followed+'" data-follow_hash="'+e.follow_hash+'" aria-label="'+Object(F.getLang)("mobile_more")+'" aria-haspopup="true" aria-expanded="false" aria-controls="more-'+e.owner_id+"-"+e.id+'"></button>\n                </div>\n             </div>\n             '+e.actions;t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <button class="ai_menu_toggle_button"></button>\n                   </div>\n                 </div>');var i=e.grid_covers;return i||e.thumb_style||(i=c.default.html({class:"audioPlaylistsPage__coverPlaceholder",inner:Object(T.default)("audio","playlist_outline_36")})),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+i+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),Object(i.escapeAttr)(e),Object(F.getLang)("mobile_audio_search_btn");var n=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+Object(F.getLang)("mobile_audio_search_placeholder_simple")+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"};return t?n():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(n)},copyValue:function(e,t){var n=Object(i.val)(e),a=Object(i.ge)(t+"_field");Object(i.val)(a,n),cur&&cur[t]&&cur[t].go();var o=Object(i.geBySel1)(".audioPage__tabs .tab_item_cur");o&&Object(i.toggleClass)("tab_item_cur_noactive",o,n)}};window.AudioPlaylist=Pp;n("eJy5");var xp=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:c.default.wrap(t.name)},c.default.wrap(Object(ka.default)({icon:n}))]}};var Lp=xp;window.BookmarksFilterListItem=xp;var Bp=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map((function(e){return{class:"Owner__tag",inner:c.default.wrap(e.name)}}))]:null}};var Rp=Bp;window.BookmarksPageItem=Bp;var Dp=window.Popup,Np=window.ActionMenu,Hp=window.attr,Vp=window.val,Up=window.ajax,Fp=window.replace,$p=window.scrollTop,Wp=window.ceFromString,qp=window.Btn;window.Bookmarks={hideTagsList:dh,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=lh(zp),a=vh();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var o=t.closest(th),r=gh(Hp(o,"id"));a=a.filter((function(e){return r.includes(e.id)})),n.classList.add("BookmarksPopup__hideCorner")}var s=Object(i.qs2obj)(nav.params),l=Object.keys(a).reduce((function(e,t){var n=a[t];return e.push(Lp({tag:n,current_id:parseInt(s.tag)})),e}),[]),u=c.default.html(l);Vp(n.$(".Popup__scrollContent"),u);var d=Object(M.$$)(Jp,n);d&&d.forEach((function(e){addEvent(e,"click",dh)}));return!1},hideDeletePopup:_h,showDeletePopup:function(e){var t=lh(Yp),n=Hp(e,"data-id"),a=Hp(e,"data-hash"),o=Hp(e,"data-name");return bh(t,{id:n,hash:a}),Vp(t.$("["+nh+"]"),Object(i.htsc)(o)),!1},submitDeleteTag:function(){var e=yh(Array.from(Object(M.$$)(Yp)).pop()),t=e.id,n=e.hash;Up.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){sh(e),_h()}})},hideCreatePopup:fh,showCreatePopup:function(e){var t=lh(Gp),n=Hp(e,"data-hash");bh(t,{hash:n});var i=Object(M.$)("[name="+ih+"]",t),a=Object(M.$)(eh,t),o=Vp(i).trim();return qp.setDisabled(a,!o),!1},submitCreateTag:function(){var e=Array.from(Object(M.$$)(Gp)).pop(),t=Array.from(Object(M.$$)(Xp)).pop(),n=yh(e).hash,i=Vp(e.$("[name="+ih+"]")),a=+!!Object(M.$)(Xp);Up.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:a},{onDone:function(e,n){if(a){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){i.push(e.value)})),Vp(t,e),i.forEach((function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)}))}else sh(e);!function(e){var t=mh(),n=e[0],i=e[1];t&&t.tags&&t.tags.push({id:n,name:i,order:0})}(n),fh()}})},hideEditPopup:ph,showEditPopup:function(e){var t=lh(Qp),n=Hp(e,"data-id"),i=Hp(e,"data-hash"),a=Hp(e,"data-name")||"",o=t.$("[name="+ah+"]");Vp(o,a),bh(t,{id:n,hash:i,name:a});var r=Array.from(Object(M.$$)(eh,t)).pop(),s=Vp(o).trim();return qp.setDisabled(r,!s),!1},submitEditTag:function(){var e=Array.from(Object(M.$$)(Qp)).pop(),t=yh(e),n=t.id,i=t.hash,a=Vp(e.$("[name="+ah+"]"));Up.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:a,hash:i,id:n},{onDone:function(e){sh(e),ph()}})},hideSettingsPopup:hh,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,a,o=Hp(e,"data-item_id"),r=Hp(e,"data-item_oid"),s=Hp(e,"data-item_type"),l=Hp(e,"data-hash"),u=Hp(e,"data-raw");t.wrap||(n=lh(Kp),i=n.$(Xp),a=gh(u),Vp(i,c.default.html({class:"Bookmarks__tagsSettingsLoading"})),bh(n,{id:o,oid:r,type:s,hash:l,itemRaw:u}));return Up.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:l,item_id:o,item_oid:r,item_type:s,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var c=Wp(e);bh(c=lh(c),{id:o,oid:r,type:s,hash:l,itemRaw:u,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else Vp(i,e),a.forEach((function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)}))}}),!1},submitSettingsTags:function(){var e=Array.from(Object(M.$$)(Kp)).pop(),t=yh(e),n=t.id,i=t.oid,a=t.type,o=t.hash,r=t.itemRaw,s=t.is_from_snackbar,l=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){l.push(e.value)}));var u=l.join(",");Up.post("/bookmarks",{_ajax:1,act:"tag_set",hash:o,item_id:n,item_oid:i,item_type:a,tag_ids:u,is_from_snackbar:s},{onDone:function(e){hh();var t=Object(M.$)("#"+r);if(t){var n=Object(M.$)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)Vp(n,e);else if(n=Object(M.$)(".Owner__tags",t)){var i=vh(),a=l.map((function(e){return parseInt(e,10)})),o=i.filter((function(e){return a.includes(e.id)})),s=c.default.html(Rp({tags:o}));Vp(n.parentNode,s)}kh(r,l,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){dh(),_h(),fh(),ph(),hh()},initStore:Ah,pushItemsToStore:function(e){var t=mh();t&&(t.items=Object(E.default)({},t.items,{},e))},pushItemToStore:kh,removeFromBookmarkLink:function(e){var t=Hp(e,"data-item_id"),n=Hp(e,"data-item_oid"),i=Hp(e,"data-item_type"),a=Hp(e,"data-hash"),o=Hp(e,"data-raw"),r=Hp(e,"data-link_url"),s=Hp(e,"data-link_title"),l=Hp(e,"data-link_img"),c=Object(M.$)("#"+o);return Np.closeMenu(),addClass(c,oh),Up.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(e){Sh(o,[oh]),Share.setBookmarkState(o,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=Hp(e,"data-item_id"),n=Hp(e,"data-item_oid"),i=Hp(e,"data-item_type"),a=Hp(e,"data-hash"),o=Hp(e,"data-raw"),r=Hp(e,"data-link_url"),s=Hp(e,"data-link_title"),l=Hp(e,"data-link_img"),c=Object(M.$)("#"+o);return Np.closeMenu(),removeClass(c,oh),Up.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(){var e=wh(o),t=e.indexOf(oh);-1!==t&&e.splice(t,1),Sh(o,e),Share.setBookmarkState(o,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,a=Object(i.geByClass1)("RepliesField_fixed");a&&(t=Object(i.getH)(a)+5);Snackbar.init({type:I.SNACKBAR_TYPE_BOOKMARK,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce((function(t,n){return t["data-"+n]=e[n],t}),{})}})},keyupCreateInput:function(e,t){var n=gpeByClass("BookmarksPopup",t),i=Object(M.$)(eh,n),a=Vp(t).trim();qp.setDisabled(i,!a)},openSavedTab:function(e,t){var n=Object(M.$)(".mm_counter",t),i=Object(_n.getCookie)(rh);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=Object(M.$)(".mm_new",e);Object(i.remove)(t)},getStoreItemDataById:Oh,getTagsByItemId:Ch,renderSearchItem:function(e,t,n,i,a){var o="";if(!i||isEmpty(i))o=n;else{var r=Ch(e),s=wh(e);i=JSON.parse(i),r&&(t=r.reduce((function(e,t){return[].concat(e,[t.id])}),[]),i.subtitle=Rp({tags:r})),s&&(i.mix=[].concat(s)),i.title=c.default.wrap(a.highlight(i.title)),o=c.default.html(Po(i))}return kh(e,t,n),o}};var zp=".BookmarksPopup__filter",Yp=".BookmarksPopup__delete",Gp=".BookmarksPopup__create",Qp=".BookmarksPopup__edit",Kp=".BookmarksPopup__settings",Xp=".Bookmarks__tagsSettings",Jp=".Bookmarks__tagsSelectItem",Zp=".basisDefault",eh=".BookmarksPopup__buttonSubmit",th=".BookmarksItem",nh="data-deletetagname",ih="createtagname",ah="edittagname",oh="BookmarksItem_removed",rh="remixblt";function sh(e){var t=$p(),n=Object(M.$)(Zp),i=Wp(e);Fp(i,n),$p(t)}function lh(e){var t;Np.closeMenu(),t="string"==typeof e?Object(M.$)(e):e,t=Dp.open(t,!0);var n="popup"+Date.now();return Hp(t,"data-popupid",n),t}function ch(e){return Hp(e,"data-popupid")}function uh(e){var t;if(t=!("string"==typeof e)?e:Array.from(Object(M.$$)(e)).pop()){Dp.close(t);var n=yh(t),a=n&&n.needRemove;!function(e){var t=ch(e);delete mh().popup[t]}(t),a&&Object(i.remove)(t)}return!1}function dh(){var e=Array.from(Object(M.$$)(zp)).pop(),t=Object(M.$$)(Jp,e);return t&&t.forEach((function(e){removeEvent(e,"click",dh)})),uh(e)}function _h(){return uh(Yp)}function fh(){var e=Array.from(Object(M.$$)(Gp)).pop();if(e){var t=e.$("[name="+ih+"]");Vp(t,"")}return uh(Gp)}function ph(){var e=Array.from(Object(M.$$)(Qp)).pop();if(e){var t=e.$("[name="+ah+"]");Vp(t,"")}return uh(Qp)}function hh(){return uh(Kp)}function mh(){return window.store.bookmarks||Ah(),window.store.bookmarks}function vh(){var e=mh();return e.tags?e.tags:{}}function gh(e){var t=mh();return t.items[e]?t.items[e][3]:[]}function Ah(e){void 0===e&&(e={}),window.store.bookmarks=Object(E.default)({},e,{popup:{}})}function bh(e,t){var n=ch(e);mh().popup[n]=t}function yh(e){var t=ch(e);return mh().popup[t]}function wh(e){var t=mh();return t&&t.items&&t.items[e]&&t.items[e][5]}function Sh(e,t){var n=mh();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function kh(e,t,n,i){var a=mh();a&&a.items&&(t=t.map((function(e){return parseInt(e,10)})),a.items[e]?(a.items[e][3]=t,a.items[e][4]=i):a.items[e]=["",n,e,t,i])}function Oh(e){var t=mh();return t&&t.items&&t.items[e]}function Ch(e){var t=Oh(e),n=vh();if(t&&n){var i=t[3]||[];return n.filter((function(e){return i.includes(e.id)}))}return!1}window.uCloseProfileSwitcher={},uCloseProfileSwitcher._onConfirmClick=Eh;var jh=null;function Eh(e,t){var n=t.checked;ae.default.clear();var a={is_closed:n?"1":"0",_ajax:1};j.default.post(e,a,{onDone:function(){ae.default.reload();var e=window.cur;jh=Object(i.scrollTop)(),e.destroy.push(Th)}})}function Th(){Object(i.scrollTop)(jh),requestAnimationFrame((function(){Object(i.scrollTop)(jh),requestAnimationFrame((function(){Object(i.scrollTop)(jh)}))}))}var Ih,Mh=function(e,t){void 0===t&&(t={});return{inner:[c.default.wrap(e)],class:"CoronaStatus__tooltip CoronaStatus__tooltip--type"+t.id,onclick:["CoronaStatus.open",t],tag:"span"}};window.page.onChange((function(){Ih&&X.default.close(Ih)}));window.CoronaStatus=Mh,Object(F.extend)(Mh,{open:function(e){void 0===e&&(e={}),Object(i.cancelEvent)(),Object(i.statlogsValueEvent)("corona_status_stat","show_tooltip");var t=c.default.elem(Object(X.default)({class:"CoronaStatus",items:[Object(X.ModalMenuHeaderCloseButton)(),Object(X.ModalMenuIcon)({inner:{class:"CoronaStatus__icon CoronaStatus__icon--type"+e.id}}),Object(X.ModalMenuTitle)({inner:c.default.wrap(e.title)}),Object(X.ModalMenuBody)({inner:c.default.wrap(e.text)}),Object(X.ModalMenuBtn)({url:"/covid19#utm_source=vk&utm_medium=cpc&utm_campaign=status_tooltip_mvk",theme:"regular",size:"large",isBtn:!0,inner:Object(F.getLang)("mobile_special_covid_status_modal_go_button"),onclick:"window.CoronaStatus.sendStat()"})]}));Ih=X.default.open(t,!0)},sendStat:function(){Object(i.statlogsValueEvent)("corona_status_stat","open_app")}});function Ph(e){void 0===e&&(e={});var t=e,n=t.url,i=t.type,a=t.url_x2;if(!n)return"";var o="";return a&&(o=n+" 2x"),{inner:[{inner:[{src:n,srcSet:o,class:"ImageStatus__image ImageStatus__image--"+i,tag:"img"}],class:"ImageStatus__imageFrame",tag:"div"}],class:"ImageStatus__imageWrapper",tag:"div"}}function xh(e){var t=e.backgrounds,n=void 0===t?{}:t,i=e.themeKey,a="";return n[i]&&n[i]&&(a=n[i]),a?{class:"ImageStatus__background",style:'background-image: url("'+a+'")',tag:"div"}:""}var Lh;window.page.onChange((function(){Lh&&X.default.close(Lh)})),window.ImageStatus={open:function(e){void 0===e&&(e={}),Object(i.cancelEvent)();var t=e.user_id,n=c.default.elem(Object(X.default)({class:"ImageStatus",items:[{class:"ImageStatus__preload",inner:c.default.wrap(Object(Sa.default)())}]}));Lh=X.default.open(n,!0,"image_status");var o=Object(M.$)(".Popup__content",Lh);ajax.post("/special_event",{act:"image_status",user_id:t},{onDone:function(e){var t,n=e.status_id,i=e.color,r=void 0===i?{}:i,s=e.backgrounds,l=void 0===s?{}:s;t=a.colorScheme.isDarkScheme()?"dark":"light";var u=[Object(X.ModalMenuHeaderCloseButton)(),xh({backgrounds:l,themeKey:t}),Ph(e.image),Object(X.ModalMenuTitle)({inner:c.default.wrap(e.title)})];e.description&&u.push(Object(X.ModalMenuBody)({inner:c.default.wrap(e.description)})),e.participants&&u.push(function(e){void 0===e&&(e={});var t=e,n=t.images,i=t.text,a=t.addition;return{inner:[{inner:[n.map((function(e){return{inner:[{src:e,class:"ImageStatus__participantImage",tag:"img"}],class:"ImageStatus__participantWrapper",tag:"div"}})),a?{inner:[{inner:["+"+a],class:"ImageStatus__participantAddition",tag:"div"}],class:"ImageStatus__participantWrapper",tag:"div"}:""],class:"ImageStatus__participantsWrapper",tag:"div"},{inner:[i],class:"ImageStatus__participantsText",tag:"div"}],class:"ImageStatus__participants",tag:"div"}}(e.participants)),(e.buttons||[]).forEach((function(e){u.push(Object(X.ModalMenuBtn)({url:e.url,theme:e.type,size:"large",isBtn:!0,inner:e.title,onclick:"ImageStatus.sendStat("+n+");",attrs:{target:"_blank"}}))})),u.push(function(e){void 0===e&&(e={});var t=e.terms;return t?{inner:[c.default.wrap(t)],class:"ImageStatus__terms",tag:"div"}:""}(e)),Array.from(o.childNodes).forEach((function(e){o.removeChild(e)})),r[t]&&(o.style.backgroundColor="#"+r[t]),o.append(c.default.elem({class:"ImageStatus__inner",inner:u})),Object(Pn.saveStatlogEvents)({name:"image_status",value:n,keys:["show_popup"]})},onFail:function(){X.default.close(Lh)}})},sendStat:function(e){e&&Object(Pn.saveStatlogEvents)({name:"image_status",value:e,keys:["popup_action"]})}};var Bh=n("Ubt6"),Rh=function(e){var t=Object(F.getLang)("mobile_promo_vkconnect_agreement");return t=(t=t.replace("{link1}",'<a href="'+e.terms_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link1}","</a>")).replace("{link2}",'<a href="'+e.privacy_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link2}","</a>"),t=c.default.wrap(t),{inner:[{inner:[Object(T.default)({sprite:"promo_vkconnect",name:"vkconnect_logo"}),{inner:[Object(T.default)({sprite:"promo_vkconnect",name:"help_outline_28"})],href:e.learn_more_url,target:"_blank",class:"PromoVKConnect__help",tag:"a"}],class:"PromoVKConnect__header",tag:"div"},{inner:[Object(F.getLang)("mobile_promo_vkconnect_title")],class:"PromoVKConnect__title",tag:"h1"},{inner:[{inner:[{inner:[Object(T.default)({sprite:"promo_vkconnect",name:"magic_wand_outline_28"})],class:"PromoVKConnect__listIcon",tag:"div"},Object(F.getLang)("mobile_promo_vkconnect_list1")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(T.default)({sprite:"promo_vkconnect",name:"user_circle_outline_28"})],class:"PromoVKConnect__listIcon",tag:"div"},Object(F.getLang)("mobile_promo_vkconnect_list2")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(T.default)({sprite:"promo_vkconnect",name:"check_shield_outline_28"})],class:"PromoVKConnect__listIcon",tag:"div"},Object(F.getLang)("mobile_promo_vkconnect_list3")],class:"PromoVKConnect__listItem",tag:"li"}],class:"PromoVKConnect__list",tag:"ul"},{inner:[Object(bi.default)({inner:[Object(F.getLang)("mobile_promo_vkconnect_button")],size:"large",class:"PromoVKConnect__button",onClick:["PromoVKConnect.accept","event","this",e.hash],use_native_onclick:!0}),{inner:[t],class:"PromoVKConnect__agreement",tag:"div"}],class:"PromoVKConnect__footer",tag:"div"}],class:"PromoVKConnect ScrollView",tag:"div"}};var Dh={init:function(e){var t=this;onDOMReady((function(){return t.open(e)}))},open:function(e){var t=Object(K.default)({on_overlay_click:[],class:"PromoVKConnectModal",attached:!0,body:Rh(e)});K.default.open(Wd.elem(t),!0,"",{swipeDown:!1})},accept:function(e,t,n){var i=this;e.preventDefault(),bi.default.setLoading(t,!0,"white"),j.default.post("/",{act:"vkconnect_accept",hash:n},{onDone:function(){i.showTooltip(),K.default.close()},onFail:function(){i.showTooltip(),K.default.close()}})},showTooltip:function(){var e=Object(M.$)(".BottomMenu__cell:nth-child(5) .BottomMenu__icon"),t=Wd.elem(Object(Bh.default)({pos:"top_right",theme:"accent",inner:getLang("mobile_promo_vkconnect_tooltip")}));e.appendChild(t)}};window.PromoVKConnect=Dh,window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,a,o){return Object(i.statlogsValueEvent)("groups_menu_item_click",e,t,n,a,o),!0};var Nh=function(e){void 0===e&&(e={});var t=window.lang;return Object(K.default)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:Object(T.default)("groups/common","hide_outline_56")},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[Object(K.ModalMenuBtn)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:t.mobile_back,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),Object(K.ModalMenuBtn)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:t.mobile_groups_warning_notification_proceed,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}})]})};window.WarningModal=Nh,extend(Nh,{close:function(e,t){t&&t.preventDefault(),X.default.close(e),j.default.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:Object(i.domData)(e,"id"),group_id:Object(i.domData)(e,"gid"),hash:Object(i.domData)(e,"hash")})},leave:function(e,t){t&&t.preventDefault(),X.default.close(e),Object(M.$)("#m .header__back").click()}}),window.Donut={help:function(e,t){var n=geByClass1("Tooltip",e);if(n)return;return n=c.default.elem(Object(Bh.default)({pos:"left",inner:lang.mobile_donut_info_text})),e.appendChild(n),Object(i.cancelEvent)(t)}};n("KiYr");var Hh=n("z1UI");function Vh(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return Object(Hh.default)({icon_raw:t,title:e.title,text:e.description,action_text:e.action_text,action_url:e.action_url,before:Uh(e),class:"DonutPaymentInfo"})}function Uh(e){return void 0===e&&(e={}),{inner:["form"===e.layout?[{inner:[{inner:[Object(T.default)("groups/donut","donut_12")],class:"DonutPayment__avatarIcon",tag:"div"}],class:"DonutPayment__avatar",style:"background-image: url("+e.avatar+")",tag:"div"},{inner:[e.title],class:"DonutPayment__title",tag:"h2"},e.description?{inner:[e.description],class:"DonutPayment__description",tag:"span"}:null]:null],class:"DonutPayment__header",tag:"div"}}var Fh=n("b6Sp"),$h=n("LmmP"),Wh=n("WWoJ"),qh={},zh=0;var Yh=function(){zh+=1};function Gh(){Kh({icon:{inner:[Object(T.default)("wall","loading_40")],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"},type:"loading",title:Object(i.getLang)("mobile_donut_payment_info_waiting"),description:Object(i.getLang)("mobile_donut_payment_info_waiting_text")})}function Qh(e){var t=e.message,n=Object(Wh.default)({inner:[Object($h.default)({inner:[t],theme:"error"})],style:{small_paddings:!0}}),i=Object(M.$)('[data-section-ref="donut_payment_form_error"]');i&&(i.innerHTML=c.default.html(n))}function Kh(e){void 0===e&&(e={});var t=Object(M.$)('[data-section-ref="donut_payment_content"]');if(t){var n=e.type;t.innerHTML=c.default.html(Vh({icon:e.icon,layout:"info",type:n,title:e.title||Object(i.getLang)("mobile_donut_payment_info_error"),description:e.description||"",action_text:("success"===n||"error"===n)&&Object(i.getLang)("mobile_donut_payment_button"),action_url:e.continueButtonURL||window.nav.path}))}}function Xh(e){var t=e.checkSuccess,n=e.onCancel,a=e.onFailure,o=e.onTimeout,r=e.paymentURL,s=e.paymentWindow,c=zh;window.clog("Open VK Pay window. Starting payment check"),s.location=r,Kh({icon:{inner:[Object(T.default)("wall","loading_40")],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"},type:"loading",title:Object(i.getLang)("mobile_donut_payment_info_waiting"),description:Object(i.getLang)("mobile_donut_payment_info_waiting_text")});var u=setInterval((function(){if(c!==zh)return clearInterval(u),void _();s&&s.window&&!s.window.closed||(window.clog("VK Pay window was manually closed. Unsubscribing from events"),clearInterval(u),_(),n())}),500),d=function(e){if(c===zh)if("externalAppDone"===e.data.method&&e.data.params.status){window.clog("Received VK Pay done event. Waiting for payment success check"),_(),clearInterval(u);var n=Date.now(),i=!0,r=setInterval((function(){if(c===zh){if(i)return Date.now()-n>=1e3*(qh.waitingTimeSec||5)?(window.clog("Payment check timeout. Showing done info."),clearInterval(r),i=!1,void o()):void t().then((function(){if(!i)return!1;window.clog("Payment check succeeded. Showing done info"),clearInterval(r),i=!1})).catch((function(){}))}else clearInterval(r)}),1e3);tm(f.RESULT_PAYMENT_SUCCESS_WAITING)}else"closeApp"!==e.data.method&&"externalAppFail"!==e.data.method||(window.clog("Received VK Pay close or fail event. Unsubscribing from events"),_(),a());else _()};window.addEventListener("message",d,!1);var _=function(){window.removeEventListener("message",d,!1)};Object(l.onEmitOnce)(window.nav.onBeforeGo,(function(){_()}))}function Jh(e){var t=e.description;Kh({icon:{inner:[Object(T.default)("common","check_circle_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(i.getLang)("mobile_donut_payment_change_amount_changed_title"),description:t,continueButtonURL:qh.backURL}),tm(f.RESULT_CHANGE_SUCCESS_OK)}function Zh(e){void 0===e&&(e=!1),Object(i.toggleClass)("DonutPayment__customAmount--visible",Object(M.$)('[data-section-ref="custom_price_input_container"]'),e)}function em(e,t,n){w.logEventAction(Object(E.default)({event_type:e,owner_id:qh.ownerId,screen:t||f.UNKNOWN,source:qh.source},n))}function tm(e,t){em(_.PAYMENT_FORM,e,t)}function nm(){em(_.PAYMENT_FORM_CLICK_OFFER,f.PAYMENT_START)}function am(){var e=window.open("");return null==e||e.focus(),null==e||e.document.write(Object(i.getLang)("mobile_donut_payment_info_waiting")),Object(l.onEmitOnce)(window.nav.onBeforeGo,(function(){return null==e?void 0:e.close()})),e}var om={init:function(e){var t=e.backURL,n=e.isCustomPriceVisible,a=e.ownerId,o=e.source,r=e.type,s=e.waitingTimeSec;zh+=1,qh={backURL:t,ownerId:a,source:o,type:r,waitingTimeSec:s};var c,u=Object(M.$)("#custom_price_input"),d=u&&u.checked;Zh(n||d),"subscribe"===r&&(c=Object(M.$)('[data-section-ref="donut_payment_external_links"]'))&&Object(i.addEvent)(c,"click",(function(e){Object(i.matchesSelector)(e.target,"a")&&nm()})),Object(l.onEmitOnce)(window.nav.onBeforeGo,Yh)},onCustomAmountChange:function(e,t){return Object(M.$)("#custom_price_input").checked=!0,Fi.default.filter("number",e,t)},onLegalExternalLinkClick:nm,onFormSubmit:function(e,t){e.preventDefault();var n=Object(Fh.getFormValues)(t),a=Object(dt.parseURL)(t.action);"subscribe"===qh.type&&function(e,t,n){var a=zh,o=Object(i.submitBtn)(n);bi.default.setLoading(o,!0);var r=am();j.default.post(e.requestUri,t,{onDone:function(e){a===zh&&(bi.default.setLoading(o,!1),Gh(),function(e,t,n){Xh({paymentURL:e,paymentWindow:n,checkSuccess:function(){return new Promise((function(e,n){j.default.post(t,{},{onDone:function(t){if(t.status)return e(t),void function(e){Kh({icon:{inner:[Object(T.default)("common","check_circle_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(i.getLang)("mobile_donut_payment_info_success"),description:e.text}),tm(f.RESULT_PAYMENT_SUCCESS_OK)}(t);n()},onFail:function(){n()}})}))},onCancel:function(){Kh({icon:{inner:[Object(T.default)("common","error_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(i.getLang)("mobile_donut_payment_info_error"),description:Object(i.getLang)("mobile_donut_payment_info_canceled_text")}),tm(f.RESULT_PAYMENT_CANCEL)},onFailure:function(){Kh({icon:{inner:[Object(T.default)("common","error_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(i.getLang)("mobile_donut_payment_info_error"),description:Object(i.getLang)("mobile_donut_payment_info_canceled_text")}),tm(f.RESULT_ERROR)},onTimeout:function(){Kh({icon:{inner:[Object(T.default)("groups/donut","recent_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(i.getLang)("mobile_donut_payment_info_success"),description:Object(i.getLang)("mobile_donut_payment_info_success_later_text")}),tm(f.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT)}})}(e,Object(dt.makeUrl)(window.nav.path,{act:"donut_payment_check",hash:t.hash}),r))},onFail:function(){bi.default.setLoading(o,!1),Qh({message:Object(i.getLang)("mobile_unknown_error")}),r.close()}})}(a,n,t),"change"===qh.type&&function(e,t,n){var a=zh,o=Object(i.submitBtn)(n);bi.default.setLoading(o,!0),r=Object(M.$)('[data-section-ref="donut_payment_form_error"]'),r&&(r.innerHTML="");var r;var s=(c=t,-1===Number(c.price)?Number(c.custom_price):Number(c.price)),l=am();var c;j.default.post(e.requestUri,t,{onDone:function(e){if(a===zh&&(bi.default.setLoading(o,!1),e))return e.error?(Qh({message:e.error}),void l.close()):void(e.paymentRequiredToComplete?function(e,t,n){var a=zh,o=Object(dt.makeUrl)(window.nav.path,{act:"donut_payment_change_check",hash:e.check_hash}),r=function(){Kh({icon:{inner:[Object(T.default)("common","error_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(i.getLang)("mobile_donut_payment_info_error"),description:Object(i.getLang)("mobile_donut_payment_info_canceled_text"),continueButtonURL:qh.backURL}),tm(f.RESULT_CHANGE_ERROR)};Xh({paymentURL:e.paymentURL,paymentWindow:n,checkSuccess:function(){return new Promise((function(n,i){j.default.post(o,{},{onDone:function(o){if(a===zh)return o.amount===t?(n(),Jh({description:e.successDescription}),void tm(f.RESULT_CHANGE_SUCCESS_OK)):void i()},onFail:function(){i()}})}))},onCancel:r,onFailure:r,onTimeout:function(){Kh({icon:{inner:[Object(T.default)("groups/donut","recent_outline_56")],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(i.getLang)("mobile_donut_payment_change_timeout_error_title"),description:Object(i.getLang)("mobile_donut_payment_change_timeout_error_description"),continueButtonURL:qh.backURL}),tm(f.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT)}}),Gh()}(e,s,l):(Jh({description:e.successDescription}),l.close()))},onFail:function(){bi.default.setLoading(o,!1),Qh({message:Object(i.getLang)("mobile_unknown_error")}),l.close()}})}(a,n,t)},onPriceRadioChange:function(e){Zh(-1===Number(e.value))}};window.DonutPayment=om;var rm=!1,sm={start:function(e,t,n){if("%page_id%"!==e&&!rm){var a;switch(rm=!0,n&&"%page_path%"!==n?n:ae.default.cur){case"/feed":a=Vu.TAB_ID_FEED;break;case"/feed?section=recommended":a=Vu.TAB_ID_RECOMMEND;break;case"/mail":a=Vu.TAB_ID_MESSAGES;break;case"/feed?section=notifications":a=Vu.TAB_ID_NOTIFICATION}a&&innerWidth<882?Vu.drawSkeletonLoader(Object(M.$)(".layout__basis"),a):(Vu.drawLoader(Object(M.$)(".layout__basis")),Object(i.alLoadingFix)()),setTimeout((function(){var i={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){}};ajax.onNavDone(sm.onStarted),n&&"%page_path%"!==n?ae.default.go(n,{push_only:!0,replace:!0},i):ae.default.go(ae.default.cur,null,i)}))}},onStarted:function(){ajax.onNavDone.off(sm.onStarted),Object(ie.calculateTimeOffsets)()}},lm=sm;window.AppShell=lm;var cm={reload:function(e){bi.default.setDisabled(e,!0),!1===navigator.onLine?setTimeout((function(){bi.default.setDisabled(e,!1)}),500):ae.default.reload()}};window.OfflinePage=cm;var um=n("2mXy");var dm=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)}))],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&Object(bi.default)({inner:[Object(F.getLang)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}},_m=function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map((function(e){return e+": "+t[e]})).join("\n");j.default.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=Object(E.default)({},t),n}Object(ai.default)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return c.default.preact(dm,Object(E.default)({},this.state,{onSendClick:this.onSendClick}))},t}(um.Component);function fm(){var e=$("#DeviceInfo");c.default.hydrate(_m,Object(F.getState)("DeviceInfo"),e)}p.default.getRouter().addRoute("/?device",fm),window.initDeviceInfo=fm;var pm={screens:[],hash:"",replacedScreen:"",isEnabled:!1},hm={setHash:function(e){pm.hash=e},getHash:function(){return pm.hash},getScreens:function(){var e=[];return pm.screens.forEach((function(t){e.push(t)})),e},replaceScreen:function(e){pm.replacedScreen=e},setScreen:function(e){pm.screens.push(e),pm.screens.length>5&&pm.screens.shift()},getScreen:function(){return""!==pm.replacedScreen?pm.replacedScreen:pm.screens.length>0?pm.screens[pm.screens.length-1]:""},getPrevScreen:function(){return pm.screens.length>1?pm.screens[pm.screens.length-2]:""},popScreen:function(){return pm.screens.length>0?String(pm.screens.pop()):""},setEnabled:function(e){pm.isEnabled=e},isEnabled:function(){return pm.isEnabled}};window.MarketAnalyticsManager=hm,Object(h.initStaticManager)(),Object(i.addEvent)(window,"scroll touchmove",(function(){Object(i.onBodyScroll)(!0)}),{passive:!0});var mm=window,vm=mm.thover,gm=mm.ajax;function Am(){if(Object(i.lsGet)("custom_opts"))return Object(i.addClass)("_copts","vk_wrap");var e=Object(i.ce)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});Object(i.append)(e,"vk_utils");var t=Object(i.ge)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&(Object(i.addClass)("_copts","vk_wrap"),Object(i.lsSet)("custom_opts",1)),Object(i.remove)(e)}Object(i.addEvent)(document,"touchmove touchcancel",vm.cancel,{passive:!0}),Object(i.addEvent)(document,"touchend",vm.end,{passive:!0}),gm.enabled=!0,gm.enabled&&(onDOMReady((function(){Object(i.remove)("app_go_frame"),gm.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),Object(i.addClass)("_js","vk_wrap")})),page.clear()),window.page&&page.onChange((function(){return p.default.getRouter().checkRoutes()})),onDOMReady((function(){p.default.getRouter().checkRoutes();var e=document.getElementById("utils");e||((e=document.createElement("div")).id="utils",document.body.insertAdjacentElement("afterbegin",e)),window.utilsNode=e})),onDOMReady(O.resizePosters),Object(i.addEvent)(window,"resize",O.resizePosters),Object(i.addEvent)(document,"touchstart",(function(e){var t=Object(i.checkTouchHover)(e.target);vm.clear(),t&&vm.start.call(t,e)}),{passive:!0}),Object(i.addEvent)(document,"click",(function(e){if(e.target.dataset.logEvent&&k(e.target.dataset.logEvent),Object(i.ajaxLayoutEnabled)()){var t=Object(i.gpeByClass)("al_after",e.target);if(t){var n=Object(i.attr)(t,"data-target"),a=!!n&&Object(i.geByClass1)(n,t);if(a&&!nav.go_after(a,e)||!nav.go_after(t,e))return}var o=Object(i.matchesSelector)(e.target,".mi_text a");if(u.EduIntegration.isIntegrated&&o)e.target.target="_blank";else{var r=Object(i.checkNav)(e.target,{allow_post_away:!0});if(r&&(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),nav.go(r,e)||Object(i.cancelEvent)(e)),"bookmarks"===cur.module){var s=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!s)return;var l=s.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],c=l[0],d=l[1],_=l[2],f=l[3];if(!(c&&d&&_&&f))return;var p=!1;switch(d){case"link":p=e.target.closest('a[target="_blank"]');break;case"page":p=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!p)return;Object(z.statlogsValueEvent)("bookmarks_product_analytics",{item_type:d,item_owner_id:intval(_),item_id:intval(f),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}})),Object(i.addEvent)(document,"submit",(function(e){var t=e.target;Object(i.hasClass)("vk_js_yes",geByTag1("html"))&&!Object(i.hasClass)("opera_mini_yes",geByTag1("body"))&&Object(i.hasClass)("qsearch",t)&&Object(i.gpeByClass)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),Object(i.cancelEvent)(e))})),Object(i.addEvent)(document,C.isTouch?"touchstart":"mousedown",(function(e){tooltip.closeByTap(e)}),{passive:!0}),onDOMReady(Am),onDOMReady((function(){Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(document.documentElement.classList.contains("vk_flex_yes")),"flexbox"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Boolean(window.matchMedia)),"match_media"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(G()),"css_variables"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Q()),"auto_change_scheme"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Boolean(window.CSS&&CSS.supports)),"css_supports"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Boolean("string"==typeof document.createElement("div").style.grid)),"grids"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Boolean(document.createElementNS)&&Boolean(document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)),"svg"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(Boolean(window.IntersectionObserver)),"intersection_observer"),Object(z.statlogsValueEvent)("mvk_feature_is_supported",Number(function(){if(window.navigator.userAgent.indexOf("Edge")>-1)return!1;try{return Boolean(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection&&window.RTCIceCandidate&&window.RTCSessionDescription)}catch(e){return!1}}()),"webrtc_calls"),Object(z.statlogsValueEvent)("mvk_dark_theme",Number(Y()),"current"),function(){var e={is_schemes_supported:G(),is_auto_schemes_supported:Q(),current_scheme:Y()?2:Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches)},t=Object.keys(e).sort().map((function(t){return t+":"+Number(e[t])})).join("/");if(localStorage&&localStorage.getItem){var n=localStorage.getItem("supportedFeatures");null!==n&&t===n||(localStorage.setItem("supportedFeatures",t),Object(z.statlogsValueEvent)("browser_features",t))}}()})),onDOMReady(ie.calculateTimeOffsets),Object(i.sgFix)(),onDOMReady((function(){var e=window.vk;e&&!e.id&&Object(i.lsCheck)()&&localStorage.clear(),Object(ie.partConfigEnabled)("mvk_experiment_perf")&&(clog("performance experiment enabled"),Object(i.addEvent)(document,"touchstart touchmove touchend",(function(e){window.__experiment||(window.__experiment={}),window.__experiment.ts=(e&&e.timeStamp||0)+ +Date.now()})))})),window.optionsTest=Am,zlayer.isReady=!0,window.isNewMail&&(n("4bPz"),n("s0aB"),n("/Id8"),n("DkIl"),n("CkGd"),n("iS9e"),n("fWqt"),n("QBkA"),n("rKp0"),n("u33z"),n("A6le"),n("SNk7"),n("JCKH"),n("1KAK"),n("eWFs"),n("drfJ"),n("V2dH"),n("PUg3"),n("3pHe")),onDOMReady((function(){b.addStatEvent(b.getModule(),v.NavigationProductionStatEventTypes.TAB_OPEN)})),C.default.android&&Object(z.statlogsValueEvent)("mvk_pixel_ratio",window.devicePixelRatio||1)},"8ZMO":function(e,t,n){"use strict";n.r(t);var i=function(e){return{class:["Anchor",e.mix],id:e.id,tag:"div"}};t.default=i},9:function(e,t,n){e.exports=n("75Qd")},"98L6":function(e,t){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,a=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){e.progress=!1,t?val(a,t):hide(a),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,a=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(a),val(a,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},"9y81":function(e,t,n){"use strict";n.r(t),n.d(t,"IconWd",(function(){return r}));var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n=e.icon,o=e.class||e.mix;return Object(a.default)({mix:i.default.class(o,"Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t)),url:e.url,attrs:e.attrs})};function r(e){var t,n=e.icon;return{class:[e.class,Bem.class("Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t))],href:e.url,attrs:e.attrs}}Object.assign(o,{toggleActive:function(e){e.classList.toggle(s)}});var s="Icon_active";t.default=o;window.Icon=o},A6le:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("z9sQ"),o=n("fdw3"),r=function(e){var t=e.durationInSeconds,n=e.isDefaultCasperTimerShown,r=t<=60;return{inner:[{inner:[Object(i.default)({sprite:"mail/casper",name:"bomb_16"})],class:a.default.class("CasperTimer__icon",{normal:!0},"--"),"aria-hidden":"true",tag:"span"},{inner:[Object(i.default)({sprite:"mail/casper",name:"bomb_active_16"})],class:a.default.class("CasperTimer__icon",{warning:!0},"--"),"aria-hidden":"true",tag:"span"},{inner:[Object(o.formatDuration)(t)],class:"CasperTimer__timer",role:"timer","aria-live":"polite",tag:"span"}],class:a.default.class("CasperTimer",{active:t>0,hidden:!n,warning:r},"--"),onClick:["CasperTimer.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false",title:Object(o.getLang)("mobile_casper_timer_title"),"data-left":t,tag:"button"}};var s=n("UxAg"),l=new(n("Cz26").Timers)({}),c={init:function(e){var t=this,n=Object(s.$)(".msg_id_"+e);if(!n)return!1;var i=Object(s.$)(".CasperTimer",n);if(!i)return!1;var a=this.getTimerElement(i);l.add((function(n){if(i.parentNode){var r=t.getLeftSeconds(i);(r-=n)<=0&&(i.classList.add("CasperTimer--hidden"),a.classList.remove("CasperTimer__timer--opened"),i.classList.remove("CasperTimer--itsGonnaBlow"),setTimeout((function(){i.hasOwnProperty("remove")?i.remove():i&&i.parentNode&&i.parentNode.removeChild(i)}),1e3),l.remove(e),r=0),t.setLeftSeconds(i,r),r>0&&r<=10&&i.classList.add("CasperTimer--itsGonnaBlow"),r>0&&r<=60&&(i.classList.remove("CasperTimer--hidden"),i.classList.add("CasperTimer--warning")),t.isOpened(i)&&(a.innerHTML=Object(o.formatDuration)(r))}else l.remove(e)}),{id:e})},getLeftSeconds:function(e){return parseInt(e.getAttribute("data-left"))},setLeftSeconds:function(e,t){e.setAttribute("data-left",t)},getTimerElement:function(e){if(!e)throw new Error("CasperTimer: element is not provided");return Object(s.$)(".CasperTimer__timer",e)},isOpened:function(e){return this.getTimerElement(e).classList.contains("CasperTimer__timer--opened")},clickHandler:function(e,t){var n=this.getTimerElement(e);n.classList.toggle("CasperTimer__timer--opened");var i=this.isOpened(e);e.setAttribute("aria-expanded",i),n.innerHTML=Object(o.formatDuration)(this.getLeftSeconds(e)),t.stopPropagation(),clearTimeout(e._autoCloseTimer),i&&(e._autoCloseTimer=setTimeout((function(){n&&n.classList.remove("CasperTimer__timer--opened")}),4e3))}};window.CasperTimer=c;t.default=r},AXyT:function(e,t,n){"use strict";n.r(t);var i=function(e){return Wd.html({class:[Bem.class("Oval",{type:e.gray?"minor":e.type,hidden:a(e.value)}),e.mix],inner:"empty"===e.value?" ":e.value})};function a(e){return"empty"!==e&&(!e||e<=0)}Object.assign(i,{setValue:function(e,t){if(!e)return;var n=a(t);e.innerText="empty"===t?" ":t,e.classList.toggle(o,n)}});var o="Oval_hidden";t.default=i;Object.assign(window,{Oval:i,Oval_isHidden:a})},AeId:function(e,t){var n={_seen:{},_saved:{},_saveTimer:null,_sendTimer:null,_cleanTimer:null,LS_ADS_EVENTS:"ads.events",postsGetRaws:function(e,t){var n,i=(e=ge(e)).id||"",a=attr(e,"data-copy")||"",o={};if("block_"===i.substr(0,6)){o[i]=1,o.block=i.substr(6);var r=attr(e,"data-contain");r&&(r=r.split(",")).forEach((function(e){e=e.split(":"),o[e[0]]=intval(e[1])||1}))}else(n=i.match(/^wall(adsite.*)$/))?o[n[1]]=1:(n=i.match(/^wall(-?\d+_\d+)$/))&&(o[n[1]]=1,(n=a.match(/^(-?\d+_\d+)$/))&&(o[n[1]]=-1));var s=attr(e,"data-ad-view");return s&&(o["ad_"+s]=1),o.height=t.offsetHeight,o.index=indexOf(domPN(t).children,t)-1,o},seen:function(e){var t,i,a,o,r,s,l;window.vk.id&&e.length&&(window._postsExtras||(window._postsExtras={}),e.forEach((function(e,c){r=e.index,l=e.block,s=e.height,Object.keys(e).forEach((function(c){"index"!==c&&"block"!==c&&"height"!==c&&"viewportHeight"!==c&&(i=e[c],a=n._seen[c],-1===(o=n._saved[c])||-1===a||1===i&&(o||a)||(t=n._seen[c]=i,_postsExtras[c]={index:r,block:l,height:s,viewportHeight:getCh()}))}))})),t&&(clearTimeout(n._saveTimer),n._saveTimer=setTimeout(n.save,2500),clearTimeout(n._sendTimer),n._sendTimer=setTimeout(n.send,5e3)))},save:function(){if(!lsCheck()||isEmpty(n._seen))return n._seen;var e,t,i,a,o,r=window.vk,s=Math.floor((r.ts+Math.floor((vkNow()-r.started)/1e3))/3600),l=lsGet("posts_sent")||{},c=lsGet("posts_seen")||{},u=lsGet("posts_extras")||{};for(t in window._postsExtras||(window._postsExtras={}),n._seen)o=n._seen[t],_postsExtras[t]&&(u[t]={index:_postsExtras[t].index,block:_postsExtras[t].block,height:_postsExtras[t].height,viewportHeight:_postsExtras[t].viewportHeight},delete window._postsExtras[t]),"ad"!==(i=t.split("_"))[0]&&"adsite"!==i[0]&&"block"!==i[0]&&(i[0]=intval(i[0]),i[1]=intval(i[1])),a=(l[i[0]]||{})[i[1]],i[0]!=r.id&&(!a||-1==o&&a>0)&&(c[i[0]]||(c[i[0]]={}),(!c[i[0]][i[1]]||-1==o&&c[i[0]][i[1]]>0)&&(e=c[i[0]][i[1]]=s*o)),n._saved[t]=o;n._seen={},e&&(lsSet("posts_seen",c),lsSet("posts_extras",u))},getSeenData:function(){var e,t,i,a={},o={},r=[];if(lsCheck())a=lsGet("posts_seen"),o=lsGet("posts_extras")||{};else for(e in i=n.save()){var s=i[e],l=e.split("_");l[0]=intval(l[0]),l[0]&&(l[1]=intval(l[1])),a[l[0]]||(a[l[0]]={}),(!a[l[0]][l[1]]||-1==s&&a[l[0]][l[1]]>0)&&(a[l[0]][l[1]]=s)}for(e in a){for(t in i=[],a[e]){var c=a[e][t]>0?t:-t,u=o[e+"_"+t],d="";u?(d+=":"+(u.index||""),d+=":"+(u.block||""),d+=":"+(u.height||""),d=(d+=":"+(u.viewportHeight||"")).replace(/:+$/,"")):d="","block"!==e||cur._pstatbref||(cur._pstatbref=attr(ge(e+"_"+t),"data-ref")),i.push(c+d)}i.length&&r.push(e+"_"+i.join(","))}return r.length?{seen:a,data:r.join(";")}:""},onSend:function(e){if(!lsCheck())return extend(n._saved,n._seen);var t,i,a=lsGet("posts_seen")||{},o=lsGet("posts_sent")||{};for(t in e){for(i in e[t])o[t]||(o[t]={}),-1!=o[t][i]&&(o[t][i]=e[t][i]),(a[t]||{})[i]&&delete a[t][i];a[t]&&isEmpty(a[t])&&delete a[t]}lsSet("posts_seen",a),lsSet("posts_sent",o),clearTimeout(n._cleanTimer),n._cleanTimer=setTimeout(n.clean,1e4)},send:function(){var e=window.cur,t=window.vk,i=n.getSeenData();if(i.data){if(!t.id)return n.clear();var a="";!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur?e&&e.module?a=e.module:nav&&"/feed"==nav.cur&&(a="feed"):a="feed_podcasts";var o={_ajax:1,act:"ping",_pstat:i.data,_pstatref:a};e._pstatbref&&(o._pstatbref=e._pstatbref),ajax.post("/",o,{onDone:function(){n.onSend(i.seen)}}),delete e._pstatbref}},clean:function(){var e,t,i,a=window.vk,o=Math.floor((a.ts+Math.floor((vkNow()-a.started)/1e3))/3600),r=lsGet("posts_sent")||{};for(e in r){for(t in r[e])o-((i=r[e][t])>0?i:-i)>24&&delete r[e][t];isEmpty(r[e])&&delete r[e]}lsSet("posts_sent",r),n.cleanAdsEvents()},clear:function(){lsSet("posts_seen",{}),lsSet("posts_sent",n._saved=n._seen={}),lsSet(n.LS_ADS_EVENTS,n._lsAdsEvents={})},getStatsObj:function(e){return e=ge(e),hasClass("_stats_cont",e)?e:gpeByClass("_stats_cont",e)},getAdsEvents:function(){var e=n._lsAdsEvents;return e||(e=n._lsAdsEvents=lsGet(n.LS_ADS_EVENTS)||{}),e},cleanAdsEvents:function(){var e=n.getAdsEvents(),t=(new Date).getTime()/1e3|0,i=!1;each(e,(function(n,a){t-a>=3600&&(delete e[n],i=!0)})),i&&lsSet(n.LS_ADS_EVENTS,e)},checkPixelEvent:function(e,t){var i=e.getAttribute("data-ad-block-uid"),a=-1!==indexOf(["load","impression"],t);if(!i||!a)return!0;try{var o=hashCode(""+t+i),r=n.getAdsEvents();if(r[o])return!1;var s=(new Date).getTime()/1e3|0;r[o]=s,lsSet(n.LS_ADS_EVENTS,r)}catch(e){try{console.log(e.message)}catch(e){}}return!0},getPixelElements:function(e,t){var n=[];return each(geByClass(t,e),(function(){attr(this,"data-src")&&n.push(this)})),n},sendPixels:function(e){each(e,(function(){attr(this,"src",attr(this,"data-src")),attr(this,"data-src",!1),addClass("_cntr",this)}))},viewed:function(e){if(e=n.getStatsObj(e)){var t=n.getPixelElements(e,"_cntr_view");t.length&&n.checkPixelEvent(e,"impression")&&n.sendPixels(t)}},clicked:function(e){if(e=n.getStatsObj(e)){attr(e,"data-clicked","1");var t=n.getPixelElements(e,"_cntr_click");t.length&&n.sendPixels(t),checkPostsSeen()}}};n._sendTimer||(n._sendTimer=setTimeout(n.send,1e4)),window.pStats=n},AgBx:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){return Object(a.default)({mix:i.default.class(e.mix,"ScrollView"),attrs:e.attrs,inner:e.inner})};n("QMH7"),t.default=o;window.ScrollView=o},"B+U2":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("29dZ"),a=n("Y6JH"),o=n("TYsd"),r=n("z9sQ"),s=n("fdw3"),l=function(e){var t=e.keyboard,n=e.msgId,l=e.pressed||{},c=t.buttons,u=0;return{class:"BotsKeyboard__main",inner:c.map((function(e){return function(e,t,n,l,c){var u=0;return{class:"BotsKeyboard__row",inner:e.map((function(e){return function(e,t,n,l,c,u){var d,_=window.lang,f=e.action.type,p=r.default.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===f,positive:"positive"===e.color,negative:"negative"===e.color},"--"),h=["uMailWrite._onKeyboardButtonClick","this","event",{action:(m=Object(s.stringifyJSON)(e.action),m.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;")),authorId:t.author_id,inline:t.inline,msgId:n}];var m;d="vkpay"===f?[{class:"BotsKeyboard__buttonInner",inner:[o.default.wrap(_.mobile_mail_keyboard_label_vkpay),o.default.wrap("&nbsp;"),o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","vkpay")]}]:"location"===f?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","place_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(_.mobile_mail_keyboard_label_location)]}]}]:"open_app"===f?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","service_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]}]}]:"open_link"===f?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]},o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","open_link_16")]}]:[o.default.wrap(e.action.label)];var v=!1,g=c+","+u;l[g]&&(v=!0);return Object(i.default)({class:p,isLoading:v,spinner:!0,on_click:h,use_native_onclick:!0,inner:d,theme:"none",size:"normal",type:"button",attrs:{"data-position":g}})}(e,t,n,l,c,u++)}))}}(e,t,n,l,u++)}))}};t.default=l},B9v3:function(e,t,n){"use strict";n.r(t),n.d(t,"setBookmarkState",(function(){return z})),n.d(t,"ActionsPanel",(function(){return d})),n.d(t,"init",(function(){return Y}));var i=n("Y6JH"),a=n("fdw3");var o=function(e){return void 0===e&&(e={}),Object(a.extend)({tag:"textarea",class:["Textarea",e.mix],name:e.name,placeholder:e.placeholder,rows:e.rows?e.rows:3,inner:e.text,maxlength:e.maxlength},e.attrs)},r=n("OcsD");var s=o,l=n("p5n7"),c=n("29dZ");function u(e){return void 0===e&&(e={}),{class:"SharePanel SharePanel-header SharePanel--active ShareHeaderConversationsPanel","aria-hidden":"false","data-name":"ShareHeaderConversationsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_close"),onclick:"cur.share.destroy()",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","cancel_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")},{class:"SharePanel-headerText__receivers"}]},{class:"SharePanel-headerRight",inner:[{"aria-label":Object(a.getLang)("mobile_search"),class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:"cur.share.toggleConversationsSearch(true)"},e.supportsExternalShare?{"aria-label":Object(a.getLang)("mobile_share_external"),class:"SharePanel-headerRight__externalShare",role:"button",inner:"iOS"===e.platform?Object(i.default)("wall","share_external_ios_24"):Object(i.default)("wall","share_external_android_24"),onclick:"cur.share.externalShare()"}:null]}]}}function d(e){var t=e.buttons,n=e.options,i="boolean"!=typeof e.active||e.active;return{class:"ActionsPanel SharePanel "+(i?"SharePanel--active":""),"data-name":"ActionsPanel","aria-hidden":!i,style:!(n.can_to_own||n.can_to_club||n.can_bookmark)?"display: none;":"",inner:t.map((function(e){if(e)return function(e){var t=e.href?"a":"div",n=e.onclick,i={tag:t,role:"button",tabindex:-1,href:e.href,onclick:n,class:"ActionsPanel-button ActionsPanel-button--"+e.target,inner:[{class:"ActionsPanel-button__icon",inner:e.icon},{class:"ActionsPanel-button__label",inner:e.label}]};"boolean"==typeof e["aria-pressed"]&&(i["aria-pressed"]=e["aria-pressed"]+"");return i}(e)}))}}var _=function(e){var t=e.can_bookmark,n=e.is_bookmarked,o=e.object,r=e.list,_=e.from,f=e.post_from,p=e.supportsExternalShare,h=e.isVKApp,m=e.targetOwnOnClick,v=Object(a.makeUrl)("/wall",{act:"add",share_box:1,is_vk_app:h,object:o,list:r,from:_,post_from:f});return{inner:[{inner:[u({platform:e.platform,supportsExternalShare:p}),{class:"SharePanel ShareHeaderSearch ShareHeaderConversationsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderConversationsSearchPanel",role:"search",inner:Object(l.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "peers", true)',prefix:{text:{role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",role:"button",onclick:'cur.share.clearSearch(event, "peers")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderConversationsSearchPanel__input",id:"ShareHeaderConversationsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})},{class:"SharePanel SharePanel-header ShareHeaderGroupsPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_back"),onclick:"cur.share.toggleGroupsPanel(false)",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","back_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")}]},{class:"SharePanel-headerRight",inner:[{class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:'cur.share.setActivePanel(this, "ShareHeaderGroupsSearchPanel", true)'}]}]},{class:"SharePanel ShareHeaderSearch ShareHeaderGroupsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsSearchPanel",role:"search",inner:Object(l.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "group", true)',prefix:{text:{"aria-label":Object(a.getLang)("mobile_search"),role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",onclick:'cur.share.clearSearch(event, "group")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderGroupsSearchPanel__input",id:"ShareHeaderGroupsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})}],class:"SharePanelRoot ShareHeader",tag:"header"},{id:"Share__input",style:"display: none;",tag:"input"},{inner:[{class:"ShareConversations SharePanel SharePanel--active filter_peer_wrap","data-name":"ShareConversations","aria-hidden":"false",role:"group",id:"ShareConversations"},{class:"ShareGroups SharePanel","data-name":"ShareGroups","aria-hidden":"true",role:"group",id:"ShareGroups"}],class:"SharePanelRoot ShareLists",tag:"section"},{inner:[d({active:!0,options:e,buttons:[e.can_to_own?{target:"own",label:Object(a.getLang)("mobile_share_target_own"),onclick:m||"cur.share.go('"+v+"')",icon:Object(i.default)("wall","repost_outline_28")}:null,e.can_to_club?{target:"group",label:Object(a.getLang)("mobile_share_target_group"),icon:Object(i.default)("wall","users_outline_28")}:null,t?{target:"bookmark","aria-pressed":n,label:n?Object(a.getLang)("mobile_share_target_bookmark_active"):Object(a.getLang)("mobile_share_target_bookmark"),icon:Object(i.default)("wall",e.is_bookmarked?"favorite_28":"favorite_outline_28")}:null]}),{class:"SharePanel MessagePanel","aria-hidden":"true","data-name":"MessagePanel",inner:[Object(l.default)({tabindex:-1,autocomplete:!1,class:"MessagePanel__input",on_click:["cur.share.expandMessage"],placeholder:Object(a.getLang)("mobile_share_message_placeholder"),spellcheck:!1,readonly:!0,disabled:!0}),Object(c.default)({stretch:!0,size:"large",inner:Object(a.getLang)("mobile_share_message_single"),on_click:"cur.share.sendMessage(event)",use_native_onclick:!0})]},{class:"SharePanel ExpandedMessagePanel","aria-hidden":"true","data-name":"ExpandedMessagePanel",inner:[{class:"ExpandedMessagePanel__textareaWrap",inner:[s({placeholder:Object(a.getLang)("mobile_share_message_placeholder"),rows:1}),{class:"ExpandedMessagePanelSend",inner:Object(i.default)("common","send_active_24")}]}]},{class:"SharePanel ProcessingPanel","aria-hidden":"true","data-name":"ProcessingPanel",inner:[{class:"ProcessingPanel__icon ProcessingPanel__icon--loading",inner:Object(i.default)("wall","loading_40")},{class:"ProcessingPanel__label",inner:Object(a.getLang)("mobile_share_state_progress")}]}],class:"SharePanelRoot ShareBottom",tag:"footer"}],class:"Share","aria-role":"dialog","aria-label":Object(a.getLang)("mobile_like_publish_head_title"),hidden:"false",tabindex:"-1",tag:"div"}},f=n("wTbK"),p=n("YU/R"),h=n("Qz23");function m(e){return/^((?:([a-z]+)_)?([a-z_]+))(-?\d+)?(?:_(\d+))?$/.test(e)}var v=n("UxAg"),g=n("j80l"),A=n("aiw/"),b=n("H5mD"),y=n("zq7H"),w="/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1",S="ShareConversations",k=0,O=!1,C={bookmarks:{}};function j(e){T(e)}function E(e){nav.go(e),cur.share.destroy({isNavigation:!0})}function T(e){if(cur.share){var t=cur.share._els.header,n=e.scrollTop;t.classList.toggle("ShareHeader--scrolled",n>=10)}}function I(e,t,n){if(!cur.share||cur.share.blocked)return!1;if(P(!0),cancelEvent(n),hasClass("inline_item_selected",t))return cur.shareSearch.toggleAttach(e,!1),function(e,t){for(var n=0;n<cur.share.selected.length;n++)if(cur.share.selected[n]===e){cur.share.selected.splice(n,1);break}return R(!1),N(),!1}(e);cur.shareSearch.toggleAttach(e,!0);for(var i=!1,a=0;a<cur.share.selected.length;a++)if(cur.share.selected[a]===e){i=!0;break}return i||cur.share.selected.push(e),P(!1),R(!1),N(),!1}function M(e,t,n){if(cur.share&&!cur.share.blocked){e=e.closest(".SharePanelRoot");var i,a=Object(v.$$)(".SharePanel",e);t&&(i=Object(v.$)("."+t,e)),a.forEach((function(e){var t=e===i;e.setAttribute("aria-hidden",!t),e.classList.toggle("SharePanel--active",t),t?e.removeAttribute("tabindex"):e.setAttribute("tabindex",-1),Object(v.$$)("input, ul",e).forEach((function(e){e.setAttribute("aria-hidden",!t),t?(e.removeAttribute("disabled"),e.setAttribute("tabindex",0)):(e.setAttribute("disabled",!0),e.setAttribute("tabindex",-1))}))}));var o=Object(v.$)("input",i);o&&n&&o.focus(),setStyle(e,{height:i?i.clientHeight:0})}}function P(e){var t=Object(v.$)(".ShareModal");t&&t.classList.toggle("ShareModal--disableAnimations",!e)}function x(e){if(cur.share){var t=cur.share._els,n=t.header,i=t.content,a=t.bottom;i.classList.add("ShareLists--transition"),P(!0),M(n,e?"ShareHeaderGroupsPanel":"ShareHeaderConversationsPanel"),M(i,e?"ShareGroups":"ShareConversations"),M(a,e?"":"ActionsPanel"),setTimeout((function(){i.classList.remove("ShareLists--transition")}),300),Object(v.$)(".SharePanel--active ul",i).focus(),N(),T(e?Object(v.$)("#ShareGroups .ShareList__container"):Object(v.$)("#ShareConversations .ShareList__container"))}}function L(e){if(cur.share){var t=cur.share._els,n=t.header,i=(t.content,t.bottom),a=D();O=e,P(!1),M(i,e?"":a),e&&M(n,"ShareHeaderConversationsSearchPanel",!0),!b.isIOS&&innerWidth<y.DESKTOP_WIDTH&&N(e),setTimeout((function(){browser.ios&&Object(r.scrollTop)(document.activeElement)}),500)}}function B(){if(cur.share){var e=cur.share._els,t=e.content,n=e.bottom,i=e.messageTextarea;M(n,"ExpandedMessagePanel"),t.classList.add("ShareLists--transition"),b.isIOS||N(!1),i.focus({preventScroll:!0})}}function R(e){if(void 0===e&&(e=!0),cur.share){var t=cur.share,n=t.selected,i=t._els;ge(S)&&(!function(){if(!cur.share)return;var e=cur.share.cache._cache,t=Object(v.$)(".ShareHeaderConversationsPanel"),n=Object(v.$)(".ShareHeaderConversationsPanel .SharePanel-headerText__receivers",t),i=cur.share.selected,a=i.length;t.classList.toggle("ShareHeaderConversationsPanel--hasReceivers",a>0);var o="";if(1===a){o=getLang("mobile_share_box_to_single");var r=e[i[0]][0];o=o.replace("{name}",r)}else if(2===a){o=getLang("mobile_share_box_to_couple");var s=e[i[0]][6]||e[i[0]][0],l=e[i[1]][6]||e[i[1]][0];o=o.replace("{name1}",s).replace("{name2}",l)}else if(a>2){o=getLang("mobile_share_box_to_many");var c=e[i[0]][6]||e[i[0]][0];o=o.replace("{name}",c).replace("{count}",a-1)}n.innerHTML=o}(),H());var a,o,r=D();M(i.bottom,r,e),a=n.length>1,o=cur.share._els.messagePanel,Object(v.$)(".Btn",o).innerHTML=a?getLang("mobile_share_message_many"):getLang("mobile_share_message_single")}}function D(){if(cur.share){var e=cur.share,t=e.selected,n=e.content,i=Object(v.$)(".SharePanel--active",n).getAttribute("data-name");return"ShareHeaderGroupsSearchPanel"===i||"ShareHeaderGroupsPanel"===i?"":document.activeElement&&document.activeElement.closest(".ExpandedMessagePanel")?"ExpandedMessagePanel":t.length>0?"MessagePanel":"ActionsPanel"}}function N(e){if(cur.share&&cur.share._els){var t=cur.share._els,n=t.header,i=t.bottom,a=t.content,o=t.groupsList;if(n&&i&&a){Object(v.$)(".ShareModal");var s=400;(e=O||e)&&(s+=cur.share.lastBottomHeight-Object(r.getH)(i)),i.clientHeight&&(cur.share.lastBottomHeight=i.clientHeight);var l=[n,i].reduce((function(e,t){var n=Object(v.$)(".SharePanel--active",t);return n&&(e+=n.clientHeight,setStyle(t,{height:n.clientHeight})),e}),0),c=Math.min(s,Object(r.getCh)()-l),u=l+c!==k;u||(P(!1),a.classList.remove("ShareLists--transition")),setStyle(o,{bottom:-i.clientHeight}),setStyle(a,{height:c}),u||P(!0),k=l+c}}}function H(){cur.share&&each(geByClass("inline_item",Object(v.$)("ShareConversations__container")),(function(e,t){if(cur.share){var n=intval((t.id||"").substr(4)),i=-1!==cur.share.selected.indexOf(n);toggleClass("inline_item_selected",t,i),t.setAttribute("aria-selected",i);var a=Object(v.$)('input[type="checkbox"]',t);a&&(a.checked=i)}}))}function V(e){var t=cur.share._els.bookmarkButton;if(t){var n=Object(v.$)(".ActionsPanel-button__icon",t),a=Object(v.$)(".ActionsPanel-button__label",t);t.setAttribute("aria-pressed",e),e?(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_28")),a.innerHTML=getLang("mobile_share_target_bookmark_active")):(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_outline_28")),a.innerHTML=getLang("mobile_share_target_bookmark")),window.thover.clear()}}function U(e){var t=cur.share._els,n=t.bottom,a=t.processingPanel,o=this.mail_hash,r=this.object,s=this.list,l=this.appId,c={_ajax:1,from:"share_box",hash:o,list:s,message:Object(v.$)(".ExpandedMessagePanel__textareaWrap textarea").value,to:cur.share.selected.join(","),app_id:l};m(cur.share.options.object)?c.media=r:c.link=r,P(!0),e&&cancelEvent(e),M(n,"ProcessingPanel"),cur.share.blocked=!0,(r.startsWith("story")||r.startsWith("narrative"))&&Stories.sendAnalyticsEvent("share_to_message"),setTimeout((function(){N()})),setTimeout((function(){N()}),350),ajax.post("/mail?act=send",c,{onDone:function(e){P(!0);var t=Object(v.$)(".ProcessingPanel__icon",a),n=Object(v.$)(".ProcessingPanel__label",a);t.classList.remove("ProcessingPanel__icon--loading");var o=e.error;t.innerHTML=Wd.html(o?Object(i.default)("wall","error_circle_40"):Object(i.default)("wall","done_circle_40")),n.innerText=o?getLang("mobile_share_state_error"):getLang("mobile_share_state_success"),setTimeout((function(){cur.app&&(o&&cur.app.hasOwnProperty("vkMiniAppShareFail")?cur.app.vkMiniAppShareFail():!o&&window.isFunction(cur.app.vkMiniAppShareSuccess)&&cur.app.vkMiniAppShareSuccess(0)),cur.share&&cur.share.destroy({isFail:o})}),1e3)}})}function F(e,t,n){void 0===n&&(n=!1),Object(r.preventEvent)(e);var i,a,o,s=cur.share._els.header;if("group"===t?(i=ge("ShareHeaderGroupsSearchPanel__input"),a="ShareHeaderGroupsPanel",o=cur.shareGroupSearch):"peers"===t&&(i=ge("ShareHeaderConversationsSearchPanel__input"),a="ShareHeaderConversationsPanel",o=cur.shareSearch),P(!1),i.value){if(n)return void P(!0);o.clear()}else"peers"===t?(M(s,a),L(!1)):(M(s,a),P(!0))}function $(){var e,t=cur.share.options.object,n="unknown";if(m(cur.share.options.object)){e=/^([a-z_]+)(-?\d+)_(\d+)$/.exec(cur.share.options.object),n=e[1];var i=e[2],a=e[3];"app"===n&&"0"===a&&(t="app"+i),cur.share.options.list&&(t+="?list="+cur.share.options.list),t=t.replace("wall_reply","wall")}else cur.share.options.isVKApp&&(n="link");t=cur.share.options.external_url||t;var o=navigator.share({url:t});if(!o)return Object(r.statlogsValueEvent)("mvk_share_external",n);o.then((function(){cur.share&&Object(r.statlogsValueEvent)("mvk_share_external",n)}))}function W(e,t,n){var i=e.split("_"),a=31,o=5,s=6,l=[a,o,3,s].includes(Object(r.toInt)(t.bookmark_type)),c=[2,s].includes(t.bookmark_type);if(ajax.post("/bookmarks.php",{_ajax:1,from:"share_box",wide:c?1:0,star:l?1:0,act:t.is_bookmarked?"bookmark_remove":"bookmark_add",item_type:t.bookmark_type,item_oid:i[0],item_id:i[1],hash:t.bookmark_hash,link_url:t.link_url,link_title:t.link_title,link_img:t.link_img},{onDone:function(e,t){var n=Object(v.$)("."+e),i=Object(r.ceFromString)(t);n&&Object(r.replace)(i,n.parentNode)}}),t.bookmark_type===o&&Article.toggleButton(e,!t.is_bookmarked),t.bookmark_type===a){var u=Object(v.$)(".StoryMenu__button");Stories.toggleBookmark(u,!0)}t.is_bookmarked=!t.is_bookmarked,C.bookmarks[e]=t.is_bookmarked,n()}function q(){N(!1)}function z(e,t){C.bookmarks[e]=t}var Y=function(e,t,n){var a=t.can_to_own,o=void 0===a||a,s=t.can_to_club,l=void 0===s||s,c=t.can_bookmark,u=t.is_bookmarked,d=t.from,y=t.post_from,k=t.list,O=(t.message,t.targetOwnOnClick),T=t.appId,D=t.isVKApp;cur.share&&cur.share.destroy();var z=!m(t.object);if(!z||D){z&&!/^(https|http)?:\/\//i.test(t.object)&&(t.object="https://"+e,e=t.object),p.default&&p.default.close(),t.withoutScrollView||Object(h.preventDocumentScroll)(),z||(u=void 0!==C.bookmarks[e]?C.bookmarks[e]:u,t.is_bookmarked=u),cancelEvent(n);var Y=!!navigator.share,G=browser.ios?"iOS":"Android",Q=Object(f.default)({on_overlay_click:"cur.share.destroy()",class:"ShareModal",attached:!0,body:_({targetOwnOnClick:!!O&&"cur.share.toOwnWall()",can_to_own:o,can_to_club:l,supportsExternalShare:Y,platform:G,can_bookmark:c,is_bookmarked:u,list:k,from:d,post_from:y,object:t.object,isVKApp:t.isVKApp})}),K=t.withoutHash?null:"share";f.default.open(Wd.elem(Q),!0,K,{swipeDown:!0,onClose:function(){cur.share&&cur.share.destroy({closeModal:!1})}});var X=Object(v.$)(".ShareModal"),J=Object(v.$)(".ShareHeader"),Z=Object(v.$)(".ShareLists"),ee=Object(v.$)(".ShareBottom"),te=Object(v.$)(".ActionsPanel-button--bookmark"),ne=Object(v.$)(".ActionsPanel-button--group");setTimeout((function(){!function(e){void 0===e&&(e={});cur.shareSearch=new QuickSearch;var t=e.appId?w+"&app_id="+e.appId:w,n=e.appId?w+"&app_id="+e.appId+S:"/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1ShareConversations";cur.shareSearch.init({action:t,field:"ShareHeaderConversationsSearchPanel__input",container:S,top_len:20,onFocusChanged:function(e){e?A.onOpen("top"):A.onClose(),N(e),setTimeout((function(){N(e)}),200)},tpl:function(e,t){return'<ul aria-multiselectable="true" aria-hidden="false" class="ScrollView ShareConversations__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(e,t){if(cur.share){var n=cur.share.cache._cache,a=n[this.id][0],o=!(!n[this.id][8]||!n[this.id][8].is_casper)?'<span class="ShareConversationsCasperTitle">\n             <span class="ShareConversationsCasperTitle__text">'+this.highlight(a)+'</span>\n             <span class="ShareConversationsCasperTitle__icon">'+Wd.html(Object(i.default)("mail/casper","casper_16"))+"</span>\n           </span>":this.highlight(a),r=-1!==cur.share.selected.indexOf(+this.id)?"inline_item_selected":"";return'\n        <label aria-label="'+a+'" tabindex="0" role="checkbox" id="peer'+this.id+'" onclick="cur.share.select('+this.id+', this)" class="inline_item active '+r+'">\n          <input type="checkbox" style="display: none;">\n            <img aria-hidden="true" class="ii_img" src="'+t+'" />\n            <div class="ii_body">\n              <div class="ii_owner">\n                 '+o+"\n              </div>\n            </div>\n          </input>\n        </label>\n      "}},null_tpl:function(e){var t=getLang("mobile_friends_search_not_found").replace("%s",htsc(e));return e||(t=getLang("mobile_share_list_no_friends")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}}),cur.share.cache=QuickSearchCache[n],H()}({appId:T})}),250),addEvent(te,"click",W.bind(this,e,t,(function(){V(t.is_bookmarked)})),{passive:!0}),addEvent(ne,"click",(function(){x(!0)}),{passive:!0});var ie=Object(v.$)(".ExpandedMessagePanel textarea"),ae=Object(v.$)(".MessagePanel__input input");ie.value=t.message||"",ae.value=t.message||"",function(e,t){void 0===t&&(t=3);var n=Object(r.ce)("span",{className:"Textarea__ghost"});Object(r.setStyle)(n,{width:e.clientWidth+"px",padding:Object(r.getStyle)(e,"padding"),lineHeight:Object(r.getStyle)(e,"line-height")}),n.innerText="_",Object(r.append)(n,e.parentNode);var i=n.clientHeight;Object(r.addEvent)(e,"input",(function(){var a=e.value.replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");("\n"===Object(r.last)(a)||a.endsWith("<br />"))&&(a+="&nbsp;"),n.innerHTML=a,e.rows=Math.max(1,Math.min(t,Math.ceil(n.clientHeight/i)))}))}(ie),addEvent(ie,"input blur focus",(function(e){var t=cur.share._els.content;ae.value=ie.value.replace(/\n/gi," "),P(!1),"input"===e.type&&N(!1),"focus"===e.type&&(t.classList.remove("ShareLists--transition"),X.classList.add("ModalMenu--blocked"),X.classList.add("ModalMenu--focused"),A.onOpen("bottom"),setTimeout((function(){R(!0),P(!1),N()}),100)),"blur"===e.type&&(X.classList.remove("ModalMenu--blocked"),e.preventDefault(),e.stopPropagation(),A.onClose(),P(!1),X.classList.remove("ModalMenu--focused"),b.isIOS||N(!1),setTimeout((function(){R(!1),P(!1),N()}),100))})),addEvent(Object(v.$)(".ExpandedMessagePanelSend"),"click touchend",(function(e){e.stopPropagation(),e.preventDefault(),document.activeElement&&document.activeElement.blur(),cur.share.sendMessage()}),{capture:!0}),addEvent(ie,"touchmove",(function(e){stopEvent(e)}),{capture:!0}),A.onCloseCallback(q),addEvent(ie,"keydown",(function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey&&browser.mac)&&cur.share.sendMessage(e)}));var oe={act:"publish_box",object:"null"};T&&(oe.app_id=T),t.object?(oe.object=t.object,t.list&&(oe.list=t.list)):z&&(oe.link=e,delete oe.object);var re=Object(g.makeUrl)("/like",oe);cur.share={open:!0,onClose:befall(),go:E,options:t,externalShare:$,actionBox:re,blocked:!1,updateHeights:N,_els:{actionsPanel:Object(v.$)(".ActionsPanel"),messagePanel:Object(v.$)(".MessagePanel"),processingPanel:Object(v.$)(".ProcessingPanel"),groupsList:ge("ShareGroups"),conversationsList:ge("ShareConversations"),bookmarkButton:te,messageTextarea:ie,header:J,content:Z,bottom:ee},selected:[],expandMessage:B,toggleGroupsPanel:x,toggleConversationsSearch:L,select:I,clearSearch:F,setActivePanel:M,onScroll:j,sendMessage:U.bind(t),lastBottomHeight:ee.clientHeight,destroy:function(e){void 0===e&&(e={}),e=extend({closeModal:!0,isFail:!0,isNavigation:!1},e),A.offCloseCallback(q);var t=Object(v.$)(".ShareModal");e.isFail&&cur.app&&cur.app.vkMiniAppShareFail&&cur.app.vkMiniAppShareFail(),t&&e.closeModal&&f.default.close(t),cur.share&&(cur.share.onClose(e.isNavigation),cur.share.open=!1),cur.share.options.withoutScrollView||Object(h.restoreDocumentScroll)(),delete cur.share,delete cur.shareSearch,delete cur.shareGroupSearch}},O&&(cur.share.toOwnWall=O),setTimeout((function(){!function(){cur.shareGroupSearch=new QuickSearch;var e=Icon({icon:"chevron_right"});if(!cur.share.options.can_to_club)return;cur.shareGroupSearch.init({load_once:!0,field:"ShareHeaderGroupsSearchPanel__input",container:"ShareGroups",action:cur.share.actionBox,onFocusChanged:function(e){e?A.onOpen("top"):A.onClose(),setTimeout((function(){N(!1)}),100)},tpl:function(e,t){return'<ul aria-hidden="true"  class="ScrollView ShareGroups__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(t,n){if(!cur.share)return"";var i=function(){if(!cur.share)return{};var e=cur.share.actionBox+"ShareGroups";return QuickSearchCache[e]}()._cache[this.id][0],a=cur.share.options,o=a.object,r=a.list,s=a.from,l=a.post_from,c={act:"add",share_box:"1"};o&&(c=extend(c,{object:o,list:r,from:s,post_from:l})),cur.share.options.isVKApp&&(c.is_vk_app=+cur.share.options.isVKApp);var u=Object(g.makeUrl)("/wall"+this.id,c);return'\n        <li aria-label="'+i+'" tabindex="0" role="link" id="group'+this.id+'" onclick="cur.share.go(\''+u+"', "+cur.share.options.isVKApp+')" class="inline_item " xmlns="http://www.w3.org/1999/html">\n          <img aria-hidden="true" class="ii_img" src="'+n+'" />\n          <div class="ii_body">\n            <div class="ii_owner">\n               '+this.highlight(i)+'\n            </div>\n            <div class="ii_go">\n               '+e+"\n            </div>\n          </div>\n        </li>\n      "},null_tpl:function(e){var t=getLang("mobile_groups_no_groups_found");return e||(t=getLang("mobile_share_list_no_groups")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}})}()}),300),V(u),N(),J.closest(".Share").focus(),onBodyResize((function(){document.activeElement&&"INPUT"===document.activeElement.tagName?N(!0):N(!1),setTimeout((function(){P(!0)}),150)})),onBodyResize(!0)}else console.warn("Can't share link outside miniapp")};window.Share=Y,extend(window.Share,{setBookmarkState:z});t.default=_},"BJj/":function(e,t,n){"use strict";function i(e,t,n){var i;return function(){var a=this,o=arguments,r=function(){i=null,n||e.apply(a,o)},s=n&&!i;clearTimeout(i),i=setTimeout(r,t),s&&e.apply(this,o)}}n.r(t),n.d(t,"debounce",(function(){return i}))},BLcx:function(e,t){var n,i=(n=document.getElementsByClassName("gift_create_post_counter"),{counter:function(e){var t=n[0];if(t){var i=e.value.length,a=e.maxLength;if(i>a)e.value=e.value.substr(0,a);else if(i>a/2){var o=Math.max(a-i,0);t.innerText=langNumeric(o,lang.text_N_symbols_remain),show(t)}else hide(t)}}});window.GiftsSendFormCounter=i},BZzM:function(e,t,n){"use strict";n.r(t),n.d(t,"resizePosters",(function(){return i}));function i(e,t,n){var i=ge(t)||document,a="[data-poster-resized='false']";(e||n)&&(a="");var o=domQuery(".poster__text"+a,i),r=[],s=cur.posterConfig&&cur.posterConfig.constants;if(!s){if(!o.length)return;s=JSON.parse(domData(o[0].parentElement,"poster-constants"))}for(var l=0;l<o.length;l++){var c=o[l],u=domPN(c);r.push(domPN(u).clientWidth)}for(var d=0;d<o.length;d++){var _=o[d],f=domPN(_),p=r[d],h=s.font_size_ratio_range_1*p+"px",m=Math.round(s.line_height_ratio_range_1*p)+"px",v="0 "+Math.round(p*(1/18))+"px";_.textContent.length>s.range_threshold&&(h=Math.round(s.font_size_ratio_range_2*p)+"px",m=Math.round(s.line_height_ratio_range_2*p)+"px"),setStyle(f,{height:p*(3/4)+"px",width:p}),setStyle(_,{fontSize:h,lineHeight:m,padding:v}),domData(_,"poster-resized",!0)}}},BoyB:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=n("Y6JH"),r=function(e){void 0===e&&(e={});var t=[e.class||e.mix,a.default.class("Loading",{white:e.white,large:e.large,spinner:e.spinner})];if(e.spinner)return i.default.html({inner:[Object(o.default)({sprite:"base",name:"spinner_16"})],class:t,tag:"div"});return i.default.html({class:t,inner:{class:"Loading__items",inner:[{class:"Loading__item Loading__item_0"},{class:"Loading__item Loading__item_1"},{class:"Loading__item Loading__item_2"}]}})};t.default=r;window.Loading=r},Cbap:function(e,t,n){"use strict";n.r(t);var i=function(){function e(){this.routes=[]}e.getRouter=function(){return window.router||(window.router=new e),window.router};var t=e.prototype;return t.addRoute=function(e,t,n){this.routes.push({isActive:!1,test:e,activateCallback:t,deactivateCallback:n})},t.test=function(e){var t=e.test;if(nav.cur)return"function"==typeof t?t(window.nav.cur):t instanceof RegExp?t.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof t)&&window.nav.cur.startsWith(t)},t.deactivateAllRoutes=function(){this.routes=this.routes.map((function(e){return e.isActive=!1,e.deactivateCallback&&e.deactivateCallback(),e}))},t.checkRoutes=function(){var e=this;this.routes=this.routes.map((function(t){var n=e.test(t);return n&&t.activateCallback&&t.activateCallback(),!n&&t.isActive&&t.deactivateCallback&&t.deactivateCallback(),t.isActive=n,t}))},e}();t.default=i,window.Router=i},CkGd:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81");function r(){var e=Object(i.default)(['\n    <div class="','" ',">","</div>\n  "]);return r=function(){return e},e}function s(){var e=Object(i.default)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <button class="Btn Btn_theme_small ','" ',">\n      ","\n    </button>\n  "]);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){e||(e={});window.lang;var t=a.default.onClick("MailActs._onMoreClick"),n=Object(o.default)({mix:"mailActs__close",icon:"close12",attrs:a.default.onClick("MailActs._onCloseClick")}),i=d("reply"),r=d("forward"),s=_("edit",e),l=_("pin",e),u=_("important",e),p=_("remove",e),h=_("spam",e),m=f("edit",e),v=f("pin",e),g=f("important",e),A=f("remove",e),b=f("spam",e),y=a.default.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel});return a.default.html(c(),y,n,i,r,s,l,u,p,h,t,m,v,g,A,b)};function d(e){var t=window.lang,n=a.default.class("mailActs__button",{type:e}),i=a.default.onClick("MailActs._onButtonClick",e),o="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return a.default.html(l(),n,i,o)}function _(e,t){var n,i=window.lang,o=a.default.class("mailActs__icon",{type:e}),r=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(s(),o,n,r)}function f(e,t){var n,i=window.lang,o=a.default.class("mailActs__chevronListItem",{type:e}),s=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(r(),o,s,n)}var p,h=n("UxAg"),m=n("+cqQ");function v(){store.mail.cur&&S()}function g(e){store.mail.cur&&function(e){var t=e.target,n=$(".mailActs");n&&n.classList.contains("mailActs_menuOpened")&&!t.closest(".mailActs__chevronList")&&!t.closest(".mailActs__chevronMoreIcon")&&n.classList.remove("mailActs_menuOpened")}(e)}function A(e){y({canEdit:e})}function b(e){$(".mailActs__button_type_forward").disabled=!e}function y(e){Object(h.$$)(".mailActs").forEach((function(t){var n=a.default.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailActs",Object.assign({},n,e)))}))}function w(e){switch(e){case"edit":u.onEditClick();break;case"remove":u.onRemoveClick();break;case"important":u.onImportantClick();break;case"reply":u.onReplyClick();break;case"forward":u.onForwardClick();break;case"spam":u.onSpamClick();break;case"pin":u.onPinClick()}}function S(){var e=document.querySelector(".mailActs__chevron"),t=e.offsetWidth-1,n=e.querySelectorAll(".mailActs__chevronListItem"),i=e.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(i,(function(e,a){t<36*i.length?t-34>=36*(a+1)?(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden")):(e.classList.add("mailActs__icon_hidden"),n[a].classList.remove("mailActs__chevronListItem_hidden")):(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden"))})),y({cutted:t<36*i.length})}function k(){Object(h.$$)(".mailActs").forEach((function(e){return e.classList.toggle("mailActs_menuOpened")}))}Object.assign(u,((p={onCloseClick:Object(m.default)(),onRemoveClick:Object(m.default)(),onImportantClick:Object(m.default)(),onReplyClick:Object(m.default)(),onForwardClick:Object(m.default)(),onSpamClick:Object(m.default)(),onPinClick:Object(m.default)(),onMoreClick:Object(m.default)(),onEditClick:Object(m.default)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);Object(h.$$)(".mailActs__counter").forEach((function(e){return e.innerText=t})),1!=e&&A(!1);S()},setEditAvailable:A,setImportantAvailable:function(e){y({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setForwardAvailable:b,setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e}}).setForwardAvailable=b,p.togglePin=function(e){Object(h.$$)(".mailActs").forEach((function(t){return t.classList.toggle("mailActs_canPin",e)}))},p.setModifiers=y,p.setLabels=function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},p.update=S,p)),u._onButtonClick=w,u._onCloseClick=u.onCloseClick,u._onMoreClick=k,onBodyResize(v),document.addEventListener("click",g);t.default=u;window.MailActs=u},DOEQ:function(e,t,n){"use strict";n.r(t),n.d(t,"POST_PARAM_DONUT_DURATION",(function(){return i}));var i="donut_duration"},DVnk:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}}))},Dh0N:function(e,t){function n(e,t){var n=t.$select,o=t.value;n.closest(i.email).classList.toggle(a.groupsVisible,e.includes(o)||e.includes(Number(o)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=n;var i={email:".settingsEmail"},a={groupsVisible:"settingsEmail_groupsVisible"}},DkIl:function(e,t,n){"use strict";n.r(t),n.d(t,"MailHat",(function(){return w})),n.d(t,"MailHat__Title",(function(){return S})),n.d(t,"MailHat__icon",(function(){return O})),n.d(t,"MailHat_main",(function(){return A})),n.d(t,"MailHat_convo",(function(){return b})),n.d(t,"MailHat_page",(function(){return y}));var i=n("MUpH"),a=n("bZ/P"),o=n("9y81"),r=n("gy8s"),s=n("KMpi"),l=n("Y6JH"),c=n("fdw3");function u(){var e=Object(i.default)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return u=function(){return e},e}function d(){var e=Object(i.default)(["\n    ","\n      ",'\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitleWrapper">\n          <div class="','">',"</div>\n          ","\n        </div>\n        ","\n      </div>\n    ","\n  "]);return d=function(){return e},e}function _(){var e=Object(i.default)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return _=function(){return e},e}function f(){var e=Object(i.default)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return f=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="mailHat__desktopTitle">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="mailHat__unreadCount mailHat__unreadCount_length_','">\n      ',"\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="mailHat '," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return g=function(){return e},e}function A(e){Object(o.default)({mix:"mailHat__burger",icon:"burger",attrs:a.default.onClick("MailHat_main.onBurgerClick")});var t,n,i,s,c,u,d,_=function(e,t,n,i,a){var o=window.lang;return Object(r.default)({mix:"mailHat__folder",triggerWrapperTag:"h1",items:[{name:"all",text:o.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:o.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:o.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:o.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important},a?{name:"ad_tag",text:o.mobile_mail_tab_ad_tag,active:"ad_tag"===e,url:t.adTag}:""]})}(e.folder,e.urls,e.withUnrespond,e.importantCount,e.withAdTag);i=e.unreadCount,s=a.default.class("mailHat__unread",{hasUnread:i>0}),c=Object(o.default)({mix:"mailHat__unreadIcon",icon:"msg"}),(t=i)>999?(t="999+",n=4):n=t>99?3:t>9?2:1,u=a.default.html(m(),n,t),d=a.default.onClick("MailHat_main.onUnreadClick"),a.default.html(v(),s,d,c,u);return w({type:"main",left:""+Wd.html({class:"mailHat__cancelForward",inner:Object(l.default)("base","back_outline_28"),onmousedown:["MailHat_main.onCancelForwardTap"]}),center:""+_+function(){var e=window.lang;return a.default.html(h(),e.mobile_mail_choose_recipient)}()+function(){var e=window.lang;return a.default.html(p(),e.mobile_mail_tab_messages)}(),right:""+Wd.html({href:e.urls.createChatUrl,class:"mailFilter__create",inner:Object(l.default)("base","write_outline_28")}),forwarding:e.forwarding})}function b(e){var t=k(),n=Wd.html({class:"mailHat__cancelEditing",inner:Object(l.default)("base","cancel_outline_28"),onmousedown:["MailHat_convo.onCancelEditingTap"]}),i=function(e){var t=e.isContact,n=(e.peerProfile.tagsData,a.default.class("mailHat__convo",{mobile:e.mobile})),i=a.default.class("mailHat__convoTitle",{casper:e.isCasper}),o=Object(s.default)({mix:"mailHat__convoAvatar",photos:e.photos,size:36,isContact:t,name:e.title}),r=function(e){var t=window.lang,n=e.membersCount,i="",o="";if(n>0)o=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var r=e.onlinePlatform;o=C(e.isOnline,e.offlineText),"mobile"===r&&(i=Wd.html({class:a.default.class("mailHat__onlineIcon",{platform:"mobile",isOnline:e.isOnline}),inner:e.isOnline?Object(l.default)("base","online_mobile_composite_16"):Object(l.default)("profile","online_mobile_12_gray_200")}))}return a.default.html(u(),o,i)}(e),_=e.isCasper?'<span title="'+Object(c.getLang)("mobile_casper_chat_title")+'" class="mailHat__convoCasperIcon">'+Wd.html(Object(l.default)("mail/casper","casper_16"))+"</span>":"",f=t?'<div class="'+n+'">':'<a class="'+n+'" href="'+e.url+'">',p=t?"</div>":"</a>";return a.default.html(d(),f,o,i,e.title,_,r,p)}(e),o=function(){var e=window.lang;return a.default.html(f(),e.mobile_mail_message_editing)}(),_="",p=function(e){return Object(r.default)({mix:"mailHat__actions",trigger_attrs:{"aria-label":Object(c.getLang)("mobile_mail_actions_label")},icon_html:Wd.html(Object(l.default)("base","more_horizontal_28")),position:"topRight",items:e})}(e.actions);Object(c.isEduIntegration)()?_=""+Wd.html({class:"mailHat__icon",inner:Object(l.default)("mail","videocam_outline_28"),onclick:["uMessenger.onCall"]})+p:_=p;return w({type:"convo",left:""+t+n,center:""+i+o,right:_,hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function y(e){return w({type:"page",left:""+k(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function w(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,o=e.editing?"mailHat_editing":"";return a.default.html(g(),i,t,n,o,e.left,e.center,e.right)}function S(e){return a.default.html(_(),e.title)}function k(){return Wd.html({tag:"button",type:"button","aria-label":Object(c.getLang)("mobile_back"),class:"mailHat__back",inner:Object(l.default)("base","back_outline_28"),onclick:["MailHat_convo.onBackTap"]})}function O(e){return Object(o.default)({mix:a.default.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url})}function C(e,t){var n=window.lang;return e?n.mobile_mail_online:t}var j=n("UxAg"),E=n("+cqQ");function T(e){Object(j.$$)(".mailHat").forEach((function(t){var n=a.default.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailHat",Object.assign({},n,e)))}))}Object.assign(A,{onUnreadClick:Object(E.default)(),onBurgerClick:Object(E.default)(),onCancelForwardTap:Object(E.default)(),setFolder:function(e){Object(j.$$)(".mailHat__folder").forEach((function(t){r.default.setActive(t,e)}))},setImportantCount:function(e){Object(j.$$)(".mailHat__folder").forEach((function(t){r.default.setCount(t,"important",e)}))},setForwarding:function(e){Object(j.$$)(".mailHat_type_main").forEach((function(t){return t.classList.toggle("mailHat_forwarding",e)}))},setModifiers:T}),Object.assign(b,{onBackTap:Object(E.default)(),onCancelEditingTap:Object(E.default)(),setOnline:function(e,t){var n=C(e,t);Object(j.$$)(".mailHat__convoDetailsText").forEach((function(e){return e.innerText=n}))},setMobile:function(e){Object(j.$$)(".mailHat__convo").forEach((function(t){return t.classList.toggle("mailHat__convo_mobile",e)}))},setHasPinnedMsg:function(e){Object(j.$$)(".mailHat_type_convo").forEach((function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)}))},setModifiers:T}),window.MailHat_main=A,window.MailHat_convo=b},EXR0:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("fdw3");t.default=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(i.default)({sprite:"common",name:"cancel_24"})],class:"ModalMenuHeader__close","aria-label":Object(a.getLang)("mobile_close"),onClick:e.onClose,tag:"button"},{inner:[e.inner],class:"ModalMenuHeader__title",tag:"div"}],class:"ModalMenuHeader",tag:"div"}}},FbVm:function(e,t,n){"use strict";n.r(t),n.d(t,"NavigationStatCollector",(function(){return s})),n.d(t,"ProductionStatCollector",(function(){return u})),n.d(t,"ActionStatCollector",(function(){return _})),n.d(t,"ClickStatCollector",(function(){return p})),n.d(t,"ViewStatCollector",(function(){return m})),n.d(t,"RegistrationItemStatCollector",(function(){return g})),n.d(t,"NavigationProductionStatEventTypes",(function(){return i.NavigationProductionStatEventTypes})),n.d(t,"RegistrationFieldItemNames",(function(){return i.RegistrationFieldItemNames})),n.d(t,"RegistrationItemEventTypes",(function(){return i.RegistrationItemEventTypes})),n.d(t,"EventScreens",(function(){return i.EventScreens}));var i=n("r0fY"),a=n("HLtZ"),o=n("W9Tc"),r=function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},s=function(){function e(e){this.ProductionStatCollector=e,this.tabId=this.ProductionStatCollector.getIntId()%128}return e.prototype.getEventTabOpen=function(e){return{subtype:i.NavigationProductionStatEventTypes.TAB_OPEN,tab_id:this.tabId,screen:e}},e.prototype.getEventMove=function(e,t){var n,o,r=this.lastStatEvents,s=this.lastNavEvents;return r&&s?(s.subtype===i.NavigationProductionStatEventTypes.TAB_OPEN?n=s.screen:(n=s.screen_to,o=s.screen),{prev_navgo_id:r.id,subtype:t,screen:n,screen_to:e,screen_prev:o,prev_navgo_timestamp:r.timestamp,tab_id:this.tabId}):(Object(a.logError)(new Error("NavigationStatCollector: previous event not found.")),null)},e.prototype.addStatEvent=function(e,t){var n;if(void 0===t&&(t=i.NavigationProductionStatEventTypes.GO),Object(o.partConfigEnabled)("navigation_timespent")){var a;if(t===i.NavigationProductionStatEventTypes.TAB_OPEN)a=this.getEventTabOpen(e);else{var s=this.getEventMove(e,t);if(!s)return;a=s}var l=r(r({},this.ProductionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_NAVGO})[i.ProductionStatEventTypes.TYPE_NAVGO]=a,n));this.ProductionStatCollector.logEvent(l),this.lastStatEvents=l,this.lastNavEvents=a}},e.prototype.getModule=function(){var e,t;return null!==(t=null===(e=window.cur)||void 0===e?void 0:e.module)&&void 0!==t?t:"unknown"},e}(),l=n("W0P9"),c=n("mMuO"),u=function(){function e(){this.DEBUG=!1}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.logEvent=function(e){this.DEBUG&&Object(l.log)(e),e.type&&e[e.type]?(Object(c.saveProductionStats)(e),this.lastEvent=e):Object(a.logError)(new Error("ProductionStatCollector: invalid event."))},e.prototype.getLastEvent=function(){return this.lastEvent},e.prototype.getBaseEvent=function(){var e;return{id:this.getIntId(),prev_id:null===(e=this.lastEvent)||void 0===e?void 0:e.id,timestamp:this.getCurrentTime(),url:window.location.href}},e.MAX_INT32=2147483647,e}(),d=function(){return(d=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},_=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e){var t,n=d(d({},this.productionStatCollector.getBaseEvent()),((t={type:i.ProductionStatEventTypes.TYPE_ACTION})[i.ProductionStatEventTypes.TYPE_ACTION]=e,t));this.productionStatCollector.logEvent(n)},e}(),f=function(){return(f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=f(f({},this.productionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_CLICK})[i.ProductionStatEventTypes.TYPE_CLICK]=f({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},m=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=h(h({},this.productionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_VIEW})[i.ProductionStatEventTypes.TYPE_VIEW]=h({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),v=n("J8bf"),g=function(){function e(e){this.actionStatCollector=e,this.fields={}}return e.prototype.logFieldInteraction=function(e,t,n){void 0===n&&(n=!1),[i.RegistrationFieldItemNames.PASSWORD,i.RegistrationFieldItemNames.SMS_CODE,i.RegistrationFieldItemNames.RULES_ACCEPT].includes(e)&&(t=t?"1":"0");var a=n?"0":this.actionStatCollector.productionStatCollector.getCurrentTime(!1);this.fields[e]?(this.fields[e].value=t,this.fields[e].end_interaction_time=a):this.fields[e]={name:e,value:t,start_interaction_time:a,end_interaction_time:a}},e.prototype.getFieldInteractions=function(){return Object.values(this.fields)},e.prototype.resetFieldInteractions=function(){for(var e=0,t=Object.getOwnPropertyNames(this.fields);e<t.length;e++){var n=t[e];delete this.fields[n]}},e.prototype.logEvent=function(e,t,n){var a;if(Object(o.partConfigEnabled)("registration_item_stat")){var r={event_type:e,screen:t,unauth_id:Object(v.getCookie)("remixstid"),sid:Object(v.getCookie)("remixnreg_sid")};[i.RegistrationItemEventTypes.SCREEN_PROCEED,i.RegistrationItemEventTypes.SCREEN_SKIP,i.RegistrationItemEventTypes.SCREEN_RETURN].includes(e)&&(r.screen_to=n,r.fields=this.getFieldInteractions(),this.resetFieldInteractions());var s=((a={type:i.ActionProductionStatEventTypes.TYPE_REGISTRATION_ITEM})[i.ActionProductionStatEventTypes.TYPE_REGISTRATION_ITEM]=r,a);this.actionStatCollector.logEvent(s)}},e}()},Fhlr:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",(function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)})),e._promoButtonClickHandlerAdded=!0}}))},Fkq0:function(e,t,n){"use strict";n.r(t),n.d(t,"marketDebug",(function(){return r})),n.d(t,"marketItemIdToObject",(function(){return s})),n.d(t,"albumLinkToObject",(function(){return l})),n.d(t,"parseBookmarkedProductClass",(function(){return c})),n.d(t,"extractURLQueryParameter",(function(){return u})),n.d(t,"isElementVisible",(function(){return d})),n.d(t,"isElementInViewport",(function(){return _}));var i=n("ZD4m"),a=n("W9Tc"),o=n("tGJf");function r(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];(Object(a.partConfigEnabled)("extended_client_logging")||o.vkLocalStorage.getItem("market_extended_client_logging"))&&("error"===e?console.error("[market "+t+"]: ",n):"warn"===e?console.warn("[market "+t+"]: ",n):"info"===e?console.info("[market "+t+"]: ",n):console.debug("[market "+t+"]: ",n))}function s(e,t){void 0===t&&(t="market");var n=new RegExp(t+"(-?[0-9]+)_([0-9]+)"),i=e.match(n);if(!i||i.length<3)return null;var a=i[1],o=i[2];return{id:a+"_"+o,ownerId:parseInt(a),itemId:parseInt(o)}}function l(e){var t=e.match(/market(\-?[0-9]+).+section=album_([0-9]+)/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:n+"_"+i,ownerId:parseInt(n),itemId:parseInt(i)}}function c(e){var t=e.match(/_([0-9]+)_(\-?[0-9]+)_4/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:i+"_"+n,ownerId:parseInt(i),itemId:parseInt(n)}}function u(e,t){var n=new RegExp("[?&]+"+t+"=([a-zA-Z0-9_]+)"),i=e.match(n);return!i||i.length<2?null:i[1]?String(i[1]):null}function d(e){var t;return"none"!==(null===(t=e.style)||void 0===t?void 0:t.display)}function _(e,t,n,a){void 0===t&&(t=50),void 0===n&&(n=null);var o=n?n.left:0,r=n?n.top:0,s=Object(i.getViewportSize)(),l=Object(i.getElementOffset)(e),c=Object(i.getElementSize)(e),u=c.width*t/100,d=c.height*t/100;if(a){if(a.width>s.width)return!1;if(a.height>s.height)return!1;s=a}return!(l.left+c.width<o+u)&&(!(l.left+u>s.width)&&(!(l.top+c.height<r+d)&&!(l.top+d>s.height)))}},"GR/G":function(e,t,n){var i=n("/8IX"),a=n("HN+/");function o(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||r(e)!==r(t)?e:(a(e,t),s(e,t),t):null:e}function r(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function s(e,t){for(var n,i,a,r,s=0,c=0;n=t.childNodes[c],i=e.childNodes[c-s],n||i;c++)if(i)if(n)if(l(i,n))(a=o(i,n))!==n&&(t.replaceChild(a,n),s++);else{r=null;for(var u=c;u<t.childNodes.length;u++)if(l(t.childNodes[u],i)){r=t.childNodes[u];break}r?((a=o(i,r))!==r&&s++,t.insertBefore(a,n)):i.id||n.id?(t.insertBefore(i,n),s++):(a=o(i,n))!==n&&(t.replaceChild(a,n),s++)}else t.appendChild(i),s++;else t.removeChild(n),c--}function l(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(3===e.type&&e.nodeValue===t.nodeValue)}e.exports=function(e,t,n){if(i.equal(typeof e,"object","nanomorph: oldTree should be an object"),i.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly)return s(t,e),e;return i.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),o(t,e)}},GVTI:function(e,t,n){"use strict";n.r(t),n.d(t,"_PhotoviewPage_tags",(function(){return f}));var i=n("vOib"),a=n("rc7J"),o=n("fdw3"),r=n("29dZ"),s=n("vk58"),l=n("Q8gl"),c=n("O5lf"),u=n("vhZE");function d(e){var t="wi_like_wrap";e.liked_people||(t+=" is_empty");var n="PhotoviewPage__description";return e.photo.description||(n+=" PhotoviewPage__description--empty"),{inner:[e.photo.caption?{inner:[Wd.wrap(e.photo.caption)],class:"PhotoviewPage__caption",tag:"div"}:null,{inner:[Wd.wrap(e.photo.description)],class:n,tag:"div"},{inner:[e.liked_people?e.liked_people:null],class:t,tag:"div"},e.buttons?{inner:[{inner:[e.buttons],class:"wi_buttons",tag:"div"}],class:"wi_buttons_wrap",tag:"div"}:null,e.author,e.replies],class:"PhotoviewPage__footer",tag:"div"}}function _(e){var t=window.lang;return{inner:[{inner:[e.edit_data.rotate.can_rotate?Object(s.default)({inner:[Object(r.default)({inner:[t.mobile_photos_edit_rotate_left],url:e.edit_data.rotate.left,stretch:!0}),Object(r.default)({inner:[t.mobile_photos_edit_rotate_right],url:e.edit_data.rotate.right,stretch:!0})],nowrap:!0}):null,{inner:[{inner:[t.mobile_photos_edit_desc_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.photo.description],name:"text",class:"textfield",rows:"4",tag:"textarea"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[{inner:[t.mobile_photos_edit_album_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.edit_data.albums.map((function(e){return{inner:[e.name],selected:e.selected?"selected":null,value:e.id,tag:"option"}}))],name:"aid",tag:"select"},{inner:[Object(l.default)({withoutWrap:!0,name:"cover",label:t.mobile_photos_edit_cover_label,type:"checkbox"})],class:"fi_subrow",tag:"div"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[Object(s.default)({inner:[Object(r.default)({inner:[t.mobile_photos_edit_save_btn],type:"submit"}),Object(r.default)({inner:[t.mobile_cancel],theme:"link",url:e.edit_data.back_url})]})],class:"fi_row",tag:"div"}],action:e.edit_data.action,method:"post",tag:"form"}],class:"form_item",tag:"div"}}function f(e){return void 0===e&&(e=[]),{inner:[Object.keys(e).map((function(t){return{inner:[{class:"fill",tag:"div"}],class:"pv_tag",id:"pv_tag"+t,style:function(e){if(!Object(o.isArray)(e))return"";var t=e[0];return Object(o.isArray)(t)?"left: "+t[0]+"%; top: "+t[1]+"%; width: "+t[2]+"%; height: "+t[3]+"%":""}(e[t]),tag:"div"}}))],class:"PhotoviewPage__tags",tag:"div"}}var p=function(e){void 0===e&&(e={});var t=e.info||{},n=e.photo||{},r=e.is_loading||!1,s=e.navigation_buttons||{},l=Object(o.concatValues)("PhotoviewPage ",e.class);e.info&&(e.author=Object(a.default)({url:t.url,author_url:t.author_url,avatar:t.avatar,title:t.title,subtitle:t.subtitle,withoutBottomBorder:!e.has_replies})),e.photo||(e.photo={}),e.photo.description||(e.photo.description="");var p,h="",m=null;r&&(l=Object(o.concatValues)(l," PhotoviewPage--skeleton"),n.width?h+=" width"+e.width+"px;":m=Wd.wrap(Object(c.default)({mix:"al_loading",type:"pageLoader"})));var v=["PhotoviewPage__photo"];e.photo.restriction&&("block"===e.photo.restriction.type?v.push("PhotoviewPage__photo--block"):"blur"===e.photo.restriction.type&&v.push("PhotoviewPage__photo--blur")),p=[{src:n.src,style:h,tag:"img"},f(e.tags)];var g,A=!!e.photo.restriction;return A&&((g=e.photo.restriction).width=e.width,g.height=e.height||e.width),Object(i.default)({inner:[{inner:[{inner:[m||{inner:[p],class:v,href:n.href,tag:"a"},{inner:[Object(u.default)(g)],class:"PhotoviewPage__restrictedInfo",style:A?"":"display: none;",tag:"div"},s],class:"PhotoviewPage__thumb",tag:"div"},e.edit_mode?_(e):d(e)],id:e.photo.id,tag:"div"}],class:l})};t.default=p},GYWy:function(e,t,n){(function(e,i){var a;!function(o){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof i&&i;r.global!==r&&r.window!==r&&r.self;var s,l=2147483647,c=/^xn--/,u=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function h(e){throw new RangeError(_[e])}function m(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function v(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+m((e=e.replace(d,".")).split("."),t).join(".")}function g(e){for(var t,n,i=[],a=0,o=e.length;a<o;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<o?56320==(64512&(n=e.charCodeAt(a++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),a--):i.push(t);return i}function A(e){return m(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function y(e,t,n){var i=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;i+=36)e=f(e/35);return f(i+36*e/(e+38))}function w(e){var t,n,i,a,o,r,s,c,u,d,_,p=[],m=e.length,v=0,g=128,b=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&h("not-basic"),p.push(e.charCodeAt(i));for(a=n>0?n+1:0;a<m;){for(o=v,r=1,s=36;a>=m&&h("invalid-input"),((c=(_=e.charCodeAt(a++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:36)>=36||c>f((l-v)/r))&&h("overflow"),v+=c*r,!(c<(u=s<=b?1:s>=b+26?26:s-b));s+=36)r>f(l/(d=36-u))&&h("overflow"),r*=d;b=y(v-o,t=p.length+1,0==o),f(v/t)>l-g&&h("overflow"),g+=f(v/t),v%=t,p.splice(v++,0,g)}return A(p)}function S(e){var t,n,i,a,o,r,s,c,u,d,_,m,v,A,w,S=[];for(m=(e=g(e)).length,t=128,n=0,o=72,r=0;r<m;++r)(_=e[r])<128&&S.push(p(_));for(i=a=S.length,a&&S.push("-");i<m;){for(s=l,r=0;r<m;++r)(_=e[r])>=t&&_<s&&(s=_);for(s-t>f((l-n)/(v=i+1))&&h("overflow"),n+=(s-t)*v,t=s,r=0;r<m;++r)if((_=e[r])<t&&++n>l&&h("overflow"),_==t){for(c=n,u=36;!(c<(d=u<=o?1:u>=o+26?26:u-o));u+=36)w=c-d,A=36-d,S.push(p(b(d+w%A,0))),c=f(w/A);S.push(p(b(c,0))),o=y(n,v,i==a),n=0,++i}++n,++t}return S.join("")}s={version:"1.4.1",ucs2:{decode:g,encode:A},decode:w,encode:S,toASCII:function(e){return v(e,(function(e){return u.test(e)?"xn--"+S(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?w(e.slice(4).toLowerCase()):e}))}},void 0===(a=function(){return s}.call(t,n,t,e))||(e.exports=a)}()}).call(this,n("YuTi")(e),n("yLpj"))},GtpT:function(e,t,n){"use strict";n.r(t),n.d(t,"getDataFromDOM",(function(){return r}));var i=n("Y6JH");var a=function(e){var t,n=e.album,a=n.url,o=n.title,r=n.photos_count_label,s=n.restriction,l="AlbumItem al_album";n.thumb?t=n.thumb:s||(l+=" AlbumItem--empty");var c,u="";if(s){var d={};d[s.type]=!0,u=Bem.class("AlbumItem__restriction",d,"--")}if(s&&"geo"===s.type)c={inner:[{inner:[Object(i.default)({sprite:"wall",name:"do_not_disturb_outline_56"})],class:u,tag:"div"}],class:"AlbumItem__thumb",tag:"div"};else{var _=[Bem.class("AlbumItem__thumb",{blur:s&&"blur"===s.type},"--")];c={inner:[s&&s.type?{inner:[Object(i.default)({sprite:"wall",name:"hide_outline_56"})],class:u,tag:"div"}:null],class:_,"data-thumb-id":n.thumb_id,style:"background-image: url("+t+")",tag:"div"}}return{inner:[{inner:[c],class:"AlbumItem__thumbWrap",tag:"div"},{inner:[{inner:[o],class:"AlbumItemInfo__title",tag:"div"},{inner:[r],class:"AlbumItemInfo__subtitle",tag:"div"}],class:"AlbumItemInfo",tag:"div"}],href:a,class:l,onclick:e.onClick,tag:"a"}},o=n("OcsD");function r(e){if(!e.classList.contains("AlbumItem"))return{};var t=Object(o.val)($(".AlbumItemInfo__title",e))||"",n=Object(o.val)($(".AlbumItemInfo__subtitle",e))||"",i=e.getAttribute("href"),a=$(".AlbumItem__thumb",e),r=/url\("(.*)"\)/.exec(a.style.backgroundImage),s=!!r&&r[1],l=$(".AlbumItem__restriction",e),c=!1;return l&&(l.classList.contains("AlbumItem__restriction--blur")?c={type:"blur"}:l.classList.contains("AlbumItem__restriction--geo")&&(c={type:"geo"})),{album:{title:Wd.wrap(t),photos_count_label:n,url:i,thumb:s,restriction:c},onClick:e.getAttribute("onclick")}}t.default=a},Gzds:function(e,t,n){"use strict";n.r(t);var i,a,o=n("+cqQ"),r=n("wkhI"),s=n("UxAg"),l=n("DOEQ"),c=n("OcsD"),u=n("fdw3"),d=n("zvhO"),_=n("W9Tc"),f=n("cZev");onDOMReady((function(){f.default.onStickerPanelUpdate((function(){if(cur.waitingStickerPanel)clog("Show sticker panel after waiting"),p.stickersToggle(null,!0);else if("mail"!==cur.module){var e=Object(s.$)("#stickers_panel");Object(c.domData)(e,"need-update",1),e&&"none"!==e.style.display&&p.stickersToggle(null,!1)}}))}));var p={curGif:null,onStickersTabSelected:Object(o.default)(),onStickerClick:Object(o.default)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var o=!1;if(each(i,(function(e,t){if("submit"===t.type)return o=t,!1})),o)return append(a,i),window.al&&n.ver?nav.go(o,t):i.submit()}return!0},saveDraft:function(e,t,n,i){if(e&&e.preventDefault(),!i||!i.classList.contains("CreatePostButtons__item--disabled")){var a=ge("feed_add_form"),o=qs2obj(nav.params),s={act:"post",save_draft:1,redirect:n,hash:t};o.comment&&(s.comment=o.comment),each(a.elements,(function(e,t){if(!["submit","file"].includes(t.type)){if(Object(r.isFieldIgnored)(t))return;s[t.name]="checkbox"===t.type?(+t.checked).toString():t.value}})),ajax.post(window.nav.path,s)}},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var a=geByClass1("wi_actions_wrap",i),o=geByClass1("wi_actions",a),r=geByClass1("wi_actions_btn",i);p.wallActionsHide(),addClass("wi_actions_opened",i);var s=getY(i)+45+getH(o)+7,l=scrollTop()+getCh();toggleClass("wi_actions_top",a,s>l),n.addHandler(p.wallActionsHide),n.show(a,r)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,a){return void 0===a&&(a=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?p.hideGif(e,t,a):(a||Gif.autoplayTest(),p.showGif(e,t,n,a))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach((function(n,i){n!==e&&p.hideGif(n,!1,t)}))},showGif:function(e,t,n,o){var r=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(r.loadedGifs||(r.loadedGifs={}),!r.loadedGifs[e.href]&&!confirm(n))return!1;r.loadedGifs[e.href]=!0}if(clearInterval(i),!o){var l=getY(e),c=scrollTop();scrollTop(c-(l-getY(e)))}geByClass("current_gif","mcont").forEach((function(e,t){p.hideGif(e,!1,o)}));var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports()&&e.href.includes("&mp4"),d=function(t,n){hasClass("current_gif",e)&&(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),"VIDEO"===a.tagName&&document.body.contains(a)?a.play():append(a,e),p.curGif=e,n&&n())};if(u){var _=geByClass1("ph_img",e).src;(a=Object(s.$)("video.gif_original",e)||ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:_})).setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.setAttribute("controls",!0),a.controls=!1,a.readyState>=2&&"VIDEO"===a.tagName?(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),a.play(),d()):a.load()}else a=ce("img",{src:e.href,className:"gif_original"});return e.classList.add("current_gif"),e.classList.contains("gif_opened")||e.classList.add("gif_loading"),u?a.oncanplay=function(){e!==p.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,o?1:0),d())}:i=setInterval((function(){a.complete&&(statlogsValueEvent("gif_play",0,"gif",null,o?1:0),d(),clearInterval(i))}),100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach((function(e){"VIDEO"===e.tagName?e.pause():remove(e)})),!n){var i=Gif.getState(),a=i.currentAutoplayElement,o=i.ignore;a===e&&(o.push(e),Gif.setState("ignore",o))}return p.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,(function(){t.push(escapeRE(this[0]))})),new RegExp("^("+t.join("|")+")")},stickerPanelInit:function(){if(Object(s.$)("#stickers_panel"))return!0;var e=!1;if("mail"===cur.module&&window.isNewMail)e=Object(s.$)(".uMailWrite__popupStickers").childNodes[0];else{var t=Object(s.$)(".RepliesField_wrap")||(Object(s.$)(".create_post")||{}).parentNode;if(!t)return!1;e=(Array.from(t.children).find((function(e){return!(!e||!e.nextSibling||e.nextSibling.nodeType!==Node.COMMENT_NODE)}))||{}).nextSibling}if(e&&e.nodeType===Node.COMMENT_NODE){var n,i=f.default.getStickerPanel();if(!i)return!1;var a=document.createElement("div");return a.innerHTML=i,e&&(n=e).after.apply(n,a.childNodes),e&&e.remove(),p.stickersInit(),!0}return!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=Object(s.$)("#stickers_panel");if(!n)return!p.stickerPanelInit()||(p.stickersInit(),"cached");var i=geByClass1("sp_body",n),a=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push((function(){e.scroller.destroy()})),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(a),e.tabScroller.init(),e.destroy.push((function(){e.tabScroller.destroy()})),p.onStickersInit(!0)}},replyTo:function(e,t,n,i,a){var o=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var r=ge("nc_form"),s=ge("nc_message"),l=geByClass1("nc_reply_name",r),c=gpeByClass("near_btn",l),u=ge("nc_reply_as"),d=val(s),_=p.replyNamesRE();if(n){var f=ge(t+"_"+n),h=getY(f)+getH(f),m=scrollTop();after(r,f),addClass("nc_current_reply",geByClass1("pi_reply_wrap",f)),scrollTop(m+getY(f)+getH(f)-h);var v=o.replyNames[i]||{},g=v[0]||"",A=v[1]||"";d=d?_?d.replace(_,g):d:g,p.onReplyClick(!0,g)}else{append(r,geByClass1("wall_replies")),scrollToEl(r);A="";d=_?d.replace(_,""):d}return val(s,replaceEntities(d)),val(l,A),toggle(c,n),u&&(val(u,+a),toggleClass("cp_post_as_group",r,+a)),val("nc_reply_to",n),o.replyTo=n,elfocus(s),!1},stickersToggle:function(e,t){var n=window.cur;if(!f.default.getStickers())return f.default.checkStickers(),!0;isUndefined(t)&&(t=!isVisible("stickers_panel")),!t&&n.waitingStickerPanel&&delete n.waitingStickerPanel;var i=ge("write_form")||ge("nc_form"),a=ge("stickers_panel"),o=geByClass1("cp_sticker_btn",i);if(!a){var r=p.stickersInit();if("cached"===r)return p.stickersToggle(e,t);if(!0===r)return n.waitingStickerPanel=!0,void f.default.checkStickers()}if(n.waitingStickerPanel&&delete n.waitingStickerPanel,!t&&Object(c.domData)(a,"need-update")){var l=Object(u.getState)("target")||safeGet(window.store,"mail.cur.peerId"),d=f.default.getStickerPanel(l),_=document.createElement("div");_.innerHTML=d;var h=Object(s.$)(".stickers_panel",_);a.innerHTML=h.innerHTML,p.stickersInit()}return toggle(a,t),toggleClass("cp_sticker_btn_sel",o,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach((function(e){return e(t)})),!1},saveCurrentStickersPanelToCache:function(){if(Object(_.partConfigEnabled)("mvk_stickers_panel_optimize")){var e=Object(s.$)(".stickers_panel");if(e){var t=safeGet(window.store,"mail.cur.peerId"),n=(Object(u.getState)("target")||"").toString()||(t?"mail"+t:"");if(n){var i=f.default.getStickerPanel(),a=document.createElement("div");a.innerHTML=i,Object(s.$)(".stickers_panel",a).innerHTML=e.innerHTML.replace(new RegExp(n,"g"),"mail0"),f.default.saveStickerPanel(a.innerHTML)}}}},stickersClick:function(e,t){var n=f.default.getStickers();return n&&n[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),p.stickersToggle(null,!0),p.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return setTimeout((function(){f.default.checkStickers({force:!0})}),1e3),ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getStickersTabHTML:function(e){var t=(f.default.getStickers()||[])[e],n=window.isNewMail?16:8,i=[];if(t&&t.length)for(var a=0;a<t.length/n;a++)i.push(t.slice(a*n,a*n+n));var o=i.map((function(e){return e&&Object(c.isArray)(e)?'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map((function(e){var t=p.fromStickerToObject(e),n=t.id,i=t.size,a=t.url,o=t.animationUrl,r=t.recent,s=t.ref,l="",c="";return o&&(l=" sticker_animation",c='\n          data-animation-path="'+o+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+l+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(r)+", '"+s+"');\"")+" "+c+'>\n              <img src="'+a+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '})).join("\n")+"\n          </div>\n        </div>\n      ":""})).join("\n"),r='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",s=i.map((function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '})).join("\n");return'\n        <div class="sp_cont scroller_wrap">\n          <div class="scroller_cont">\n            '+(t&&t.length?o:r)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(i.length>1?s:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),a=geByClass1("sp_body",i),o=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(a,p.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",o),addClass("sp_tab_selected",e);var r=getY(i),s=r+getW(i),l=scrollTop(),c=l+getCh();return(r<l||s>c)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),p.saveCurrentStickersPanelToCache(),window.isNewMail&&p.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){window.cur;var i=gpeByClass("sticker_item",e);if(f.default.getStickers()&&i){var a=Object.keys(f.default.getStickers()).reduce((function(e,n){return e||f.default.getStickers()[n].find((function(e){return p.fromStickerToObject(e).id===t}))}),null);if(!a)throw new Error("Sticker "+t+" not found");var o=p.fromStickerToObject(a),r=o.id,l=o.size,c=o.url,u=o.animationUrl,_=f.default.getStickers()[-1]||[];(_=_.filter((function(e){return p.fromStickerToObject(e).id!==r}))).unshift(p.fromObjectToSticker({id:r,size:l,url:c,animationUrl:u,recent:1,ref:"recent"})),_=_.filter((function(e,t){return t<(window.isNewMail?16:8)})),f.default.setStickerTab(-1,_);var h=-1;if(!n){var m=Object(s.$)(".stickers_panel .sp_tab_selected"),v=m&&m.className.split(" ").find((function(e){return/sp_tab.([0-9])*/.test(e)})).split("sp_tab")[1];Object(d.isNumber)(+v)&&(h=+v)}p.stickersSelectTab(!1,h)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&p.onStickerClick(t,i))return p.addRecentSticker(e,t,!1),!1;var a=window.cur;if(a.scroller&&!a.scroller.canClick())return!1;p.stickersToggle(e,!1);var o=ge("write_submit"),r={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(r.url_params.media_from="recent"),a.ref&&(r.url_params.ref=a.ref,a.ref=void 0),a.refSource&&(r.url_params.ref_source=a.refSource,a.refSource=void 0),!i){var s=attr(e,"href");s&&(i=s.split("sticker_referrer=")[1].split("&")[0])}return i&&(r.url_params.sticker_referrer=i),p.addRecentSticker(e,t,n),o?ajax.click(o,extend({save:!0},Dialog),r):(o=ge("nc_submit"))?(setTimeout((function(){Replies.setCurrentTimestamp(0)}),0),ajax.click(o,{},r)):void 0},toggleMarkAsAds:function(e,t){var n=Object(s.$)("input[name='from_group']");if(n&&!n.checked)return cancelEvent(t);var i=Object(s.$)("input",e);if(i.disabled)return cancelEvent(t);var a=Object(s.$)("input[name='mute_notifications']");a&&(a.checked=i.checked,a.disabled=i.checked),p.checkCopyright()},toggleDonut:function(e,t){var n=Object(s.$)("input[name='from_group']");if(!n||n.checked){var i=Object(s.$)("#feed_add_form"),a=Object(s.$)('input[name="donut_only"]'),o=Object(s.$)("#select-donut-duration"),u=Object(s.$)('[name="'+l.POST_PARAM_DONUT_DURATION+'"]',i),d=!a.checked,_=Object(s.$)("input",o);Object(r.setFieldIgnored)(u,d),o.classList.toggle("post__select_hidden",d),Object(c.domData)(_,"ignore-field",d);var f=Object(s.$)("input[name='marked_as_ads']");if(f){var p="1"===Object(c.domData)(f,"value");a.checked?(Object(c.domData)(f,"value",f.checked?"1":"0"),f.checked=!1):(Object(c.domData)(f,"value",null),f.checked=p),f.disabled=a.checked}}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input"),i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications","donut_only"]},a=Object(s.$)("input[name='marked_as_ads']");Object(s.$)("input[name='donut_only']");$$(".Control.Control_type_switcher.Row").forEach((function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)(n.checked&&!i.group.includes(t.name)||!n.checked&&i.user.includes(t.name))&&(t.disabled=!n.checked),"mute_notifications"===t.name&&a&&a.checked&&(t.disabled=!0);else{var o=Object(s.$)(".header__user"),r=Object(s.$)(".header__group"),l=Object(s.$)("#select-timer"),c=Object(s.$)("input[name=postpone]"),u=Object(s.$)("input#add_post_btn");if(n.checked?(o.classList.add("header_hidden"),r.classList.remove("header_hidden"),l.style.display="inline-block",c.disabled=!1):(o.classList.remove("header_hidden"),r.classList.add("header_hidden"),l.style.display="none",c.disabled=!0),u){var d=u.value;u.value=u.dataset.value,u.dataset.value=d}}}})),p.checkCopyright()},checkCopyright:function(){var e=Object(s.$)("input[name='marked_as_ads']"),t=Object(s.$)("input[name='from_group']"),n=ge("select-copyright"),i=Object(s.$)('input[name="copyright"]'),a=Object(s.$)(".create_post__source-option");if(n){var o=Object(s.$)(".Btn",a),r=Object(s.$)(".Btn__text",o);e&&e.checked&&(!t||t.checked)?(hide(n),attr(o,"disabled",!0),a.classList.add("create_post__source-option--disabled"),r.innerHTML=getLang("mobile_wall_post_copyright_add_button")):(attr(o,"disabled",!1),a.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),r.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):r.innerHTML=getLang("mobile_wall_post_copyright_add_button"))}}};t.default=p,window.post=p},HGMY:function(e,t,n){"use strict";n.r(t),n.d(t,"MailPreSendList__Msg",(function(){return o})),n.d(t,"getElem",(function(){return s})),n.d(t,"setMsgs",(function(){return l})),n.d(t,"addMsg",(function(){return c})),n.d(t,"removeMsg",(function(){return u})),n.d(t,"getMsg",(function(){return d}));n("TYsd");var i=n("/Id8"),a=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}};function o(e){var t=store.mail,n=t.members[e.authorId],a=e.peerId,o=t.peers[a],r=Object(i.Msg__authorName)(n,a,t.cur.userId);return Object(i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:r,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:o.isChannel&&o.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,ts:e.ts,maxDepth:store.mail.cur.maxMsgDepth})}var r=n("UxAg");function s(){return Object(r.$)(".MailPreSendList__box")}function l(e){s().innerHTML=e.map((function(e){return o(e)})).join("")}function c(e){s().insertAdjacentHTML("beforeend",o(e)),MailScrap.peerGoToBottom()}function u(e){var t=i.default.getElem(e.sendId);t&&t.remove()}function d(e){return i.default.getElem(e.sendId)}t.default=a},"HN+/":function(e,t,n){var i=n("vOyG"),a=i.length;function o(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}e.exports=function(e,t){var n=e.nodeType,r=e.nodeName;1===n&&function(e,t){for(var n=t.attributes,i=e.attributes,a=null,o=null,r=null,s=null,l=i.length-1;l>=0;--l)s=i[l],r=s.name,a=s.namespaceURI,o=s.value,a?(r=s.localName||r,t.getAttributeNS(a,r)!==o&&t.setAttributeNS(a,r,o)):t.hasAttribute(r)?t.getAttribute(r)!==o&&("null"===o||"undefined"===o?t.removeAttribute(r):t.setAttribute(r,o)):t.setAttribute(r,o);for(var c=n.length-1;c>=0;--c)!1!==(s=n[c]).specified&&(r=s.name,(a=s.namespaceURI)?(r=s.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttributeNS(null,r)||t.removeAttribute(r))}(e,t);3!==n&&8!==n||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);"INPUT"===r?function(e,t){var n=e.value,i=t.value;o(e,t,"checked"),o(e,t,"disabled"),n!==i&&(t.setAttribute("value",n),t.value=n);"null"===n&&(t.value="",t.removeAttribute("value"));e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===r?function(e,t){o(e,t,"selected")}(e,t):"TEXTAREA"===r&&function(e,t){var n=e.value;n!==t.value&&(t.value=n);if(t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t);!function(e,t){for(var n=0;n<a;n++){var o=i[n];e[o]?t[o]=e[o]:t[o]&&(t[o]=void 0)}}(e,t)}},HdGT:function(e,t,n){"use strict";n.r(t),n.d(t,"onStopped",(function(){return v})),n.d(t,"onSent",(function(){return g})),n.d(t,"onFailed",(function(){return A})),n.d(t,"onCaptcha",(function(){return b})),n.d(t,"onErrorMessage",(function(){return y})),n.d(t,"onMessage",(function(){return w})),n.d(t,"onMessageRemove",(function(){return S})),n.d(t,"QUEUE_MAX_FAILS",(function(){return k})),n.d(t,"QUEUE_NAME",(function(){return O})),n.d(t,"ready",(function(){return C})),n.d(t,"getItems",(function(){return j})),n.d(t,"send",(function(){return E})),n.d(t,"retry",(function(){return T})),n.d(t,"remove",(function(){return I}));var i=n("W38l"),a=n("OcsD"),o={},r={};function s(e,t){var n=o[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),d(e)}function l(e){var t=o[e];t.failed=t.failed.concat(t.pending),t.pending=[],r[e]="idle",t.sendingItemId=null,t.onStopped(),d(e)}function c(e){var t=o[e];return t.loaded?Promise.resolve():(t.retrieving||(t.retrieving=function(e){return new Promise((function(t){var n=Object(a.lsGet)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter((function(e){return!!n.items[e]})),n.pending=[],t(n)}))}(e).then((function(t){var n=t.pending,i=t.failed,a=t.items,r=o[e];r.retrieving=null,r.loaded=!0,r.pending=n,r.failed=i,r.items=a}))),t.retrieving)}function u(e,t){if(!1!==navigator.onLine){var n=o[e];if("sending"!==r[e]&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],a=n.items[i];if(!a.fails||t)r[e]="sending",n.sendingItemId=i,n.onSend(a.id,a.data);else{var s=Math.pow(2,Math.max(a.fails-2,0));n.backoffTimer=setTimeout((function(){n.backoffTimer=null,u(e,!0)}),1e3*s)}}}}function d(e){var t=o[e],n=t.pending,i=t.failed,r=t.items;Object(a.lsSet)("q_"+e,{pending:n,failed:i,items:r})}window.addEventListener("online",(function(){Object.keys(o).forEach((function(e){u(e)}))}));var _,f,p=n("qHA9"),h=n("+cqQ"),m=n("j80l"),v=Object(h.default)(),g=Object(h.default)(),A=Object(h.default)(),b=Object(h.default)(),y=Object(h.default)(),w=Object(h.default)(),S=Object(h.default)(),k=5,O="mail_send";function C(){return c(O)}function j(){return{pending:(e=o[O]).pending,failed:e.failed,items:e.items};var e}function E(e){C().then((function(){var t;i.logQueueSize((t=o[O])?t.pending.length:0);var n=Object(p.sendDataToMessage)(e);!function(e,t,n){var i={id:t,data:n,fails:0},a=o[e];s(e,t),a.items[t]=i,a.pending.push(t),u(e),d(e)}(O,n.sendId,{data:e}),w(n)}))}function T(e,t){var n,i=(n=e,o[O].items[n]||null);t&&(i.data=t(i.data)),s(O,e),E(i.data.data)}function I(e,t){s(O,e),"silent"!==t&&S(e)}f={onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",a="edit_message"===e.act;a?Object.keys(e).forEach((function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]})):(n=Object(m.makeUrl)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach((function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t||delete e[t]}))),i.log(t,a?"edit":"send");var s=function(e){var n,s,l;i.mark(t,"server"),a&&!e.was_modified&&S(t),g(),s=o[n=O],(l=s.sendingItemId)&&(s.pending[0]===l&&s.pending.shift(),delete s.items[l]),r[n]="idle",s.sendingItemId=null,u(n),d(n)};Object(p.mailRequest)(n,e).then(s,(function e(n){var a=n.type,c=n.code,d=n.message,_=n.data;if(i.error(t,"server_send",a),"captcha"!==a&&i.clean(t),"server"===a&&c&&c!==p.UNKNOWN_ERROR)return d&&y(d),void l(O);"captcha"!==a?(function(e){var t=o[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void l(e)}r[e]="idle",t.sendingItemId=null,u(e)}(O),A()):b(_,(function(n){if(!n)return i.clean(t),void l(O);n.then(s,e)}))}))}(t.data,e)},onStopped:v,maxFails:k},o[_=O]={pending:[],failed:[],items:{},onSend:f.onSend,onStopped:f.onStopped,maxFails:0|f.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},r[_]="idle"},I2ZF:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,a=n;return[a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]]].join("")}},I7Du:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=e.on_change;return{class:[e.mix||e.class,i.default.class("Select",{disabled:e.disabled})],inner:[{class:"Select__native",tag:"select",name:e.name,disabled:e.disabled,onchange:e.nativeOnChange?e.onChange:t?["Select._onChange","this",t]:null,required:e.required,inner:e.options.map((function(e){return e?{class:"Select__option",tag:"option",value:e.value,selected:e.selected?"selected":null,inner:e.label,attrs:e.attrs}:null}))}]}};t.default=a},IetZ:function(e,t,n){"use strict";n.r(t),n.d(t,"cutTextToHighlight",(function(){return i}));function i(e){var t=null;document.querySelectorAll(e+":not(.cutTextToHighlight)").forEach((function(e){if(e.classList.add("cutTextToHighlight"),null===t){var n=getComputedStyle(e).font;i=n,(a=document.createElement("canvas").getContext("2d")).font=i,t=function(e){var t=a.measureText(e).width;return Math.ceil(t)}}var i,a;e.innerHTML=function(e,t,n){void 0===n&&(n="…");var i=e.querySelector(".highlight");if(!i)return e.innerHTML;var a=e.innerHTML.indexOf('<em class="highlight">');if(i.offsetLeft+i.offsetWidth<=e.offsetWidth-15)return e.innerHTML;if(i.offsetWidth<e.offsetWidth-15){for(var o=0,r="",s=a;s>0&&o+i.offsetWidth<=e.offsetWidth;){var l=e.innerHTML.lastIndexOf(" ",s-1);if(-1===l&&(l=0),r=e.innerHTML.substring(l,s)+r,!((o=t(n+r.trim()))+i.offsetWidth<=e.offsetWidth-15))break;s=l}a=s}if(a>0)return n+e.innerHTML.substring(a).trim();return e.innerHTML}(e,t)}))}},JCKH:function(e,t,n){"use strict";n.r(t),n.d(t,"GroupCallSnippet",(function(){return a})),n.d(t,"GroupCallSnippetSkin",(function(){return s}));var i=n("chpQ"),a={join:function(e){i.EduIntegration.isIntegrated&&i.EduIntegration.embedded.sendMessage("call_join",{callData:e,peerId:store.mail.cur.peerId})}},o=n("Y6JH"),r=n("fdw3");function s(e){var t=e.data,n=t?{inner:[Object(r.getLang)("mobile_mail_snippet_groupcall_connect")],class:"GroupCallSnippet__link",tag:"div"}:{inner:[Object(r.getLang)("mobile_mail_snippet_groupcall_ended")],class:"GroupCallSnippet__ended",tag:"div"};return{inner:[{inner:[Object(o.default)({sprite:"mail",name:"phone_24"})],class:"GroupCallSnippet__left",tag:"div"},{inner:[{inner:[Object(r.getLang)("mobile_mail_snippet_groupcall_title")],class:"GroupCallSnippet__title",tag:"div"},n],class:"GroupCallSnippet__main",tag:"div"}],class:"MailButton GroupCallSnippet",type:"button",onClick:t?["GroupCallSnippet.join",t]:"",tag:"button"}}window.GroupCallSnippet=a},KMpi:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=n("fdw3"),r=function(e){var t,n,r=e.photos||[e.photo],c=(r=Object(o.isArray)(r)?r:[r]).length,u=!!e.isContact,d="";if(u&&e.name)d+=function(e){for(var t="",n=e.split(" "),i=n.length,a=0;a<i;a++)t+=n[a].substr(0,1);return'<div class="Avatar__contact">'+(t=t.substr(0,2))+"</div>"}(e.name);else if(c>1)for(var _=0;_<c;_++)d+=s(r[_],_);n=40===e.size?"m":36===e.size?"s":e.size?e.size:"xl";return Object(a.default)({mix:i.default.class(e.mix,"Avatar",(t={},t[c]=!0,t.size=n,t)),url:u?"":e.url,attrs:1===c?l(r[0]):"",inner:d})};function s(e,t){var n;return Object(a.default)({mix:i.default.class("Avatar__image",(n={},n[t]=!0,n)),attrs:l(e)})}function l(e){return i.default.attr("style","background-image: url('"+e+"')")}t.default=r;window.Avatar=r},KiYr:function(e,t,n){"use strict";n.r(t);var i=n("LmmP");t.default=i.default},L9Nh:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"QueueManager",(function(){return QueueManager}));var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("wx14"),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("OcsD"),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t]},QueueManager.start=function(){QueueManager.started||(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach((function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))})),curNotifier.lpMakeRequest&&curNotifier.lpMakeRequest(curNotifier.frame_url,params,(function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}),(function(){return!0}))},QueueManager.init=function(e){window.curNotifier=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.default)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__.createIframe)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path});var t=setInterval((function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())}),500);setTimeout((function(){return clearInterval(t)}),1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},LmmP:function(e,t,n){"use strict";n.r(t),n.d(t,"Alert",(function(){return a}));var i=n("z9sQ");function a(e){return{inner:[e.title?{inner:[e.title],class:"Alert__title",tag:"div"}:null,{inner:[e.text||e.inner],class:"Alert__description",tag:"div"}],class:[e.class,i.default.class("Alert",{theme:e.theme})].join(" "),tag:"div"}}t.default=a},Mc5h:function(e,t,n){"use strict";n.r(t);var i=n("2IoG");t.default=i.default,window.Brick=i.default},MzAf:function(e,t){function n(e){return function(t){t.$control.closest(a.sms).classList.toggle(o[e])}}function i(e,t){var n=t.$select,i=t.value;n.closest(a.sms).classList.toggle(o.pmUsersVisible,e.includes(i)||e.includes(Number(i)))}window.SettingsSms={},SettingsSms._onEnabledChange=n("enabled"),SettingsSms._onTimeLimitedChange=n("timeLimited"),SettingsSms._onFrequencyChange=i;var a={sms:".settingsSms"},o={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},N4ZS:function(e,t,n){"use strict";function i(e){return"https://vk.com/web/away.php?to="+e}function a(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return i})),n.d(t,"wrapAwayIfExternal",(function(){return a}))},O5lf:function(e,t,n){"use strict";n.r(t);var i=n("9y81"),a=n("Y6JH"),o=n("z9sQ"),r=function(e){void 0===e&&(e={});var t=e.mix||"",n="pageLoader"===(e.type||"gray"),r=o.default.class("Spinner",{pageLoader:n,hidden:e.isHidden,fixed:e.isFixed},"--"),s=t+" "+r;if(n)return Wd.html({inner:[Object(a.default)("wall","loading_40")],class:s,tag:"div"});return Object(i.default)({mix:s,icon:"spinner"})};var s=n("jE6c");var l={show:function(e){Object(s.isElement)(e)&&e.classList.remove("Spinner--hidden")},hide:function(e){Object(s.isElement)(e)&&(e.classList.contains("Spinner--hidden")||e.classList.add("Spinner--hidden"))}};Object.assign(r,l),window.Spinner=r;t.default=r},OGWK:function(e,t){window.SubscribeBtn={onClick:function(e,t,n,i,a,o){try{var r=o+"_unsubscribe",s=o+"Icon",l=o+"Icon_unsubscribe",c=o+"Icon_subscribe",u=hasClass(e,r),d=u?i:n,_=u?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),f=!u,p=geByClass1(s,e),h=function(e){var t=intval(domData(e,"block-id"));if(!t){var n=domCA(e,".feedAssistance");t=intval(domData(n,"block-id"))||null}return t}(e),m=domData(e,"from")||null;p&&(toggleClass(l,p,f),toggleClass(c,p,!f)),attr(e,"aria-label",escapeAttr(_)),toggleClass(r,e,f),"group"===a?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(t,d,u):function(e,t,n,i,a){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,a)}(t,d,u,m,h)}catch(e){console.trace(e)}return!1}}},PU8N:function(e,t,n){"use strict";n.r(t),n.d(t,"isMvk",(function(){return a})),n.d(t,"getVideoDuration",(function(){return o})),n.d(t,"getMediaBlob",(function(){return r})),n.d(t,"getBlobType",(function(){return s})),n.d(t,"noop",(function(){return l})),n.d(t,"getAverageRGB",(function(){return c})),n.d(t,"loadImage",(function(){return u})),n.d(t,"loadImages",(function(){return d})),n.d(t,"loadFontFace",(function(){return _})),n.d(t,"loadFontFacePromise",(function(){return f})),n.d(t,"getCroppedImage",(function(){return p}));var i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){return!!window.isMVK}function o(e){return void 0===e&&(e=""),new Promise((function(t,n){var i=document.createElement("video");i.addEventListener("loadedmetadata",(function(){return t(i.duration)}),{once:!0}),i.addEventListener("error",n,{once:!0}),i.crossOrigin="anonymous",i.preload="metadata",i.src=e}))}function r(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(404===i.response.status)return n();t(i.response)},i.onerror=n,i.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var l=function(){};function c(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var i=-4,a=0;(i+=20)<t.data.length;)++a,n.r+=t.data[i],n.g+=t.data[i+1],n.b+=t.data[i+2];return n.r=~~(n.r/a),n.g=~~(n.g/a),n.b=~~(n.b/a),n}function u(e){return new Promise((function(t,n){var i=new Image;i.crossOrigin=e.startsWith("data:")?null:"Anonymous",i.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},i.onload=function(){return t(i)},i.src=e}))}var d=function(e){return new Promise((function(t){var n=e.map((function(e){return u(e)}));Promise.all(n).then((function(e){return t(e)})).catch((function(){}))}))};function _(e,t){var n,i,a,o,r,s,l,c,u={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},_={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function f(e){var t=[];return each(e,(function(e,n){t.push(e+":"+n)})),t.join(";")}function p(e,t,n){return Math.abs(e.width-t.offsetWidth)>n||Math.abs(e.height-t.offsetHeight)>n}function h(){o||(utilsNode.appendChild(r),o=!0,a={sansSerif:{width:l.offsetWidth,height:l.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(l.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(l,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),o&&a&&(p(a.sansSerif,l,t.tolerance)||p(a.serif,s,t.tolerance))?(re(r),t.success()):(new Date).getTime()-i.getTime()>t.timeout?(re(r),t.error()):!o&&"requestAnimationFrame"in window?window.requestAnimationFrame(h):window.setTimeout(h,t.delay)}for(var m in d)t.hasOwnProperty(m)||(t[m]=d[m]);_["font-weight"]=t.weight,_["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(n=setTimeout((function(){t.error()}),t.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(i){i.family.toLowerCase()===e.toLowerCase()&&(u[i.weight]||i.weight)===""+t.weight&&i.style===t.style&&i.load().then((function(){t.success(),clearTimeout(n)}))}))}(n)):(c="AxmTYklsjo190QW"+t.glyphs,i=new Date,r=ce("div"),l=ce("div",{innerHTML:c}),s=ce("div",{innerHTML:c}),l.setAttribute("style",f(extend({"font-family":"sans-serif"},_))),s.setAttribute("style",f(extend({"font-family":"serif"},_))),r.appendChild(l),r.appendChild(s),h())}function f(e,t){return new Promise((function(n,a){_(e,i(i({},t),{glyphs:"",success:function(){var e=function(){n(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){a(),(null==t?void 0:t.error)&&t.error()}}))}))}function p(e,t,n,i,a){return new Promise((function(o,r){("string"==typeof e?u(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var l=s.getContext("2d");if(l){l.drawImage(e,0,0);var c=l.getImageData(t,n,i,a),d=document.createElement("canvas");d.width=i,d.height=a;var _=d.getContext("2d");if(_)return _.putImageData(c,0,0),u(d.toDataURL("image/jpeg",1)).then(o).catch(r);o(e)}else o(e)})).catch(r)}))}},PUg3:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("Mc5h"),s=n("9y81"),l=n("AXyT"),c=n("gy8s"),u=n("29dZ"),d=n("Y6JH"),_=n("/Id8"),f=(n("BoyB"),n("fdw3"));function p(){var e=Object(i.default)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return g=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return A=function(){return e},e}function b(){var e=Object(i.default)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return w=function(){return e},e}function S(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return S=function(){return e},e}function k(){var e=Object(i.default)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return k=function(){return e},e}function O(){var e=Object(i.default)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n      </div>\n    "]);return O=function(){return e},e}var C=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel)return"";var l=i.kickedMessage||e.mobile_msg_mail_privacy_error,u=Object(s.default)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"});return a.default.html(O(),u,l)}var _=a.default.onSubmit("uMailWrite._onSubmit","event","this"),p=a.default.onClick("uMailWrite.onToBottomClick"),h=Object(r.default)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:""}),m=T(null),v=I(n),y=function(e){var t=window.lang,n=store.mail,i=n.cur,r=n.queue,l=a.default.onMouseDown("uMailWrite._onStickersClick","event"),u=a.default.onMouseDown("uMailWrite._onKeyboardClick","event"),_=n.peers[e],p=i.groupId,h=Math.abs(p),m=p?"&community="+h:"",v=!Object(f.isEduIntegration)(),g=!Object(f.isEduIntegration)()&&_.canSendGift,b=!Object(f.isEduIntegration)()&&_.canSendGift,y=!Object(f.isEduIntegration)(),S=Object(f.isEduIntegration)(),k=Object(f.isEduIntegration)(),O=!Object(f.isEduIntegration)(),C=Object(c.default)({icon_html:o.default.html(Object(d.default)("base","attach_outline_28")),name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:Object(d.default)("mail-attachments","picture_outline_28"),attrs:a.default.onClick("mediaUpload.onUnfoldItemClick","event","this")},O?{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+m,icon:Object(d.default)("mail-attachments","camera_outline_28")}:null,S?{text:t.mobile_attachments_add_device_video,icon:Object(d.default)("mail-attachments","video_outline_28"),attrs:a.default.onClick("EduIntegration.embedded.sendMessage","attach_video",{peerId:e})}:null,y?{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+m,icon:Object(d.default)("mail-attachments","video_outline_28")}:null,v?{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+m,icon:Object(d.default)("mail-attachments","music_outline_28")}:null,{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+m,icon:Object(d.default)("mail-attachments","document_outline_28")},k?{text:t.mobile_attachments_add_device_document,icon:Object(d.default)("mail-attachments","document_outline_28"),attrs:a.default.onClick("EduIntegration.embedded.sendMessage","attach_document",{peerId:e})}:null,g?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:Object(d.default)("mail-attachments","gift_outline_28")}:null,b?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+m,icon:Object(d.default)("mail-attachments","money_transfer_outline_28")}:null,_.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+m,icon:Object(d.default)("mail-attachments","poll_outline_28"),mix:"uMailWrite__pollUnfoldItem"}:null]}),j=a.default.onKeyUp("uMailWrite._onKeyUp"),T=a.default.onInput("uMailWrite._onInput","event","this"),I=a.default.onKeyDown("uMailWrite._onKeyDown","event","this"),M=a.default.onFocus("uMailWrite._onFocus","event","this"),P=a.default.onBlur("uMailWrite._onBlur","event","this"),x=a.default.onClick("uMailWrite._onClick","event","this"),L=a.default.onTouchEnd("uMailWrite._onSendTouchEnd","event","this"),B=o.default.html({class:"uMailWrite__buttonSendIcon Icon_send",inner:Object(d.default)("base","send_outline_28")}),R=o.default.html({class:"uMailWrite__buttonSendIcon Icon_send Icon_active",inner:Object(d.default)("base","send_outline_28")}),D=E("accept"),N=E("remove"),H=E("templates"),V=E("templatesActive"),U=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"}),F=o.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker",inner:Object(d.default)("base","smile_outline_28")}),$=o.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker Icon_active",inner:Object(d.default)("base","smile_outline_28")}),W=a.default.html(A()),q=_.attachmentsHTML.length,z=i.msgAttached[i.peerId],Y=z&&z.length,G=!!(r[i.peerId]||[]).length,Q=a.default.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(q>150||Y),loading:G});return a.default.html(w(),C,u,W,l,F,$,Q,L,B,R,U,D,N,H,V,t.mobile_mail_message_placeholder,M,j,T,I,M,P,x)}(n),S=a.default.html(b()),C=function(){var e=window.lang,t=Object(s.default)({icon:"plus"}),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,o="/mail?act=template&from="+n+i,r=a.default.onClick("uMailWrite.loadTemplatePage","event","this",o);return a.default.html(g(),e.mobile_mail_templates_panel_title,o,r,t)}(),M=j(),P=a.default.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});return a.default.html(k(),P,n,i.hashSend,t.cur.communityParam,_,p,M,m,v,y,h,S,C)};function j(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,o=i?Object(l.default)({mix:"uMailWrite__toBottomValue",value:i}):"",r=Object(s.default)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"});return a.default.html(S(),o,r)}function E(e){return a.default.html(y(),e)}function T(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,o=t.msgReply[i],r=null;o&&(r=store.mail.forwards[o]||store.mail.msgs[o]);var s="",l="";if(r){var c=Object(_.Msg__authorName)(n[r.authorId],i,t.userId);s=Object(_.Msg__reply)(r,c,e),l='\n      <input type="hidden" name="attached_messages" value="'+o+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(l+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=a.default.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:a.default.onClick("uMailWrite.onReplyClose")});return a.default.html(v(),u,s,d,l)}function I(e){var t,n=store.mail,i=n.cur,o=n.peers[e].attachmentsHTML,r=a.default.class("uMailWrite__attachments",((t={})[e]=!0,t)),l=i.msgAttached[e]||[],c=l.length,u="";c>0&&(u=function(e,t){var n=window.lang,i=a.default.onClick("uMailWrite.onAttachedMsgsRemove"),o=Object(s.default)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"}),r=Object(s.default)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i}),l=langNumeric(e,n.mobile_mail_messages),c=function(e){return a.default.html(p(),e)}(t);return a.default.html(h(),c,r,o,l)}(c,l.join(";")));return a.default.html(m(),r,u,o)}var M=n("UxAg"),P=n("+cqQ"),x=n("jk6M"),L=n("rKp0"),B=n("V4qE"),R=n("HGMY"),D=n("t7Ww"),N=n("r/ag");function H(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((function(e,t){return e+t})))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}var V=n("N4ZS"),U=n("9M99"),F=n("H5mD"),$=n("aiw/"),W=n("Qz23"),q=n("jE6c"),z=n("UlUB"),Y=n("hw56"),G=n("j80l"),Q=n("wcVR"),K=n("B+U2");function X(e){var t=e.length,n=!t;return o.default.html([J(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map((function(e,n){return function(e,t,n){var i=t>0&&t===n-1,r=store.mail.cur.communityParam,s=store.mail.cur.peerId,l=e.name,u=e.text;l=Object(U.emojiToHTML)(l),u=Z(u,!0);var d="_touched uMailWrite__templatesRow";d+=" uMailWrite__templatesRow"+e.id,e.deleting&&(d+=" uMailWrite__templatesRow_hidden");return{class:d,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:o.default.html(l)},{class:"uMailWrite__templatesRowText",inner:o.default.html(u)}]},{class:"uMailWrite__templatesRowMore",inner:[o.default.wrap(Object(c.default)({mix:"",icon:"more",position:i?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+r+"&from="+s},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:a.default.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)}))}])}function J(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=a.default.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},Object(u.default)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function Z(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,a=store.mail.cur,o=i[a.peerId],r=i[a.userId],s=i[a.groupId],l=o.raw_name.replace(o.firstName,"").trim(),c=r.raw_name.replace(r.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,o.firstName)).replace(/{user surname}/g,l)).replace(/{admin name}/g,r.firstName)).replace(/{admin surname}/g,c)).replace(/{community}/g,s.name)).match(/{greeting}/g)){var u,d=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());u=d>=3&&d<12?lang.mobile_mail_templates_greeting_morning:d>=12&&d<17?lang.mobile_mail_templates_greeting_afternoon:d>=17&&d<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,u)}return t&&(e=Object(U.emojiToHTML)(e)),e}var ee=n("HdGT"),te=n("qHA9"),ne=n("cZev"),ie=n("W9Tc");Object.assign(C,{onToBottomClick:Object(P.default)(),onAttachedMsgsRemove:Object(P.default)(),onReplyClose:Object(P.default)(),onMessage:Object(P.default)(),showToBottom:function(){if(de)return;_e&&(clearTimeout(_e),_e=null);addClass("uMailWrite__toBottom_visible",Object(M.$)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(null),_e=setTimeout((function(){removeClass("uMailWrite__toBottom_visible",Object(M.$)(".uMailWrite__toBottom"))}),100)},preventShowToBottom:function(){de=!0,setTimeout((function(){de=!1}),300)},openStickersPanel:Ee,redrawReply:Fe,uiRedrawAttachments:$e,redrawToBottom:function(){Object(M.$$)(".uMailWrite__toBottom").forEach((function(e){return e.innerHTML=j()}))},drawStickers:Oe,setModifiers:function(e){Object(M.$$)(".uMailWrite").forEach((function(t){var n=a.default.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",a.default.class("uMailWrite",Object.assign({},n,e)))}))},hideStickersPanel:je,setText:rt,renderKeyboardIfNeeded:lt,openKeyboard:ut,init:function(){var e=store.mail,t=e.cur,n=e.msgs,i=e.pendingReplies,a=t&&Object(Y.getPeerDraft)(t.viewerId,t.peerId);a&&!t.editing&&a.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;Object(M.$$)(".uMailWrite__textarea").forEach((function(e){return e.value=n}));var i=Object(M.$)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");ve()}(a.text);"templates"===Object(Y.getKeyboardType)()?Be():lt();mt(),be(),a&&!t.editing&&Array.isArray(a.msgs)&&(t.msgAttached[t.peerId]=a.msgs);if(a&&!t.editing&&isFinite(a.reply)){var o=_.default.getReplyDataFromHTML(a.reply);o&&(t.msgReply[t.peerId]=a.reply,i[a.reply]=o)}Fe(),$e(t.peerId),Object.keys(n).forEach((function(e){CasperTimer.init(e)})),Object(M.$$)(".uMailWrite__textarea").forEach((function(e){Object(W.setScrollView)(e,{topBanner:!1,overscrollY:!1})})),Object(M.$$)(".uMailWrite__attachments").forEach((function(e){Object(W.setScrollView)(e,{topBanner:!1,allowY:!1})}))},reset:function(){Object(Y.setKeyboardType)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)}}),uVK.onReady(Ae),C._onBlur=Ze,C._onKeyUp=ze,C._onKeyDown=Ke,C._onFocus=Je,C._onInput=Ye,C._onSubmit=We,C._onClick=Xe,C._onAttachClick=De,C._onStickersClick=Ce,C._onKeyboardClick=Te,C._onKeyboardButtonClick=Ie,C._onDeleteTemplate=_t,C._onConfirmDeleteTemplate=ft,C._onSendTouchEnd=qe,C._onRetryFailedMsg=gt,C._onDeleteFailedMsg=At,C._onCancelPendingMsg=bt,C._onConfirmSendGeo=Me,mediaUpload.onRemove(ye),mediaUpload.onComplete(ke),mediaUpload.onStart(we),mediaUpload.onError(Se),post.onStickersTabSelected(Ne),post.onStickerClick(He),ne.default.onStickerPanelUpdate(Ve),ee.onSent(ht),ee.onErrorMessage(yt),_.default.onPendingClick(vt),c.default.onOpen("uMailWrite_attachments")(me),C.onToBottomClick((function(){var e=Object(M.$)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),L.default.removeDivider()})),C.onReplyClose((function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,Object(Y.setPeerDraft)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),Fe()})),C.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some((function(e){if(e.id===n)return i=e,!0})),i&&rt(Z(i.text)))},Mention.onOpen((function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},(function(e){Object.assign(store.mail.members,e);var t=Ge(n);Mention.update({items:t,defaultItems:t})}),(function(){t[n]=!1})))}}));var ae,oe,re="uMailWrite__popupAttach_open",se="uMailWrite__popupStickers_open",le="uMailWrite_canAttachPoll",ce=".uMailWrite",ue=".attachment_type_poll",de=!1,_e=null,fe=[],pe=Object(z.throttle)(tt,100),he=Object(z.throttle)(et,1e3);function me(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}Object(M.$$)("a.Unfold__item").forEach((function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)})),Object(M.$$)("input.inline_upload").forEach((function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))}))}function ve(){var e=Object(M.$)(".uMailWrite__textareaGhost").offsetHeight;Object(M.$$)(".uMailWrite__textarea").forEach((function(t){return setStyle(t,"height",e)})),Object(M.$$)(".uMailWrite__main").forEach((function(t){return setStyle(t,"height",e+8)})),Object(M.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(t){setStyle(t,"bottom",e+8+-5)})),tt()}function Ae(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,Object(M.$$)(".uMailWrite__attachments").forEach((function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)})),function(){var e=Object(M.$)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=Object(M.$)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",ot,!0):e.removeEventListener("mousedown",ot,!0)}()}}}function be(){var e=store.mail.cur;e&&e.peerId&&(fe=Ge(e.peerId),Mention.init({defaultItems:fe,items:fe,appendTo:geByClass1("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=Object(M.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,ve(),et(i,e.viewerId,e.peerId)}}))}function ye(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,$e(a)),e.closest(ue))Object(M.$)(ce).classList.add(le)}}function we(){store.mail.cur&&(Ae(),tt())}function Se(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&($e(n),Messenger.scrollConvoToBottom())}}function ke(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,tt())}}function Oe(){var e=store.mail.cur,t=Object(M.$)(".uMailWrite__popupStickers"),n=Object(ie.partConfigEnabled)("mvk_stickers_panel_optimize");e&&t&&!t.childElementCount&&(n?(ne.default.checkStickers(),t.innerHTML=ne.default.getStickerPanel("mail"+e.peerId),t.innerHTML||(e.waitingStickerPanel=!0)):t.innerHTML=e.stickersPanelHTML.replace(/mail0/g,"mail"+e.peerId),Object(M.$$)(".sp_body",t).forEach((function(e){Object(W.setScrollView)(e,{topBanner:!1})})),Object(M.$$)(".scroller_wrap",t).forEach((function(e){Object(W.setScrollView)(e,{topBanner:!1,allowY:!1})})),post.stickersSelectTab(null,-1))}function Ce(e){var t=Object(M.$)(".uMailWrite__popupStickers"),n=hasClass(se,t);e.preventDefault(),Oe(),dt("stickers"),n?je():Ee()}function je(){"stickers"===Object(Y.getKeyboardType)()&&Object(Y.setKeyboardType)("");var e=Object(M.$)(".uMailWrite__popupStickers");removeClass(se,e),nt(!1);var t=ge("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none"),domData(e,"need-update")&&(clog("[mail sticker panel] inject new sticker panel after close"),Ue(),domData(e,"need-update",null))}function Ee(){Object(Y.setKeyboardType)("stickers");var e=Object(M.$)(".uMailWrite__popupStickers");addClass(se,e),post.stickerPanelInit(),post.stickersInit(),nt(!0)}function Te(e){var t=Object(M.$)(".uMailWrite__keyboard"),n=hasClass("uMailWrite__keyboard_open",t);e.preventDefault(),dt("buttons"),n?Pe({store:!0}):xe({store:!0})}function Ie(e,t,n){var i,o,r=n.authorId,s=n.inline,l=n.msgId,c=JSON.parse(Object(q.replaceEntities)(n.action)),d=c.type,_=c.payload,f=c.rawLabel,p=store.mail,h=p.cur,m=p.members,v=p.peers,g=p.msgs,A=m[r],b=H();if(l){var y=g[l];i=y.peerId,o=y.conversationMsgId}else i=h.peerId;var w,S=v[i],k=f||"";if(i>=2e9)if(A.domain)w="@"+A.domain+" "+k;else{var O=A.url.replace(/^\//,"");w="@"+O+" ("+A.firstName+") "+k}else w=k;var C=d,j=s?"inline":"normal";if("open_app"===C&&(C="app"),statlogsValueEvent("message_send_from_keyboard",0,h.viewerId,i,r,C,j),"vkpay"!==d)if("open_app"!==d)if("open_link"!==d)if("location"!==d){if("callback"===d)return u.default.setLoading(e,!0,"spinner"),void ajaxRequest("/mail",{act:"sendEvent",peer_id:i,author_id:r,message_id:l,conversation_message_id:o,payload:_,hash:S.hashSend},(function(t){var n=t.result.event_id;clog("waiting for "+n+" event callback"),Object(Y.registerCallbackButtonEvent)(i,e,n,l)}),(function(){B.init({type:B.SNACKBAR_TYPE_ERROR,text:lang.mobile_unknown_error}),u.default.setLoading(e,!1)}));at({act:"send",to:i,from:"dialog",hash:S.hashSend,message:w,media:"",_af:h._af,random_id:b,payload:_}),s&&!h.peerId&&nav.go(Object(G.makeUrl)("/mail",{act:"show",peer:i,community:nav.getQuery("community")}))}else{Q.default.init()?(u.default.setLoading(e,!0,"blue"),Q.default.getCurrentPosition((function(t){var n=t.coords,o=n.latitude,r=n.longitude;u.default.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmSendGeo",o,r,_,w,i)})}),(function(){u.default.setLoading(e,!1),B.init({text:lang.mobile_mail_geo_not_available})}),{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):B.init({text:lang.mobile_mail_geo_not_available})}else{var E=c.link,T=Object(V.wrapAwayIfExternal)(E,!0);nav.hard_go(T)}else{var I=c.app_id,M=c.hash,P=Object(G.makeUrl)("/app"+I,{from:nav.cur.slice(1)});nav.go(P+"#"+M)}else{var x=c.hash,L=Object(G.makeUrl)("/app6217559",{from:nav.cur.slice(1)});nav.go(L+"#"+x)}}function Me(e,t,n,i,a){var o=store.mail,r=o.cur,s=o.peers[a],l=H();at({act:"send",to:a,from:"dialog",hash:s.hashSend,message:i,media:"",_af:r._af,random_id:l,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go(Object(G.makeUrl)("/mail",{act:"show",peer:a,community:nav.getQuery("community")}))}function Pe(e){"buttons"===Object(Y.getKeyboardType)()&&Object(Y.setKeyboardType)("");var t=Object(M.$)(".uMailWrite__keyboard");if(removeClass("uMailWrite__keyboard_open",t),it(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(ae[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",ae))}}function xe(e){Object(Y.setKeyboardType)("buttons");var t=Object(M.$)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass("uMailWrite__keyboard_open",t),it(!0);var i=Object(Y.getKeyboardState)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=o.default.render(Object(K.default)({keyboard:i.keyboard,pressed:wt(t.peerId)})),r=Object(M.$)(".uMailWrite__keyboard");r.innerHTML=a,Object(W.setScrollView)(r,{topBanner:!1}),Object(Y.getKeyboardState)(t.peerId).rendered=!0}(),e&&e.store&&Le()}function Le(){var e=store.mail.cur.peerId;Object(Y.clearCallbackButtons)(e),ae&&(delete ae[e],lsSet("mail_keyboard_hidden",ae))}function Be(){Object(Y.setKeyboardType)("templates");var e=Object(M.$)(".uMailWrite__templates");addClass("uMailWrite__templates_open",e),tt(),ct()}function Re(){"templates"===Object(Y.getKeyboardType)()&&Object(Y.setKeyboardType)("");var e=Object(M.$)(".uMailWrite__templates");removeClass("uMailWrite__templates_open",e),tt()}function De(e){var t=Object(M.$)(".uMailWrite__popupAttach"),n=Object(M.$)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(se,n)&&removeClass(se,n),hasClass(re,t)?removeClass(re,t):(addClass(re,t),addEvent(window,"click",(function e(n){removeClass(re,t),removeEvent(window,"click",e)})))}function Ne(){store.mail.cur&&(geByClass1("sp_body")&&(cur.scroller&&cur.scroller.destroy(),geByClass1("sp_body").scrollTop=0,removeClass("scroller_wrap",geByClass1("sp_cont")),geByClass("sp_page").forEach((function(e){return removeClass("scroller_page",e)}))))}function He(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,o=(geByClass1("uMailWrite"),Object(M.$)(".uMailWrite__popupStickers")),r=H(),s=0===t.indexOf("suggestion"),l={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:r,sticker_referrer:t};post.addRecentSticker(!1,e,!1);var c=i.msgReply[i.peerId];if(c&&(l.attached_messages=c,l.has_reply=!0,Object(Y.setPeerDraft)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),s){var u=Object(M.$)(".uMailWrite__textarea");u.value="",et("",i.viewerId,i.peerId),Ye({},u)}return at(l),tt(),Fe(),Object(M.$)(".sp_tab_selected",o).classList.contains("sp_tab-1")&&setTimeout((function(){post.stickersSelectTab(!1,-1)})),!0}}function Ve(){var e=Object(M.$)(".uMailWrite__popupStickers");if(!Object(ie.partConfigEnabled)("mvk_stickers_panel_optimize"))return!1;if(!e)return!1;clog("[mail sticker panel] received panel update event");var t=e.classList.contains("uMailWrite__popupStickers_open"),n=!e.innerHTML;t&&!n?domData(e,"need-update",1):(clog("[mail sticker panel] redraw closed sticker panel"),n&&Oe(),Ue())}function Ue(){var e=store.mail.cur,t=Object(M.$)(".uMailWrite__popupStickers");if(!t)return!1;var n=Object(M.$)("#stickers_panel");if(!n)return!1;var i=Object(M.$)(".sp_tab_selected",n),a=Array.from(i.classList).reduce((function(e,t){if(t.startsWith("sp_tab")){var n=parseInt(t.split("sp_tab")[1]);isNaN(n)||(e=n)}return e}),0);return t.innerHTML=ne.default.getStickerPanel("mail"+e.peerId),post.stickersSelectTab(!1,a),!0}function Fe(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var o=n[i];o&&(a=o.preview_url)}else{var r=i&&_.default.getElem(i);if(r){var s=Object(M.$)(".thumbs_map .thumb_map_img_as_div",r);(a=s&&s.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}Object(M.$$)(".uMailWrite__reply").forEach((function(e){e.outerHTML=T(a)}))}function $e(e){Object(M.$$)(".uMailWrite__attachments_"+e).forEach((function(t){t.outerHTML=I(e)})),Ae(),Object(M.$)(".uMailWrite__textarea")&&tt();var t=Object(M.$)(ce);if(t){var n=!!t.$(ue);t.classList.toggle(le,!n)}}function We(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=Object(M.$)(".uMailWrite__textarea"),i=store.mail,a=i.cur,o=i.peers,r=H(),s=store.mail.cur.editing,l=s&&store.mail.msgs[s],c=l?{act:"edit_message",id:s,peerId:l.peerId,hash:o[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:o[a.peerId].hashSend,_af:a._af,random_id:r,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!st())return l?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&!Object(te.isChatPeer)(a.peerId)&&(t=Object(M.$)(".uMailWrite__templates"),dt("templates"),hasClass("uMailWrite__templates_open",t)?Re():Be()),!1;each(geByClass1("uMailWrite"),(function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(c[t.name]=t.value))))))})),s?(uMailHat.onCancelEditing(!0),at(c)):(at(c),store.mail.cur.mvk_entrypoint="",Object(Y.popPeerAttachments)(a.peerId),n.value="",et("",a.viewerId,a.peerId),Object(Y.setPeerDraft)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,Ye({},n)),L.default.onSystemMessageClick(),$e(a.peerId),Fe(),StickersHints.actualizeVisibility(),F.isIOS?(n.focus(),setTimeout((function(){return n.focus()}))):x.default.msie_edge||(n.focus(),requestAnimationFrame((function(){return n.focus()})))}function qe(e){x.default.msie_edge&&(e.preventDefault(),We(e))}function ze(){var e=ze,t=e.typingData||(e.typingData={});if(!(0===Object(M.$)(".uMailWrite__textarea").value.length||store.mail.cur&&store.mail.cur.editing)){var n=Date.now(),i=store.mail,a=i.cur,o=i.peers,r=a.peerId;r<=-2e9||t[r]&&n-t[r]<5e3||(t[r]=n,ajaxRequest("/mail",{_ajax:1,act:"typing",peer:r,hash:o[r].hashTyping,community:nav.getQuery("community")}))}}function Ye(e,t){var n=Object(M.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,o=n.offsetHeight;Object(M.$$)(".uMailWrite__textarea").forEach((function(e){return setStyle(e,"height",o)})),Object(M.$$)(".uMailWrite__main").forEach((function(e){return setStyle(e,"height",o+8)})),Object(M.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(e){setStyle(e,"bottom",o+8+-5)})),pe(),a&&he(i,a.viewerId,a.peerId),Qe(e,t,(function(){Mention.onKeyUp(e,t)}))}function Ge(e){var t=store.mail,n=t.peers,i=t.members,a=t.cur,o=n[e].memberIds||[],r=[],s=[];return o.forEach((function(e,t){if(e!==a.viewerId){var n=i[e];if(n){var o=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];r.push(o)}else{var l=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];s.push(l)}}})),r.concat(s)}function Qe(e,t,n){fe.length&&(!hasClass("Mention_inited",geByClass1("uMailWrite__main"))&&be(),n(e,t))}function Ke(e,t){Qe(e,t,(function(){Mention.onKeyDown(e,t)})),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&We()}function Xe(e,t){Qe(e,t,(function(){Mention.onClick(e,t)}))}function Je(e,t){Object(Y.setKeyboardType)("text");var n=function(){store.mail.cur&&(Oe(),dt("text"),StickersHints.init({peerId:store.mail.cur.peerId}),Qe(e,t,(function(){Mention.onFocus(e,t)})))};F.isIOS?n():requestAnimationFrame((function(){requestAnimationFrame((function(){n()}))})),$.onOpen("bottom")}function Ze(e,t){if("text"===Object(Y.getKeyboardType)()&&Object(Y.setKeyboardType)(""),$.onClose(),he._timer&&clearTimeout(he._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,a=n.peerId;et(t.value,i,a)}}function et(e,t,n){var i=store.mail.cur.editing;Object(Y.setPeerDraft)(t,n,{text:e},i)}function tt(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t&&t.peerId){var i=!st(),o=!mediaUpload.checkUploading(),r=!!t.editing,s={sendActive:!i&&!r&&!o,loading:o,editAccept:r&&!i,editRemove:r&&i},l=n.templates&&!(r||!t.groupId||Object(te.isChatPeer)(t.peerId)||!i||s.loading||s.uploading);s.templates=l&&"templates"!==Object(Y.getKeyboardType)(),s.templatesActive=l&&"templates"===Object(Y.getKeyboardType)();var c=!(s.sendActive||s.loading||s.editAccept||s.editRemove||s.templates||s.templatesActive);s.disabled=c;var u=a.default.class("uMailWrite__button","uMailWrite__buttonSend",s);Object(M.$$)(".uMailWrite__buttonSend").forEach((function(e){return e.className=u}))}}function nt(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});Object(M.$$)(".uMailWrite__buttonStickers").forEach((function(e){return e.className=t}))}function it(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});Object(M.$$)(".uMailWrite__buttonKeyboard").forEach((function(e){return e.className=t}))}function at(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,a=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),ee.send(e),a){var o=store.mail.peers[a];if(o&&o.keyboard&&o.keyboard.one_time)o.keyboard=null,Object(Y.getKeyboardState)(a).updateTime=Date.now(),lt()}tt()}}function ot(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function rt(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=Object(M.$$)(".uMailWrite__textarea");i.forEach((function(e){return e.value=n})),Ye({},i[0])}function st(){return function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!Object(M.$)(".uMailWrite__textarea").value.trim()}function lt(e){if(Object(M.$)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,o=n.peers,r=i.peerId&&o[i.peerId];t=!(i.groupId||!r||r.closed||r.kicked)&&!(!r.keyboard||!r.keyboard.buttons.length);var s=Object(M.$)(".uMailWrite"),l=a.default.parseClass("uMailWrite",s.className);if(l.keyboard!==t&&(s.className=a.default.class("uMailWrite",Object.assign({},l,{keyboard:t}))),Object(Y.getKeyboardState)(i.peerId).rendered=!1,t){ae||(ae=lsGet("mail_keyboard_hidden")||{});var c=r.keyboard,u=ae[i.peerId];e&&!0===e.update&&Object(Y.clearCallbackButtons)(i.peerId);var d=!Object(Y.getKeyboardType)()||"buttons"===Object(Y.getKeyboardType)()||"text"===Object(Y.getKeyboardType)(),_=!1;u&&(u==c.chat_local_id?d=!1:_=!0),d?ut("buttons",{store:_}):_&&Le()}else Pe()}}function ct(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=Object(M.$)(".uMailWrite__templatesBody"),o=t.templates;if(a)return o?void function(e,t){e.innerHTML=X(t)}(a,o):(function(e){e.innerHTML=Loading({mix:"uMailWrite__templatesLoading"})}(a),oe||(oe=new Promise((function(e){ajaxRequest("/mail",{act:"get_templates"},(function(t){e(t)}),(function(t){e()}))}))),void oe.then((function(e){oe=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),ct()})))}}function ut(e,t){switch(dt(e),e){case"stickers":Ee();break;case"buttons":xe(t);break;case"text":(n=Object(M.$)(".uMailWrite__textarea"))&&n.focus();break;case"templates":Be()}var n}function dt(e){var t;"stickers"!==e&&je(),"buttons"!==e&&Pe(),"text"!==e&&(t=Object(M.$)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&Re()}function _t(e){var t=store.mail.cur.templates.find((function(t){return t.id===e}));if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",Object(U.emojiToHTML)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function ft(e){var t=store.mail.cur.templates,n=t.findIndex((function(t){return t.id===e}));if(-1!==n){var i=t[n],a=Object(M.$)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},(function(n){if(n.error)pt(e);else{var i=t.findIndex((function(t){return t.id===e}));t.splice(i,1),ct()}}),(function(){pt(e)}))}MailDialog.close()}function pt(e){var t=store.mail.cur.templates,n=Object(M.$)(".uMailWrite__templatesRow"+e),i=t.findIndex((function(t){return t.id===e})),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var o=lang.mobile_mail_templates_delete_error;o=o.replace("{name}",a.name),B.init({text:o,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}function ht(){L.default.clearSystemMessage2(),remove(geByClass1("message__newMsgsDivider")),remove(geByClass1("Unfold__item_returnToChat"))}function mt(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,a=[],o=n.failed[t.peerId]||[],r=n.pending[t.peerId]||[];(o.length||r.length)&&(o.concat(r).map((function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))C.onMessage(t);else{if(t.reply){var o=_.default.getReplyDataFromHTML(t.reply);o&&(i[t.reply]=o)}a.push(t)}})),R.setMsgs(a))}function vt(e,t,n){var i;n?i=[Object(D.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),Object(D.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[Object(D.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var a=Object(D.default)({class:"",close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});N.default.open(o.default.elem(a),!0)}function gt(e,t){D.default.close(e);var n=store.mail.presend.msgs[t];Object(Y.removeFailedMsg)(n),ee.retry(t,(function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e}))}function At(e,t){D.default.close(e),ee.remove(t)}function bt(e,t){D.default.close(e),ee.remove(t)}function yt(e){B.init({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}function wt(e){return store.mail&&store.mail.cur&&store.mail.cur.pressedButtons?store.mail.cur.pressedButtons.peers[e]:{}}t.default=C;window.uMailWrite=C},"Po+v":function(e,t,n){"use strict";n.r(t),t.default=function(e){void 0===e&&(e={});var t=[];if(e.on_overlay_click_native)t=e.on_overlay_click_native;else{var n=!0;"boolean"==typeof e.hide_on_overlay_click&&(n=e.hide_on_overlay_click),t=["Popup._onOverlayClick","this",e.on_overlay_click||null,n]}e.content||(e.content=e.inner);return{id:e.id,class:[e.mix?e.mix:e.class,Bem.class("Popup",{open:e.open,scrollable:e.scrollable})],inner:[e.rel?e.rel:null,{class:"Popup__overlay",onclick:t},{class:"Popup__wrap",inner:{tag:"div",class:"Popup__content",role:"dialog","aria-modal":"true",inner:[e.header?{class:"Popup__header",inner:[e.header.title?{class:"Popup__headerTitle",inner:e.header.title}:null,e.header.corner?{class:["Popup__headerCorner",e.header.corner.class],inner:e.header.corner.text,href:e.header.corner.url,onclick:e.header.corner.onclick,attrs:e.header.corner.attrs}:null]}:null,e.scrollable?{class:"Popup__scroll ScrollView",inner:{class:"Popup__scrollContent",inner:e.content}}:e.content,e.footer?{class:"Popup__footer",inner:e.footer}:null]}}]}}},Q8gl:function(e,t,n){"use strict";n.r(t),n.d(t,"Control_switcher",(function(){return c})),n.d(t,"Control_checkbox",(function(){return s})),n.d(t,"Control_radio",(function(){return l}));var i=n("OcsD"),a=n("z9sQ"),o=n("UWnA"),r=n("fdw3");function s(e){return u(Object(r.extend)(e,{type:"checkbox"}))}function l(e){return u(Object(r.extend)(e,{type:"radio"}))}function c(e){return u(Object(r.extend)(e,{type:"switcher"}))}function u(e){void 0===e&&(e={});var t,n=e.name,i=e.description,s=e.label||e.inner,l=e.type,c=e.checked,u=e.disabled,d=e.on_change||e.onChange,_=e.ariaHiddenLabel?e.ariaHiddenLabel:"true",f="value"in e?e.value:"1",p=[e.class||e.mix,a.default.class("Control",{type:l})],h=e.attrs||[];h=Object(r.extend)({onclick:!0},h),"switcher"===l&&(t="switch");var m=e.name+"_"+f+"_label",v={inner:[{id:e.input_id,class:"Control__native",name:n,value:f,checked:!!c&&"checked",disabled:!!u&&"disabled",type:"switcher"===l?"checkbox":l,onChange:d?["Control._onChange","this",d]:null,"aria-labelledby":s?m:null,role:t,tag:"input"},{class:"Control__icon",tag:"div"},{inner:[{inner:[s],id:m,"aria-hidden":_,tag:"span"},i?{inner:[i],class:"Control__description",tag:"div"}:""],class:"Control__label",tag:"div"}],tag:"div"}.inner;return e.withoutWrap?{inner:[v],class:p,attrs:h,tag:"label"}:(h.role="menuitem",Object(o.default)({inner:[v],tag:"label",class:p,attrs:h}))}var d=u,_=n("TYsd"),f={setChecked:function(e,t){void 0===t&&(t=!0);g(e).checked=t},isChecked:function(e){return g(e).checked}},p=f;f._onChange=v;var h=".Control",m=".Control__native";function v(e,t){_.default.handle(t,{$control:e.closest(h),name:e.name,checked:e.checked,value:e.value})}function g(e){return e.$(m)}var A=Object(i.extend)(d,p);t.default=A;window.Control=A},QBkA:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("9y81"),o=function(e){var t=window.lang,n=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!n}),e.mix],inner:[SVGIcon("base","search_outline_16"),{class:"mailFilter__input",tag:"input",placeholder:t.mobile_search,value:n,oninput:["MailFilter._onInput","this"],attrs:i.default.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[Wd.wrap(Object(a.default)({mix:"mailFilter__clear",icon:"close12",attrs:i.default.onMouseDown("MailFilter._onClearMouseDown","this")}))]}]})};var r=n("UxAg"),s=n("+cqQ"),l=n("jk6M"),c=n("aiw/");function u(e){requestAnimationFrame((function(){var t=e.value;f(e.value),o.onChange(t)}))}function d(){c.onOpen("top")}function _(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(l.default.ios?setTimeout:requestAnimationFrame)((function(){f(""),t.value="",n&&t.focus(),o.onClear(),o.onChange("")}))}function f(e){Object(r.$$)(".mailFilter").forEach((function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)}))}Object.assign(o,{onChange:Object(s.default)("query"),onClear:Object(s.default)(),setQuery:function(e){var t=Object(r.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,o.onChange(e),f(e))},setQuerySilently:function(e){var t=Object(r.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,f(e))}}),o._onInput=u,o._onClearMouseDown=_,o._onFocus=d;t.default=o;window.MailFilter=o},QMH7:function(e,t,n){"use strict";n.r(t),n.d(t,"healScroll",(function(){return u})),n.d(t,"unhealScroll",(function(){return d}));var i=n("OcsD"),a=n("UxAg"),o=n("Qz23");n("H5mD").isIOS&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",l);var r=".ScrollView",s="_scrollViewHealed";function l(){(c(),document.body)&&new MutationObserver(c).observe(document.body,{childList:!0,subtree:!0})}function c(){Object(a.$$)(r).forEach(u)}function u(e){if(!e[s]){e[s]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),a=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=a+1+"px",_(e),Object(o.setScrollView)(e,{override:!1}),Object(i.hasClass)("messenger__body",e)||Object(i.addEvent)(e,"scroll",p),Object(i.addEvent)(e,"scroll",f)}}function d(e){e[s]&&(e[s]=null,e.style.paddingTop="",e.style.paddingBottom="",Object(o.cleanScrollView)(e),Object(i.removeEvent)(e,"scroll",p),Object(i.removeEvent)(e,"scroll",f))}function _(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function f(e){var t=e.target,n=t[s];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){t[s]&&_(t)}),50))}function p(){onBodyScroll(!0)}},QQoL:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=n("9y81"),r=function(e){var t=window.lang,n=e.count;return i.default.html({class:[a.default.class("Bell",{empty:!n}),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[i.default.html(Object(o.default)({mix:"Bell__icon",icon:"bell"})),{class:"Bell__counter",inner:n,tag:"em"}]})};var s=n("UxAg");Object.assign(r,{setCount:function(e){Object(s.$$)(c).forEach((function(t){var n=t.$(u);t.classList.toggle(l,!e),n.innerText=e}))}});var l="Bell_empty",c=".Bell",u=".Bell__counter";t.default=r;window.Bell=r},Qg0H:function(e,t,n){"use strict";n.r(t);var i=n("UxAg"),a=n("TYsd"),o=n("+cqQ");window.Voting={cls:"Voting",setLoading:m,setHtml:function(e,t){f(e).forEach((function(e){e.outerHTML=t})),f(e).forEach((function(e){e.classList.add(s)})),setTimeout((function(){f(e).forEach((function(e){e.classList.remove(s),Voting.onHtmlUpdate(e)}))}),30)},getVotingsById:f,onHtmlUpdate:Object(o.default)("$voting")},Voting._onSubmit=v,Voting._onSingleAnswerClick=h,Voting._onCheckboxClick=p,Voting._onRevoteClick=g;var r="Voting_loading",s="Voting_beforeAnimation",l="Voting_hasCheckedOptions",c=".Voting",u=function(e){return'.Voting[data-id="'+e+'"]'},d=".Voting__option",_=".Voting__optionControl";function f(e){return Object(i.$$)(u(e))}function p(e){var t=e.closest(c),n=Array.from(Object(i.$$)(_)).some((function(e){return e.checked}));e.closest(d).setAttribute("aria-checked",e.checked),t.classList.toggle(l,n)}function h(e){var t=e.name,n=e.value,i=e.closest("form"),a=i.getAttribute("action");i._Voting_singleAnswerAction=a+"&"+t+"="+encodeURIComponent(n)}function m(e){e.classList.add(r)}function v(e,t,n){var i;if(e.preventDefault(),t._Voting_singleAnswerAction)i=t._Voting_singleAnswerAction,m(t);else{var o=Array.from(t.$$("input:checked"));if(0===o.length)return;var r=o[0].name,s=o.map((function(e){return e.value})).join(","),l=t.getAttribute("action"),c=l.includes("?")?"&":"?";m(t),i=""+l+c+r+"="+s+"&is_board="+t.$('input[name="is_board"]').value}a.default.handle(n,{$voting:t,url:i})}function g(e,t){var n=e.closest(c);a.default.handle(t,{$voting:n})}},Qz23:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return g})),n.d(t,"preventDocumentScroll",(function(){return A})),n.d(t,"restoreDocumentScroll",(function(){return b})),n.d(t,"cleanDocumentViews",(function(){return y})),n.d(t,"allowScrolling",(function(){return w})),n.d(t,"setScrollView",(function(){return O})),n.d(t,"cleanScrollView",(function(){return C})),n.d(t,"hideTopBanner",(function(){return H})),n.d(t,"showTopBanner",(function(){return V}));var i,a,o,r,s,l,c,u=n("UxAg"),d=n("aiw/"),_=n("H5mD"),f=!0,p=!1,h="closed",m=!1,v=[];function g(e){m&&y(),A(e)}function A(e){void 0===e&&(e={}),_.isIOS&&(!0!==e.stack&&m||(c={initialized:!1,scrollViews:[]},v.push(c),e.layoutElement&&e.layoutElement.nodeType?c.layoutElement=e.layoutElement:c.layoutElement=Object(u.$)(e.layoutElement||".layout")),!1===e.topBanner?c.topBanner=!1:c.topBanner=!0,m||(m=!0,addEvent(window,"focusin",B),addEvent(window,"focusout",R),addEvent(document,"touchmove",P,{capture:!0}),addEvent(document,"touchmove",x,{capture:!1}),addEvent(window,"resize",E),d.onCloseCallback(D),_.isWKWebView||(addEvent(window,"orientationchange",T),requestAnimationFrame((function(){Object(_.isLandscapePhone)()?T(null,!0):(E(),c&&!c.topBanner?requestAnimationFrame(H):o||requestAnimationFrame(V))})))))}function b(){m&&(m=!1,y(),1===v.length&&(c.layoutOffset=null,U(),document.body.style.height=""),c.layoutElement=null,v.pop(),(c=v.length?v[v.length-1]:null)&&U(),removeEvent(window,"focusin",B),removeEvent(window,"focusout",R),removeEvent(document,"touchmove",P,{capture:!0}),removeEvent(document,"touchmove",x,{capture:!1}),removeEvent(window,"resize",E),removeEvent(window,"orientationchange",T),removeEvent(window,"resize",I),removeEvent(window,"scroll",M),d.offCloseCallback(D))}function y(){c.scrollViews.forEach((function(e){return C(e)})),c.scrollViews=[]}function w(e){var t=e.currentTarget.__ScrollView;if("prevented"!==t.state){if(!("start"!==t.state||t.allowX&&t.allowY)){var n=Math.abs(t.startX-e.changedTouches[0].clientX),i=Math.abs(t.startY-e.changedTouches[0].clientY);if(!t.allowX&&n>i)return void(t.state="prevented");if(!t.allowY&&i>n)return void(t.state="prevented")}if("allowed"!==t.state&&(t.state="allowed"),f=!1,!t.overscrollX){var a=e.currentTarget.scrollLeft,o=t.startX-e.changedTouches[0].clientX;(a<=0&&o<=0||a>=t.maxX&&o>=0)&&(f=!0,t.standalone&&e.preventDefault())}if(!t.overscrollY){var r=e.currentTarget.scrollTop,s=t.startY-e.changedTouches[0].clientY;(r<=0&&s<=0||r>=t.maxY&&s>=0)&&(f=!0,t.standalone&&e.preventDefault())}}}function S(e){var t=e.currentTarget,n=t.__ScrollView;n.state="start",n.startX=e.changedTouches[0].clientX,n.startY=e.changedTouches[0].clientY,n.maxX=n.overscrollX?null:t.scrollWidth-t.clientWidth,n.maxY=n.overscrollY?null:t.scrollHeight-t.clientHeight}function k(e){e.currentTarget.__ScrollView.state=""}function O(e,t){if(void 0===t&&(t={}),_.isIOS&&(!1!==t.override||!e.__ScrollView)){if(!0!==t.standalone){if(!m)return;e.__ScrollView||c.scrollViews.push(e)}e.__ScrollView={allowX:!1!==t.allowX,allowY:!1!==t.allowY,overscrollX:!1!==t.overscrollX,overscrollY:!1!==t.overscrollY,standalone:!0===t.standalone},c&&(_.isWKWebView||(!1!==t.topBanner&&(e.__ScrollView.topBanner=t.topBanner||{hide:30,show:60}),addEvent(e,"scroll",j))),addEvent(e,"touchstart",S),addEvent(e,"touchmove",w),addEvent(e,"touchend",k)}}function C(e){e.__ScrollView=null,removeEvent(e,"touchstart",S),removeEvent(e,"touchmove",w),removeEvent(e,"touchend",k),removeEvent(e,"scroll",j)}function j(e){if("closed"!==h||Object(_.isLandscapePhone)())return p=!1,void(r&&clearTimeout(r));p=!0;var t=e.target.__ScrollView.topBanner;c&&c.topBanner&&t?N(e.target,t.show,t.hide):N(e.target,1/0,0),r&&clearTimeout(r),r=setTimeout((function(){p=!1,E()}),100)}function E(){if(!p)if(l)l=!1;else if(!Object(_.isLandscapePhone)()){window.pageYOffset;"closed"===h&&(_.isWKWebView||(i=document.documentElement.offsetHeight,a=innerHeight,o=i===a,"show"===s?(s=null,requestAnimationFrame(V)):"hide"===s&&(s=null,requestAnimationFrame(H))))}}function T(e,t){_.isIPad?c.topBanner||setTimeout((function(){H()}),400):90===Math.abs(window.orientation)?(addEvent(window,"resize",I),document.body.style.height="",c.layoutHeight=null,t?setTimeout((function(){window.scrollTo(0,-300),I()})):setTimeout((function(){window.scrollTo(0,-300)}),400)):(removeEvent(window,"resize",I),c.layoutOffset=null,U(),c.topBanner||setTimeout((function(){H()}),400))}function I(){if("closed"===h){var e=document.body.offsetHeight,t=e-innerHeight;c.layoutOffset=t,U(),window.scrollTo(0,e)}}function M(){pageYOffset&&(h="opened",removeEvent(window,"scroll",M))}function P(e){f=!0}function x(e){f&&e.preventDefault()}function L(e){var t=e&&e.target,n=0===e.eventPhase&&t.getAttribute("autofocus"),i=!1;return"textarea"!==t.tagName.toLowerCase()||n||(i=!0),"input"!==t.tagName.toLowerCase()||["checkbox","radio","image","submit"].includes(t.type)||n||(i=!0),"select"===t.tagName.toLowerCase()&&(i=!0),i}function B(e){if(L(e)){var t,n=e&&e.target;h="opening",addEvent(window,"scroll",M),window.isCustomScroll&&(t=n.dataset.scrollviewposition),d.onOpen(t,{exitIfStarted:!0})}}function R(e){L(e)&&d.onClose({exitIfStarted:!0})}function D(){removeEvent(window,"scroll",M),h="closed",setTimeout((function(){Object(_.isLandscapePhone)()?I():E()}),100)}function N(e,t,n){var i=e.scrollTop;i<=-t&&(o||s)?(s="show",window.scrollTo(0,-10)):i>=n&&(!o||s)&&(s="hide",window.scrollTo(0,10))}function H(){window.scrollTo(0,300)}function V(){window.scrollTo(0,-300)}function U(){var e=c.layoutOffset;c.layoutElement.style.top=e?e+"px":""}},RJa5:function(e,t,n){"use strict";var i,a,o,r;n.r(t),n.d(t,"AnalyticsArea",(function(){return i})),n.d(t,"AnalyticsEventTable",(function(){return a})),n.d(t,"ECommGoodsEvent",(function(){return o})),n.d(t,"ECommOrdersEvent",(function(){return r})),function(e){e.MARKET="market",e.GROUP="group",e.USER_PROFILE="user_profile",e.BOOKMARKS="bookmarks"}(i||(i={})),function(e){e.GOODS="ecomm_goods",e.ORDERS="ecomm_orders"}(a||(a={})),function(e){e.TRANSITION_TO_ITEM="transition_to_item",e.TRANSITION_TO_ALBUM="transition_to_album",e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.TRANSITION_TO_ITEM_LEFT="transition_to_item_left",e.TRANSITION_TO_ITEM_RIGHT="transition_to_item_right",e.VIEW_ITEM="view_item",e.VIEW_ALBUM="view_album",e.CLOSE_ITEM="close_item",e.TRANSITION_TO_OWNER="transition_to_owner",e.VIEW_ITEM_MEDIA="view_item_media",e.ADD_ITEM_TO_CART="add_item_to_cart",e.EXPAND_ITEM_DESCRIPTION="expand_item_description",e.ADD_ITEM_TO_BOOKMARKS="add_item_to_bookmarks",e.REMOVE_ITEM_FROM_BOOKMARKS="remove_item_from_bookmarks",e.EXPAND_COMMENTS="expand_comments",e.COMMENT="comment",e.ADD_TO_CART_HS="add_to_cart_hs",e.OPEN_WIKI="open_wiki",e.SEND_MESSAGE_TO_OWNER="send_message_to_owner",e.OPEN_CHAT_WITH_OWNER="open_chat_with_owner",e.LIKE_ITEM="like_item",e.UNLIKE_ITEM="unlike_item",e.SHARE_ITEM="share_item",e.CTA_LINK="cta_link",e.CREATE_ITEM="create_item",e.CREATE_ALBUM="create_album",e.EDIT_ITEM="edit_item",e.EDIT_ALBUM="edit_album",e.DELETE_ITEM="delete_item",e.DELETE_ALBUM="delete_album",e.GROUP_ITEMS="group_items",e.ADD_PROPERTY="add_property",e.ADD_PROPERTY_VALUE="add_property_value",e.DELETE_PROPERTY="delete_property",e.DELETE_PROPERTY_VALUE="delete_property_value",e.TRANSITION_TO_EDIT_PROPERTIES="transition_to_edit_properties",e.TRANSITION_TO_EDIT_ALBUMS="transition_to_edit_albums",e.TRANSITION_TO_ADD_ALBUM="transition_to_add_album",e.TRANSITION_TO_ADD_ITEM="transition_to_add_item",e.TRANSITION_TO_EDIT_ITEM="transition_to_edit_item",e.TRANSITION_TO_DELETE_ALBUM="transition_to_delete_album",e.TRANSITION_TO_GROUP_ITEMS="transition_to_group_items"}(o||(o={})),function(e){e.EVENT_MAKE_ORDER="make_order",e.CANCEL_ORDER="cancel_order",e.EXPAND_ORDER_INFO="expand_order_info",e.TRANSITION_TO_ORDERS="transition_to_orders",e.OPEN_MARKET_GROUP_ORDERS="open_market_group_orders",e.OPEN_MARKET_GROUP_ITEMS="open_market_group_items",e.OPEN_MARKET_GROUP_SETTINGS="open_market_group_settings",e.OPEN_MARKET_GROUP_DELIVERY="open_market_group_delivery",e.TRANSITION_TO_MARKET_SUPPORT="transition_to_market_support",e.OPEN_ORDER_INFO="open_order_info",e.ADD_TRACK_CODE="add_track_code",e.ADD_INTERNAL_COMMENT="add_internal_comment",e.CHANGE_ORDER_STATUS="change_order_status",e.OPEN_CHAT_WITH_CUSTOMER="open_chat_with_customer",e.SEND_MESSAGE_TO_CUSTOMER="send_message_to_customer",e.OPEN_ORDER_HISTORY="open_order_history",e.FILTER_ORDERS_BY_STATUS="filter_orders_by_status",e.EXPORT_ORDERS_DATA="export_orders_data"}(r||(r={}))},SNk7:function(e,t,n){"use strict";n.r(t);var i=n("fdw3"),a=n("Y6JH"),o=function(){return{inner:[{inner:[Object(a.default)({sprite:"mail/casper",name:"bomb_24"})],class:"CasperHiddenMessages__buttonIcon","aria-hidden":"true",tag:"span"},{inner:[Object(i.getLang)("mobile_casper_chat_message_has_gone")],class:"CasperHiddenMessages__buttonText",tag:"span"}],class:"CasperHiddenMessages__button",onClick:["CasperHiddenMessages.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false","aria-controls":"mail-dialog",tag:"button"}};var r=n("iS9e"),s=n("TYsd"),l=n("CQvH"),c=null,u={clickHandler:function(e){r.default.open({body:s.default.html({inner:[{inner:[Object(i.getLang)("mobile_casper_message_modal_info")],class:"CasperHiddenMessages__paragraph",tag:"p"}],class:"CasperHiddenMessages__box",tag:"div"}),title:Object(i.getLang)("mobile_casper_message_modal_title"),class:"CasperHiddenMessages__dialog",buttons:s.default.html({inner:[{inner:[Object(i.getLang)("mobile_casper_message_modal_install_vk_me")],tag:"span"}],class:"Btn Btn_theme_regular CasperHiddenMessages__dialogButton mailDialog__button mailDialog__confirmButton",tag:"button"}),onConfirm:function(e){if(c(),!(store&&store.mail&&store.mail.cur&&store.mail.cur.vkmeLink))throw new Error("Cannot find a link to VK Me app");nav.hard_go(store.mail.cur.vkmeLink)},onClose:function(){c(),r.default.close()}}),(c=Object(l.expandPopup)(e)).exitIntent=function(){r.default.close()}}};window.CasperHiddenMessages=u;t.default=o},STl5:function(e,t,n){"use strict";n.r(t);var i=n("QQoL"),a=function(){var e=window.store,t="/feed?section=notifications";return Object(i.default)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})};t.default=a;window.uBell=a},T24x:function(e,t,n){"use strict";n.r(t);var i=n("BZzM"),a=(n("CQvH"),n("QMH7")),o=n("Y6JH"),r=n("qHA9"),s={onChange:se(),onChanged:se(),onRestore:se(),fast_load:!1,need_hard_go:!1,getHash:function(e){if("#player"===e.hash)return e.path+e.hash;var t=qs2obj(e.params);return delete t.z,e.path+obj2qs(t)},getAlias:function(e){if(!e)return!1;var t=(e||"").split("?"),n=t[0],i=qs2obj(t[1]);return i.from&&delete i.offset,delete i.from,delete i.z,delete i.ref,Object.keys(i).forEach((function(e){0===e.indexOf("_")&&delete i[e]})),n+obj2qs(i)},set:function(e,t,n,o){void 0===n&&(n={});var l=window,c=l.zlayer,u=l.cur,d=l.nav,_=l.menu,f=l.audioplayer,p=$("body.fixed"),h=p?Math.abs(parseInt(getStyle(p,"top"),10)):scrollTop(),m=null;if(window.isNewMail){var v=e.split("?");toggleClass("vk__page_mail",window.bodyNode,Object(r.isNewMailPage)(v[0],v[1]))}c.opened()&&(h=c._st);var g=n.forceUpdate&&t.newHTML,A=!g&&d.hasUpdate(o,e,t),b=!!A||d.needUpdate(o,e,t),y=0;if(!n.force&&!A&&b||g?(y=scrollTop(),m=remove("m"),each(geByClass("_cntr",m),(function(){remove(this)})),each(geByClass("ScrollView",m),(function(){Object(a.unhealScroll)(this)})),remove(geByClass1("_cntrs",m))):each(geByClass("ScrollView",geByClass1("m")),(function(){Object(a.unhealScroll)(this)})),!n.after&&!s.fast_load){var w=s.getHash(d),S=o||t.options||{};o&&o.is_native_back&&(S.prev_tab=S.native_prev),s.save(w,{html:null,st:h,page:m,state:s.stash(),cur:window.cur,options:S},!0)}if(n.before||s.clear(),(n.before||!n.before&&!n.after)&&(window.lm_qsearch_counter?window.lm_qsearch_counter++:window.lm_qsearch_counter=1),n.before){var k=o&&o.target;s.fast_load=!0,k&&addClass("__al_target",k);var O=m.cloneNode(!0);k&&removeClass("__al_target",k);var C=geByClass1("__al_target",O);removeClass("__al_target",C),n.beforeAppend&&n.beforeAppend(O,C),after(O,"l"),scrollTop(y),u.toggleHeaderSearch&&u.toggleHeaderSearch(!1),n.afterAppend&&n.afterAppend(O),_&&_.clear_hover(),_&&_.closeSearch(),_&&_.enabled(!0)}else{o&&o.zProcess&&o.zProcess(0,!0)&&delete o.zProcess;var j=!1;if(o&&d.set(o),s.need_hard_go)return d.hard_go(d.cur,null,{replace:!0});if(!n.force&&!A&&b||g){var E;if(t.title&&(document.title=t.title),g?((E=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(E,t.newHTML)):(E=t.page)?j=!0:((E=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(E,t.html)),_.opened()){var T=ce("div",{id:"m_helper",onclick:_.close});append(T,E)}after(E,"l")}s.fast_load=!1,thover.clear(),!A&&b&&(t.lm&&_.refresh(t.lm),t.bc&&(window.bodyNode.className=t.bc),c.opened(),o&&o.zProcess?o.zProcess(0,!1)&&delete o.zProcess:c.close()),n.force||(j&&(window.qsearch.isCachedPage=!0),t.js&&evalJs(t.js),j&&(window.qsearch.isCachedPage=!1),t.state&&s.stash(t.state),t.cur&&extend(window.cur,t.cur),o&&(t.options=o),post.wallActionsHide(),s.save(e,t));var I=o?o.nav&&o.nav.hash:d.hash;if(A||b)if(A)Tabbar.showUpdateButton(A.currentCache.d.page);else if(t.st||!I){var M=window.isCustomScroll&&hasClass("ScrollView","mcont")?1:0;scrollTop(t.st||M),scrollTop(t.st||M,10)}else I?scrollToHash(I):n.no_scroll&&!n.force?(scrollTop(h),scrollTop(h,10)):scrollToHash();else;f&&f.initAudio(),AudioMessagePlayer&&AudioMessagePlayer.redrawWaves()}var P=window.Tabs;onBodyResize(P.actualizeShowMoreVisibility),P.actualizeShowMoreVisibility(),Object(i.resizePosters)(),s.onChange(!0,o&&o.nav&&o.nav.push),(n.al_transition||n.restored)&&s.onChanged(!0)},save:function(e,t,n){if(e){var i=window.nav,a=n?i.page_get(e,t.options.prev_tab):{};a&&i.page_set(e,extend(a,t),s.getAlias(e))}},restore:function(e){var t=window.nav,n=t.page_get(e);return n||(n=t.page_get(s.getAlias(e))),!!n&&(s.onRestore(!0),n)},stash:function(e){var t=window.cur;return window.cur&&t.stash&&t.stash(e)||!1},clear:function(){var e=window.cur,t=window.zlayer,n=window.menu,i=window.tooltip;onBodyScroll("__clear"),onBodyResize("__clear"),n&&n.initEvents(),t.isReady&&t.initEvents(),i&&i.clear(),window.cur&&e.destroy&&each(e.destroy,(function(){this()})),window.cur={destroy:[]}},hideHeader:function(e){var t=geByClass1("mhead",e);hide(t)},setMhead:function(e,t,n,i,a){void 0===a&&(a={});var r=geByClass1("mhead",e),s=geByClass1("mhb_logo",r),l=geByClass1("mh_header",e),c=!1,u=window.nav,d=document.body,_=geByClass1("SliderTabs",r),f=geByClass1("header__right",r),p=geByClass1("header__gear",r);_&&remove(_),f&&remove(f),p&&remove(p),removeClass("vk_header_tabs",d);var h="header__title hb_btn mh_header mhi_back";if(a.movable&&(h+=" header__title--movable header__title--initial-position"),n){!0===n?c=u.path+(u.params?"?"+u.params:""):n&&(c=n),t||(t=val(l)||"&nbsp;");var m=geByClass1("mhb_back",e),v="",g=hasClass("mh_nobr",m)?" mh_nobr":"",A=i?' onclick="'+i+'"':"";if("/"==c)v='<div class="hb_wrap mhb_back'+g+'"'+A+'><h1 class="hb_btn mh_header">'+t+"</h1></div>";else{var b=Wd.html(Object(o.default)("base","back_outline_28"));v='\n        <div class="header__center hb_wrap mhb_back '+g+'">\n          <a class="header__back al_back" href="'+escapeAttr(c)+'" accesskey="0" '+A+">"+b+'</a>\n          <h1 class="'+h+'">\n            <div class="header__text">\n                '+t+"\n            </div>\n          </h1>\n        </div>\n      "}if(r&&s){var y=geByClass1("mhb_notify",e);val(r,(window.al&&window.al.menu?'<a href="/" class="hb_wrap mhb_home" accesskey="*" onclick="return menu.toggle(event);"><div class="hb_btn mhi_home">&nbsp;</div></a>':'<a href="/" class="hb_wrap mhb_home mhb_vkhome" accesskey="*"><div class="hb_btn mhi_home mhi_vkhome">&nbsp;</div></a>')+'<div id="header_msgs" class="hb_wrap mhb_notify'+(!y||hasClass("mhb_no_notify",y)?" mhb_no_notify":"")+'">'+val(y)+"</div>"+v)}else m&&(m.outerHTML=v);var w=$(".header__center");w&&w.classList.toggle("is_unfold",$(".Unfold",w))}else t&&val(l,t)}};window.page=s,t.default=s},Tjn9:function(e,t){function n(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout((function(){addClass(e,"profileEdit_animated"),setTimeout((function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")}),1e3)}),1500))}function i(e){(e=ge(e))&&setTimeout((function(){var t=getXY(e)[1],i=getSize("mhead")[1],a=scrollGetY(),o=getCh();t<i+a||t>a+o?setTimeout((function(){scrollTo(0,t-i),n(e)}),0):n(e)}),0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&i(geByClass1("_"+e))},highlightRow:n,scrollHighlightRow:i}},U34x:function(e,t){var n="dropdown_open",i={_onTogglerClick:function(e,t){preventEvent(e),stopEvent(e);var i=gpeByClass("dropdown",t);if(toggleClass(i,n),!1!==i.isFirstClick){i.isFirstClick=!1;var a=function(){removeClass(i,n)};addEvent(window,"click",a),window.cur.destroy.push((function(){removeEvent(window,"click",a),i.isFirstClick=!0}))}}};window.Dropdown=i},UWnA:function(e,t,n){"use strict";n.r(t);var i=n("WWoJ");n.d(t,"Row_labeledSelect",(function(){return i.Row_labeledSelect})),t.default=i.default},Ubt6:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");t.default=function(e){return{class:[e.class,i.default.class("Tooltip",{pos:e.pos,onboarding:e.onboarding,theme:e.theme||""})],"tooltip-id":e["tooltip-id"],inner:{class:i.default.class("Tooltip__inner",{pos:e.pos,theme:e.theme||""}),inner:e.inner},onclick:e.onclick}}},UlUB:function(e,t,n){"use strict";function i(e,t){var n,i,a=!1;return function o(){if(a)return n=arguments,void(i=this);e.apply(this,arguments),a=!0,setTimeout((function(){a=!1,n&&(o.apply(i,n),n=i=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return i}))},UvyM:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("BoyB"),o=n("TYsd"),r=n("fdw3");t.default=function(e){void 0===e&&(e={});var t=e.url,n=e.is_icon,s=e.icon,l=e.tag||"button",c=e.on_click||e.onClick||e.onclick,u=e.use_native_onclick,d=e.inner||e.children;Object(r.isArray)(d)&&1===d.length&&"string"==typeof d[0]&&(d=d[0]);var _=!1;"function"==typeof c&&(u=!0,_=!0);c&&!u&&(c=["Btn._onClick","event","this",c]);var f={class:[e.class,i.default.class("Btn",{theme:e.theme||"regular",size:e.size||"",stretch:e.stretch})],onclick:c,attrs:e.attrs};_&&(f.onClick=c,delete f.onclick);var p=e.hide?"; display: none;":"",h=e.style?e.style+p:p,m=null;e.isLoading&&(f.class.push("Btn_loading"),m=o.default.wrap(Object(a.default)({mix:"Btn__loader",white:"secondary"===e.theme?"white":"",large:!0,spinner:e.spinner})));if(t)return Object(r.mergeObjects)(f,{_:o.default.getInternalData(),tag:"a",href:t,role:"button",style:h,inner:s?[{class:"Btn__icon",inner:s},{class:"Btn__text",inner:d}]:n?d:{class:"Btn__text",inner:d},target:(e.open_in_new_tab?"_blank":e.target)||""});var v=e.is_submit?"submit":null,g=e.type||v;return Object(r.mergeObjects)(f,{_:o.default.getInternalData(),"aria-label":e["aria-label"]||"",tag:l,style:h,disabled:e.disabled,type:g,inner:s?[m,{class:"Btn__icon",inner:s},{class:"Btn__text",inner:d}]:n?[m,d]:[m,{class:"Btn__text",inner:d}]})}},V2dH:function(e,t,n){"use strict";n.r(t);var i=n("rKUZ"),a=n("iWgD"),o=function(){return Object(i.default)(r())};function r(){var e,t,n=store.mail.cur.peerId,i=Object(a.uTyping_getPeerTyping)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:Object(a.uTyping_getNames)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}Object.assign(o,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.default.getElem("curConvo"),t=r();q.parseClass("typing",e.className).animation===t.animation?i.default.setTyping(e,t):e.outerHTML=Object(i.default)(t)}});t.default=o;window.uCurConvoTyping=o},V4qE:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return y})),n.d(t,"close",(function(){return k})),n.d(t,"SNACKBAR_POSITION_COMMON",(function(){return _})),n.d(t,"SNACKBAR_POSITION_MAIL",(function(){return f})),n.d(t,"SNACKBAR_TYPE_SUCCESS",(function(){return m})),n.d(t,"SNACKBAR_TYPE_ERROR",(function(){return v})),n.d(t,"SNACKBAR_TYPE_BOOKMARK",(function(){return g})),n.d(t,"SNACKBAR_TYPE_BULLYING",(function(){return A}));var i=n("z9sQ"),a=n("29dZ"),o=n("Y6JH"),r=n("fdw3"),s=function(e){void 0===e&&(e={});var t=e.position||"bottom",n=!(!e.type||e.image),s={class:i.default.class("SnackbarItem__cell",{left:!0,image:!!e.image,top:e.avatar&&"left"===e.avatar_position,icon:n})},l={class:i.default.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar})},c=!1,u=!1;if(e.type){c=!0;var d=null;switch(e.type){case 1:d=Object(o.default)("common","snackbar_done_24");break;case 2:d=Object(o.default)("common","snackbar_error_24");break;case 3:d=Object(o.default)("common","favorites_24");break;case 4:d=Object(o.default)("wall","error_fill_24")}s.inner={class:"SnackbarItem__icon",inner:d}}e.image&&(c=!0,s.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(u=!0,l.inner=Object(a.default)({theme:"none",class:"SnackbarItem__action",url:e.action.url,target:e.action.target,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));if(e.avatar){var _={tag:"img",class:"SnackbarItem__avatar",src:e.avatar};e.avatar_position&&"right"!==e.avatar_position?"left"===e.avatar_position&&(c=!0,s.inner=_):(u=!0,l.inner=_)}return{style:e.style?e.style:"",class:Object(r.concatValues)("SnackbarItem_"+e.id+" SnackbarItem--"+t+" ",i.default.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:n},"--")),attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[c?s:null,e.text?{class:i.default.class("SnackbarItem__cell",{text:!0}),inner:{class:"SnackbarItem__text",inner:Object(r.isObject)(e.text)?e.text:Wd.wrap(e.text)}}:null,u?l:null]}]}};var l=n("OcsD"),c=n("UxAg"),u=n("kr3z"),d=n("zq7H");window.Snackbar={init:y,close:k,_onActionClick:function(e,t){var n=h[t];if(!n)return void Object(l.hide)(t);var i=n.callback,a=n.url;i?"function"==typeof i?i.call(null,e,{id:t,url:a}):Wd.handle2(i,e,{id:t,url:a}):Object(l.hide)(t)},_onRestoreClick:function(e,t,n){var i=t.closest(".SnackbarItem"),a=Object(l.domData)(i,"snackbar-id"),o=h[a];e.stopPropagation(),e.preventDefault();var r=o.callback;r&&("function"==typeof r?r.call(null,e,{id:a,url:n}):Wd.handle2(r,e,{id:a,url:n}));k(a),u.default.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var _="common",f="mail",p=0,h={},m=1,v=2,g=3,A=4,b=[];function y(e){var t=isFinite(e.duration)?e.duration:5e3,n=p++,i=e.action&&e.action.callback,a=e.action&&e.action.url;e.position=e.position||_;var o=e.position;e.id=n,i&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var r,s=Wd.elem(SnackbarItem(e));return function(e,t){if(t.position===_)Object(l.append)(e,document.body);else if(t.position===f){var n="msg"===window.store.mail.cur.page?Object(c.$)(".messenger__layer_page .messenger__header"):Object(c.$)(".messenger__layer_convo .messenger__header");Object(l.append)(e,n)}setTimeout((function(){e.classList.add("SnackbarItem_added")}),100)}(s,e),t&&(r=S(n,t)),Object(l.addEvent)(s,"touchstart",P,{passive:!0}),Object(l.addEvent)(s,"touchmove",x,{capture:!1}),Object(l.addEvent)(s,"touchcancel touchend",L,{passive:!0}),h[n]={id:n,timer:r,callback:i,url:a,duration:t,position:o},b.push(n),w(),n}function w(){var e=(b=b.filter((function(e){var t=h[e],n=O(e);return!(!t||!n)}))).reduce((function(e,t){var n=h[t];return e[n.position]||(e[n.position]=[]),e[n.position].push(t),e}),{});Object.keys(e).forEach((function(t){var n=e[t],i=0,a=t===f?8:12;n.forEach((function(e,n){var o=O(e),r=Object(l.getH)(o);h[e].vertical=t===f?i:-i,l.setStyle.transform(o,1,[0,h[e].vertical]),i+=r+a}))}))}function S(e,t){return setTimeout((function(){k(e,!1)}),t)}function k(e,t){var n=h[e],i=O(e);n&&(n.timer&&clearTimeout(n.timer),delete h[e]),i&&function(e,t){if(Object(l.removeEvent)(e,"touchstart",P,{passive:!0}),Object(l.removeEvent)(e,"touchmove",x,{capture:!1}),Object(l.removeEvent)(e,"touchcancel touchend",L,{passive:!0}),t)return Object(l.remove)(e),void w();e.classList.add("SnackbarItem--closing");if(!e)return;e.classList.add("SnackbarItem_removed"),setTimeout((function(){Object(l.remove)(e),w()}),600)}(i,t)}function O(e){return Object(c.$)(".SnackbarItem_"+e)}onDOMReady((function(){onBodyResize(w)}));var C=!1,j=null,E=!1,T=0,I=!1,M=Object(l.getCw)();function P(e){if(M=Object(l.getCw)(),e.touches&&e.touches.length>1)C=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=Object(l.domData)(t,"snackbar-id");if(M>=d.DESKTOP_WIDTH&&(I=!0),h[n].position===f){I=!1;var i=Object(c.$)(".messenger");M=Object(l.getW)(i),h[n].parentXY=Object(l.getXY)(i)}else h[n].parentXY=Object(l.getXY)(bodyNode);h[n].timer&&clearTimeout(h[n].timer),j=e.touches[0],T=e.touches[0].clientX,C=!0,E=n,document.body.style.overflow="hidden"}}function x(e){var t=E;if(e.preventDefault(),e.touches&&e.touches.length>1)C=!1;else if(j&&C){var n=e.touches[0],i=e.target.closest(".SnackbarItem"),a=-(T-n.clientX);I&&(a=Math.min(a,0));var o=Object(l.getX)(i),r=(Object(l.getW)(i)+a)/2+o-h[t].parentXY[0],s=r>=.95*M||r<=M/.95-M;h[t].canClose=s,l.setStyle.transform(i,1,[a,h[t].vertical])}}function L(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=Object(l.domData)(t,"snackbar-id"),i=h[n];if(h[n].dragging=!1,E=!1,document.body.style.overflow="visible",i.canClose){var a=Object(l.getX)(t)>0?Object(l.getCw)():-Object(l.getCw)();return Object(l.getCw)()>=d.DESKTOP_WIDTH&&(a=Object(l.getX)(t)>Object(l.getCw)()/2?Object(l.getCw)():-Object(l.getCw)()),l.setStyle.transform(t,1,[a,h[n].vertical||0]),void k(n)}h[n].timer=S(n,i.duration),t&&l.setStyle.transform(t,1,[0,h[n].vertical||0])}t.default=s;window.SnackbarItem=s},W38l:function(e,t,n){"use strict";n.r(t),n.d(t,"log",(function(){return s})),n.d(t,"mark",(function(){return l})),n.d(t,"error",(function(){return c})),n.d(t,"clean",(function(){return u})),n.d(t,"logQueueSize",(function(){return d}));var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function a(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}var o=n("WwUR"),r={};function s(e,t){var n={action:t,startTime:Date.now(),networkType:a(),lpState:o.default.isLongPollingEnabled()};r[e]=n}function l(e,t){if(r[e]){var n=r[e],i=n.startTime,a=n.action,o=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,a,t,o,s)}}function c(e,t,n){if(r[e]){var i=r[e],a=i.action,o=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,a,t,n,o,s)}}function u(e){delete r[e]}function d(e){statlogsValueEvent("mvk_mail_send_queue_size",e,a())}},WWoJ:function(e,t,n){"use strict";n.r(t),n.d(t,"Row",(function(){return c})),n.d(t,"Row_btn",(function(){return u})),n.d(t,"Row_labeledText",(function(){return d})),n.d(t,"Row_labeledInput",(function(){return _})),n.d(t,"Row_labeledSelect",(function(){return f}));var i=n("8ZMO"),a=n("p5n7"),o=n("I7Du"),r=n("9y81"),s=n("29dZ"),l=n("z9sQ");function c(e){void 0===e&&(e={});var t=e.anchor,n=e.attrs||{},a=e.style||{},o=e.url,s=e.count,c=o&&!a.no_go_icon&&!s,u=e.tag;u||(u=o?"a":"div");var d=null;return c?d=Wd.wrap(Object(r.default)({mix:"Row__right",icon:"chevron_right"})):s&&(d={inner:[s],class:"Row__right Row__count",tag:"div"}),{class:[e.mix||e.class,l.default.class("Row",{go:c,style_withBorder:a.with_border,style_withBorderForce:a.with_border_force,style_withHover:a.with_hover,style_smallPaddings:a.small_paddings,style_noPaddingTop:a.no_padding_top,style_noPaddingBottom:a.no_padding_bottom,style_tinyPaddingTop:a.tiny_padding_top,style_tinyPaddingBottom:a.tiny_padding_bottom,paddingTop_short:a.padding_top_short})],tag:u,href:o,attrs:n,role:e.role,inner:[t?Object(i.default)({id:t}):null,d,e.icon?{inner:[e.icon],class:"Row__icon "+e.icon_class,tag:"div"}:null,e.content||e.inner]}}function u(e){return c({content:Object(s.default)(e)})}function d(e){return p({anchor:e.anchor,url:e.url,label:e.label,content:e.text,is_mini:!0})}function _(e){return p({anchor:e.anchor,label:e.label,style:e.style,content:Object(a.default)(e)})}function f(e){return p({anchor:e.anchor,style:e.style,label:e.label,content:Object(o.default)(e)})}function p(e){return c({anchor:e.anchor,url:e.url,style:e.style,content:[h({is_mini:e.is_mini,label:e.label}),m({content:e.content})]})}function h(e){return{inner:[e.label],class:[l.default.class("Row__label",{mini:e.is_mini}),e.class||""].join(" "),tag:"div"}}function m(e){return{inner:[e.content],class:["Row__labeledContent",e.class||""].join(" "),tag:"div"}}t.default=c},WwUR:function(e,t,n){"use strict";n.r(t);var i=n("OcsD"),a=n("+cqQ");function o(e,t){var n,i=new Promise((function(i){n=i,setTimeout(i.bind(null,t),1e3*e)}));return{pause:function(){return i},abort:function(){n(t)}}}var r=n("cGUQ");function s(e,t,n){var i;return void 0===n&&(n={}),i=window.XDomainRequest?new XDomainRequest:ajax._getreq(),{request:new Promise((function(a,o){var s,l=Date.now(),c=n.timeout||60,u=Object(r.toQueryString)(t);if(window.XDomainRequest)i.open("get",e+"?"+u),i.ontimeout=function(e){o([e,{}])},i.onerror=function(e){o([e,{}])},i.onload=function(){a([i.responseText,{}])},setTimeout((function(){i.send()}),0);else{i.onreadystatechange=function(){4==i.readyState&&(clearInterval(s),i.status>=200&&i.status<300?a([i.responseText,i]):o([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return o([e,i])}i.send()}s=setInterval((function(){Date.now()-l>1e3*c&&(window.browser.safari&&i.abort(),o(["",{}]),clearInterval(s))}),1e3)})),cancel:function(){i.abort()}}}var l=n("jE6c");function c(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var u={};function d(e){if(u[e])return u[e];for(var t=e?e.length:0,n=[],i=[],a="",o=0;o<t;o++){var r=e[o],s=r.charCodeAt(0);s>=48&&s<=57||"_"===r||"-"===r?a+=r:"("!==r&&")"!==r&&":"!==r&&","!==r||(""!==a&&(i.push(a),n.push("id"),a=""),i.push(r),n.push(r))}a.length>0&&(i.push(a),n.push("id"));var l=function e(t,n,i,a){if(void 0===i&&(i=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var o=[],r="";i<t.length;){var s=t[i];if("id"===s)r=n[i];else if(","===s&&r)o.push(c(r)),r="";else if("("===s){var l=e(t,n,i+1,a+1),u=l[0];i=l[1],o.push(c(r,u)),r=""}else if(")"===s)return""!==r&&o.push(c(r)),[o,i];i++}return r&&o.push(c(r)),[o,i]}(n,i)[0];return Object.keys(u).length>300&&(u={}),u[e]=l,l}function _(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:d(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?n.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(l.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(l.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(l.intval)(e["attach"+i+"_call_receiver_id"])}):n.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function f(e){switch(e[0]){case 0:return{type:"event_delete",localId:e[1]};case 1:return O=(k=e)[1],C=k[2],j=k[3],{type:"event_replace_flags",messageId:O,mask:C,peerId:j};case 2:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_flags",messageId:t,flags:n,peerId:i}}(e);case 3:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_flags",messageId:t,flags:n,peerId:i}}(e);case 4:return h(e);case 5:return(S=h(e)).type=p,S;case 6:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_inbound",peerId:t,upToId:n,unread:i}}(e);case 7:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_outbound",peerId:t,upToId:n,unread:i}}(e);case 8:return b=(A=e)[1],y=A[2],w=A[3],{type:"event_got_online",userId:-b,platform:y,lastSeenTs:w};case 9:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_got_offline",userId:-t,reason:n,lastSeenTs:i}}(e);case 10:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 11:return function(e){var t=e[1],n=e[2];return{type:"event_replace_directories",peerId:t,mask:n}}(e);case 12:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 13:return function(e){var t=e[1],n=e[2];return{type:"event_delete_dialog",peerId:t,localId:n}}(e);case 18:return function(e){var t=h(e);return t.type="event_replace_message",t}(e);case 19:return function(e){var t=e[1];return{type:"event_invalidate_event",messageId:t}}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:"event_chat_changed",chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_chat_updated",peerId:n,updateType:t,updateArg:i}}(e);case 63:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_typing",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_recoding_audio",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:"event_video_call",userId:t,callId:n}}(e);case 80:return m=(f=e)[1],v=f[2],g=f[3],{type:"event_unread_count",count:m,countNotMuted:v,showOnlyNotMuted:g};case 114:return d=e[1],{type:"event_notify_settings_changed",peerId:(_=void 0===d?{}:d).peer_id,sound:_.sound,disabledUntil:_.disabled_until};case 115:return{type:"incoming_call",payload:e[1]};case 116:return function(e){var t=e[1],n=void 0===t?{}:t,i=h([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return i.type=p,i}(e);case 117:return c=e[1],{type:"event_audio_start",uuid:(u=void 0===c?{}:c).uuid,deviceName:u.device_name||""};case 119:return a=e[1],o=a.event_id,r=a.owner_id,s=a.peer_id,l=a.action,{type:"event_keyboard_callback_received",event_id:o,owner_id:r,peer_id:s,action:l};case-1:return{type:"event_resync"};case-2:return n=(t=e)[1],i=t[2],{type:"event_refresh_lp_key",key:n,url:i};case-3:return{type:"event_waiting_for_reconnect",timeout:e[1]};case-4:return{type:"event_reconnecting"};case-5:return{type:"event_reconnected"};default:return function(e){return{type:"event_empty",params:e}}(e)}var t,n,i,a,o,r,s,l,c,u,d,_,f,m,v,g,A,b,y,w,S,k,O,C,j}var p="event_edit_message";function h(e){var t,n=e[1],i=e[2],a=e[3],o=e[4],r=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=extend(s,l||void 0);return{type:"event_add_message",messageId:intval(n),flags:intval(i),peerId:intval(a),date:intval(o),attaches:_(f,n),subject:s.title||"",text:r,kludges:f,randomId:intval(c),userId:(t=a,t>2e9?intval(f.from):intval(a)),update_time:d,chat_local_id:u}}var m=function(){return(m=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function v(e,t){e.waitAbortFns.push(t)}function g(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=s(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],i=t[1];return window.lpDebug&&(window.lpDebug=m(m({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,i),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=m(m({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?o(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},i=n.abort,a=n.pause;switch(t.failed){case 1:return v(e,i),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(a).then((function(){return g(e)}));case 2:return v(e,i),e.onKeyExpired(e,t).then((function(t){var n=t[0],i=t[1],a=t[2],o=t[3];return e.onResult({ts:+o,updates:[[-2,n,i+"/"+a],[-1]]})})).then(a).then((function(){return g(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function A(e){e.isStoppedFn()||g(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&b(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),b(e,-3);var n=o(e.waitTimeout,null),i=n.abort,a=n.pause;return v(e,i),a().then((function(){return b(e,-4)}))}(e,t)})).then((function(){return A(e)}))}function b(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function y(e){return e||function(){}}function w(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}function S(e,t,n){var i=0,a=e,o=[],r=!1;function s(){!o.length||i>0||r||(t(o),o=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,s())},onLp:function(e,t,i){r||(a>=e?(a=t,o.push.apply(o,i),s()):n&&(r=!0,n(a).then((function(e){var t=e[1],n=e[2];a=t,r=!1,o.push.apply(o,n),s()}))))}}}var k={onNewMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(a.default)("msgId","dialogId"),onMsgReadByOther:Object(a.default)("msgId","dialogId"),onOnlineChange:Object(a.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(a.default)("dialogId","authorId"),onMultiTyping:Object(a.default)("peerId","userIds","totalCount"),onRecordingAudio:Object(a.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(a.default)("msgId"),onMsgImportantAdd:Object(a.default)("msgId"),onMsgRequestChange:Object(a.default)("peerId","type"),onMsgRemove:Object(a.default)("msgId"),onMsgListen:Object(a.default)("msgId"),onMsgRestore:Object(a.default)("msgId"),onPeerKeyboard:Object(a.default)("peerId"),onPeerBanner:Object(a.default)("peerId"),onPeerConvert:Object(a.default)("peerId","convertId"),onPeerAdmin:Object(a.default)("peerId","userId","isAdmin"),onDialogImportant:Object(a.default)("peerId","isImportant"),onDialogMarkedUnread:Object(a.default)("peerId","isMarkedUnread"),onDialogAdTag:Object(a.default)("peerId"),onDialogRemove:Object(a.default)("peerId"),onUnreadCount:Object(a.default)("count"),onIncomingCall:Object(a.default)("event"),onKeyboardCallback:Object(a.default)("eventId","peerId","ownerId","action"),onResync:Object(a.default)(),_onLpEvents:Object(a.default)("Array<Object>"),init:function(e){k._lpConnect&&(k._onLpEvents.off(),k._lpConnect.stopConnection(),k._lpQueue=null,k._lpConnect=null),k._lpConfig=e},isLongPollingEnabled:function(){return!(!k._lpConnect||k._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",O),window.addEventListener("offline",O),k._lpConnect?k._lpConnect.reinitConnection():k._createLongpoll(k._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",O),window.removeEventListener("offline",O),k._lpConnect&&k._lpConnect.stopConnection()},pause:function(){clog("[longpoll] pause"),k._lpQueue&&k._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),k._lpQueue&&k._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),k._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!k._lpConnect){var t=S(e.ts,(function(e){k._onLpEvents(e)})),n=function(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||11,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&o(i.ts,e.ts,e.updates.map(f))},onData:y(t.onData),onRequestError:y(t.onRequestError),onHistoryLost:w(t.onHistoryLost),onKeyExpired:w(t.onKeyExpired),onLpBroken:w(t.onHistoryLost)},a=t.onEvents;function o(e,t,n){i.ts=t;for(var o=0;o<n.length;++o)"event_refresh_lp_key"===n[o].type&&(i.key=n[o].key||"",i.url=n[o].url||"");a(e,t,n)}var r={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",s),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",s),b(i,-4),n=!1,A(i)},abortWaiting:function(){i.waitAbortFns.forEach((function(e){return e()})),i.waitAbortFns=[],i.waitTimeout=2},onLp:o};function s(){r.abortWaiting()}return document.addEventListener("resume",s),A(i),r}(e,{onEvents:function(e,n,i){i.length?i.forEach((function(i){t.onLp(e,n,[i])})):t.onLp(e,n,[])},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),t="/mail",(n={act:"get_key",user_id:e.id})&&(n.im_v=3),new Promise((function(e,a){ajax.post(t,n,{timeout:i,onDone:function(){e.apply(null,[Array.prototype.slice.call(arguments)])},onFail:function(){return a.apply(null,arguments),!0}})}));var t,n,i},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});k._lpQueue=t,k._lpConnect=n,k._onLpEvents((function(e){try{e.forEach(k._onEvent)}catch(e){console.error(e)}}))}},_onEvent:function(e){var t=e.type;switch(t){case"event_replace_flags":var n=e.flags,a=e.messageId;e.peerId;8&n?k.onMsgImportantAdd(a):k.onMsgImportantRemove(a),128&n||64&n?k.onMsgRemove(a):k.onMsgRestore(a);break;case"event_set_flags":var o=e.flags,r=e.messageId,s=e.peerId;8&o&&k.onMsgImportantAdd(r),(128&o||64&o)&&k.onMsgRemove(r,s),4096&o&&k.onMsgListen(r);break;case"event_reset_flags":var l=e.flags,c=e.messageId;e.peerId;8&l&&k.onMsgImportantRemove(c),(128&l||64&l)&&k.onMsgRestore(c);break;case"event_add_message":case p:case"event_replace_message":var u=e.messageId,d=e.peerId,_=e.randomId,f=e.text,h=e.flags,m=e.attaches,v=e.kludges,g=e.date,A=Object(i.toInt)(v.from_admin)||null,b=function(e){if(2&e.flags)return k._lpConfig.id;return e.userId}(e),y=!!v.source_act,w=t===p||"event_replace_message"===t,S=2&h,O=!!(65536&h),C={peerId:d,id:u,authorId:b,attaches:m,text:f,ts:g,flags:h,adminId:A,randomId:_,isService:w?void 0:y,edited:!!w||void 0,replaced:"event_replace_message"===t,keyboard:v.keyboard,isStealth:O,isOut:S,hasReply:function(e,t){t&1<<21&&function(e){e.fwd_count}(e)}(v,h),ttl:v.ttl||v.expire_ttl&&parseInt(v.expire_ttl)||null,isExpired:v.is_expired};w?k.onEditMsg(C):k.onNewMsg(C);break;case"event_read_inbound":case"event_read_outbound":var j=e.peerId,E=e.upToId;e.unread;"event_read_inbound"===t?k.onMsgReadByMe(E,j):k.onMsgReadByOther(E,j);break;case"event_got_online":case"event_got_offline":var T=e.userId,I=e.platform,M=(e.reason,e.lastSeenTs),P="mobile";I&&6!==I&&7!==I||(P="desktop"),k.onOnlineChange({userId:T,isOnline:"event_got_online"===t,onlinePlatform:P,lastActionTime:M});break;case"event_reset_directories":case"event_set_directories":var x=e.mask,L=e.peerId;e.local;1&x?k.onDialogImportant(L,"event_set_directories"===t):32768&x?k.onDialogAdTag(L):x&1<<20&&k.onDialogMarkedUnread(L,"event_set_directories"===t);break;case"event_replace_directories":var B=e.mask,R=e.peerId;e.local;k.onDialogImportant(R,!!(1&B));break;case"event_delete_dialog":var D=e.peerId;k.onDialogRemove(D);break;case"event_chat_updated":var N=e.peerId,H=e.updateType,V=e.updateArg;if(11===H&&k.onPeerKeyboard(N),10===H&&k.onPeerBanner(N),13===H&&k.onPeerConvert(V,N),12===H){var U="";switch(V){case 3:U="created";break;case 2:U="rejected";break;case 1:U="accepted";break;case 0:U="canceled"}k.onMsgRequestChange(N,U)}3===H&&k.onPeerAdmin(N,V,!0),9===H&&k.onPeerAdmin(N,V,!1);break;case"event_typing":var F=e.peerId,$=e.userIds,W=e.totalCount;e.ts;k.onMultiTyping(F,$,W);break;case"event_recoding_audio":var q=e.peerId,z=e.userIds,Y=e.totalCount;e.ts;k.onRecordingAudio(q,z,Y);break;case"event_video_call":break;case"event_unread_count":var G=e.count,Q=e.countNotMuted,K=e.showOnlyNotMuted;k.onUnreadCount(K?Q:G);break;case"event_notify_settings_changed":break;case"incoming_call":k.onIncomingCall(e);break;case"event_keyboard_callback_received":var X=e.owner_id,J=e.peer_id,Z=e.event_id,ee=e.action;k.onKeyboardCallback(Z,J,X,ee);break;case"event_resync":k.onResync()}}};t.default=k;function O(e){"online"===e.type?(clog("[longpoll] online"),k._lpConnect.reinitConnection()):(clog("[longpoll] offline"),k._lpConnect.stopConnection())}},XCiN:function(e,t,n){"use strict";n.r(t);var i=n("izth");window.isBootstrapInited||(window.cur={destroy:[]},window.lang={},Object(i.setDocumentDomain)(),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.isBootstrapInited=!0)},XLP4:function(e,t){window.FeedAssistanceImportContacts={importContacts:function(e,t,i){if(!window.XMLHttpRequest||i)return;var a=domData(e,"service-id");return window.open(t),n[a]=e,!1}};var n={},i="feedAssistanceImportContacts__desc",a=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement((function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(a=!0)})),Friends.onImportSuccess((function(){var e=arguments[0],t=arguments[2],o=n[e];if(o){var r=geByClass1(i,o);r.textContent=getLang("mobile_join_friends_found_count",t)}a&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,o,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})})),Friends.onImportFailed((function(e){var t=n[e];t&&(geByClass1(i,t).textContent=getLang("mobile_friends_import_error"))}))},"YU/R":function(e,t,n){"use strict";n.r(t),n.d(t,"ContextMenu",(function(){return o})),n.d(t,"ContextMenuItem",(function(){return r}));var i=n("OcsD"),a=n("wTbK");function o(e){return Object(a.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[e.list?{tag:"ul",class:"ContextMenu__list",inner:Wd.wrap(e.list)}:null]})}function r(e){return{inner:[{inner:[e.title],"data-ref":e.ref,href:e.href,target:e.target,class:"ContextMenu__listLink",onclick:e.onclick,tag:"a"}],class:"ContextMenu__listItem","data-name":e.name,tag:"li"}}var s=n("t7Ww"),l=n("UxAg"),c={open:function(e,t,n){void 0===n&&(n={});var i=e.closest(t),a=!!n.appendToBody,o=Object(l.$)(d,i);o&&(o=s.default.open(o,a),u=function(){f(o)},nav.onBeforeGo(u));return!1},close:f},u=function(){},d=".ContextMenu",_=".ContextMenu.Popup_open";function f(e){return e||(e=Object(l.$)(".Popup_open.ContextMenu")||Object(l.$)(_)),e&&s.default.close(e),nav.onBeforeGo.off(u),!1}Object(i.extend)(o,c);t.default=o;window.ContextMenu=o},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},ZD4m:function(e,t,n){"use strict";function i(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}function a(){var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function o(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n&&i?{width:n,height:i}:{width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"getElementOffset",(function(){return i})),n.d(t,"getViewportSize",(function(){return a})),n.d(t,"getElementSize",(function(){return o})),n.d(t,"getJsonDataValue",(function(){return r}));var r=function(e,t){var n=e.getAttribute(t);if(n)try{return JSON.parse(n)}catch(e){return}}},aJgW:function(e,t,n){"use strict";n.r(t),n.d(t,"ColorSchemeMode",(function(){return i})),n.d(t,"ColorSchemeName",(function(){return a})),n.d(t,"ColorScheme",(function(){return s})),n.d(t,"colorScheme",(function(){return r}));var i,a,o=n("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(i||(i={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(a||(a={}));var r,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var n=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){n.currentMode===i.Auto&&n.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?a.Dark:a.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(o.setCookie)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var n=!1;switch(t){case i.Light:n=!1;break;case i.Dark:n=!0;break;case i.Auto:if(e.isSchemesAutoSwitchingSupported())n=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(n),this.isModeSavingAllowed&&Object(o.setCookie)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var n,i=(null===(n=this.schemesMap)||void 0===n?void 0:n[t])||t;e.setAttribute("scheme",i)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();r=window.colorScheme?window.colorScheme:new s,window.colorScheme=r,window.isSchemesSupported=s.isSchemesSupported.bind(null)},"aiw/":function(e,t,n){"use strict";n.r(t),n.d(t,"onOpen",(function(){return q})),n.d(t,"onClose",(function(){return z})),n.d(t,"isKeyboardOpen",(function(){return Y})),n.d(t,"onCloseCallback",(function(){return G})),n.d(t,"offCloseCallback",(function(){return Q})),n.d(t,"onOpenCallback",(function(){return K})),n.d(t,"offOpenCallback",(function(){return X}));var i=0,a=0,o=null,r=null;function s(){var e=pageYOffset;e!==i&&999999!==e&&(i=e,a=Math.max(a,e),scrollTo(0,999999)),clearTimeout(r),r=setTimeout((function(){r=null,window.removeEventListener("scroll",s),scrollTo(0,999999),setTimeout((function(){return scrollTo(0,999999)}),1e3)}),150)}var l,c,u,d,_,f,p,h,m,v=n("H5mD"),g=0,A=0,b="",y=!1,w={},S=0;function k(e){if(b=e,y=!1,l=!1,u=0,d=0,f=0,p=0,w={},void 0,h="start",m=0,S=0,v.isIPhone)if("top"===b||"bottom"===b){I()<v.IPHONE_KEYBOARD_REJECT_OFFSET&&M(0);var t=document.body;_=t.offsetHeight,t.offsetWidth,window.addEventListener("scroll",C),"top"===b&&Object(v.isLandscapePhone)()||(E(),j())}else document.body.classList.add("ScrollViewsDisabled")}function O(){"top"===b||"bottom"===b?(c&&clearTimeout(c),window.removeEventListener("scroll",C)):document.body.classList.remove("ScrollViewsDisabled"),y=!1,b="",l=!1,_=0,0}function C(){if(E(),"top"!==b){if("bottom"===b){var e=pageYOffset,t=I();l&&(l=!1,e===f)||(v.isWKWebView?p<=5&&j():e>v.IPHONE_KEYBOARD_REJECT_OFFSET?e>t?(M(e),v.isWKWebView||j()):e<t?w[e]||e>T(t)?(w[e]=!0,j(_)):j():e!==T(t)&&j():t||(e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?(u===e?d++:(u=e,d=1),d>=3&&(window.removeEventListener("scroll",C),M(u)),setTimeout((function(){j()}),300)):j()))}}else{if(Object(v.isLandscapePhone)())return;if(v.isWKWebView)return void(0!==pageYOffset&&j(0));var n=innerHeight;if("start"===h&&(n<_?h="animate":j(1)),"animate"===h)if(m=_-n,S||(S=Math.max(1,Math.min(4,Math.floor(m/10)))),m<=0)h="stop";else{var i=v.isIPad?v.iosMajor<11?3:2:1;j(Math.min(m,S)*i)}"stop"===h&&j(1)}}function j(e){l=!0;var t,n=I();"bottom"===b?t=e||(!n||v.isWKWebView||v.isIPad?_:T(n)):"top"===b&&(t=isFinite(e)?e:1),p++,f=t,window.scrollTo(0,t)}function E(){c&&clearTimeout(c),y||(c=setTimeout((function(){y=!0,c=null,window.removeEventListener("scroll",C)}),500))}function T(e){return v.isIPad||v.isWKWebView||90===Math.abs(window.orientation)&&screen.width>=375||(v.isIPhoneX?e-=v.IPHONE_X_SAFARI_BOTTOM_BAR:e-=v.IPHONE_SAFARI_BOTTOM_BAR),e}function I(){return 90===Math.abs(window.orientation)?g:A}function M(e){90===Math.abs(window.orientation)?g=e:A=e}var P=null,x=0,L=0;function B(){if(!(visualViewport.height>=x)){var e=x-visualViewport.height;L!==e&&(!v.isWKWebView&&e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?scrollTo(0,0):scrollTo(0,e))}}var R=!1,D=!1,N=!1,H=null,V=[],U=[],F=null,$=v.isScrollBasedViewport&&(v.isIPad||v.isWKWebView),W=v.isScrollBasedViewport&&v.iosMajor<=12;function q(e,t){void 0===e&&(e="default");var n=(void 0===t?{}:t).exitIfStarted,l=void 0!==n&&n;if(v.isIOS&&!(v.iosMajor<8)&&!(D&&l||R)){if(F=e,D=!0,H&&(clearTimeout(H),H=null),"bottom"===e){if((Object(v.isLandscapePhone)()||!$&&!W)&&!function(){if(P||(P={onceBlocked:!1}),P.onceBlocked&&(P.opened=!0),!P.onceBlocked&&!P.opened){P.onceBlocked=!0;var e=document.activeElement;return e.blur(),e.focus(),!1}return P.opened=!0,window.visualViewport&&(x=visualViewport.height,L=0,setTimeout(B),visualViewport.addEventListener("scroll",B),visualViewport.addEventListener("resize",B)),!0}())return;!$&&W&&k(e),$&&function(e){void 0===e&&(e="default"),o&&(clearTimeout(o),o=null),r&&(clearTimeout(r),r=null),i=0,0,0,a=0,window.addEventListener("scroll",s),setTimeout((function(){scrollTo(0,999999)}),10),setTimeout((function(){scrollTo(0,999999)}),100),setTimeout((function(){scrollTo(0,999999)}),200),setTimeout((function(){scrollTo(0,999999)}),300),setTimeout((function(){scrollTo(0,999999)}),400),setTimeout((function(){scrollTo(0,999999)}),500)}()}else!$&&W&&k(e);U.length&&U.forEach((function(e){return e()})),R=!0,D=!1}}function z(e){var t=(void 0===e?{}:e).exitIfStarted,n=void 0!==t&&t;if(v.isIOS&&!(v.iosMajor<8)&&(!N||!n)){if(N=!0,"bottom"===F){if((Object(v.isLandscapePhone)()||!$&&!W)&&(!P||P.onceBlocked&&!P.opened||(window.visualViewport&&(setTimeout(B),visualViewport.removeEventListener("scroll",B),visualViewport.removeEventListener("resize",B)),P=null,x=0,L=0,0)))return;if(!R)return;!$&&W&&O(),$&&(clearTimeout(o),clearTimeout(r),i=0,0,0,o=null,r=null,window.removeEventListener("scroll",s))}else!$&&W&&O();R=!1,N=!1,F=null,H&&clearTimeout(H),H=setTimeout((function(){scrollTo(0,0),V.length&&V.forEach((function(e){return e()}))}),10)}}function Y(){return R}function G(e){-1===V.indexOf(e)&&V.push(e)}function Q(e){var t=V.indexOf(e);-1!==t&&V.splice(t,1)}function K(e){-1===U.indexOf(e)&&U.push(e)}function X(e){var t=U.indexOf(e);-1!==t&&U.splice(t,1)}},b6Sp:function(e,t,n){"use strict";function i(e,t){var n=t;return e&&(n=[e]).push(t),n}function a(e){var t=e.elements,n={};return Array.from(t).forEach((function(e){switch(e.type){case"submit":break;case"radio":e.checked&&(n[e.name]=e.value);break;case"checkbox":e.checked&&(n[e.name]=i(n[e.name],e.value));break;default:n[e.name]=i(n[e.name],e.value)}})),n}n.r(t),n.d(t,"getFormValues",(function(){return a}))},bKAG:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return c})),n.d(t,"StoryType",(function(){return i})),n.d(t,"StoryEntryPoint",(function(){return a})),n.d(t,"StorySource",(function(){return o})),n.d(t,"getStoryUploadUrl",(function(){return u})),n.d(t,"uploadStoryBlobToServer",(function(){return d})),n.d(t,"saveStoryOnServer",(function(){return _}));var i,a,o,r=n("jE6c"),s=n("PU8N"),l=function(){return(l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=16;function u(e){return new Promise((function(t,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",l({act:"get_upload_url"},e),{onDone:t,onError:n,onFail:n})}))}function d(e,t){var n=new FormData,i=encodeURIComponent("edited_"+Object(r.irand)(0,99999)+".jpg");return n.append("file0",e,i),fetch(t,{method:"POST",body:n}).then((function(e){return e.json()}))}function _(e,t){return new Promise((function(n,i){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:n,onError:i,onFail:i})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(a||(a={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(o||(o={}))},bRFj:function(e,t){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(e,t,i,a,o,r,s,l){void 0===i&&(i="");void 0===a&&(a=null);void 0===o&&(o="");void 0===r&&(r="");void 0===s&&(s=null);void 0===l&&(l=null);n("accept",e,t,i,a,o,r,s,l)},decline:function(e,t,i,a,o,r,s,l){void 0===i&&(i="");void 0===a&&(a=null);void 0===o&&(o="");void 0===r&&(r="");void 0===s&&(s=null);void 0===l&&(l=null);n("decline",e,t,i,a,o,r,s,l)},makeImportRequest:function(e,t,n){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},(function(e){return function(e,t,n){var a=parseJSON(e),o=a.user,r=a.user_hash,s=a.contacts,l="/friends.php?act=save_contacts&type="+n;if(a.error)return void i(n);ajax.post(l,{_ajax:1,user:o,userhash:r,hash:t,contacts:s},{onDone:function(e,t){return function(e,t,n){var i=geByClass1("friendsImport__loading"),a=geByClass1("friendsImport__result");addClass("friendsImport__loading_hidden",i),a&&(a.innerHTML=t,addClass("friendsImport__result_shown",a));autoScroll((function(){return geByClass1("friendsList__footerBtn_showMore")}),ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,n),window.opener&&window.opener.Friends.onImportSuccess(e,t,n)}(n,e,t)},onFail:function(){return i(n)}})}(e,t,n)}),(function(){return i(n)}),!0)}};function n(e,t,n,i,a,o,r,s,l){var c={act:e,hash:n,id:t};i&&(c.from=i),a&&(c.block_id=a),o&&(c.ref=o),r&&(c.track_code=r);var u="/friends"+obj2qs(c);ajax.post(u,{_ajax:1},{onDone:s,onFail:l})}function i(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},"bZ/P":function(e,t,n){"use strict";n.r(t);var i={};function a(e,t){return e+'="'+t+'"'}function o(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(e,r(n))}}function r(e){return e[0]+"("+e.slice(1).map(s).join(", ")+")"}function s(e){return"number"==typeof e||"event"===e||"this"===e?e:JSON.stringify(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e,t){var n,i=[];"string"==typeof t&&((n={})[t]=!0,t=n);return Object.keys(t).forEach((function(n){var a=t[n];!0===a?i.push(e+"_"+n):a&&i.push(e+"_"+n+"_"+a)})),i}Object.assign(i,{html:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a="";return e.forEach((function(e,t){var i=n[t];a+=e+(i||0===i?i:"")})),a}}),Object.assign(i,{attr:a,onBlur:o("onblur"),onClick:o("onclick"),onFocus:o("onfocus"),onInput:o("oninput"),onKeyDown:o("onkeydown"),onKeyPress:o("onkeypress"),onKeyUp:o("onkeyup"),onMouseDown:o("onmousedown"),onMouseUp:o("onmouseup"),onScroll:o("onscroll"),onSubmit:o("onsubmit"),onTouchEnd:o("ontouchend"),onTouchMove:o("ontouchmove"),onTouchStart:o("ontouchstart"),onWheel:o("onwheel"),onChange:o("onchange")}),Object.assign(i,{list:function(e,t){void 0===t&&(t=null);Array.isArray(e)||(e=[e]);return t?e.map(t).join(""):e.join("")}}),Object.assign(i,{class:function(){for(var e=[],t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){"string"==typeof n?(e.push(n),t=n):n&&(e=e.concat(l(t,n)))})),e.join(" ")},parseClass:function(e,t){var n={};return t.trim().split(/\s+/).forEach((function(t){if(t!==e){var i=t.replace(e+"_","").split("_");n[i[0]]=!(i.length>1)||i[1]}})),n}});t.default=i;window.q=i},cGUQ:function(e,t,n){"use strict";n.r(t),n.d(t,"fromQueryString",(function(){return l})),n.d(t,"toQueryString",(function(){return s}));var i=n("jE6c"),a={},o=function(e){if(a[e])return e;try{return encodeURIComponent(e)}catch(e){return""}},r=function(e){try{return decodeURIComponent(e)}catch(t){return a[e]=1,e}};function s(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)&&null!=e[a]&&!Object(i.isFunction)(e[a]))if(Object(i.isArray)(e[a]))for(var r=0,s=0,l=e[a].length;r<l;++r)null==e[a][r]||Object(i.isFunction)(e[a][r])||(n.push(o(a)+"["+s+"]="+o(e[a][r])),++s);else n.push(o(a)+"="+o(e[a]));return t||n.sort(),n.join("&")}function l(e){if(!e)return{};var t={};return e=e.split("&"),Object(i.each)(e,(function(e,n){var i=n.split("=");if(i[0]){var a=r(i[1]+"");if("[]"===i[0].substr(i.length-2)){var o=r(i[0].substr(0,i.length-2));t[o]||(t[o]=[]),t[o].push(a)}else t[r(i[0])]=a}})),t}},cLcH:function(e,t){function n(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,n,i,a,o){var s=hasClass(e,"post__subscribeBtn_unsubscribe"),l=s?i:n,c=s?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),u=!s,d=geByClass1("post__subscribeBtnIcon",e),_=(f=e,p=domCA(f,".post_exploreBait"),intval(domData(p,"block-id")));var f,p;d&&(toggleClass("post__subscribeBtnIcon_unsubscribe",d,u),toggleClass("post__subscribeBtnIcon_subscribe",d,!u));attr(e,"aria-label",escapeAttr(c)),toggleClass("post__subscribeBtn_unsubscribe",e,u),"group"===a?function(e,t,n,i){var a=n?Groups.leave:Groups.enter,o=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;i&&r(o),a.call(Groups,e,t,"feed")}(t,l,s,o):function(e,t,n,i,a){var o=n?Friends.decline:Friends.accept,s=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&r(s),o.call(Friends,e,t,"feed",i)}(t,l,s,_,o);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(e._exploreBaitClickHandlerAdded)return;a=!0,addEvent(e,"click",(function(e){!function(e){for(var t,i=e.target,a=n(s);!(t=a()).done;){if(!0===t.value.call(null,i))return}}(e)})),e._exploreBaitClickHandlerAdded=!0}})),nav.onBeforeGo((function(e){if(!a)return void(o=!1);if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;o=hasClass("item_replies",e),function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){if(hasClass(n[t],e))return r(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)})),window.page&&page.onChange((function(){if(!a)return;o&&function(){var e=ge("nc_submit");addEvent(e,"click",(function(){r(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_COMMENT)}))}()}));var a=!1,o=!1;function r(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var s=[function(e){if("A"!==e.tagName||!hasClass("item_sel",e))return hasClass("item_like",e)||(hasClass("i_like",e)||hasClass("v_like",e))&&!hasClass("item_sel",domPN(e))?(r(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):void 0},function(e){if(domData(e,"post-owner-type"))return r("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return r(t),!0}]},cZev:function(e,t,n){"use strict";n.r(t);var i=n("Xrg9"),a=n("J8bf"),o=n("kr3z"),r=n("fdw3"),s=n("+cqQ"),l=n("UxAg"),c=n("zvhO"),u=n("OcsD"),d=n("W9Tc"),_=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],r=0,s=o.length;r<s;r++,a++)i[a]=o[r];return i},f=function(){function e(){}return e.saveStickerPanel=function(e,t){i.default.set("sticker_panel",e),t&&Object(a.setCookie)("remixstickers_hash",t),window.cur.sticker_panel=e},e.getStickerPanel=function(e){if(void 0===e&&(e=""),e||(e=Object(r.getState)("target")||""),!Object(d.partConfigEnabled)("mvk_stickers_panel_optimize"))return cur.sticker_panel&&cur.sticker_panel.replace(/mail0/g,e);var t=i.default.get("sticker_panel")||window.cur.sticker_panel;return t?e?t.replace(/mail0/g,e):t:""},e.saveStickers=function(t){e.stickers=t,i.default.set("stickers",t)},e.setStickerTab=function(e,t){return void 0===t&&(t=[]),Object(d.partConfigEnabled)("mvk_stickers_panel_optimize")?(this.getStickers(),this.stickers[e]||(this.stickers[e]=[]),t&&(this.stickers[e]=t),this.saveStickers(this.stickers),this.stickers[e]):cur.stickers&&cur.stickers[e]},e.getStickers=function(){if(!Object(d.partConfigEnabled)("mvk_stickers_panel_optimize"))return cur.stickers;if(this.stickers)return this.stickers;var t=i.default.get("stickers");return!t&&cur.stickers&&(t=cur.stickers,this.saveStickers(t)),e.stickers||(e.stickers=t),e.stickers},e.setNewStickersCount=function(t,n){var i=n||e.getStickerPanel();if(!Object(c.isNumber)(t))return n;var a=ce("div");a.innerHTML=i;var o=Object(l.$)(".sp_badge",a),r=window.devicePixelRatio>=1.5?"_2x":"";return Object(u.setStyle)(o,{"background-image":t>0?"url(/images/mobile/badge"+t+r+".png)":""}),a.innerHTML},e.checkStickers=function(t){var n=this;if(void 0===t&&(t={}),Object(d.partConfigEnabled)("mvk_stickers_panel_optimize")){if(!window.vk)return setTimeout((function(){var t;return(t=n.checkStickers).call.apply(t,_([e],arguments))}),1e3);if(window.vk.id){if(this.getStickers()&&this.getStickerPanel()&&Object(a.getCookie)("remixstickers_hash")){if(!t.force&&Date.now()-i.default.get("stickers_last_load")<3e5)return clog("[StickerCache] Stickers check was fired in less than 5 minutes. Prevent loading"),!1}else clog("[StickerCache] Stickers cache isn't loaded or broken"),Object(a.setCookie)("remixstickers_hash","");t.ignore_hash&&Object(a.setCookie)("remixstickers_hash",""),i.default.set("stickers_last_load",Date.now()),o.default.post("/?act=load_stickers",{},{onDone:function(t){if(i.default.set("stickers_last_load",Date.now()),t){if(t.part_load){clog("[StickerCache] Force loaded some categories");var n=t.stickers_data,a=t.new_items;if(Object(c.isNumber)(a)){var o=e.setNewStickersCount(a);e.saveStickerPanel(o)}var r=extend(e.getStickers()||{},n);e.saveStickers(r)}else{clog("[StickerCache] New version of stickers async loaded");o=t.sticker_panel,n=t.stickers_data;e.saveStickerPanel(o,t.hash),e.saveStickers(JSON.parse(n))}e.onStickerPanelUpdate()}else clog("[StickerCache] Stickers already exists.")}})}else clog("[StickerCache] User unauthorized.")}},e.stickers=null,e.onStickerPanelUpdate=Object(s.default)(),e}();t.default=f},ciqL:function(e,t){var n={show:function(e,t){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){n.onCallback(e)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+t})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(e){if(grecaptcha&&e){var t=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",t);i&&(val(i,""),grecaptcha.render(i,{sitekey:e,callback:n.onResponse}))}}};window.ReCaptcha=n},drfJ:function(e,t,n){"use strict";n.r(t);var i=n("STl5"),a=n("DkIl"),o=n("fdw3");function r(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel,a=s("markAsUnread",null,'onmousedown="uMessenger.onMarkDialogAsUnreadClick()"');return e>-2e9&&e<0?[s("showMedias",n.showMedia),a,s("deleteHistory",n.flushHistory),s("blockCommunity",n.blockCommunity),s("unblockCommunity",n.unblockCommunity),s("blockNotify",n.blockNotify)]:Object(o.isChatPeer)(e)?[s("chatInfo",n.chatInfo,"",i),s("chatAdd",n.addToChat),Object(o.isEduIntegration)()?"":s("inviteLink",n.inviteLink,"",i),s("showMedias",n.showMedia),n.unpinMsg?s("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?s("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?s("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",a,s("chatDeleteHistory",n.flushHistory),s("chatReturn",n.returnToChat,"",i),s("chatLeave",n.leaveChat,"",i)]:t.cur.groupId?[s("showMedias",n.showMedia),s("markAsAnswered",n.communityMarkAsAnswered),a,n.isDialogImportant?s("removeImportantMark",n.communityToggleImportant):s("markAsImportant",n.communityToggleImportant),n.isBlacklisted?s("unbanUser",n.userBan):s("banUser",n.userBan),s("deleteHistory",n.flushHistory)]:[s("showMedias",n.showMedia),a,s("deleteHistory",n.flushHistory)]}function s(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1);var a=window.lang;if(!t&&!n)return null;var o={showMedias:[a.mobile_mail_show_medias,"picture_outline_28"],deleteHistory:[a.mobile_mail_delete_history,"delete_outline_28"],blockCommunity:[a.mobile_mail_block_community,"remove_circle_outline_28"],blockNotify:[a.mobile_mail_block_community_notify,"remove_circle_outline_28"],unblockCommunity:[a.mobile_mail_unblock_community,"add_circle_outline_28"],chatAdd:[a.mobile_mail_add_to_chat,"add_circle_outline_28"],chatUnpinMsg:[a.mobile_mail_unpin_msg,"unpin_outline_28","unpin"],chatShowPinnedMsg:[a.mobile_mail_pin_show,"pin_outline_28","showPinned"],chatHidePinnedMsg:[a.mobile_mail_pin_hide,"hide_outline_28","hidePinned"],chatInfo:[a.mobile_mail_chat_info,"info_outline_28"],chatDeleteHistory:[a.mobile_mail_delete_chat_history,"delete_outline_28"],chatReturn:[i?a.mobile_mail_return_to_channel:a.mobile_mail_chat_return,"chevron_left_outline_28","returnToChat"],chatLeave:[i?a.mobile_mail_channel_leave:a.mobile_mail_chat_leave,"cancel_circle_outline_28","leaveChat"],markAsAnswered:[a.mobile_mail_mark_as_answered,"double_mark_outline_28"],removeImportantMark:[a.mobile_mail_remove_important_mark,"unfavorite_outline_28"],markAsImportant:[a.mobile_mail_mark_as_important,"favorite_outline_28"],markAsUnread:[a.mobile_mail_mark_as_unread,"mark_unread_outline_28"],unbanUser:[a.mobile_settings_blacklist_unban_user,"add_circle_outline_28"],banUser:[a.mobile_settings_blacklist_ban_user,"remove_circle_outline_28"],inviteLink:[i?a.mobile_mail_channel_invite_link:a.mobile_mail_invite_link,"link_outline_28"]},r={text:o[e][0],icon:SVGIcon("mail-unfold",o[e][1]),attrs:n,url:t};return o[e][2]&&(r.name=o[e][2]),r}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=Object(o.isChatPeer)(e),s=Object(o.isContactPeer)(e),l={title:n.title,photos:n.avatarImages,actions:r(e),editing:t.cur.editing,peerProfile:{isEnabled:t.flags.isPeerProfileEnabled,tagsData:n.peerProfileTagsData||{},tags:t.peerProfileTags||[]}};if(i){var c=i?e-2e9:null;if(l.url="/mail?act=info&chat="+c,l.membersCount=n.countMembers,l.hasPinnedMsg=n.hasPinnedMsg,l.isChannel=n.isChannel,l.isCasper=n.isCasper,l.isChannel||n.isCommunityChat){var u=-n.ownerId;l.url="/club"+u}else if(n.viewerId<0){var d=-n.viewerId;l.url="/mail?act=info&chat="+c+"&community="+d}}else l.url=n.profileUrl,l.isOnline=n.isOnline,l.onlinePlatform=n.onlinePlatform,l.offlineText=n.offlineText,l.isContact=s;return Object(a.MailHat_convo)(l)}(e);if(t)return function(e){return Object(a.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=!!t,o=n?"&community="+t:"",r=n?"?community="+t:"";return Object(a.MailHat_main)({folder:e.folder,urls:{all:"/mail"+r,unrespond:"/mail?act=unrespond"+o,unread:"/mail?act=unread"+o,important:"/mail?act=important"+o,adTag:"/mail?act=ad_tag"+o,createChatUrl:"/mail?act=new_chat"},unreadCount:e.countUnread,importantCount:e.countImportant,withUnrespond:n,withAdTag:n,forwarding:!!e.forwardFromId,notifier:Object(i.default)()})}()}},eJy5:function(e,t){var n=need("Voting");function i(e){o(e.$voting,e.url)}function a(e,t){o(t.$voting,e,!0)}function o(e,t,i){var a=setTimeout((function(){n.setLoading(e)}),140);ajax.post(t,{_ajax:1},{onDone:function(t,o){domData(e,"is-web-view")&&n._onPollChanged&&n._onPollChanged(e,i),clearTimeout(a),n.setHtml(t,o)}})}window.uVoting={},uVoting._onSubmit=i,uVoting._onRevoteClick=a},eWFs:function(e,t,n){"use strict";n.r(t),n.d(t,"uConvo_getLastMsgId",(function(){return f}));n("bZ/P");var i=n("TYsd"),a=(n("Mc5h"),n("s0aB")),o=n("iWgD"),r=n("/Id8"),s=n("fdw3"),l=function(e,t){void 0===t&&(t=null);var n="last"===t,i=store.mail,o=i.peers[e],r=Object(s.isContactPeer)(e),l=o.url,_=null;if(t){var f;n||(l=l+"&msg="+t),(f=n?p(e):i.msgs[t])&&(_={text:c(f),date:f.dateShort,unreadCount:d(e),muted:o.isMuted,typing:h(e),pending:f.pending,failed:f.failed})}return Object(a.default)({id:e,url:l,photos:o.avatarImages,title:o.title,online:u(o),important:o.isImportant,profileUrl:o.profileUrl,isLast:n,peerProfile:{tagsData:o.peerProfileTagsData||{},tags:i.peerProfileTags||[]},isMarkedUnread:o.isMarkedUnread,more:_,isCasper:o.isCasper,isContact:r,name:o.title})};function c(e){var t=window.lang,n=store.mail,a=!!e.attaches.call;if(e.isExpired){var o=Object(s.getLang)("mobile_mail_you")+": "+Object(s.getLang)("mobile_casper_chat_message_disappeared");return i.default.html({inner:[o],tag:"span"})}if(e.isService&&!a)return i.default.html({tag:"span",inner:[i.default.wrap(e.serviceText)]});var l=e.body?i.default.wrap(Object(r.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:Object(r.Msg__attachPreview)(e)}}(e),c="";return e.authorId===n.cur.userId&&e.peerId!==n.cur.userId?c=t.mobile_mail_you:Object(s.isChatPeer)(e.peerId)&&e.authorId&&(c=(c=n.members[e.authorId].shortName).replace(/\.$/,"")),c&&(c+=": "),i.default.html({tag:"span",inner:[i.default.wrap(c),l]})}function u(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function d(e){var t=_(e).countUnread;if(0===t){var n=store.mail,i=p(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function _(e){return store.mail.peers[e]}function f(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],a=t.presend&&t.presend.failed[e];if(i&&i.length)for(var o=i.length-1;o>=0;o--){var r=i[o];if(-1===r.indexOf("edit"))return r}if(a&&a.length)for(var s=a.length-1;s>=0;s--){var l=a[s];if(-1===l.indexOf("edit"))return l}return n&&n.length?last(n):null}function p(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,a=f(e);return i&&i[a]?i[a]:a?t[a]:null}function h(e){var t,n,i=Object(o.uTyping_getPeerTyping)(e),a=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!a||Object(o.uTyping_getNames)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}n("+cqQ");Object.assign(l,{onTap:a.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=u(t);a.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=d(e),n=_(e).isMarkedUnread;a.default.setUnreadCount(e,t,n)},redrawLastMsg:function(e){var t=p(e);t&&a.default.setLastMsg(e,c(t),{dateShort:t.dateShort,pending:t.pending,failed:t.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=Object(o.uTyping_getPeerTyping)(e),n=(t&&1===t.count&&t.users[0],h(e));a.default.setTyping(e,n)},redrawImportant:function(e,t){a.default.setImportant(e,t)},updateAdTag:function(e){var t=store.mail.peers[e];a.default.updateAdTag(e,t.peerProfileTagsData)}});t.default=l;window.uConvo=l},eoxF:function(e,t){var n=function(){var e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l="",c="";function u(e,t){return!t&&g(e)}function d(e){i=!1;var n=ge("medias_map"),a=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),append(n,a));var o=+e[1]||0,r=e[3]||"",s=e[4]||"",l=e[5]||"",c=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",n),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+r+(l?", "+l:s?", "+s:"")+"</div>",_='<input type="hidden" name="place_id" value="'+o+'"><input type="hidden" name="place" value="'+c+'">';if(u)val(u,d+_);else{d='<div class="medias_map">'+d+_+"</div>";val(n,d)}addClass("cp_geo_btn_sel","geo_btn"),t=!0,show(n)}function _(t){return g(e)}function f(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function p(t,n){h();var i=a[n];i&&(e={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):m(e,i))}function h(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function m(e,n){i=!0;var a=ge("medias_map"),o=ge("attached_wrap");a||(a=ce("div",{id:"medias_map",className:"pi_medias"}),o.appendChild(a));var r=e.latitude,s=e.longitude,l=(window.devicePixelRatio,n&&n[4]||!1),c=geByClass1("medias_map",a),u=l?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+l+"</div>":"",d='<input type="hidden" name="map" value="'+(r+"_"+s+"_0")+'">';c?val(c,u+""+d):val(a,'<div class="medias_map">'+u+d+"</div>");t=!0,addClass("cp_geo_btn_sel","geo_btn"),show(a)}function v(){e=null,a={},o=[],r=0,ajax.post(c,{_ajax:1}),remove("medias_map")}function g(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,a=gpeByTag("form","geo_btn"),o=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!a)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var r=!1;return each(a,(function(e,t){if("submit"===t.type)return r=t,!1})),r?(append(o,a),window.al&&t.ver?nav.go(r,null,{removeAfterNextResponse:!1}):a.submit()):void 0}function A(t){t&&t.coords&&u(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0})}function b(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},addNewPlace:function(){var t=val("place_name_fld"),n=val("place_address_fld");return t?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:e.latitude,longitude:e.longitude,title:t,address:n,hash:l},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(a,n),o.splice(o[0]?0:1,0,e),f(),p(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(t,n){var i=window.lang,a="/places.php"+obj2qs({act:"add_place",latitude:e.latitude,longitude:e.longitude,hash:l});val("place_add_box",'<h3 class="sub_header">'+i.mobile_geo_new_place_header+'</h3><div class="form_item fi_fat"><form id="place_add_form" action="'+a+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(t)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),t?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:f,selectPlace:p,changePlace:_,back:h,refreshCurrentPosition:function(){geo.getCurrentPosition(A,b)},getCurrentAddress:function(){return a[0]&&a[0][5]||""},savePlaces:function(e){extend(a,e)},add:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(A,b),show("geo_waiting"))},add_place:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(A,b),show("geo_waiting"))},remove:function(){t=!1,removeClass("cp_geo_btn_sel","geo_btn"),v()},stash:function(n){if(!n)return[e,t,i,a,o,r,s];e=n[0],t=n[1],i=n[2],a=n[3],o=n[4],r=n[5],s=n[6]},init:function(u,d,_){return hide("geo_waiting"),e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l=d||"",c=_||"",u&&n.add(u),geo.init()}}}();window.checkin=n},eyw1:function(e,t){var n=function(){function e(e,t,n,i,a,o){var r="/club"+t+obj2qs({act:e,hash:n,id:t,from:i});ajax.post(r,{_ajax:1},{onDone:a,onFail:o})}return{enter:function(t,n,i,a,o){void 0===a&&(a=null),void 0===o&&(o=null),e("enter",t,n,i,a,o)},leave:function(t,n,i,a,o){void 0===a&&(a=null),void 0===o&&(o=null),e("leave",t,n,i,a,o)}}}();window.Groups=n},fWqt:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"onConfirmDelete",(function(){return u})),n.d(i,"open",(function(){return d})),n.d(i,"close",(function(){return _})),n.d(i,"isDeleteMessagesForAll",(function(){return f}));var a=n("MUpH"),o=n("bZ/P"),r=n("+cqQ"),s=n("iS9e");function l(){var e=Object(a.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=null,u=Object(r.default)();function d(e){s.default.open({body:p(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:o.default.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:o.default.onClick("MsgDeleteDialog.close")})}function _(){var e=$(".MsgDeleteDialog__checkboxInput");e&&(c=e.checked,lsSet("delete_message_for_all_checked",c)),s.default.close()}function f(){var e=$(".MsgDeleteDialog__checkboxInput");return!!e&&e.checked}function p(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var r=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(r,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var s=lang.mobile_mail_delete_for_all;n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="MsgDeleteDialog__checkboxInput" '+(function(){if("boolean"!=typeof c){var e=!!lsGet("delete_message_for_all_checked");c=e}return c}()?"checked":"")+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+s+"</span>\n        </label>\n      </div>\n    "}return o.default.html(l(),t,n)}t.default=i;window.MsgDeleteDialog=i},fYoA:function(e,t){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=a;var n=".settingsNotifyGroup",i=".settingsNotifyGroup__description";function a(e,t){t.$control.closest(n).$(i).innerHTML=e}},g3t9:function(e,t,n){"use strict";n.r(t),n.d(t,"Separator",(function(){return a}));var i=n("z9sQ");function a(e){return void 0===e&&(e={}),{class:[e.class,i.default.class("Separator",{hideOnDesktop:e.hideOnDesktop,noOffset:e.noOffset,gray:e.gray},"--")],tag:"div"}}t.default=a},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r})),n.d(t,"getVisibilityState",(function(){return c})),n.d(t,"getVisiblityEvent",(function(){return u}));var i=n("uQjJ"),a=n("PU8N"),o=browser.iphone||browser.ipad||browser.ipod;function r(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,n){Object(a.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(a.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(r.prototype,i.default.prototype),extend(r.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&s(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNTM:function(e,t){var n=function(){var e=null,t=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var a=e.latitude,o=e.longitude,r=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",l='<input type="hidden" name="map" value="'+(a+"_"+o+"_0")+'">';r?val(r,s+""+l):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+l+"</div>");show(n)}function a(){e=null,remove("medias_map")}function o(t){var n;t&&t.coords&&(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0},n=e,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:r}))}function r(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},add:function(n){!n&&t||(t=!0,addClass("cp_geo_btn_sel","geo_btn"),n&&(n.latitude||n.longitude)?i(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.label):(geo.getCurrentPosition(o,r),show("geo_waiting")))},remove:function(){t&&(t=!1,removeClass("cp_geo_btn_sel","geo_btn"),a())},init:function(e){return e&&n.add(e),geo.init()}}}();window.geoloc=n},gy8s:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=n("9y81"),r=n("AXyT"),s=n("Y6JH"),l=function(e){var t="unfold-"+Date.now()+"-"+Math.round(9999*Math.random());e.uniqueId=t;var n=i.default.class(e.mix,"Unfold",{position:e.position,asIcon:!!e.icon||!!e.icon_html,open:e.opened,withTitle:!!e.title}),a=i.default.list(e.items,u);return Wd.html({class:n,"data-name":e.name,onclick:e.onclick,inner:[{class:"Unfold__trigger",tag:e.triggerWrapperTag||"div",inner:c(e)},{id:t,class:["Unfold__popup","ScrollView",e.popup_class].filter((function(e){return e})).join(" "),inner:Wd.wrap(a),role:"menu"}]})};function c(e){var t,n=e.title;if(e.icon)t=Object(o.default)({icon:e.icon});else if(e.icon_html)t=e.icon_html;else{for(var r=e.items,l=r.length,c="",u="",d=0;d<l;d++){var _=r[d];if(_&&_.active){c=_.text,u=_.activeCount;break}}t=[Object(a.default)({mix:"Unfold__triggerText",tag:"div",inner:[Wd.html({class:"Unfold__triggerContent",inner:n?[{class:"Unfold__triggerContentTitle",inner:n},{class:"Unfold__triggerContentSubTitle",inner:c}]:[c,u?Wd.html(Object(a.default)({mix:"Unfold__triggerTextCount",inner:u})):""]})]}),Wd.html({class:"Unfold__triggerIcon",inner:Object(s.default)("base","dropdown_16")})],t=i.default.list(t)}var f=e.opened?e.close_url:e.open_url;return{tag:"button",type:"button","aria-haspopup":"true","aria-expanded":"false","aria-controls":e.uniqueId,href:f,class:"Unfold__trigger",onclick:["Unfold._onTriggerClick","this"],attrs:e.trigger_attrs,inner:Wd.wrap(t)}}function u(e){if(!e)return"";var t="";return e.svgIcon?t=Wd.html({class:"Unfold__itemIcon",inner:e.svgIcon}):e.icon&&(t="string"==typeof e.icon?Object(o.default)({mix:"Unfold__itemIcon",icon:e.icon}):Object(a.default)({mix:i.default.class("Unfold__itemIcon",e.icon.class)})),e.attrs+=' data-name="'+e.name+'" role="menuitem" tabindex="-1"',e.active&&(e.attrs+=' aria-current="true"'),e.preventNavigation&&(e.attrs+=' data-prevent-navigation="1"'),Object(a.default)({mix:i.default.class(e.mix,"_touched","replaceState","Unfold__item",{active:e.active,name:e.name,disabled:e.disabled,replaceState:e.replaceState}),url:e.url,tag:e.tag,attrs:e.attrs,inner:[t,Object(a.default)({mix:"Unfold__itemText",inner:[e.text,e.count?Object(a.default)({mix:"Unfold__itemCountHidden",inner:e.count}):""]}),e.count?Object(r.default)({mix:"Unfold__itemCount",gray:!0,value:e.count}):""]})}var d=n("OcsD"),_=n("UxAg"),f=n("jk6M"),p=n("CQvH");Object.assign(l,{onOpen:befall.kind("unfoldName"),getByName:function(e){return Object(_.$)(S.unfoldByName(e))},setActive:k,setCount:function(e,t,n){var i=e.$(S.itemCountByName(t));r.default.setValue(i,n)},setTitle:function(e,t,n){e.$(S.itemByName(t)).$(S.itemText).innerText=n},toggleItemEnabled:function(e,t,n){void 0===n&&(n=!0);var i=e.$(S.itemByName(t));i&&i.classList.toggle(m,!n)},changePosition:function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!1);var i;e.classList.remove(g,A,b,y),i=t?n?g:b:n?A:y;e.classList.add(i)}}),l._onTriggerClick=O;var h="Unfold__item_active",m="Unfold__item_disabled",v="Unfold_open",g="Unfold_position_topLeft",A="Unfold_position_topRight",b="Unfold_position_bottomLeft",y="Unfold_position_bottomRight",w="Unfold__item_replaceState",S={unfold:".Unfold",unfoldByName:function(e){return'.Unfold[data-name="'+e+'"]'},itemActive:"."+h,itemByName:function(e){return".Unfold__item_name_"+e},itemCountByName:function(e){return S.itemByName(e)+" .Unfold__itemCount"},item:".Unfold__item",itemDisabled:"."+m,triggerText:".Unfold__triggerText",itemText:".Unfold__itemText",popup:".Unfold__popup"};function k(e,t){var n,i;if(1===arguments.length?e=(i=e).closest(S.unfold):i=e.$(S.itemByName(t)),(n=e.$(S.itemActive))&&i){n.classList.remove(h),i.classList.add(h);var a=e.$(S.triggerText),o=i.$(S.itemText);a.innerText=o.textContent.trim()}}function O(e){var t=e.closest(S.unfold),n=f.isTouch?"touchend":"mousedown",i=f.isTouch?"touchend":"mouseup",a=!f.isTouch&&window.innerWidth<882,o=t.getAttribute("data-name"),r=!1;o&&l.onOpen(o)(),t.classList.add(v),document.addEventListener("touchmove",m),f.default.msie_mobile?document.addEventListener(i,g,!0):document.addEventListener(n,A,!0);var s=function(){},c=function(){},u=Object(_.$)(S.popup,t);function h(){t.classList.remove(v),document.removeEventListener("touchmove",m),document.removeEventListener(n,A,!0),document.removeEventListener(i,g,!0),Object(p.onTransitionEnd)(u).then((function(){c&&c(),s&&s()}))}function m(e){e.target.closest(S.popup)||h(),r=!0}function g(){document.addEventListener(n,A,!0)}function A(e){if(r)r=!1;else{var t=e.target.closest(S.itemDisabled);if(!t){var n=e.target.closest(S.item+"[href]");if(n){if(f.default.safari&&f.default.safari_mobile&&f.default.version<9)setTimeout(h,500);else{Object(d.cancelEvent)(e);var i=Object(d.domData)(n,"prevent-navigation");if(i||nav.onBeforeGo((function(){h()})),n.classList.contains(w))k(n.closest(S.unfold),Object(d.domData)(n,"name"));i?h():nav.go(n)}return}if(n=e.target.closest(S.item+"[onclick]")||e.target.closest(S.item+"[onmousedown]"))return void setTimeout(h);if(n=e.target.closest("label"+S.item))return void(f.default.safari&&f.default.safari_mobile&&f.default.version<9?setTimeout(h,500):setTimeout(h));if(n=e.target.closest("input[onchange]"))return void(f.default.safari&&f.default.safari_mobile&&f.default.version<9?setTimeout(h,500):setTimeout(h))}(f.isTouch||a||t)&&(e.preventDefault(),e.stopImmediatePropagation()),(a||!f.isTouch&&t)&&document.addEventListener("click",b,!0),t||h()}}function b(e){e.preventDefault(),e.stopImmediatePropagation(),document.removeEventListener("click",b,!0)}u&&Object(p.onTransitionEnd)(u).then((function(){(c=Object(p.expandPopup)(e)).exitIntent=function(){return!1},(s=Object(p.setMenuNavigation)(u))&&(s.exitIntent=function(){return h(),!1})}))}t.default=l;window.Unfold=l},h8oe:function(e,t,n){"use strict";n.r(t),n.d(t,"rescan",(function(){return j})),n.d(t,"trackMarketEvent",(function(){return E})),n.d(t,"trackMarketArea",(function(){return T}));var i=n("Fkq0"),a=n("z9Td"),o=n("tGJf"),r=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],r=0,s=o.length;r<s;r++,a++)i[a]=o[r];return i};function s(e,t,n,a){var s=window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getHash();if(s){var c=n.slice(0,10),u=0,d=o.vkLocalStorage.getItem("market_event_count");d&&(u=parseInt(d)),u>=20&&(l(e),u=0);var _=Date.now(),f="market_event_item_"+Math.floor(1e5*Math.random())+"_"+_+"_"+t;c.unshift(_),c.unshift(t),c.push(s),o.vkLocalStorage.setItem(f,JSON.stringify(c)),o.vkLocalStorage.setItem("market_event_count",String(++u)),a&&l(e),i.marketDebug.apply(void 0,r(["debug","event",t],n))}else Object(i.marketDebug)("warn","events","Hash error")}function l(e){for(var t=[],n=0;n<o.vkLocalStorage.length();++n){var r=o.vkLocalStorage.key(n);r&&0===r.lastIndexOf("market_event_item_")&&t.push(r)}if(!(t.length<=0)){o.vkLocalStorage.setItem("market_event_count",String(0));var s=[],l="";t.forEach((function(e){var t=o.vkLocalStorage.getItem(e);if(o.vkLocalStorage.removeItem(e),t)try{var n=JSON.parse(t);l?n.pop():l=n.pop(),s.push(Object.values(n))}catch(e){Object(i.marketDebug)("error","event error","Unable to assemble events pack",e)}})),!l||s.length<1||(!window.MarketAnalyticsManager||window.MarketAnalyticsManager.isEnabled()?window.ajax.post(e===a.PLATFORM_MVK?"market.php":"al_market.php",{act:"log_events",hash:l,events:s},{onDone:function(){Object(i.marketDebug)("warn","events sent",s.length+" events sent")}}):Object(i.marketDebug)("error","event error","analytics disabled"))}}var c=function(){function e(){}return e.prototype.connectMutator=function(t){if(this.mutationObserver)throw new Error("{Observer #"+t.getObserverId()+"} MutationObserver already connected to observer");var n=document.querySelector(t.getContainerQuery());n instanceof HTMLElement&&(this.mutationObserver=new MutationObserver((function(n){n.forEach((function(n){if(n.addedNodes)for(var i=0;i<n.addedNodes.length;i++){var a=n.addedNodes[i];if(a instanceof HTMLElement){var o=e.resolveNodes(a,t).filter((function(e){return!!e}));o&&(o.forEach((function(e){t.add(e)})),t.scan())}}}))})),this.mutationObserver.observe(n,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},e.prototype.disconnectMutator=function(e){e.isRunning()&&this.mutationObserver&&this.mutationObserver.disconnect()},e.resolveNodes=function(e,t){var n=[];if(t.getSelectorQuery(!1).split(",").forEach((function(t){if(e.matches(t))return n.push(e),!1})),n.length<1){var i=e.querySelectorAll(t.getSelectorQuery(!1));n=Array.from(i)}return n},e}(),u=n("BJj/"),d={};function _(){var e=o.vkSessionStorage.getItem("market_stat_data");return e&&JSON.parse(e)||{}}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=function(){function e(e,t,n,i,a,o){var r;if(void 0===n&&(n=""),void 0===i&&(i=!1),void 0===a&&(a=""),this.observerId=e,this.itemSelector=t,this.container=n,this.isUnifyNodes=i,this.platform=a,this.getExtraItemParams=o,this.trackingItems={},this._debounceTimeout=20,this.uniqueNodeCounter=0,this.nodes=[],this.isWatching=!1,this.mutatorList=[],(r=this).getObserverId()in d&&(d[r.getObserverId()].stop(),delete d[r.getObserverId()]),d[r.getObserverId()]=r,!this.itemSelector.types&&!this.itemSelector.selectors)throw new Error("Empty itemSelector definition");this.container||(this.container=this.observerId)}return Object.defineProperty(e.prototype,"debounceTimeout",{set:function(e){this._debounceTimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemReachedCallback",{set:function(e){this._itemReachedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preCheckReachedCallback",{set:function(e){this._preCheckReachedCallback=e},enumerable:!0,configurable:!0}),e.prototype.getObserverId=function(){return this.observerId},e.prototype.getItemSelector=function(){return this.itemSelector},e.prototype.getPlatform=function(){return this.platform},e.prototype.add=function(e){this.nodes.push(e)},e.prototype.getTrackingItems=function(){return this.trackingItems},e.prototype.addMutators=function(e){this.mutatorList=this.mutatorList.concat(e)},e.prototype.isRunning=function(){return this.isWatching},e.prototype.watch=function(){this.isWatching||(this.update(),this.startObserving(),this.connectMutators(),this.isWatching=!0)},e.prototype.stop=function(){this.isWatching&&(this.trackUntracked(),this.stopObserving(),this.disconnectMutators(),this.isWatching=!1)},e.prototype.scan=function(){this.viewportScanner()},e.prototype.trackUntracked=function(){var e=this.getTrackingItems();for(var t in e)if(e[t]){var n=e[t];!n.isTracked&&n.isReached&&(this.track(n),this.persist(n))}},e.prototype.connectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.connectMutator(e)}))},e.prototype.disconnectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.disconnectMutator(e)}))},e.prototype.getContainerQuery=function(){var e=this.container.substr(0,1);return"#"===e||"."===e?this.container:'[data-stat-container="'+(this.container?this.container:this.observerId)+'"]'},e.prototype.getSelectorQuery=function(e){void 0===e&&(e=!0);var t=this.getContainerQuery(),n=[];return this.itemSelector.selectors?n=this.itemSelector.selectors.split(",").map((function(n){return e?t+" "+n:n})):this.itemSelector.types&&(n=this.itemSelector.types.split(",").map((function(n){return e?t+' [data-stat-item^="'+n+'|"]':'[data-stat-item^="'+n+'|"]'}))),n.join(",")},e.prototype.update=function(){var e=document.querySelectorAll(this.getSelectorQuery());this.nodes=Array.from(e)},e.parseStatAttribute=function(e){var t=e.getAttribute("data-stat-item"),n=null==t?void 0:t.split("|");return n?{type:n[0],ownerId:parseInt(n[1]),itemId:n[2]}:{type:"",ownerId:0,itemId:0}},e.prototype.getNodeKey=function(e,t){var n=String(t.itemId);this.isUnifyNodes&&(this.unifyNode(e),n=n+"_"+e.getAttribute("data-stat-id"));return this.observerId+"_"+n},e.prototype.isItemReached=function(e){return!(void 0!==this._preCheckReachedCallback&&!this._preCheckReachedCallback(e))&&this.isReached(e)},e.prototype.filterItem=function(e){return!e.isTracked&&!e.isReached&&(this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.persist(e),!0))},e.prototype.track=function(e){e.isTracked||(e.viewEnd=Date.now(),e.duration=e.viewEnd-e.viewStart,this._itemReachedCallback(e),e.isReached=!1,e.isTracked=!0)},e.prototype.persist=function(e){this.trackingItems[e.key]=e},e.prototype.getTrackingItem=function(t){var n=e.parseStatAttribute(t);if(!n.type||!n.itemId)return null;var i=this.getNodeKey(t,n);return i?i in this.trackingItems?this.trackingItems[i]:this.createTrackingItem(t,n):null},e.prototype.createTrackingItem=function(e,t){var n=this.getNodeKey(e,t),i=this.getExtraItemParams&&this.getExtraItemParams()||{};return this.trackingItems[n]=f(f({},i),{key:n,type:t.type,observerId:this.observerId,ownerId:t.ownerId,itemId:t.itemId,isTracked:!1,isReached:!1,viewStart:0,viewEnd:0,duration:0,node:e,viewTimer:0,data:{},platform:this.getPlatform(),city:_().city,screen:_().screen}),this.trackingItems[n]},e.prototype.getNextUnifyId=function(){return++this.uniqueNodeCounter},e.prototype.unifyNode=function(e){e.getAttribute("data-stat-id")||e.setAttribute("data-stat-id",String(this.getNextUnifyId()))},e.prototype.startObserving=function(){var e=this;this.update(),this.viewportScanner=Object(u.debounce)((function(){e.nodes=e.nodes.filter((function(t){var n=e.getTrackingItem(t);return!!n&&e.filterItem(n)}))}),this._debounceTimeout),this.scrollEventListener=function(){return e.scan()},document.addEventListener("scroll",this.scrollEventListener,{passive:!0}),this.scan()},e.prototype.stopObserving=function(){document.removeEventListener("scroll",this.scrollEventListener),this.nodes=[],this.viewportScanner=function(){},this.scrollEventListener=function(){}},e}();var h,m=(h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return m(t,e),t.prototype.filterItem=function(e){return!e.isTracked&&(e.isReached&&!this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.isItemReached(e.node)&&this.view(e),this.persist(e),!0))},t.prototype.view=function(e){var t=this;e.isTracked||(e.isReached=!0,e.viewStart||(e.viewStart=Date.now()),e.viewTimer&&(clearTimeout(e.viewTimer),e.viewTimer=0),e.viewTimer=window.setTimeout((function(){var n=e.node;!t.isItemReached(n)||function(e){var t=e.viewStart;return Date.now()-t>3e4}(e)?t.track(e):t.view(e)}),3e3))},t.prototype.track=function(t){t.viewTimer&&(clearTimeout(t.viewTimer),t.viewTimer=0),e.prototype.track.call(this,t)},t}(p),g=n("ZD4m"),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(e){function t(n,i,a,o,r,s,l){void 0===a&&(a=""),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===s&&(s="");var u=e.call(this,n,i,a,o,s,l)||this;return u.observerId=n,u.itemSelector=i,u.container=a,u.isUnifyNodes=o,u.isDynamicNodes=r,u.gap=null,r&&u.addMutators([new c]),u.gap=t.getViewportGap(u.getPlatform()),u}return A(t,e),t.prototype.isReached=function(e){if(!Object(i.isElementVisible)(e))return!1;var t,n=this.gap,a=e.closest("[data-stat-viewport]");if(a){var o=a.getBoundingClientRect();n={top:o.top,left:o.left},t={width:o.left+o.width,height:o.top+o.height}}return Object(i.isElementInViewport)(e,45,n,t)},t.create=function(e){return new t(e.observerId,e.itemSelector,null==e?void 0:e.container,null==e?void 0:e.isUnifyNodes,null==e?void 0:e.isDynamicContent,null==e?void 0:e.platform,null==e?void 0:e.getExtraItemParams)},t.getViewportGap=function(e){void 0===e&&(e="");var t={left:0,top:0},n="";return n=e===a.PLATFORM_MVK?"#vk_head":"#page_header_wrap,#market_search_input",document.querySelectorAll(n).forEach((function(e){var n=Object(g.getElementSize)(e);t.top=t.top+n.height})),t},t}(v),y=n("RJa5"),w=[],S=!1;function k(e,t){void 0===t&&(t=0);var n=O(t);return!!n&&e.includes(n.event)}function O(e){return void 0===e&&(e=0),w.length>e?w[w.length-(1+e)]:null}function C(e){S||(window.addEventListener("beforeunload",(function(){!function(){for(var e in d){if(d[e])d[e].stop()}}(),l(e)})),S=!0)}function j(){!function(){for(var e in d){if(d[e])d[e].scan()}}()}function E(e){if(function(e){var t=O();if(t){if(e===y.ECommGoodsEvent.CLOSE_ITEM&&t.event===y.ECommGoodsEvent.CLOSE_ITEM)return!1;if(e===y.ECommGoodsEvent.TRANSITION_TO_ITEM){if(k([y.ECommGoodsEvent.TRANSITION_TO_ITEM_LEFT,y.ECommGoodsEvent.TRANSITION_TO_ITEM_RIGHT]))return!1;if(k([y.ECommGoodsEvent.SWITCH_ITEM_VARIANT_1,y.ECommGoodsEvent.SWITCH_ITEM_VARIANT_2]))return!1}}return!0}(e.event))if(e.event||e.table){e.table||(Object.values(y.ECommGoodsEvent).includes(e.event)?e.table=y.AnalyticsEventTable.GOODS:Object.values(y.ECommOrdersEvent).includes(e.event)?e.table=y.AnalyticsEventTable.ORDERS:Object(i.marketDebug)("error","table not specified")),e.screen=e.screen?e.screen:window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getScreen(),e.platform=e.platform?e.platform:"web",C(e.platform);var t=String(e.event),n=e.table+":"+t;e.instant?function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!0)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration):function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!1)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration),w.push(e),w.length>3&&w.shift()}else Object(i.marketDebug)("error","event and table not specified",e)}function T(e,t){var n;switch(void 0===t&&(t=""),C(t),l(t),Object(i.marketDebug)("warn","analytics: start tracking area",e),e){case y.AnalyticsArea.MARKET:n=function(e){var t=0;void 0!==window.cur.aid&&(t=window.cur.aid),E({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?t:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var o=b.create({observerId:"market_products",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});o.itemReachedCallback=n;var r=b.create({observerId:"market_albums",itemSelector:{types:"market_album"},isUnifyNodes:!0,isDynamicContent:!1,platform:t});r.itemReachedCallback=n,t!==a.PLATFORM_MVK&&(r.preCheckReachedCallback=function(e){var t,n=e.offsetTop,i=null===(t=e.parentNode)||void 0===t?void 0:t.parentNode;return i&&n<i.offsetHeight}),o.watch(),r.watch();break;case y.AnalyticsArea.GROUP:n=function(e){E({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?0:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var s=b.create({observerId:"market_module",itemSelector:{types:"market_item"},isUnifyNodes:!0,platform:t});s.itemReachedCallback=n;var c=b.create({observerId:"group_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});c.itemReachedCallback=n,s.watch(),c.watch();break;case y.AnalyticsArea.USER_PROFILE:var u=b.create({observerId:"user_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});u.itemReachedCallback=function(e){E({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,duration:e.duration,time:e.viewStart,albumId:"market_item"===e.type?0:e.itemId,platform:e.platform})},u.watch();break;case y.AnalyticsArea.BOOKMARKS:var d=b.create({observerId:"bookmarks",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});d.itemReachedCallback=function(e){E({table:y.AnalyticsEventTable.GOODS,event:y.ECommGoodsEvent.VIEW_ITEM,ownerId:e.ownerId,itemId:e.itemId,duration:e.duration,time:e.viewStart,albumId:0,platform:e.platform})},d.watch()}}},he4e:function(e,t,n){"use strict";n.r(t),n.d(t,"clear",(function(){return d})),n.d(t,"onClear",(function(){return l})),n.d(t,"onClearConfirm",(function(){return _})),n.d(t,"onClearDecline",(function(){return f})),n.d(t,"isCleared",(function(){return u}));var i=n("OcsD"),a=n("+cqQ"),o=n("UxAg"),r=n("r/ag"),s=n("29dZ"),l=Object(a.default)(),c={};function u(e){var t=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(e)[2];return!!c[t]||!!c[e]}function d(e,t,n,a,o,r){if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),r){s.default.setLoading(e,!0,"white");var l="restr_"+Object(i.srand)(),c=e.closest(".PostPhotoRestriction");Object(i.domData)(c,"clear-id",l),function(e,t,n,i,a){photoview._toggleTouches(!1),clog("[PostPhotoRestriction] Show confirm to unblur "+i),Confirm(t,"PostPhotoRestriction.onClearConfirm('"+e+"', '"+i+"', '"+a+"')","PostPhotoRestriction.onClearDecline('"+e+"')",{id:e,ok_text:n})}(l,n,a,o,r)}else clog("[PostPhotoRestriction] No hash was provided")}function _(e,t,n){r.default.close(Object(i.ge)(e)),photoview._toggleTouches(!0),ajax.post(t+"?act=unblur&hash="+n,{},{onDone:function(n){var a=Object(o.$)('[data-clear-id="'+e+'"]');if(a){var r=Object(o.$)(".SplashScreen__more .Btn",a);s.default.setLoading(r,!1),a.classList.add("PostPhotoRestriction--clear")}else clog("[PostPhotoRestriction] Can't find restriction el with clear id "+e);var u=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(t),d=u[2],_=u[3],f=[];n?(f.push.apply(f,Object(o.$$)('.thumb_map_img--blur[data-id^="'+d+'"]')),f.push.apply(f,Object(o.$$)('.thumb_map_img--blur[href^="/photo'+d+'"]'))):(f.push(Object(o.$)('.thumb_map_img--blur[data-id="'+d+"_"+_+'"]')),f.push(Object(o.$)('.thumb_map_img--blur[href^="/photo'+d+"_"+_+'"]'))),f.forEach((function(e){if(e){e.classList.remove("thumb_map_img--blur");var t=Object(o.$)(".PostPhotoRestriction--blur,.PostPhotoRestriction--blurWithText",e);Object(i.re)(t)}})),n&&(c[""+d]=!0),c[t]=!0,l(t);var p=[];n?p.push.apply(p,Object(o.$$)('.PhotosPhotoItem__photo[data-id^="'+d+'"]')):p.push(Object(o.$)('.PhotosPhotoItem__photo[data-id="'+t.replace("photo","")+'"]')),p.forEach((function(e){if(e){e.classList.remove("PhotosPhotoItem__photo--blur");var t=Object(o.$)(".PhotosPhotoItem__restriction",e);Object(i.re)(t)}}));var h=[];n?h.push.apply(h,Object(o.$$)('.AlbumItem__thumb--blur[data-thumb-id^="'+d+'"]')):h.push(Object(o.$)('.AlbumItem__thumb--blur[data-thumb-id="'+t.replace("photo","")+'"]')),h.forEach((function(e){if(e){e.classList.remove("AlbumItem__thumb--blur");var t=Object(o.$)(".AlbumItem__restriction",e);Object(i.re)(t)}})),setTimeout((function(){Object(i.remove)(a)}),500)}})}function f(e){var t=Object(o.$)('[data-clear-id="'+e+'"]'),n=Object(o.$)(".SplashScreen__more .Btn",t);photoview._toggleTouches(!0),r.default.close(Object(i.ge)(e)),s.default.setLoading(n,!1)}nav.onBeforeGo((function(){Object(o.$$)(".Confirm[id^=restr]").forEach((function(e){f(e.id)}))}))},hw56:function(e,t,n){"use strict";n.r(t),n.d(t,"getKeyboardState",(function(){return l})),n.d(t,"getKeyboardType",(function(){return c})),n.d(t,"setKeyboardType",(function(){return u})),n.d(t,"clearCallbackButtons",(function(){return _})),n.d(t,"stopCallbackButtonWaiting",(function(){return f})),n.d(t,"registerCallbackButtonEvent",(function(){return p})),n.d(t,"loadDrafts",(function(){return h})),n.d(t,"getPeerDraft",(function(){return m})),n.d(t,"setPeerDraft",(function(){return v})),n.d(t,"pushPeerAttachments",(function(){return g})),n.d(t,"popPeerAttachments",(function(){return A})),n.d(t,"setPeerTyping",(function(){return b})),n.d(t,"removePeerTypingUser",(function(){return y})),n.d(t,"filterPeerTypingUser",(function(){return w})),n.d(t,"replacePeer",(function(){return k})),n.d(t,"removePeer",(function(){return O})),n.d(t,"addPeer",(function(){return C})),n.d(t,"addPendingMsg",(function(){return j})),n.d(t,"getPendingMsg",(function(){return E})),n.d(t,"removePendingMsg",(function(){return T})),n.d(t,"removeFailedMsg",(function(){return I})),n.d(t,"failAllPendingMsgs",(function(){return M})),n.d(t,"queueToPresendMsgs",(function(){return P})),n.d(t,"saveFolderScroll",(function(){return x})),n.d(t,"restoreFolderScroll",(function(){return L}));var i=n("wx14"),a=(n("2IoG"),n("qHA9")),o=n("29dZ"),r=n("jE6c"),s=n("OcsD");function l(e){var t=store.mail.cur.keyboards,n=t[e];return n||(n=t[e]={}),n}function c(){return store.mail.cur&&store.mail.cur.keyboardType||""}function u(e){store.mail.cur&&(store.mail.cur.keyboardType=e)}var d={};function _(e,t){void 0===t&&(t=!1),store.mail.cur.pressedButtons&&(t?delete store.mail.cur.pressedButtons.msgs[t]:delete store.mail.cur.pressedButtons.peers[e])}function f(e){var t=d[e];if(t){var n,i=t.peerId,a=t.msgId,r=t.position,s=t.button,l=t.inline;if(l?store.mail.cur.pressedButtons.msgs[a]&&delete store.mail.cur.pressedButtons.msgs[a][r.join(",")]:store.mail.cur.pressedButtons.peers[i]&&delete store.mail.cur.pressedButtons.peers[i][r.join(",")],delete d[e],!bodyNode.contains(s))(n=l?$(".msg_id_"+a+" .BotsKeyboard__main"):$(".uMailWrite__keyboard .BotsKeyboard__main"))&&(s=$('.BotsKeyboard__button[data-position="'+r.join(",")+'"]',n));s&&o.default.setLoading(s,!1)}}function p(e,t,n,i){var a=(Object(s.domData)(t,"position")||"").split(",");if(!a)return o.default.setLoading(t,!1),clog("Can't find button position for callback event"),!1;d[n]={time:Object(r.vkNow)(),peerId:e,msgId:i,button:t,position:a,inline:!!i},store.mail.cur.pressedButtons||(store.mail.cur.pressedButtons={peers:{},msgs:{}}),a[0]&&a[1]&&(i?(store.mail.cur.pressedButtons.msgs[i]||(store.mail.cur.pressedButtons.msgs[i]={}),store.mail.cur.pressedButtons.msgs[i][a.join(",")]=n):(store.mail.cur.pressedButtons.peers[e]||(store.mail.cur.pressedButtons.peers[e]={}),store.mail.cur.pressedButtons.peers[e][a.join(",")]=n)),setTimeout((function(){f(n)}),6e4)}function h(e){var t=store.mail.cur.drafts;return t||(t=lsGet("mail_drafts_"+e),t=store.mail.cur.drafts=t||{}),t}function m(e,t){var n=h(e);return n[t]||(n[t]={})}function v(e,t,n,a){var o=store.mail.cur.drafts;if(o||(o=store.mail.cur.drafts=o||{}),a){var r=o[t],s=r&&r.editing&&r.editing.id===a?r.editing:void 0;o[t]=Object(i.default)({},r,{editing:Object(i.default)({},s,{},n,{id:a})})}else o[t]=Object(i.default)({},o[t],{},n,{editing:void 0});lsSet("mail_drafts_"+e,o)}function g(e,t){var n=store.mail.peers[e];n.attachmentsStack.push(n.attachmentsHTML),n.attachmentsHTML=t}function A(e){var t=store.mail.peers[e],n=t.attachmentsStack.pop();n||(n=Brick({mix:"cp_attached_wrap",attrs:'id="attached_wrap"'})),t.attachmentsHTML=n}function b(e,t){var n=store.mail.cur.typings[e];if(n||(n=store.mail.cur.typings[e]={}),"text"!==t.type&&"audio"!==t.type||(t.count?n[t.type]=t:n[t.type]=null),n.text&&n.audio){var i=S(n.text,n.audio);n.mixed=i.count>1?i:null}else n.mixed=null}function y(e,t){var n=store.mail.cur.typings[e];if(n){var i=n.audio,a=n.text;if(i&&((i=w(i,t)).count?n.audio=i:n.audio=null),a&&((a=w(a,t)).count?n.text=a:n.text=null),n.text&&n.audio){var o=S(n.text,n.audio);n.mixed=o.count>1?o:null}else n.mixed=null}}function w(e,t){var n=e.users.filter((function(e){return e!==t}));return n.length!==e.users.length&&(e.count=e.count-(e.users.length-n.length),e.users=n),e}function S(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return e.count+=t.count,t.users.reduce((function(e,t){return-1===e.users.indexOf(t)?e.users.push(t):e.count--,e}),e)}),{users:[],count:0,type:"mixed"})}function k(e,t){var n=store.mail,i=n.scraps.folder,a=i.indexOf(e);-1!==a&&(t?i.splice(a,1,t):i.splice(a,1)),Object.keys(n.rolls.folder).forEach((function(i){var a=n.rolls.folder[i],o=a.indexOf(e);-1!==o&&(t?a.splice(o,1,t):a.splice(o,1))})),t&&(n.rolls.peer[t]=n.rolls.peer[e],n.reached.peer.before[t]=n.reached.peer.before[e],n.reached.peer.after[t]=n.reached.peer.after[e]),e!==t&&(n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(i){var a=n.msgs[i];a&&(t?(a.peerId=t,a.authorId===e&&(a.authorId=t)):delete n.msgs[i])})),delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e],delete n.members[e],delete n.peers[e])}function O(e,t){void 0===t&&(t={});var n=store.mail;if(!1!==t.lists){var i=n.scraps.folder,a=i.indexOf(e);-1!==a&&i.splice(a,1),Object.keys(n.rolls.folder).forEach((function(t){var i=n.rolls.folder[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)}))}!1!==t.msgs&&n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(e){n.msgs[e]&&delete n.msgs[e]})),!1!==t.lists&&(delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e]),!1!==t.data&&(delete n.members[e],delete n.peers[e])}function C(e,t){void 0===t&&(t={});var n=store.mail;if(t.msgs){var i=t.msgs;n.rolls.peer[e]=i,n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1}else n.rolls.peer[e]||(n.rolls.peer[e]=[],n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1);var a=n.msgs[n.rolls.peer[e][0]];n.rolls.folder.all.unshift(e),n.cur.folder&&n.scraps.folder.unshift(e),a&&(a.isUnread&&n.rolls.folder.unread.unshift(e),a.isImportant&&n.rolls.folder.important.unshift(e))}function j(e){var t=store.mail.presend;t.pending[e.peerId]||(t.pending[e.peerId]=[]),t.msgs[e.sendId]=e,t.pending[e.peerId].push(e.sendId)}function E(e,t){var n=store.mail.presend;return n.pending[t]?n.msgs[e]:null}function T(e){var t=store.mail.presend;if(t.pending[e.peerId]){var n=e.sendId;delete t.msgs[n],t.pending[e.peerId]=t.pending[e.peerId].filter((function(e){return e!==n}))}}function I(e){var t=store.mail.presend;if(t.failed[e.peerId]){var n=e.sendId;delete t.msgs[n],t.failed[e.peerId]=t.failed[e.peerId].filter((function(e){return e!==n}))}}function M(){var e=store.mail.presend,t={};Object.keys(e.msgs).forEach((function(n){var i=e.msgs[n];i.pending=!1,i.failed=!0,t[i.peerId]||(t[i.peerId]=[]),t[i.peerId].push(n)}),{}),e.pending={},e.failed=t}function P(e){var t={};Object.keys(e.items).forEach((function(n){var i=e.items[n];t[n]=Object(a.sendDataToMessage)(i.data.data,-1!==e.failed.indexOf(n))}));var n={};e.pending.forEach((function(e){var i=t[e];n[i.peerId]||(n[i.peerId]=[]),n[i.peerId].push(e)}),{});var i={};e.failed.forEach((function(e){var n=t[e];i[n.peerId]||(i[n.peerId]=[]),i[n.peerId].push(e)}),{}),store.mail.presend={msgs:t,pending:n,failed:i}}function x(e,t){var n=store.mail.cur;n&&(n.folderScroll||(n.folderScroll={}),n.folderScroll[e]=t)}function L(e){var t=store.mail.cur;if(t){t.folderScroll||(t.folderScroll={});var n=t.folderScroll[e]||0;return t.folderScroll[e]=0,n}}},iS9e:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <div class="','" role="dialog" id="mail-dialog">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            ',"\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return o=function(){return e},e}var r=function(e){var t=e.onClose||a.default.onClick("MailDialog._onDialogClose"),n=a.default.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");var r="";r=e.buttons?e.buttons:'<div class="BtnStack">\n      <div class="Btn Btn_theme_regular mailDialog__button mailDialog__confirmButton" '+e.onConfirm+">"+e.confirmText+'</div>\n      <div class="Btn Btn_theme_secondary mailDialog__button mailDialog__closeButton" '+t+">"+e.cancelText+"</div>\n    </div>";return a.default.html(o(),n,t,t,i,e.body,r)};var s,l=n("UxAg"),c=n("OcsD");function u(){var e=Object(l.$)(".messenger__dialog");s=null,e.innerHTML=""}Object.assign(r,{open:function(e){s={},"function"==typeof e.onConfirm&&(s.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(s.onClose=e.onClose,e.onClose="");var t=Object(l.$)(".messenger__dialog"),n=r(e),i=Object(c.ceFromString)(n);s.onConfirm&&(Object(l.$)(".mailDialog__confirmButton",i).onclick=function(e){return s.onConfirm(e,t)});s.onClose&&Object(l.$$)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",i).forEach((function(e){e.onclick=function(e){return s.onClose(e,t)}}));t.innerHTML="",t.appendChild(i)},close:u,_onDialogClose:u});t.default=r;window.MailDialog=r},iWgD:function(e,t,n){"use strict";n.r(t),n.d(t,"uTyping_getPeerTyping",(function(){return i})),n.d(t,"uTyping_getNames",(function(){return a}));n("rKUZ");function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function a(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,a=[],o=0;o<i;o++){var r=t[n[o]];if(r){var s=1===i?r.name:r.shortName;a.push(s)}}return a}},iwo4:function(e,t,n){"use strict";n.r(t),n.d(t,"audioRepeat",(function(){return i}));var i={NONE:0,ALL:1,ONE:2}},"k+Df":function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("TYsd"),o=n("9y81"),r=n("29dZ"),s=n("tlMv");t.default=function(e){void 0===e&&(e={});var t=null;e.icon_raw?t=e.icon_raw:e.icon&&(t=Object(o.IconWd)({class:"SplashScreen__icon",icon:e.icon,svg:e.is_svg_icon}));var n=a.default.wrap(e.more_text);"primary"!==e.more_type&&"regular"!==e.more_type&&"outlineMono"!==e.more_type||(n=Object(r.default)({inner:[e.more_text],theme:e.more_type,url:e.more_url,onClick:e.more_onclick,attrs:{ontouchend:e.more_ontouchend},use_native_onclick:e.more_native_onclick}),e.more_url=null);var l=[e.class,i.default.class("SplashScreen",e.mix||{})];e.small&&l.push("SplashScreen--small");return[e.separator?Object(s.default)({hideOnDesktop:!e.separator_desktop}):{},{class:l,inner:e.inner||[e.before,t,e.title?{class:"SplashScreen__title",inner:a.default.wrap(e.title)}:null,e.text?{class:[e.text_class,"SplashScreen__text"],inner:a.default.wrap(e.text)}:null,e.more_text?{class:"SplashScreen__more",inner:n,href:e.more_url}:null,e.action_text?{class:"SplashScreen__action",inner:{class:"SplashScreen__actionButton",inner:a.default.wrap(e.action_text),href:e.action_url}}:null]}]}},kYGI:function(e,t){var n={tt:!1,handlers:[],show:function(){n.shown||(n.tt=Array.prototype.slice.call(arguments))},hide:function(){n.tt&&(n.tt=!1)},addHandler:function(e){e&&n.handlers.push(e)},removeHandler:function(e){e?each(n.handlers,(function(t){if(e===this)return n.handlers.splice(t,1),!1})):n.handlers=[]},onClose:function(){each(n.handlers,(function(){this()}))},clear:function(){n.tt&&(n.hide(),n.onClose(),n.removeHandler())},closeByTap:function(e){if(!n.tt||!e.target)return!1;var t=e.target;do{for(var i=0;i<n.tt.length;i++)if(t===n.tt[i])return!1}while(t=t.parentNode);return n.hide(),n.onClose(),!0}};window.tooltip=n},kr3z:function(e,t,n){"use strict";n.r(t);var i=n("wx14"),a=n("UxAg"),o=n("+cqQ"),r=n("jk6M"),s=n("jE6c"),l=n("OcsD"),c=n("j80l"),u=n("eGQV"),d=n("tgcV"),_=n("cGUQ"),f=n("izth"),p=n("Cbap"),h=function(e){void 0===e&&(e={});var t=["AudioPlaylistRoot",e.class].filter((function(e){return e})).join(" ");return{attrs:{"data-playlist-id":e.playlist_id},inner:e.inner,class:t}};var m=n("g3t9"),v=n("fdw3"),g=n("0hva"),A=n("z1UI"),b=n("GtpT"),y=n("vOib"),w=n("v+Uj");var S=function(e){void 0===e&&(e={});var t=window.lang,n=e.items||[],i=e.count||null,a=e.href,o=n.map((function(e){return{inner:[Object(b.default)({album:e})],class:"AlbumsBlock__album",tag:"div"}})),r={text:Object(v.getLang)("mobile_subheader_show_all"),class:"al_albums",url:a},s=Object(w.default)({inner:[{inner:[o],class:"AlbumsBlock__albums",tag:"div"}]});return{inner:[{name:"albums",tag:"a"},Object(y.default)({title:t.mobile_photos_block_albums_title,count:i,corner:r,content:s,no_border:!0,noShadow:!0})],class:"AlbumsBlock",tag:"div"}},k=n("1VZq");var O=function(e){var t=window.lang,n=e.items||[],i=e.count||null,a=e.buttons||{},o=e.href,r=e.hide_header||!1,s=e.label||t.mobile_photos_block_photos_title,l="PhotosBlock",c="PhotosBlock__photos";!!e.autoload&&(l+=" PhotosBlock--autoload",c+=" photos_page");var u={inner:[n.map((function(e){return Object(k.default)({photo:e})}))],class:c,tag:"div"},d=null;return o&&(d={text:Object(v.getLang)("mobile_subheader_show_all"),class:"al_empty",url:o}),{inner:[{name:"photos",tag:"a"},Object(y.default)({inner:[{inner:[a.prev,u,a.more],tag:"div"}],title:r?null:s,corner:d,count:i,noShadow:!0,no_border:!0})],class:l,tag:"div"}},C=n("tlMv");var j=function(e){var t=window.lang,n=e.pretag,i=e.buttons||{},a=e.is_owner,o=[],r=e.section,s=e.albums,l=e.albums_count,c=e.albums_href,u=e.photos,d=e.photos_count,_=e.new_tags_photos,f=e.new_tags_count,p=e.new_tags_href;if("all"===r){var h=s.map((function(e){return Object(b.default)({album:e})}));h&&o.push({inner:[i.prev?i.prev:null,{inner:[h],class:"AlbumsPage__items album_items photos_page bl_cont",tag:"div"},i.more?i.more:null],tag:"div"})}else s&&s.length&&o.push(S({items:s,count:l,href:c})),_&&_.length&&o.push(O({label:t.mobile_photos_block_tags_title,items:_,count:f,href:p})),u&&u.length&&o.push(O({autoload:!0,items:u,count:d,buttons:i}));if(!o.length){var m=a?t.mobile_albums_can_store_photos:t.mobile_albums_no_albums;return Object(A.default)({separator:!0,text:m,more_type:"primary",more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_url:e.add_url})}return{inner:["all"!==r?Object(C.default)({hideOnDesktop:!0}):null,{inner:[o],class:"upanel bl_cont",tag:"div"},n],class:"AlbumsPage PageBlock PageBlock_bottomPadding",tag:"div"}},E=n("GVTI"),T=n("W9Tc"),I=n("gF8j"),M=n("r/ag"),P=n("29dZ"),x=n("vk58");var L,B=function(e){var t=function(e){var t=e.buttons,n=Object.keys(t).map((function(n){var i=t[n],a=i.theme;a="yes"!==n||a?"secondary":"regular";var o={"data-key":n,"data-force":e.force?1:0};return Object(P.default)({inner:[i.text],theme:a,url:i.href,attrs:o,on_click:"ConfirmPopup.onButtonClick(this, event);",use_native_onclick:!0})}));return Object(x.default)({inner:[n]})}(e),n={title:e.title};return Object(M.default)({inner:[Wd.wrap(e.text),{inner:[t],class:"Popup__buttons",tag:"div"}],class:"ConfirmPopup",header:n,scrollable:!0,on_overlay_click_native:"ConfirmPopup.onOverlayClick(this, event);"})},R=n("zq7H");if(!window.ajax){var D={onBeforeRedirect:Object(o.default)("url"),onBeforePageParse:Object(o.default)(),onRedirect:Object(l.se)(),onNavDone:Object(o.default)(),_tStart:!1,_tAlStart:!1,RESPONSE_ARGUMENTS:0,RESPONSE_REDIRECT:1,RESPONSE_CAPTCHA:2,RESPONSE_PAGE:3,RESPONSE_FAILED_AUTH:4,RESPONSE_CONFIRM:5,RESPONSE_IGNORE:100,_getreq:function(){return new XMLHttpRequest},_al_reqs:[],_last_req:null,save_req:function(e){D._al_reqs.push(e||D._last_req)},abort_reqs:function(){Object(l.each)(D._al_reqs,(function(e,t){t.abort()})),D._al_reqs=[]},_failed_relogin:!1,_failed_reqs:[],save_failed_req:function(e,t,n,i){D._failed_reqs.push([e,t,n,i])},repeat_reqs:function(){Object(l.each)(D._failed_reqs,(function(){var e=this.shift();D._post.apply(null,this),Object(l.remove)(e)})),D._failed_reqs=[]},_error_displayed:null,plainpost:function(e,t,n,i,a,o,r,s){var c="string"!=typeof t?Object(_.toQueryString)(t,!0):t,d={"Content-Type":"application/x-www-form-urlencoded"};a||s||(d["X-Requested-With"]="XMLHttpRequest"),s||(Object(u.isStandalone)()&&(d["X-View-Mode"]="pwa"),o&&o.headers&&Object.assign(d,o.headers));var f=new AbortController,p=f.signal,h=new Request(e,{credentials:"same-origin",method:"POST",headers:d,body:c,signal:p}),m=fetch(h).then((function(e){return e.text().then((function(t){return e.status>=200&&e.status<300?n&&n(t,e):i&&i(t,e),{response:e,text:t}}))})).catch((function(e){var t=!1;if(i&&i(e&&e.message,null)&&(t=!0),"AbortError"===e.name)return null;if(window.isBasicOffline&&("true"===h.headers.get("X-Ajax-Nav")&&history.back(),!t&&(!D._error_displayed||D._error_displayed<=Date.now()-1e4))){var n=Object(l.getLang)("mobile_general_snackbar_error");navigator.onLine||(n=Object(l.getLang)("mobile_pwa_offline_network_lost")),Object(l.statlogsValueEvent)("mvk_ajax_error_snackbar",Number(navigator.onLine)),Snackbar.init({text:n}),D._error_displayed=Date.now()}throw e})),v={request:h,abort:f.abort.bind(f),promise:m};return D._last_req=v,v},post:function(e,t,n){return"/"!=e.substr(0,1)&&(e="/"+e),e=e.split("#")[0],D._post(e,t,n||{})},onPrepared:Object(l.se)(),prepare_click:function(e){var t=window.al;if(r.default.ios&&!(r.default.ios>=7)&&window.al&&t.ver){var n=[],i=!1;e&&"a"==(e.tagName||"").toLowerCase()?n.push(e):Object(l.isArray)(e)?n=e:(n=Object(l.geByTag)("a",e),i=!0);for(var a=0,o=n.length;a<o;a++){var s=n[a],c=s&&s.target||"";if(s&&s.getAttribute&&(!i||!s.getAttribute("data-href")&&Object(l.checkElementNav)(s,{skip_onclick:!0})&&"_blank"!=c)){var u=s.getAttribute("href");if(null==u||!Object(l.isHttpHref)(u))continue;Object(l.attr)(s,"data-href",Object(l.getHref)(s)),Object(l.attr)(s,"href",!1)}}}},click:function(e,t,n){var i=window.nav;t=t||{};var a,o=!1,r={_ajax:1},s=Object(l.extend)(t,{link:e});if(n=n||{},(n=Object(l.extend)({closeContextMenu:!0},n)).closeContextMenu&&ContextMenu.close(),t.onStart){var c=D.tAlGetParam();D.tAlStart=(new Date).getTime(),c&&(r._talstat=c)}if(n.use_cache){var u=Object(l.ge)(!0===n.use_cache?"preload_data":n.use_cache),d=u.innerHTML.replace(/(^<!--|-->$)/g,""),_=d.split("--\x3e\x3c!--");if(d)u.innerHTML="",t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0}),t.onDone&&t.onDone.apply(s,_),(e=Object(l.geByClass1)("show_more",Object(l.geByClass1)("pcont","mcont")))&&D.click(e,{onDone:function(){var e="";Object(l.each)(arguments,(function(t,n){e+="\x3c!--"+(n||"")+"--\x3e"})),u.innerHTML=e,Object(l.ge)("show_more_loading")&&D.click(!1,t,n)}},{closeContextMenu:!1});else t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0});return!1}if(!e)return!0;if(e.form){if(e.disabled)return!0;var f=e.form,p={};o=(f.action||"").replace(/^https?:\/\/[^\/]+/i,""),Object(l.each)(f,(function(t,n){return!(n.name&&!n.disabled)||("radio"===n.type&&!n.checked||("checkbox"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==e||("image"===n.type&&n!==e||void(p[n.name]=n.value))))))})),"image"==e.type&&(p[e.name]=e.value,p[e.name+".x"]=1,p[e.name+".y"]=1),f.method&&"get"!=f.method?Object(l.extend)(r,p):o=o.split("?",1).shift()+Object(l.obj2qs)(p)}else e.getAttribute&&(o=e.getAttribute("data-href")||e.getAttribute("href"));if(o||(o=e.pathname?e.pathname+e.search+e.hash:e),!o)return!0;Object(l.extend)(r,n.url_params||{});var h=window.pStats,m=h.getSeenData();if(m){var v=window.cur;r._pstat=m.data,v&&v.module&&(r._pstatref=v.module)}return(a=D.post(o,r,{onDone:function(){m&&h.onSend(m.seen),n.lock&&Object(l.unlockButton)(e),t.onDone&&t.onDone.apply(s,arguments),(n.nav||n.scroll)&&Object(l.scrollToHash)()},onFail:function(){n.lock&&Object(l.unlockButton)(e),t.onFail&&t.onFail.apply(s,arguments),(n.nav||n.scroll)&&Object(l.scrollToHash)()}}))&&(t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0}),n.lock&&Object(l.lockButton)(e)),!a},nav:function(e,t){var n=window.nav,o=window.page,u=window.menu,_=window.cur,f=window.Tabbar;(t=t||{}).nav=t.nav||{};var p,A=Object(l.getHref)(e),y=o.getHash(t.nav);if(!(A=n.checkUrl(A)))return!1;"/"!=A.substr(0,1)&&(A="/"+A),u.close(null,!0);var w=D.tGetParam();if(D.tStart=(new Date).getTime(),t.need_restore&&u&&u.closeSearch(),window.isNewMail&&(t.need_restore&&t.nav.push&&!t.need_check_updates&&D.abort_reqs(),n.onBeforeGo2(t.nav.path,Object.assign({},Object(l.qs2obj)(t.nav.params),t.params),t.nav.push,t)))return D.abort_reqs(),!0;if(t.need_restore&&t.nav.push&&(p=o.restore(y))&&(D.abort_reqs(),D._failed_relogin=!1,p.lm&&Object(l.extend)(p.lm,{tn:!1,bn:!1}),o.set(y,p,{restored:!0},t),t.zProcess&&(t.zProcess(p.st),delete t.zProcess),n.set(t),D.tModule=window.cur.module,D.tRestoreRender=(new Date).getTime(),!t.need_check_updates))return!0;var S=!1,k=!1;if(t.need_check_updates&&n.isTabHaveCache(t.tab,y));else if(t.fast)S=!0,o.set(y,!1,{before:!0,beforeAppend:t.beforeAppend,afterAppend:t.afterAppend}),k=t.onAfterFast||!1;else if(t.target&&t.target.className){(O=/(?:^|\s)(al_([a-z_]+)(-?[0-9]+)?)(?:\s|$)/i.exec(t.target.className))&&O[1];var O,C=O&&O[2]||!1;switch(C){case"menu":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){var n=Object(a.$)(".vk__page");if(n.className=n.className.replace("vk__page_notifications",""),window.isNewMail){var i=Object(l.geByClass1)("mcont",e)||Object(l.geByClass1)("layout__basis");Object(l.val)(i,'<div class="pcont bl_cont"><div id="al_loading"></div></div>')}else Object(l.val)(Object(l.geByClass1)("mcont",e),'<div class="pcont bl_cont"><div id="al_loading"></div></div>');o.setMhead(e,Object(l.attr)(t.target,"data-header"),"/")},afterAppend:function(){window.isNewMail&&"/mail"===y?Object(l.alLoadingFix)(Object(l.geByClass1)("layout").offsetHeight):Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"tab":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){Object(l.val)(Object(l.geByClass1)("upanel",e),'<div id="al_loading"></div>'),Object(l.val)(Object(l.geByClass1)("basisDefault",e),'<div id="al_loading"></div>');var t=Object(l.geByClass1)("tabs_block",e)||Object(l.geByClass1)("tabs",e),n=Object(l.geByClass1)("active",t);n&&(Object(l.hasClass)("tab_item_top",n)?(Object(l.removeClass)("tab_item_cur",Object(l.geByClass1)("tab_item_cur",t)),Object(l.addClass)("tab_item_cur",Object(l.geByClass1)("tab_item",t))):(Object(l.removeClass)("tab_item_cur",Object(l.geByClass1)("tab_item_cur",t)),Object(l.addClass)("tab_item_cur",n)))},afterAppend:function(){Object(l.alLoadingFix)()}},t);break;case"post":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(l.clone)(Object(l.gpeByClass)("post_item",t.target)),a=i.id,r=Object(l.outer)(Object(l.gpeByTag)("a",Object(l.geByClass1)("pi_img",i))).replace("pi_img","op_img"),s=Object(l.gpeByTag)("div",Object(l.geByClass1)("pi_author",i)),c=Object(l.remove)(Object(l.geByClass1)("pi_date",i)),u=Object(l.outer)(Object(l.remove)(Object(l.geByClass1)("explain",s))),d=Object(l.remove)(Object(l.geByClass1)("pi_fronly",i)),_=Object(l.outer)(s),f=Object(l.geByClass1)("pi_body",i),p=Object(l.geByClass1)("pi_text_more",f),h=(c=Object(l.geByClass1)("pi_date",i),Object(l.geByClass1)("pi_info",f)),m=Object(l.geByClass1)("pi_links",f),v=Object(l.geByClass1)("replies_link",m),g=Object(l.val)(Object(l.remove)(Object(l.geByClass1)("pi_actions_wrap",i))),A=Object(l.val)(Object(l.remove)(Object(l.geByClass1)("item_replies",h)))?Object(l.val)(v):n.mobile_wall_post_replies_title,b=v?'<a name="comments"></a><h3 class="slim_header">'+(A||"")+'</h3><div id="al_loading"></div>':"";if(p){var y=p.nextSibling?p:p.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}Object(l.val)(m,Object(l.outer)(Object(l.geByClass1)("like_wrap",f))),c&&Object(l.attr)(c,"data-date")&&Object(l.val)(c,Object(l.attr)(c,"data-date")),o.setMhead(e,Object(l.attr)(t.target,"data-header"),!0),Object(l.val)(Object(l.geByClass1)("mcont",e),function(e,t,n,i,a,o,r,s){return'<div class="pcont bl_cont"><div class="owner_panel">'+(t||"")+'<div class="op_cont">'+(n||"")+'<div class="op_info"><span class="item_date">'+(i||"")+'</span></div></div></div><div id="'+(e||"")+'" class="post_item single_post_item"><div class="pi_cont"><div class="pi_head">'+(a||"")+'</div><div class="pi_body">'+(o||"")+"</div></div>"+(s||"")+"</div>"+(r||"")+"</div>"}(a,r,_,Object(l.val)(c)+(d?'<b class="pi_fronly"></b>':""),u,Object(l.val)(f),b,g))},afterAppend:function(e){var n=Object(l.geByTag1)("h3",e);n&&Object(l.alLoadingFix)(t.nav.hash?Object(l.getCh)()-n.offsetHeight:0),t.nav.hash?Object(l.scrollToHash)(t.nav.hash):Object(l.scrollTop)(0)}},t);break;case"wall":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(l.clone)(Object(l.hasClass)("wall_item",t.target)?t.target:Object(l.gpeByClass)("wall_item",t.target)),a=i.id,r=Object(l.geByClass1)("wi_body",i),s=Object(l.geByClass1)("wi_buttons",i),c=Object(l.geByClass1)("item_like",s),u=Object(l.geByClass1)("v_like",c),d=Object(l.geByClass1)("item_share",s),_=Object(l.geByClass1)("v_share",d),f=Object(l.remove)(Object(l.geByClass1)("item_replies",s)),p=!!f&&Object(l.geByClass1)("v_replies",f),h=+Object(l.stripTags)(Object(l.val)(p)).replace(/\D/g,""),v=Object(l.geByClass1)("pi_text_more",r),g=Object(l.geByClass1)("wi_date",i),A=h?Object(l.langNumeric)(h,n.mobile_wall_post_comments):n.mobile_wall_post_replies_title,b=f&&h<50?'<a name="comments"></a><h3 class="slim_header">'+(A||"")+'</h3><div id="al_loading"></div>':"";if(clog("item_replies",f),Object(l.remove)(Object(l.geByClass1)("wi_actions_btn",i)),Object(l.remove)(Object(l.geByClass1)("post__subscribeBtn",i)),Object(l.remove)(Object(l.geByClass1)("post__extraHeader",i)),u?Object(l.val)(u):Object(l.append)(Object(l.ce)("span",{className:"v_like"}),c),_?Object(l.val)(_):Object(l.append)(Object(l.ce)("span",{className:"v_share"}),d),v){var y=v.nextSibling?v:v.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}g&&Object(l.attr)(g,"data-date")&&Object(l.val)(g,Object(l.attr)(g,"data-date")),o.setMhead(e,Object(l.attr)(t.target,"data-header"),!0);var w=Wd.html(Object(m.Separator)({hideOnDesktop:!0}));Object(l.val)(Object(l.geByClass1)("mcont",e),function(e,t,n,i){return'<div class="pcont"><div class="PageBlock">'+e+'<div class="wall_item single_wall_item" id="'+(t||"")+'">'+(n||"")+"</div>"+(i||"")+"</div></div>"}(w,a,Object(l.val)(i),b)),Object(l.addClass)("vk__page_singlePost",document.body)},afterAppend:function(e){var n=Object(l.geByTag1)("h3",e);n&&Object(l.alLoadingFix)(t.nav.hash?Object(l.getCh)()-n.offsetHeight:0),t.nav.hash?Object(l.scrollToHash)(t.nav.hash):Object(l.scrollTop)(0)}},t);break;case"pinfo":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){var t=window.lang,n=Object(l.geByClass1)("owner_panel",e),i=Object(l.geByClass1)("pp_img",n),a=Object(l.geByClass1)("op_header",n),r=Object(l.geByClass1)("lvi",a),s=Object(l.geByClass1)("pp_last_activity",n),c=Object(l.ce)("div");Object(l.addClass)("mhi_back",Object(l.geByClass1)("mh_header",e)),Object(l.val)(n,'<img src="'+Object(l.escapeAttr)(Object(l.attr)(i,"src")||"")+'" class="op_img"><div class="op_cont"><h2 class="op_header">'+Object(l.stripTags)(Object(l.val)(a))+'</h2><div class="pp_online">'+(r?t.mobile_online:Object(l.val)(s))+"</div></div>"),Object(l.val)(Object(l.geByClass1)("ipanel",e),"<div>"+Object(l.val)(c)+'</div><div id="al_loading"></div>'),o.setMhead(e,!1,!0)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0,10)}},t);break;case"player":S=!0;var I=Object(l.qs2obj)(t.nav.params).playlist_id;o.set(y,!1,{before:!0,beforeAppend:function(e){var t=window,n=t.lang,i=t.audio,a=(i.playlist(),i.playlist_q());o.setMhead(e,n.mobile_menu_player_head_title,!0),Object(l.val)(Object(l.geByClass1)("mcont",e),'\n                <div class="pcont audioPage">\n                  <div class="PageBlock">\n                    <div class="audioPage__header">\n                      '+AudioPlaylist.tplPlayerSearch(I)+'\n                    </div>\n                    <div id="au_search_items" class="upanel bl_cont">\n                      <div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(a)+'"></div>\n                    </div>\n                  </div>\n                </div>'),Object(l.val)("m",e.innerHTML)}},t),k=function(){var e=window,n=e.qsearch,i=e.audio,a=i.playlist(),s="/audio"+Object(l.obj2qs)({act:"player",list:I}),c=[],u={},d=i.getCurrentId();Object(l.each)(a,(function(e,t){t.chartInfo=null,c.push(t.fullId),u[t.fullId]=[t.performer+" "+t.title,t]}));var _=c.indexOf(d),f=_>-1?Math.min(_+10,c.length):50,p=[];n.init({action:s,al_action:s,container:"au_search_items",field:Object(l.ge)("au_search_field"),btn:Object(l.ge)("au_search_btn"),top_items:c,_cache:u,forceRerender:!0,tpl:function(e,t,n,a){var o="";if(t){if(a)return a;o=""==a?'<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(t)+'">'+e+"</div>":'<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(t)+'"><div class="al_loading qs_loading">&nbsp;</div></div>'}else o='<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(i.playlist_q())+'">'+e+"</div>";return Wd.html(h({playlist_id:I,inner:Wd.wrap(o)}))},item_tpl:function(e){var t=window.audioplayer;return p.push(e),t&&t.getDOMFromAudio(e,!0,this.q,!0)||""},null_tpl:function(e){var t=window.lang;return'<div class="service_msg_box">\n                  <div class="service_msg service_msg_null">\n                  '+(e?t.mobile_audio_search_not_found.replace("%s",Object(l.htsc)(e)):t.mobile_audio_no_audio)+"\n                  </div>\n                </div>"},soft_filter:!0,need_invalid_keys:r.default.desktop,top_len:f,global_search:!0,onRendered:function(){var e=window,t=e.audioplayer,n=e.audio;t&&t.initAudio(),n.addToPlaylist(p),Object(l.alLoadingFix)()},al_need:!0,init_offset:0});var m=window.audioplayer.getCurrentElem();if(m){var v=Object(l.getY)(m)+m.offsetHeight/2-Object(l.getCh)()/2;Object(l.scrollTop)(v,100),o.save(y,{html:null,st:Object(l.scrollTop)(),page:Object(l.ge)("m"),state:o.stash(),cur:window.cur,options:t||{}},!1)}};break;case"photo":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n=Object(l.geByTag1)("img",t.target),i=(Object(l.attr)(n,"data-src_big")||"").split("|"),a=(i[0],i[1],i[2],n&&n.src||"/images/mobile/blank.gif"),r=n&&n.width||+i[1]||0,s=n&&n.height||+i[2]||0,c=(domData(n,"info-title"),domData(n,"info-subtitle"),function(e,t){return Wd.html(Object(E.default)({is_loading:!0,photo:e}))}({src:a,width:r,height:s}));Object(l.val)(Object(l.geByClass1)("mcont",e),c),Object(l.alLoadingFix)(),o.setMhead(e,lang.mobile_photos_photo_title)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"album":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n,r=t.target.href,s=/((?:album|tag)(-?\d+)(?:(?:_(\d+))?))/.exec(r);s&&(n=s[1]);var u=n&&Object(v.getState)(n)||{},d=Object(a.$)(".AlbumItemInfo__title",t.target),_=!1;t.target.classList.contains("AlbumItem--empty")&&(_=!0);var p=Object(c.makeUrl)("/"+n,{act:"select_album"}),h=Object(i.default)({},u,{title:u.title||Object(l.val)(d)||lang.mobile_page_title_album,description:Wd.wrap(u.description),is_empty:_,add_url:p}),m=function(e){return void 0===e&&(e={}),Wd.html(Object(g.default)(Object(i.default)({},e,{title:Wd.wrap(e.title),is_loading:!e.is_empty})))}(h);Object(l.val)(Object(l.geByClass1)("mcont",e),m),Object(l.alLoadingFix)(),o.setMhead(e,h.title,!0,!1,{movable:!0})},afterAppend:function(){Object(g.initAlbumPage)(),Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"albums":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n=t.target.closest(".AlbumsBlock"),o=[];n&&(o=Array.from(Object(a.$$)(".AlbumItem",n)).map((function(e){return Object(b.getDataFromDOM)(e).album})));var r=function(e){return void 0===e&&(e={}),Wd.html(j(Object(i.default)({},e,{section:"all"})))}({albums:o});Object(l.val)(Object(l.geByClass1)("mcont",e),r),Object(l.alLoadingFix)()},afterAppend:function(){Object(g.initAlbumPage)(),Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"u":case"g":case"p":case"e":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"playlists":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"empty":case"artist":case"playlist":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"news_subsection":S=!0,o.set(y,!1,{before:!0,beforeAppend:function(e){var t=Object(l.geByClass1)("news_subsections",e);t&&!Object(l.hasClass)("summary_loading",t.firstChild)&&Object(l.before)(Object(l.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}});break;case"tabbar":S=!0,t.is_fast=!0;var M=!1,P={options:{is_fast:!0,tab:t.tab,prev_tab:t.prev_tab}};t.need_check_updates&&p&&(P=Object(l.extend)(P,p),M=!0),o.set(y,P,{before:!M,beforeAppend:function(e){o.setMhead(e,Object(l.attr)(t.target,"data-header"),!1),f.drawSkeletonLoader(e,t.tab),document.body.classList.contains("vk_tabbar_bottom")&&o.hideHeader(e)},afterAppend:function(){Object(l.alLoadingFix)()}});break;default:_=window.cur;var x=!!Object(l.geByClass1)("mhi_logo","mhead");if(S=!0,_.al_fast&&_.al_fast[C])o.set(y,!1,_.al_fast[C](t),t);else if(!x){var L={options:{is_fast:!0,tab:t.tab,removeAfterNextResponse:t.removeAfterNextResponse}};o.set(y,L,{before:!0,afterAppend:function(){Object(l.alLoadingFix)()}})}}}if(t.need_check_updates||D.abort_reqs(),t.local){var B=!0;o.set(y,{},{after:!0,no_scroll:!0,force:!0},!1),k&&k()}else{var R=Object(T.partConfigEnabled)("mvk_fix_nav_params")?{}:Object(l.qs2obj)(t.nav.params);Object(l.extend)(R,t.params||{}),window.al&&!window.al.inited?R[u.NEED_MENU_PARAM]=u.FORCE_NEED_MENU:window.al&&window.al.menu||(R[u.NEED_MENU_PARAM]=u.NEED_MENU),w&&(R._tstat=w);var N=window.pStats,H=N.getSeenData();H&&(R._pstat=H.data,_&&_.module&&(R._pstatref=_.module)),t.target&&Object(s.isElement)(t.target)&&(R._ref=domData(t.target,"ref")),R._ref||(R._ref=(n.path||"").substr(1));var V=A.split("#");!R._hash&&V.length>1&&(R._hash="#"+V[1]),Object(d.preloadStaticForNavigation)(A);var U=Object.assign({},t.headers,{"X-Ajax-Nav":"true"});B=D.post(A,R,{onPageDone:function(e,n,i,r,s){D.fastNav=!1;var l=window.cur;if(H&&N.onSend(H.seen),D.tProcess=(new Date).getTime(),o.set(y,{title:e,html:n,js:i,lm:r,bc:s,st:t.st||0},{after:S,no_scroll:S,al_transition:!0},!S&&t),t.back){var c=Object(a.$)(".layout");o.setMhead(c,!1,t.back)}D.tModule=l.module,D.tRender=(new Date).getTime(),D.onNavDone()},redirectToLoginPage:t.redirectToLoginPage,headers:U});D.save_req()}return S&&(t.zProcess&&(t.zProcess(),delete t.zProcess),n.set(t),D.tModule=_.module,D.tFastRender=(new Date).getTime(),D.fastNav=!0),B},confirm:function(e){function t(t,n,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i){return!!confirm(t)&&D.click(e,i,{url_params:{hash:n}})})),_post:function(e,t,n){var i=function(e,t){n.onFail&&n.onFail.call(window,0,e,t)},a=window.debuglogSent?window.debuglogSent(e):-1;return D.plainpost(e,t,(function(o,r){if(204===r.status&&r.headers.get("X-AppShell-Fallback")){var s=location.href;return history.replaceState(null,null,Object(c.makeUrl)(location.href,{__appshell_fallback:r.headers.get("X-AppShell-Fallback")})),void location.replace(s)}var u=!1;try{u=Object(l.parseJSON)(o)}catch(t){if(r.getResponseHeader("Content-Type").includes("text/html"))return nav.hard_go(e,null,n);u=!1}!1===u?i():(D.parseResponse(u,e,t,n),D._debugLog(a,u.debugLog))}),i,null,{headers:n.headers})},_debugLog:function(e,t){window.debuglogGot&&window.debuglogGot(e,t)},parseResponse:function(e,t,n,i){var o,r=window.al,s=window.nav,c=window.menu,u=window.page,_=e.version,h=e.counters,m=e.notifications,v=e.type,g=e.statsMeta,A=t.indexOf("community")>=0,b=!1;if(v!==D.RESPONSE_IGNORE)switch(A?(b=!(!window.al||_===r.ver))&&Object(l.statlogsValueEvent)("mvk_version_reload",1,_,r.ver,"old_force_reload_community"):window.al&&_!==r.ver?Object(T.partConfigEnabled)("mvk_lazy_static_reload")?v===D.RESPONSE_ARGUMENTS?L||(L=new I.default({id:"mvk_static_manager",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:6e5,onIdleCb:function(){Object(l.statlogsValueEvent)("mvk_version_reload",1,_,r.ver,"new_idle_reload"),L.stop(),location.reload()}})).start():(Object(l.statlogsValueEvent)("mvk_version_reload",1,_,r.ver,"new_force_reload"),b=!0):(Object(l.statlogsValueEvent)("mvk_version_reload",1,_,r.ver,"old_force_reload"),b=!0):!window.menu||e.lm_data&&e.lm_data.lm||c.isMenuHasItems()&&((b=!c.refreshCounters(h))&&Object(l.statlogsValueEvent)("mvk_version_reload",1,_,r.ver,"old_force_reload_change_menu"),c.refreshNotifications(m)),void 0===h||!1===h||A||Object(l.setNotify)(h[R.COUNTERS_POS_MESSAGES]),e.lm_data&&e.lm_data.lm&&(h&&(e.lm_data.counters=h),m&&(e.lm_data.notifications=m)),g&&window.vk&&(window.vk.statsMeta=g),v){case D.RESPONSE_ARGUMENTS:if(b)return s.hard_go(s.cur,null,{replace:!0});var y=e.data;if(o=y&&Object(l.isObject)(y[0])&&y[0]._snackbar){if(Snackbar.init(o),2===o.type)return photoview.opened()?void photoview.close():Stories.opened?void Stories.close():zlayer.opened()?void zlayer.close():void(D.fastNav&&history.back());delete y[0]._snackbar}i&&i.onDone&&i.onDone.apply(window,y);break;case D.RESPONSE_REDIRECT:var w=e.location;D.onRedirect(!0,w);var S=e.hard,k=e.frame,O=e.clear,C=e.restore,j=e.replace;if(!k&&window.isNewMail&&D.onBeforeRedirect(w))break;if(O&&s.clear(),(o=e._snackbar)&&(Snackbar.init(o),delete e.snackbar),b||S)s.hard_go(w,null,{replace:j});else if(k){Object(f.setDocumentDomain)();var E=w+(-1==w.indexOf("?")?"?":"&")+"__extra=1",M=Object(l.createIframe)({src:E})}else j&&w===s.prev_cur?history.back():s.go(w,null,{ignore_cur_process:!0,need_restore:C,replace:j});break;case D.RESPONSE_CAPTCHA:var P=e.location,x=e.img,N=e.post,H=e.key;i&&i.onFail?i.onFail(v,P,{location:P,img:x,post:N,key:H}):s.hard_go(P);break;case D.RESPONSE_PAGE:var V=e.lm_data;if(u.need_hard_go=b,V&&V.rdr&&window.al&&r.menu&&Object(l.getW)("vk_wrap")>=614){s.go(V.rdr,null,{replace:!0});break}p.default.getRouter().deactivateAllRoutes(),cur.share&&"destroy"in cur.share&&cur.share.destroy(),(i=i||{}).onPageDone||(i.onPageDone=function(e,n,i,a,o){s.go(t,null,{push_only:!0}),u.set(u.getHash(s),{title:e,html:n,js:i,lm:a,bc:o})});var U=e.title,F=e.html,$=e.js,W=e.body_class,q=e.top_bar,z=Object(l.ge)("vk_topbar");q&&!z?(z=Object(l.ce)("div",{id:"vk_topbar",innerHTML:q}),Object(l.before)(z,Object(a.$)(".layout"))):Object(l.val)(z,q),e.env&&e.env.pe&&(window.vk.pe=e.env.pe),Object(d.addStatic)(e.static_files).then((function(){i.onPageDone(U,F,$,V,W)}));break;case D.RESPONSE_FAILED_AUTH:if(i.redirectToLoginPage)return window.location=e.location,!1;if(!D._failed_relogin){var Y=e.location;Object(f.setDocumentDomain)();M=Object(l.createIframe)({src:Y})}D._failed_relogin=!0,D.save_failed_req(M,t,n,i);break;case D.RESPONSE_CONFIRM:var G=e.data,Q=B(G),K=Wd.elem(Q);Popup.open(K,!0);break;case D.RESPONSE_IGNORE:return}},onReLoginDone:function(){D.repeat_reqs(),D._failed_relogin=!1},tGetParam:function(){if(D.tStart&&D.tModule){var e=D.tFastRender-D.tStart,t=D.tRestoreRender-D.tStart,n=D.tProcess-D.tStart,i=D.tRender-D.tProcess,a=["/"==D.tModule.substr(0,1)?D.tModule.substr(1):D.tModule,e,t,n,i];for(var o in a)(!a[o]||a[o]<0)&&(a[o]=0);return D.tStart=!1,a.join(",")}},tAlGetParam:function(){if(D.tAlStart&&D.tAlModule){var e=D.tAlProcess-D.tAlStart,t=D.tAlRender-D.tAlProcess,n=["al_"+("/"==D.tAlModule.substr(0,1)?D.tAlModule.substr(1):D.tAlModule),e,t];for(var i in n)(!n[i]||n[i]<0)&&(n[i]=0);return D.tAlStart=!1,n.join(",")}},refreshLinks:function(e,t){if(e){var n=Object(l.geByClass1)("mmi_fv","lm_cont"),i=n&&Object(l.geByClass1)("lfm_item",n),a=Object(l.geByClass1)("mmi_fv","mfoot"),o=a&&Object(l.geByClass1)("lfm_item",a),r=Object(l.ge)("fv_link"),s=Object(l.ge)("menu_fv_link"),c=Object(l.geBySel1)('link[rel="canonical"]');Object(l.attr)(i,"href",e),Object(l.attr)(o,"href",e),Object(l.attr)(r,"href",e),Object(l.attr)(c,"href",Object(l.attr)(Object(l.ge)("mcont"),"data-canonical")),window.nav.prev_fv_link&&Object(l.attr)(s,"href",window.nav.prev_fv_link),window.nav.fv_link=e}if(t){var u=Object(l.geByClass1)("mmi_app","lm_cont"),d=u&&Object(l.geByClass1)("lfm_item",u),_=Object(l.geByClass1)("mmi_app","mfoot"),f=_&&Object(l.geByClass1)("lfm_item",_),p=Object(l.ge)("app_link"),h=!!t&&"return nav.app_go(this, event, '"+Object(l.escapeStr)(t)+"');";Object(l.attr)(d,"onclick",h),Object(l.attr)(f,"onclick",h),Object(l.attr)(p,"onclick",h)}}};window.ajax=D}t.default=window.ajax},l51W:function(e,t){var n=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(a),val(a.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(a)}}}();window.GroupsInvite=n},ldCb:function(e,t){window.Informer={close:function(e){hide(e)}}},lkNA:function(e,t,n){"use strict";function i(e,t){var n,i=t.timeout,a=t.onLoad,o=t.onError,r=document.createElement("script");function s(e){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(c(),a&&a())}function l(e){c(),o&&o()}function c(){clearTimeout(n),r.removeEventListener("load",s),r.removeEventListener("readystatechange",s),r.removeEventListener("error",l)}return r.addEventListener("load",s),r.addEventListener("readystatechange",s),r.addEventListener("error",l),r.src=e,document.head.appendChild(r),i&&(n=setTimeout(l,i)),{destroy:function(){c()}}}n.r(t),n.d(t,"loadScript",(function(){return i}))},mPGc:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedGroups"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER){var t,n,i=e.querySelector(".Slider__scroll").dataset.code;if(i)null==(t=window.RecommendedGroupsSlider)||t.viewBlock(i),null==(n=window.RecommendedGroupsSlider)||n.onScroll();if(e._groupsSliderHandlersAdded)return;e._groupsSliderHandlersAdded=!0}}))},myok:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("BoyB"),o={className:"Btn",setLoading:function(e,t,n){void 0===n&&(n="");if(!e)return;var i=e.classList.contains(r);if(t){if(i)return;var o=e.classList.contains(s),d=e.classList.contains(c);!n&&o&&(n="white");var _=!1;"spinner"===n&&(_=!0,n=!1);var f=Object(a.default)({mix:l,white:"white"===n||d,large:!0,spinner:_});e.classList.add(r),e.insertAdjacentHTML("afterbegin",f)}else{if(!i)return;var p=e.$(u.loader);e.classList.remove(r),p.remove()}},setDisabled:function(e,t){void 0===t&&(t=!0);e.disabled=t}};t.default=o,o._onClick=d;var r="Btn_loading",s="Btn_theme_secondary",l="Btn__loader",c="Btn__loader--white",u={loader:"."+l};function d(e,t,n){e.preventDefault(),i.default.handle(n,{$btn:t})}},nXjO:function(e,t){var n={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout((function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()}),this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),(function(){this.src=n})),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=n},nj7l:function(e,t,n){"use strict";n.r(t),n.d(t,"setShown",(function(){return d})),n.d(t,"canShow",(function(){return f})),n.d(t,"initShownTooltips",(function(){return u})),n.d(t,"initEnabledTooltips",(function(){return c}));var i=n("UxAg"),a=n("OcsD"),o=n("Xrg9"),r=n("kr3z");u();var s={},l={};function c(e){l=e}function u(){s=o.default.get("shown_tooltips")||{}}function d(e){if(!e)return!1;var t=o.default.get("shown_tooltips")||{};t[e]=!0,_(e),o.default.set("shown_tooltips",t),s[e]=!0,r.default.post("/?act=tooltip_click&id="+e)}function _(e){var t=Object(i.$)('.Tooltip[tooltip-id="'+e+'"]');Object(a.re)(t)}function f(e){return!!e&&(u(),Object(a.isUndefined)(l[e])?!s[e]:!s[e]&&l[e])}Object(a.addEvent)(window,"click",(function(e){var t=e.target&&e.target.classList.contains("Tooltip")?e.target:e.target.closest(".Tooltip");if(t&&(e.preventDefault(),e.stopPropagation()),t&&t.classList.contains("Tooltip_onboarding")){var n=t.getAttribute("tooltip-id");d(n),_(n)}}),{capture:!0})},p5n7:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("fdw3"),o=function(e){void 0===e&&(e={});var t=e.style||[],n=e.class||e.mix,o=e.prefix,r=e.postfix,s=function(e){var t=[];Object(a.isArray)(e.on_key_down)?(e.on_key_down.push("event"),t=e.on_key_down):e.on_key_down&&(t=[e.on_key_down,"event"]);var n=e.on_key_press;return{class:"TextInput__native",id:e.id,tag:"input",type:e.type,name:e.name,value:e.value,spellcheck:e.spellcheck+"",placeholder:e.placeholder,autocapitalize:!1===e.autocapitalize?"off":null,autocomplete:!1===e.autocomplete?"off":null,tabindex:e.tabindex,readonly:e.readonly,disabled:e.disabled,oninput:e.on_change,onkeydown:t,onkeypress:n,onblur:e.onblur,onfocus:e.onfocus,maxlength:e.maxlength,pattern:e.pattern,required:e.required,inputmode:e.inputmode}}(e),l=e.error;l&&(t.error=!0);return{class:[i.default.class("TextInput",{style_stretch:t.stretch,prefixed:!!o,hidden:"hidden"===e.type,error:t.error}),n],tag:"label",onclick:e.on_click,inner:o||r||l?[o?{class:i.default.class("TextInput__prefix",{rightPadding:o.with_right_padding,gray:o.gray}),inner:o.text}:null,{class:"TextInput__nativeWrap",inner:s},r?{class:"TextInput__postfix",inner:r.text}:null,l?{inner:[l],class:"TextInput__errorLabel",tag:"span"}:null]:s}};var r=n("zvhO"),s=n("OcsD");Object.assign(o,{setPrefix:function(e,t){e.$(c).innerText=t},getValue:function(e){return e.$(l).value},filter:function(e,t,n){switch(e){case"number":var i=Object(s.val)(n)+String.fromCharCode(t.which);Object(r.isNumber)(parseInt(i))||Object(s.cancelEvent)(t),Object(s.val)(n,Object(s.val)(n).split("").filter((function(e){return Object(r.isNumber)(+e)})).join(""))}}});var l=".TextInput__native",c=".TextInput__prefix";t.default=o;window.TextInput=o},"r/ag":function(e,t,n){"use strict";n.r(t),n.d(t,"POPUP_DISAPPEAR_TIME",(function(){return d})),n.d(t,"POPUP_NAV_PREFIX",(function(){return u}));var i,a,o=n("Po+v"),r=n("1By4"),s=n("UxAg"),l=n("j80l"),c=n("OcsD"),u="pop_",d=200;Object.assign(o.default,{open:function(e,t,n){void 0===n&&(n={});var i=n,a=i.hash,o=i.oncloseCallback;if(C(e),g=Boolean(n.forceScrollDisable),t){var r=e;(e=r.cloneNode(!0)).appendedToBody=!0,e.original=r,document.body.appendChild(e)}e.classList.add(f.open);var s=e.$(p.scroll);k(e),o&&b.push([e,o]);if(s){if(w(e,s),e.onResizeHandler=function(){w(e,s)},Object(c.addEvent)(window,"resize",e.onResizeHandler),!window.MutationObserver)return e;e.scrollContentObserver=new MutationObserver(e.onResizeHandler),e.scrollContentObserver.observe(s,{childList:!0,subtree:!0})}if(a){var l="#"+u+a,d=nav.cur.split("#")[0];nav.go(d+l,!1,{push_only:!0}),A[l]=e}return e},close:S});o.default;o.default._onOverlayClick=y;var _,f=((i={popup:"Popup",open:"Popup_open",wrap:"Popup__wrap",content:"Popup__content",hasScroll:"Popup_hasScroll",scrollView:"ScrollView",closing:"Popup--closing"}).content="Popup__content",i),p=((a={open:"."+f.open,popup:"."+f.popup,wrap:"."+f.wrap,content:"."+f.content,scroll:".Popup__scroll",header:".Popup__header",footer:".Popup__footer"}).content="."+f.content,a),h=!1,m=null,v=null,g=!1,A={},b=[];function y(e,t,n){var i=e.closest(p.popup);t&&r.default.handle(t,{$popup:i}),n&&S(i)}function w(e,t){var n=e.$(p.header),i=e.$(p.footer);t.scrollHeight-6>t.offsetHeight?(Object(c.addClass)(e,f.hasScroll),Object(c.addClass)(t,f.scrollView),ContentScrollView.restore()):(Object(c.removeClass)(e,f.hasScroll),Object(c.removeClass)(t,f.scrollView),t.scrollTop=0);var a=Object(c.getCh)(),o=0,r=0;n&&(o=n.offsetHeight),i&&(r=i.offsetHeight);var s=Math.min(a-o-r-100,420);Object(c.setStyle)(t,"max-height",s+"px")}function S(e,t){void 0===t&&(t={});var n=t,i=n.smooth,a=n.velocity,o=n.lastY;if(e&&!e.classList.contains(f.popup)&&(e=e.closest(p.popup)),e||(e=Object(s.$)(p.open)),e){var r=Object(s.$)(p.wrap,e),d=Object(s.$)(p.content,e);if(i&&a&&o){var _=Object(c.getH)(d),h=(_-o)*a.y;return h>=300&&(h=200),h=Math.max(150,Math.min(300,h)),c.setStyle.animate(r,"transform",{duration:h,func:"cubic-bezier(0.0, 0.0, 0.2, 1)"}),c.setStyle.transform(r,1,[0,_+"px"]),e.classList.add(f.closing),setTimeout((function(){S(e)}),1.1*h)}if(i){e.classList.add(f.closing);var m=Object(c.getH)(d);return c.setStyle.transform(r,1,[0,m+"px"]),setTimeout((function(){S(e)}),200*1.1)}if(e.classList.remove(f.open),e.appendedToBody&&document.body.contains(e)&&Object(c.replace)(e,e.original),e.classList.remove(f.closing),c.setStyle.transform(r),Object(c.removeEvent)(window,"resize",e.onResizeHandler),e.scrollContentObserver&&e.scrollContentObserver.disconnect(),Object(s.$)(p.open)||O(),nav.cur&&nav.cur.startsWith("#"+u)){var v=l.default.make(nav.path,qs2obj(nav.params));nav.set({nav:Object(c.extend)({},nav,{cur:nav.path,path:nav.path||"",push:v||""})})}var g,A=(g=e,(b.find((function(e){return e[0]===g}))||[])[1]);A&&(A(),C(e)),window.cur&&window.cur.app&&window.cur.app.frame&&window.cur.app.frame.focus()}}function k(e){if(window.MutationObserver&&!h){nav.saveScrollPosition();var t=document.body;m=t.style.overflow,h=!0,browser.ios||browser.ipad||(t.style.overflow="hidden"),g&&(t.style.height="100%",document.documentElement.style.overflow="hidden"),v=new MutationObserver((function(){t.contains(e)||O()})),_=Object(c.scrollTop)(),document.body&&(document.body.classList.add("fixed"),Object(c.setStyle)(document.body,{top:"-"+_+"px"}),browser.safari&&Object(c.getCw)()<882&&document.scrollingElement&&(document.scrollingElement.scrollTop=_,setTimeout((function(){document.scrollingElement.scrollTop=_}),100),setTimeout((function(){document.scrollingElement.scrollTop=_}),300))),v.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}}function O(){window.MutationObserver&&h&&(document.body.style.overflow=m,g&&(document.documentElement.style.overflow="initial"),v.disconnect(),document.body&&(document.body.classList.remove("fixed"),Object(c.setStyle)(document.body,{top:""}),Object(c.scrollTop)(_)),h=!1)}function C(e){var t=b.findIndex((function(t){return t[0]===e}));t>=0&&b.splice(t,1)}nav.onPopState&&nav.onPopState((function(){var e=A[nav.cur];e&&(S(e),delete A[nav.cur])})),window.Popup=o.default;t.default=o.default},r0fY:function(e,t,n){"use strict";var i,a,o,r,s,l,c,u,d,_,f,p;n.r(t),n.d(t,"EventScreens",(function(){return i})),n.d(t,"ProductionStatEventTypes",(function(){return a})),n.d(t,"NavigationProductionStatEventTypes",(function(){return o})),n.d(t,"ActionProductionStatEventTypes",(function(){return r})),n.d(t,"ClickProductionStatEventTypes",(function(){return s})),n.d(t,"ViewProductionStatEventTypes",(function(){return l})),n.d(t,"MarketScreenNames",(function(){return c})),n.d(t,"MarketEventTypes",(function(){return u})),n.d(t,"EventItemType",(function(){return d})),n.d(t,"EventItemSubType",(function(){return _})),n.d(t,"RegistrationItemEventTypes",(function(){return f})),n.d(t,"RegistrationFieldItemNames",(function(){return p})),function(e){e.NOWHERE="nowhere",e.OTHER="other",e.START="start",e.START_PROCEED_AS="start_proceed_as",e.REGISTRATION_COMPLETE="registration_complete",e.REGISTRATION_COUNTRY="registration_country",e.REGISTRATION_PHONE="registration_phone",e.REGISTRATION_PHONE_VERIFY="registration_phone_verify",e.REGISTRATION_PASSWORD="registration_password",e.REGISTRATION_EDUCATION="registration_education",e.REGISTRATION_EMAIL="registration_email",e.REGISTRATION_NAME="registration_name",e.REGISTRATION_INVITE_CONFIRM="registration_invite_confirm"}(i||(i={})),function(e){e.TYPE_NAVGO="type_navgo",e.TYPE_ACTION="type_action",e.TYPE_CLICK="type_click",e.TYPE_VIEW="type_view"}(a||(a={})),function(e){e.GO="go",e.BACK="back",e.TAB_OPEN="tab_open"}(o||(o={})),function(e){e.TYPE_REGISTRATION_ITEM="type_registration_item",e.TYPE_MARKETING_TRANSITION_ITEM="type_marketing_transition_item",e.TYPE_DONUT_PAYMENT_ITEM="type_donut_payment_item",e.TYPE_CALL_ITEM="type_voip_call_item"}(r||(r={})),function(e){e.TYPE_MARKET_CLICK="type_market_click",e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item"}(s||(s={})),function(e){e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item",e.TYPE_MARKET_VIEW="type_market_view"}(l||(l={})),function(e){e.MARKETPLACE="marketplace",e.MARKETPLACE_BLOCK="marketplace_block",e.MARKETPLACE_SEARCH="marketplace_search"}(c||(c={})),function(e){e.TYPE_MARKET_ORDERS_ITEM="type_market_orders_item",e.TYPE_MARKET_CARTS_ITEM="type_market_carts_item",e.TYPE_MARKET_GOODS_ITEM="type_market_item",e.TYPE_MARKET_MARKETPLACE_ITEM="type_market_marketplace_item"}(u||(u={})),function(e){e.ARTICLE="article",e.GROUP="group",e.PHOTO="photo",e.POST="post",e.STORY="story",e.USER="user",e.BROWSER="browser",e.NARRATIVE="narrative",e.MINI_APP="mini_app",e.GAME="game",e.VIDEO="video",e.MARKET_ITEM="market_item",e.MARKET_ITEM_ALBUM="market_item_album",e.MARKET_ORDER="market_order",e.CATALOG_BANNER="catalog_banner"}(d||(d={})),function(e){e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.OPEN_WIKI="open_wiki"}(_||(_={})),function(e){e.SCREEN_PROCEED="screen_proceed",e.SCREEN_SKIP="screen_skip",e.SCREEN_RETURN="screen_return",e.COMMON_SERVER_ERROR="common_server_error",e.RESEND_SMS_CODE="resend_sms_code",e.RESEND_SMS_CODE_FAILED="resend_sms_code_failed",e.INCORRECT_SMS_CODE="incorrect_sms_code",e.INCORRECT_PASSWORD="incorrect_password",e.INCORRECT_NAME="incorrect_name",e.INCORRECT_CAPTCHA="incorrect_captcha",e.INCORRECT_PHONE_NUMBER="incorrect_phone_number",e.INCORRECT_BDAY="incorrect_bday",e.INCORRECT_SEX="incorrect_sex",e.INCORRECT_EMAIL="incorrect_email",e.INCORRECT_EDUCATION="incorrect_education"}(f||(f={})),function(e){e.PHONE_COUNTRY="phone_country",e.PHONE_NUMBER="phone_number",e.COUNTRY="country",e.CITY="city",e.EMAIL="email",e.UNIVERSITY="university",e.FACULTY="faculty",e.SCHOOL="school",e.CHAIR="chair",e.YEAR_FROM="year_from",e.YEAR_TO="year_to",e.CLASS="class",e.EDU_FORM="edu_form",e.EDU_STATUS="edu_status",e.GRADUATION="graduation",e.SPECIALIZATION="specialization",e.RULES_ACCEPT="rules_accept",e.SMS_CODE="sms_code",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.SEX="sex",e.BDAY="bday",e.PASSWORD="password"}(p||(p={}))},rEJs:function(e,t,n){"use strict";n.r(t),n.d(t,"events",(function(){return i}));var i={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init"}},rKUZ:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("z9sQ"),r=n("BoyB"),s=n("fdw3");function l(){var e=Object(i.default)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){var t,n,i=e.dimmed,s=e.animation,u=!!e.compact,f=e.typingCount,p=a.default.class("typing",{dimmed:i,id:e.id,empty:d(f),animation:s}),h=_(e);"audio"===s?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!0,compact:u})}),n=""):"dots"===s?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!1,compact:u})}),n=""):"simple-dots"===s&&(t="",n=a.default.html(l()));return a.default.html(c(),p,t,h,n)};function d(e){return!e}function _(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_recaudio_1).replace("{name}",r)}else if(2===a&&i.length>=2){var l=i[0],c=i[1];o=(o=(o=n.mobile_mail_recaudio_2).replace("{name1}",l)).replace("{name2}",c)}else if(a>1&&i.length>=1){var u=i[0];o=(o=(o=n.mobile_mail_recaudio_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_recaudio_N_unknown));return o}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return"";var i=e,a=t,o="";if(1===a&&i.length>=1)o="";else if(2===a&&i.length>=2){var r=i[0],l=i[1];o=(o=(o=n.mobile_mail_mixtyping_2).replace("{name1}",r)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];o=(o=(o=n.mobile_mail_mixtyping_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_mixtyping_N_unknown));return o}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return e?n.mobile_mail_typing_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_typing_1).replace("{name}",r)}else if(2===a&&i.length>=2){var l=i[0],c=i[1];o=(o=(o=n.mobile_mail_typing_2).replace("{name1}",l)).replace("{name2}",c)}else if(a>1&&i.length>=1){var u=i[0];o=(o=(o=n.mobile_mail_typing_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_typing_N_unknown));return o}(e.typing,e.typingCount)}var f=n("UxAg");Object.assign(u,{setTyping:function(e,t){var n="string"==typeof e?Object(f.$)(".typing_id_"+e):e,i=n.$(".typing__names");n.classList.toggle("typing_empty",d(t.typingCount)),i.innerHTML=_(t)},getElem:function(e){return Object(f.$)(".typing_id_"+e)}});t.default=u;window.Typing=u,Object.assign(window,{Typing_renderNames:_,Typing_isEmpty:d})},rKp0:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("O5lf"),s=n("V2dH"),l=n("1KAK"),c=n("eWFs"),u=n("HGMY"),d=n("TYsd"),_=n("Y6JH"),f=n("fdw3");function p(){var e=Object(i.default)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n      <div class="mailScrap__empty mailScrap__empty_',' mailScrap_casper">\n        <div class="mailScrap__casperIcon" aria-hidden="true">\n          ','\n        </div>\n        <div class="mailScrap__casperText">\n          ',"\n        </div>\n      </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="mailScrap__empty mailScrap__empty_','">\n      ',"\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return g=function(){return e},e}var A=function(e){var t=e.scrap,n=e.isCasper,i="peer"===t,r=C(t),l=i?k("before"):"",c=k("after"),v=k("center"),A=function(e){var t,n=a.default.class("mailScrap__items",((t={})[e]=!0,t)),i=b(e);return Object(o.default)({mix:n,inner:i})}(t),y=n?"":function(e){var t=O(e);return a.default.html(m(),e,t)}(t),w=n?function(e){var t=d.default.html(Object(_.default)("mail/casper","ghost_outline_56")),n=Object(f.getLang)("mobile_casper_chat_no_messages");return a.default.html(h(),e,t,n)}(t):"",S=i?Object(s.default)():"",j=i?d.default.html(Object(u.default)()):"",E=i?(T=store.mail.cur.notification||"",I=a.default.onClick("MailScrap.clearSystemMessage2"),a.default.html(p(),I,T)):"";var T,I;return a.default.html(g(),r,l,A,y,w,c,j,S,E,v)};function b(e){for(var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps[e],r=o.length,s=[],l=!1,c=0;c<r;c++){if(c>0&&"peer"===e&&!l){var u=i[o[c-1]],d=i[o[c]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){l=!0,s.push(y(e,o[c],!0));continue}}s.push(y(e,o[c]))}return a.default.list(s)}function y(e,t,n){void 0===n&&(n=!1);var i=store.mail,a=i.cur,o="";if("folder"===e)o="important"===a.folder?w(t):S(t);else if("search"===e)if("peers"===a.tab){var r=t;i.peers[r].isIncomingMR||(o=function(e){return Object(c.default)(e)}(r))}else{o=w(t)}else if("peer"===e){o=function(e,t){void 0===t&&(t=!1);return Object(l.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){o=S(t)}return o}function w(e){var t=store.mail.msgs[e].peerId;return Object(c.default)(t,e)}function S(e){return Object(c.default)(e,"last")}function k(e){var t,n=a.default.class("mailScrap__loading",((t={})[e]=!0,t)),i=Object(r.default)({mix:""});return a.default.html(v(),n,i)}function O(e){var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty,ad_tag:t.mobile_mail_sublist_empty}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function C(e){var t,n=store.mail,i=n.cur,o=n.reached,r=!0,s=!1,l=!1,c=!1;if("peer"===e){var u=i.peerId,d=n.scraps.peer,_=d.length,f=n.rolls.peer[u]||[];r=o.peer.before[u]&&d[0]===f[0],s=last(d)===last(f)&&o.peer.after[u],0===_&&(s=!0);var p=u?n.peers[u]:null;p&&(l=!!p.systemMessageCode,p.isChannel&&(c=p.ownerId!==i.viewerId))}else if("mrs"===e)s=o.mrs;else if("folder"===e)s=o.folder[i.folder];else if("search"===e){var h=i.tab;i.query;if("peers"===h){var m=n.scraps.search.length;s=o.search[i.tab][i.query]||m>0}else s=o.search[i.tab][i.query]}return a.default.class("mailScrap",((t={})[e]=!0,t.empty=function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.reached,o=!1;switch(e){case"peer":var r=n.peerId,s=t.rolls.peer[r];0===(s?s.length:0)&&a.peer.after[r]&&a.peer.before[r]&&(o=!0);break;case"mrs":0===i.mrs.length&&a.mrs&&(o=!0);break;case"folder":0===i.folder.length&&a.folder[n.folder]&&(o=!0);break;case"search":0===i.search.length&&a.search[n.tab][n.query]&&(o=!0)}return o}(e),t.systemMessage=l,t.reachedBefore=r,t.reachedAfter=s,t.tab="search"===e&&i.tab,t.isChannel=c,t))}n("+cqQ");var j=n("3pHe"),E=n("BZzM"),T=(n("s0aB"),n("GR/G")),I=n.n(T);Object.assign(A,{updateClass:R,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,R("peer"),D()}()},resetPrevScraps:function(){M={folder:[],search:[],peer:[]}},redrawPeer:function(){B("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach((function(e){return e.className=C("peer")}))},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;B("folder",i.folder,e),$$(".mailScrap_folder").forEach((function(e){return e.className=C("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=O("folder")}))},redrawSearch:function(){$$(".mailScrap__items_search").forEach((function(e){return e.innerHTML=b("search")})),$$(".mailScrap_search").forEach((function(e){return e.className=C("search")})),$$(".mailScrap__empty_search").forEach((function(e){return e.innerHTML=O("search")}))},redrawMRs:function(e){B("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach((function(e){return e.className=C("mrs")})),$$(".mailScrap__empty_mrs").forEach((function(e){return e.innerHTML=O("mrs")}))},redrawSystemMessage:D,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.innerHTML=L(e,!0)})),$$(".mailScrap_folder").forEach((function(e){return e.className=C("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=O("folder")}))},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.insertAdjacentHTML("beforeend",L(e))}))},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach((function(t){[].slice.call(t.children).slice(e).forEach((function(e){return t.removeChild(e)}))}))},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(x([e],!0));n.appendChild(t),I()(t,i),R("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);R("peer"),e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)}));var n=j.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout((function(){return window._preventedCheckTop=!1}));var i='\n    <div class="load_before load_before_closed">\n      '+x(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach((function(e){return e.insertAdjacentHTML("afterbegin",i)})),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)})),$$(".mailScrap__items_peer").forEach((function(n){n.insertAdjacentHTML("beforeend",x(e,t))})),R("peer"),Object(E.resizePosters)()},peerReplaceItems:function(e){e.forEach((function(e){var t=$(".msg_id_"+e),n=ceFromString(x([e],!0));I()(t,n),CasperTimer.init(e)})),Object(E.resizePosters)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach((function(t){return t.innerHTML=x(e)}))},peerGoToBottom:function(){var e=j.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:P,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&P()}}),uVK.onReady((function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;M.folder=e.folder.slice(),M.search=e.search.slice(),M.peer=e.peer.slice()}}));var M={folder:[],search:[],peer:[]};function P(){remove($(".msg__newMsgsDivider"))}function x(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,a=i.cur,o=i.msgs,r=!!$(".msg__newMsgsDivider");return e.map((function(e,i){var s=o[e];return i>0&&!r&&!t&&!n.isUnread&&s.isUnread&&s.authorId!==a.viewerId?(n=s,r=!0,y("peer",e,!0)):(n=s,y("peer",e))})).join("")}function L(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map((function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":y("folder",e)})).join("")}function B(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var a=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach((function(n,a){var o=i.indexOf(n);-1===o?(i.splice(a,0,n),domInsert(e,t(n),a)):o!==a&&(i.splice(o,1),i.splice(a,0,n),before(e.children[o],e.children[a]))})),i.forEach((function(t,i){-1===n.indexOf(t)&&a.push(e.children[i])})),a.forEach(remove)}($(".mailScrap__items_"+e),(function(t){return y(e,t)}),t,n)}function R(e){$$(".mailScrap_"+e).forEach((function(t){return t.className=C(e)}))}function D(){$$(".mailScrap__systemMessage").forEach((function(e){e.innerHTML=store.mail.cur.notification||""}))}t.default=A;window.MailScrap=A},rc7J:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=i.default.class("AlbumInfoRow",{withoutBottomBorder:e.withoutBottomBorder},"--");return{inner:[{inner:[{src:e.avatar,alt:"avatar",tag:"img"}],class:"AlbumInfoRow__avatar",href:e.author_url,onclick:"cancelEvent(event); nav.go(this);",tag:"a"},{inner:[{inner:[e.title],class:"AlbumInfoRow__title",href:e.url,tag:"a"},{inner:[e.subtitle],class:"AlbumInfoRow__subtitle",tag:"div"}],class:"AlbumInfoRow__content",tag:"div"}],class:t,onclick:"nav.go('"+e.url+"')",tag:"div"}};t.default=a},s0aB:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("AXyT"),s=n("9y81"),l=n("KMpi"),c=n("Y6JH"),u=n("rKUZ"),d=n("fdw3");function _(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title">\n          <div class="convo__title">',"</div>\n          ","\n          ",'\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">','</div>\n          </div>\n        </div>\n        <div class="convo__row convo__row_text">\n          <div class="convo__typing">','</div>\n          <div class="convo__text">','</div>\n          <div class="convo__row_right convo__unreadBox" ',">\n            ",'\n            <div class="convo__unreadOut"></div>\n            ','\n          </div>\n          <div class="convo__status">',"</div>\n        </div>\n      </a>\n    </div>\n  "]);return _=function(){return e},e}var f=function(e){var t,n,i=e.more,o="",f="",g=0,A=!1,b="";i&&(o=i.text,f=i.date,g=i.unreadCount,A=i.muted,b=i.typing?Object(u.default)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(f=""));var y=a.default.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!b,important:e.important,unread:e.isLast&&(g>0||e.isMarkedUnread),unreadOut:e.isLast&&g<0}),w=Object(l.default)({mix:"convo__avatar",photos:e.photos,url:e.profileUrl,name:e.name,isContact:e.isContact}),S=h({pending:t,failed:n}),k=p(e.online),O=Object(s.default)({mix:"convo__star",icon:"star",blue:!0}),C=m(e.peerProfile),j=e.isLast?Object(r.default)({mix:"convo__unread",value:v(g,e.isMarkedUnread),gray:A}):"",E=e.url,T=a.default.onClick("Convo._onClick","event",E),I=e.isCasper?'<span class="convo__casper" title="'+Object(d.getLang)("mobile_casper_chat_title")+'">'+Wd.html(Object(c.default)("mail/casper","casper_16"))+"</span>":"";return a.default.html(_(),y,T,k,w,e.url,e.title,C,I,O,f,b,o,S?"hidden":"","",j,S)};function p(e){return"mobile"===e?Wd.html({inner:[{inner:[Object(c.default)({sprite:"base",name:"online_mobile_composite_16"})],class:"mlvi_default",tag:"div"},{inner:[Object(c.default)({sprite:"base",name:"online_mobile_composite_muted_16"})],class:"mlvi_muted",tag:"div"}],class:"lvi mlvi convo__online convo__online_mobile",tag:"div"}):"desktop"===e?Object(o.default)({mix:a.default.class("convo__online",{desktop:!0})}):Object(o.default)({mix:"convo__online"})}function h(e){var t=window.lang;return e.pending?Wd.html({inner:[Object(c.default)({sprite:"mail",name:"recent_16"})],class:"convo__pending",tag:"div"}):e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}function m(e){var t=e.tags,n=e.tagsData,i=[];t&&n.peerTags&&(i=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var a,o=i.length;if(!o&&!n.fromAd)return"";if(n.fromAd&&!o)a={class:"convo__adTag",inner:[Object(d.getLang)("mobile_mail_ad_tag_no_access_text"),Object(c.default)("mail","ad_tag_10")]};else if(n.fromAd||1!==o){var r=window.lang,s=o+(n.fromAd?1:0);a={class:"convo__extraTag",inner:langNumeric(s,r.mobile_mail_peer_profile_extra_tags)}}else{var l=i[0];a={class:"convo__peerTag",inner:l.name,style:"background-color: "+l.color}}return Wd.html({class:"convo__peerTags",inner:a})}function v(e,t){var n=e;return t&&e<=0&&(n="empty"),n}var g=n("UxAg"),A=n("+cqQ"),b=n("OcsD");n("jk6M");function y(e,t){e.stopPropagation(),e.preventDefault(),f.onTap(t)}Object.assign(f,{onTap:Object(A.default)("url"),setOnline:function(e,t){Object(g.$$)(".convo_id_"+e+" .convo__online").forEach((function(e){e.outerHTML=p(t)}))},setLastMsg:function(e,t,n){var i=n.dateShort,a=n.pending,o=n.failed;Object(g.$$)(".convo_last.convo_id_"+e).forEach((function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=h({pending:a,failed:o}),a||o?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=i,e.$(".convo__unreadBox").hidden=!1)}))},setTyping:function(e,t){Object(g.$$)(".convo_last.convo_id_"+e).forEach((function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||Object(d.isArray)(i))){var a=n.$(".typing"),o=a&&q.parseClass("typing",a.className);a&&o.animation===t.animation?u.default.setTyping(a,t):(e.classList.add("convo_typing"),n.innerHTML=Object(u.default)(t))}else n.innerHTML="",e.classList.remove("convo_typing")}))},setUnreadCount:function(e,t,n){Object(g.$$)(".convo_last.convo_id_"+e).forEach((function(e){var i=e.$(".Oval");e.classList.toggle("convo_unread",t>0||n),e.classList.toggle("convo_unreadOut",t<0),r.default.setValue(i,v(t,n))}))},setImportant:function(e,t){Object(g.$$)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_important",t)}))},updateAdTag:function(e,t){Object(g.$$)(".convo_id_"+e).forEach((function(e){var n=Object(g.$)("convo__peerTags",e);t.fromAd&&!n&&(n=Object(b.ceFromString)(m({tagsData:t})),after(n,Object(g.$)(".convo__title",e)))}))}}),f._onClick=y;t.default=f;window.Convo=f,window.Convo__online=p},t7Ww:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalMenuBtn",(function(){return s})),n.d(t,"ModalMenuContent",(function(){return _})),n.d(t,"ModalMenuIcon",(function(){return l})),n.d(t,"ModalMenuTitle",(function(){return u})),n.d(t,"ModalMenuBody",(function(){return c})),n.d(t,"ModalMenuHeaderCloseButton",(function(){return d}));var i=n("r/ag"),a=n("29dZ"),o=n("Y6JH"),r=n("fdw3");function s(e){var t=e.class?" "+e.class:"";return t=e.isBtn?Object(r.concatValues)(t," ModalMenu__customBtn"):Object(r.concatValues)(t," ModalMenu__item"),Object(a.default)({url:e.url,class:"ModalMenu__btn "+t,theme:e.theme?e.theme:"none",size:e.size?e.size:"",inner:e.inner,on_click:e.onclick,use_native_onclick:!0,attrs:e.attrs,"aria-label":e["aria-label"]||""})}function l(e){return{inner:[{inner:[e.inner],class:"ModalMenu__icon",tag:"div"}],class:"ModalMenu__iconWrapper",tag:"div"}}function c(e){return{inner:[e.inner],class:"ModalMenu__customBody",tag:"div"}}function u(e){return{inner:[e.inner],class:"ModalMenu__title",tag:"div"}}function d(e){return void 0===e&&(e={}),{inner:[Object(o.default)({sprite:"base",name:"dismiss_24"})],class:"ModalMenu__headerCloseButton",onClick:e.onClose?e.onClose:["ModalMenu.close","this"],"aria-label":Object(r.getLang)("mobile_close"),tag:"button"}}function _(e){return e.class+=" ModalMenuContent",e}t.default=function(e){var t=e.attached?"ModalMenu--attached":"",n=window.lang,o=[];if(e.title&&o.push({class:"ModalMenu__title",inner:e.title}),e.body&&o.push({class:"ModalMenu__body",inner:e.body}),Object(r.isArray)(e.items)){var s=e.items.map((function(e){return e}));o.push(s)}e.close&&o.push(Object(a.default)({class:"ModalMenu__btn ModalMenu__cancel",theme:"secondary",size:"large",inner:e.closeText?e.closeText:n.mobile_cancel,on_click:e.onClose?e.onClose:["ModalMenu.close","this"],use_native_onclick:!0}));var l=function(e){if(e&&e[0]&&e[0].inner&&e[0].inner.inner&&"ModalMenuHeader"===e[0].inner.inner[0].class)return!0;return!1}(o)?" ModalMenu--hasHeader":"";return Object(i.default)({id:e.id||"",class:"ModalMenu "+e.class+" "+t+" "+l,on_overlay_click_native:e.on_overlay_click?e.on_overlay_click:["ModalMenu.close","this"],content:o})}},tgcV:function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=function(){return t(i)},i.onerror=function(){return n(new Error("Stylesheet load error for "+e))},document.head.appendChild(i)}))}function a(e){var t,n=(t=e,new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.response):n(i.response)},i.onerror=function(){n(i.response)},i.send()})));return n.then((function(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)})),n}var o;n.r(t),n.d(t,"addStatic",(function(){return _})),n.d(t,"preloadStaticForNavigation",(function(){return f})),n.d(t,"initStaticManager",(function(){return p}));var r=[];function s(e,t){var n=e;t&&(n+="?"+t);var i=new Promise((function(t,i){var a,o,r;a=n,o=function(n){n?(window.stManager.staticFiles[e]=null,i(n)):t()},(r=document.createElement("script")).src=a,r.onload=function(){return o(null,r)},r.onerror=function(){return o(new Error("Script load error for "+a))},document.head.appendChild(r)}));return window.stManager.staticFiles[e]=i,i}function l(e,t){var n=function(){if(void 0!==o)return o;try{var e=document.createElement("b");e.style.display="flex",o="flex"===e.style.display}catch(e){o=!1}return o}()?i:a,r=e;t&&(r+="?"+t);var s=n(r).catch((function(){return window.stManager.staticFiles[e]=null,Promise.resolve()}));return window.stManager.staticFiles[e]=s,s}function c(e){window.stManager.staticFiles[e]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles&&window.stManager?(Object.keys(window.vk.stFiles).forEach((function(e){return c(e)})),window.vk.stFiles=[]):setTimeout(u,0)}function d(e){r[e]&&r[e]()}function _(e){return void 0===e&&(e={}),Promise.all(Object.keys(e).map((function(t){return n=t,i=e[t],window.stManager.staticFiles[n]||(n.includes(".js")?s(n,i):n.includes(".css")?l(n,i):Promise.resolve());var n,i})))}function f(e){var t=window.vk.stNavMap||{};for(var n in t){if(t.hasOwnProperty(n))if(new RegExp(n).test(e)){_(t[n]||{});break}}}function p(){u(),window.stManager={done:d,staticFiles:[],registerLoadedScript:c}}},tlMv:function(e,t,n){"use strict";n.r(t);var i=n("g3t9");t.default=i.default},tqja:function(e,t){var n,i=(n={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(e,t,i,a,o,r){if(void 0===r&&(r=!1),e.classList.contains("_locked"))return!1;var s=!0;return n[t]&&(s=!1),e.classList.add("_locked"),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:t,resource:i,group_id:a,hash:o},{onDone:function(){if(e.classList.remove("_locked"),r)r();else if(s){var t=attr(e,"href");nav.go(t)}}}),!s}});window.GroupActionButton=i},u33z:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return o=function(){return e},e}function r(){var e=Object(i.default)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return r=function(){return e},e}var s=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return a.default.html(r(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return a.default.html(o(),s,t,e.onClick,e.text)};t.default=s;window.MailButton=s},uo4j:function(e,t){ownerPhotoUpload.onUploadedDone((function(e){var t=geByClass1("feedAssistance_profilePhoto");if(t){var i=geByClass1("feedAssistanceProfilePhotoContent__avatar",t),a=geByClass1("feedAssistanceProfilePhotoContent__desc",t),o=geByClass1("feedAssistanceProfilePhotoContent__title",t),r=geByClass1("feedAssistance__footerButton",t);(function(e,t){if(window.Image){var i=new Image;i.onload=function(){return n(e,t)},i.src=e}else n(e,t)})(e=function(e){return e.replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"")}(e),i),o&&(o.textContent=getLang("mobile_assistance_profile_photo_uploaded_title")),a&&(a.textContent=getLang("mobile_assistance_profile_photo_uploaded_desc")),FeedAssistance.setFilled(t),remove(r)}})),FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto");function n(e,t){var n;t&&(addClass("feedAssistanceProfilePhotoContent__avatar_uploaded",t),setStyle(t,"background-image","url("+e+")")),n=e,geByClass("al_u"+vk.id).forEach((function(e){domData(e,"photo")&&domData(e,"photo",n);var t=geByClass1("_u"+vk.id,e);t&&"IMG"===t.tagName&&(t.src=n)}))}},"v+Uj":function(e,t,n){"use strict";n.r(t),n.d(t,"getCurrentElementIndex",(function(){return p})),n.d(t,"getElements",(function(){return f})),n.d(t,"scrollToElem",(function(){return _})),n.d(t,"_onWheel",(function(){return v}));var i=n("z9sQ");var a=function(e){return{class:[i.default.class("Slider",{snapping:!!e.snapping},"--"),e.class||e.mix],id:e.id,inner:{class:["Slider__scroll","_preventMenuOpen"],attrs:e.attrs,onwheel:["Slider._onWheel","event","this"],inner:{class:"Slider__line",attrs:{role:"presentation"},inner:e.inner}}}},o=n("OcsD"),r=n("UxAg"),s=n("jk6M");window.Slider={scrollToElem:_,nextElem:h,prevElem:m},Slider._onWheel=v,onDOMReady(A),onDOMReady((function(){onBodyResize(g)}));var l=".Slider",c=".Slider--snapping",u=".Slider__scroll",d=".Slider__line";function _(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n="center"),e){var i=e.closest(u),a=e.offsetLeft;"center"===n&&(a-=i.offsetWidth/2-e.offsetWidth/2);var r=0;if(window.getComputedStyle){var s=getComputedStyle(e);(s.scrollMarginLeft||s.scrollSnapMarginLeft)&&(r+=Object(o.toInt)(s.scrollMarginLeft||s.scrollSnapMarginLeft))}t&&i.scrollTo?(Object(o.domData)(i,"left",a-r),i.scrollTo({left:a-r,behavior:"smooth"})):i.scrollLeft=a-r}}function f(e){return e=Object(o.ge)(e),Object(r.$)(d,e).childNodes}function p(e,t){var n=Object(r.$)(u,e);return t||(t=f(e)),Array.from(t).map((function(e,t){return{index:t,scrollLeft:Math.abs(e.offsetLeft-n.scrollLeft)}})).sort((function(e,t){return e.scrollLeft-t.scrollLeft}))[0].index}function h(e,t,n){void 0===t&&(t=!1);var i=f(e=Object(o.ge)(e)),a=i[p(e,i)+1];h&&_(a,t,n)}function m(e,t,n){void 0===t&&(t=!1);var i=f(e=Object(o.ge)(e)),a=i[p(e,i)-1];a&&_(a,t,n)}function v(e,t){var n=e.deltaX,i=e.deltaY;Math.abs(n)>Math.abs(i)&&(e.preventDefault(),t.scrollLeft+=n)}function g(){var e=Object(r.$$)(c);Array.from(e).forEach((function(e){var t=Object(r.$)(u,e);t.scrollLeft=t.scrollLeft}))}function A(){(s.default.ios||s.default.msie_edge)&&(onDOMReady(y),window.page&&window.page.onChange(y),window.MutationObserver&&onDOMReady((function(){document.body&&new MutationObserver(b).observe(document.body,{subtree:!0,childList:!0})})))}function b(e){e.forEach((function(e){e.addedNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&e.$$(l).forEach(w)}))}))}function y(){Object(r.$$)(l).forEach(w)}function w(e){var t=getComputedStyle(e),n=Number(t.paddingTop.replace("px","")),i=Number(t.paddingBottom.replace("px",""));e.style.overflow="hidden",e.style.height=e.offsetHeight-n-i+"px",e.$(u).style.paddingBottom="20px"}t.default=a;window.Slider=a,Object(o.extend)(a,{scrollToElem:_,nextElem:h,prevElem:m,_onWheel:v})},vOib:function(e,t,n){"use strict";n.r(t);var i=n("UWnA"),a=n("8ZMO"),o=n("KiYr"),r=n("z9sQ"),s=n("fdw3");function l(e){var t=[e];return Object(s.isArray)(e)&&(t=Object(s.wdToFlatArray)(e)),t.join("")}function c(e){var t=l(e);return!t||"<div></div>"===t}var u=function(e){if(void 0===e&&(e={}),e.content_only)return{outerHTML:l(e.content)};var t=e.title,n=e.corner||{},s=e.inner||e.content||e.children,u=e.anchor,d=e.alert,_=e.style||{},f=e.attrs||{},p=e.noShadow,h="gray";null!==e.count&&(h="black");var m=e.pageBlock?"PageBlock PageBlock--separate":"",v=[t];if(null!==e.count){var g={inner:[e.count],class:"Pad__count",tag:"span"};v.push(g)}return{tag:e.tag||"div",class:[e.class||e.mix,r.default.class("Pad",{empty:c(s),noBorder:e.no_border,noCapsTitle:e.no_caps_for_title,style_extraTopPadding:_.extra_top_padding,theme:h,noShadow:p}),m],attrs:f,"data-id":e.name||e.id,inner:[u?Object(a.default)({mix:"Pad__anchor",id:u}):null,d?Object(i.default)({inner:[Object(o.default)({inner:[d],class:"Pad__alert",theme:e.alert_theme})],style:{tiny_padding_bottom:!0}}):null,t?Object(i.default)({inner:[e.isHeaderPage?{inner:[v],class:"Pad__title",tag:"h1"}:{inner:[v],class:"Pad__title",tag:"h3"},n.url?{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"a"}:{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"div"}],class:"Pad__header"}):null,t?{inner:[s],class:["Pad__content",e.content_mix],tag:"div"}:s]}};t.default=u},vOyG:function(e,t){e.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"]},vhZE:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("z1UI"),o=n("Y6JH");var r=function(e){void 0===e&&(e={});var t={},n=e.raw||"",r=e.hash||"",s=e.text||"";"album"===(e.attachment_type||"")&&(e.height-=60),e.type&&"blur"!==e.type||(e.width>=250&&e.height>=250?e.type="blurWithText":e.type="blur"),("blur"===e.type||e.only_icon)&&(delete e.button,delete e.title),e.type&&(t[e.type]=!0);var l,c=i.default.class("PostPhotoRestriction",t,"--");"blur"!==e.type&&"blurWithText"!==e.type||(l=e.width<100||e.height<100?Object(o.default)({sprite:"wall",name:"hide_outline_28"}):Object(o.default)({sprite:"wall",name:"hide_outline_56"})),"block"===e.type&&(!e.forceText&&(e.width<300||e.height<250)&&(delete e.title,delete e.text),l=e.width<100||e.height<100?Object(o.default)({sprite:"wall",name:"block_outline_28"}):Object(o.default)({sprite:"wall",name:"do_not_disturb_outline_56"})),l={inner:[l],class:"SplashScreen__icon",tag:"div"},"block"!==e.type||e.title||(e.title=e.text);var u="PostPhotoRestriction.clear(this, event, '"+s+"', '"+e.button+"', '"+n+"', '"+r+"')";return{inner:[{inner:[Object(a.default)({title:e.title,icon_raw:l,more_text:e.button,more_type:"outlineMono",more_onclick:u,more_ontouchend:u,more_native_onclick:!0})],class:"PostPhotoRestriction__splash",tag:"div"}],class:c,tag:"div"}},s=n("he4e"),l=n("OcsD");window.PostPhotoRestriction={clear:s.clear,onClearConfirm:s.onClearConfirm,onClearDecline:s.onClearDecline};t.default=Object(l.extend)(r,{onClear:s.onClear,isCleared:s.isCleared})},vk58:function(e,t,n){"use strict";n.r(t);var i=n("29dZ"),a=n("fdw3"),o=n("z9sQ");var r=function(e){var t=e.btns||e.inner||[],n=e.mode||"horizontal",r=e.align||"start";Object(a.isArray)(e.inner)&&1===e.inner.length&&e.inner[0].length>1&&(t=e.inner[0]),e.nowrap&&(t=t.map((function(e){return e.nowrap=!0,e})));var s,l=o.default.class("BtnStack",{stretchOnSmallScreens:e.stretch_on_small_screens,table:e.nowrap,mode:n,align:r}),c=t.map((function(e){if(!e)return null;var t=["BtnStack__btn"];if(e.class&&t.push(e.class),e.mix&&t.push(e.mix),e.class=Object(a.arrayUnique)(Object(a.arrayFlat)(t)),!!e._&&e._.__is_wd_internal_data||Object(a.arrayIncludes)(t,"CellButton")||(e=Object(a.extend)(Object(i.default)(e),{nowrap:e.nowrap,is_icon:e.is_icon})),e.nowrap){var n=o.default.class("BtnStack__cell",{icon:e.is_icon});return delete e.nowrap,{inner:[e],class:n,tag:"div"}}return e}));return e.after&&(s={class:o.default.class("BtnStack__cell",e.after_mix),inner:e.after}),{inner:[c[0]?c:null,s],class:l,tag:"div"}};t.default=r},w1QQ:function(e,t){window.FeedAssistance={hide:function(e,t,n){var i=domCA(e,".feedAssistance"),a=hasClass(i,"feedAssistance_filled");remove(i),a||function(e,t,n){var i=FeedAssistanceStats.getFromRef(e);ajax.post("/feed",{_ajax:1,type:t,hash:n,act:"hide_assistance",from:i})}(e,t,n);return!1},setFilled:function(e){var t=hasClass(e,"feedAssistance")?e:domCA(e,".feedAssistance");addClass("feedAssistance_filled",t)}}},wCFN:function(e,t,n){"use strict";n.r(t),n.d(t,"AlertBox",(function(){return s}));var i=n("OcsD"),a=n("TYsd"),o=n("Po+v"),r=n("29dZ");function s(e,t,n,s){void 0===s&&(s={});var l=Object(i.ceFromString)(a.default.html(Object(o.default)({id:s.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[Object(r.default)({onClick:n||"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:a.default.wrap(getLang("mobile_close"))})]}]})));domInsert(document.body,l),o.default.open(l,!0)}window.page&&page.onChange((function(){$$(".AlertBox").forEach((function(e){return o.default.close(e)}))})),window.AlertBox=s},wTbK:function(e,t,n){"use strict";n.r(t),n.d(t,"open",(function(){return b})),n.d(t,"close",(function(){return S})),n.d(t,"ModalMenuBtn",(function(){return s.ModalMenuBtn})),n.d(t,"ModalMenuIcon",(function(){return s.ModalMenuIcon})),n.d(t,"ModalMenuTitle",(function(){return s.ModalMenuTitle})),n.d(t,"ModalMenuBody",(function(){return s.ModalMenuBody})),n.d(t,"ModalMenuHeaderCloseButton",(function(){return s.ModalMenuHeaderCloseButton}));var i,a,o,r=n("OcsD"),s=n("t7Ww"),l=n("r/ag"),c=n("UxAg"),u=function(){function e(e){this.lastTime=0,this.lastRegisteredTime=0,this.lastCoordinates=[],this.lastTime=e.time,this.lastCoordinates=[e.x,e.y],this.velocity={x:0,y:0}}return e.getVelocity=function(e,t,n){return{x:t/e||0,y:n/e||0}},e.prototype.registerEvent=function(t){if("touchmove"===t.type){var n=t.touches[0].clientX,i=t.touches[0].clientY,a=t.timeStamp-this.lastTime;if(t.timeStamp-this.lastRegisteredTime<=16.67)this.lastCoordinates=[n,i],this.lastTime=t.timeStamp;else{var o=n-this.lastCoordinates[0],r=i-this.lastCoordinates[1];this.velocity=e.getVelocity(a,o,r),this.lastTime=t.timeStamp,this.lastRegisteredTime=this.lastTime,this.lastCoordinates=[n,i]}}else window.clog&&window.clog("[Gestures.js] unhandled event "+t.type)},e}(),d=n("CQvH"),_=!1,f=null,p=0,h=0,m={},v=null,g=Object(c.$)(".Popup__wrap",i),A=!1;function b(e,t,n,s){void 0===t&&(t=!0),void 0===n&&(n=""),void 0===s&&(s={});var u=s,_=u.settling,f=void 0===_?75:_,p=u.expandable,h=void 0!==p&&p;if(s.settling=f,s.expandable=h,i=l.default.open(e,t,{hash:n}),m=s,g=Object(c.$)(".Popup__wrap",i),o=Object(c.$)(".Popup__content",g),void 0===s.swipeDown&&(s.swipeDown=!0),h&&w(i)){i.classList.add("ModalMenu--expandable");var v=(100-m.settling)/100*window.innerHeight;C=v,r.setStyle.animate(g,"transform",{duration:200,func:"ease"}),r.setStyle.transform(g,1,[0,v])}return I(),Object(r.onBodyResize)(I),s.swipeDown&&window.innerWidth<882&&(scrollTop(0),Object(r.addEvent)(o,"touchstart",k,{passive:!0}),Object(r.addEvent)(o,"touchmove",j,{capture:!0}),Object(r.addEvent)(o,"touchcancel touchend",E,{passive:!0}),Object(r.addEvent)(g,"click",y,{passive:!0}),Object(r.addEvent)(g,"click",y,{passive:!0})),(a=Object(d.setFocusTrap)(i))&&(a.exitIntent=function(){return!1}),i}function y(e){if(g&&e.target===g)return(a=Object(d.setFocusTrap)(i))&&(a.exitIntent=function(){return!1}),i}function w(e){var t=Object(c.$)(".ModalMenu__body",e)||Object(c.$)(".ModalMenuContent",e)||Object(c.$)(".Popup__content",e);return!(Object(r.getCw)()>=882)&&(t.scrollHeight||Object(r.getH)(t))>=window.innerHeight}function S(e,t){if(void 0===t&&(t={}),e||(e=document.activeElement),e){var n=e.closest(".ModalMenu.Popup_open")||e;n&&(innerWidth<882?(l.default.close(n,{smooth:!0,velocity:!(!v||!v.velocity)&&v.velocity,lastY:h}),t.onClose&&t.onClose()):setTimeout((function(){l.default.close(n),t.onClose&&t.onClose()})),Object(r.removeEvent)(o,"touchstart",k,{passive:!0}),Object(r.removeEvent)(o,"touchmove",j,{capture:!0}),Object(r.removeEvent)(o,"touchcancel touchend",E,{passive:!0}),Object(r.removeEvent)(g,"click",y,{passive:!0}),Object(r.removeEvent)(g,"click",y,{passive:!0}),f=null,p=0,O=!1,h=0,C=0,i=null,g=null,o=null,v=null,m={},Object(r.onBodyResize)("__clear",I),a&&(a(),a=null))}}function k(e){if(e.touches&&e.touches.length>1)_=!1;else{var t=e.target.closest(".ScrollView")||Object(c.$)(".ScrollView",e.target);if(!Object(c.$)(".ModalMenu").classList.contains("ModalMenu--blocked")){var n=m.expandable&&w(i);A=n,f=e.touches[0],p=e.touches[0].clientY,t&&t.scrollTop>1?_=!1:(v=new u({time:e.timeStamp,x:e.touches[0].clientX,y:e.touches[0].clientY}),_=!0)}}}var O=!1,C=0;function j(e){if(e.touches&&e.touches.length>1)_=!1;else if(f&&_){var t=e.touches[0];v.registerEvent(e);var n=-Math.min(0,p-t.clientY-C);0!==n&&(Object(r.cancelEvent)(e),h=n,O||(i.classList.add("ModalMenu--dragging"),browser.ios&&r.setStyle.animate(g,"transform",{duration:50,func:"linear"}),O=!0),T(n),r.setStyle.transform(g,1,[0,n]))}}function E(e){if(_){_=!1,i.classList.remove("ModalMenu--dragging"),O=!1,T(h);var t=m.expandable&&w(i);A=t;var n=i.classList.contains("ModalMenu--expanded"),a=!n,o=function(e){void 0===e&&(e=[]);return e.find((function(e){return 0!==e.scrollTop||e.scrollHeight>e.offsetHeight}))}(e.path),s=!1;o&&(s=0!==o.scrollTop);var l=!1,c=!1;v&&(l=!s&&v.velocity.y>=.6,c=!s&&v.velocity.y<=-.15);var u=h/innerHeight*100,d="";n?d="expand":a&&(d="collapse");var f=d;l&&u<8?u=8:c&&(u=0),!t&&u>=8||u>=100-m.settling+8?f="close":n?u>=8&&!s&&(f="collapse"):a&&w(i)&&u<=100-m.settling&&(f="expand"),function(e){if(!e)return;i.classList.toggle("ModalMenu--expanded","expand"===e),"close"!==e&&g.style.removeProperty("transition");switch(e){case"collapse":i.classList.add("ModalMenu--restore");var t=0;w(i)&&(t=(100-m.settling)/100*window.innerHeight),C=t,r.setStyle.transform(g,1,[0,t]),T(C=t,!0),setTimeout((function(){i&&i.classList.remove("ModalMenu--restore"),0===t&&Object(r.setStyle)(g,{transform:""})}),200);break;case"expand":i.classList.add("ModalMenu--restore"),i.classList.add("ModalMenu--expanded"),r.setStyle.transform(g,1,[0,0]),T(C=0,!0),setTimeout((function(){i&&(I(),i.classList.remove("ModalMenu--restore"))}),200);break;case"close":C=0,S(i,m)}}(f),v=null}}function T(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),A){var n=(100-m.settling)/100*window.innerHeight,i=Object(c.$)(".ModalMenuHeader__title",g),a=Object(c.$)(".ModalMenuHeader__close",g),o=1-Math.max(0,Math.min(1,(null===e?C:e)/n));t&&(r.setStyle.animate(i,"transform",{duration:250}),r.setStyle.animate(a,"transform, opacity",{duration:250})),r.setStyle.transform(i,1,[44*o,0]),r.setStyle.transform(a,o),Object(r.setStyle)(a,{opacity:o})}}function I(){var e=Object(c.$)(".ModalMenuContent",i),t=Object(c.$)(".ModalMenuHeader",i);if(e&&t){var n=Object(r.getH)(t),a=Object(r.getH)(e),o=Math.min(Object(r.getCh)(),a+n+"px");Object(r.getCw)()>=882&&(o=null),Object(r.setStyle)(e,"height",o)}}Object(r.addEvent)(window,"keydown",(function(e){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(c.$)(".ModalMenu.Popup_open");if(t)switch(e.keyCode){case 27:S(t,m)}})),Object(r.addEvent)(window,"click",(function(e){if(e.isTrusted){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(c.$)(".ModalMenu.Popup_open"),n=!!e.target.closest(".ModalMenu");if(t&&n&&!e.target.closest(".Popup__content")){var i=Object(c.$)(".Popup__overlay",t);window.clog("Simulate modal overlay click"),i.click()}}}),{passive:!0});t.default=s.default;window.ModalMenu=s.default,Object(r.extend)(s.default,{open:b,close:S})},wcVR:function(e,t,n){"use strict";n.r(t);var i={_def_opts:{enableHighAccuracy:!0,maximumAge:3e5,timeout:6e4},_provider:null,initW3C:function(){i._provider=navigator.geolocation,i.getCurrentPosition=function(e,t,n){i._provider.getCurrentPosition((function(t){void 0!==t.latitude?e(extend(t,{coords:extend(t.coords||{},{latitude:t.latitude,longitude:t.longitude})})):e(t)}),t,n)}},initGears:function(){var e=window.google;i._provider=e.gears.factory.create("beta.geolocation")},initSymbian:function(){var e=window.device;i._provider=e.getServiceObject("Service.Location","ILocation"),i.getCurrentPosition=function(e,t){i._provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},(function(n,i,a){4==i?t({code:2,message:"Position unavailable"}):e({timestamp:null,coords:{latitude:a.ReturnValue.Latitude,longitude:a.ReturnValue.Longitude,altitude:a.ReturnValue.Altitude,heading:a.ReturnValue.Heading}})}))}},initPalm:function(){i.getCurrentPosition=function(e,t,n){var i={};n&&(n.enableHighAccuracy&&1==n.enableHighAccuracy&&(i.accuracy=1),n.maximumAge&&(i.maximumAge=n.maximumAge),n.responseTime&&(n.responseTime<5?i.responseTime=1:n.responseTime<20?i.responseTime=2:i.timeout=3)),new window.Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:i,onSuccess:function(t){e({timestamp:t.timestamp,coords:{latitude:t.latitude,longitude:t.longitude,heading:t.heading}})},onFailure:function(e){1==e.errorCode?t({code:3,message:"Timeout"}):2==e.errorCode?t({code:2,message:"Position unavailable"}):t({code:0,message:"Unknown Error: webOS-code"+e.errorCode})}})}},getCurrentPosition:function(e,t,n){i._provider.getCurrentPosition(e,t,extend(i._def_opts,n||{}))},init:function(){var e=window,t=e.google,n=e.device,a=e.Mojo;try{var o="undefined";if(typeof navigator.geolocation!==o)i.initW3C();else if(typeof window.google!==o&&typeof t.gears!==o)i.initGears();else if(typeof n!==o&&typeof n.getServiceObject!==o)i.initSymbian();else{if(typeof a===o||"Mojo.Service.Request"==typeof a.Service.Request)return!1;i.initPalm()}}catch(e){return!1}return!0}};window.geo=i,t.default=i},wyHI:function(e,t){var n=window,i=n.gpeByClass,a=n.hasClass,o=n.addClass,r=n.removeClass,s=n.geByClass1,l=n.setStyle,c=n.tooltip,u=n.ajax;window.Fave={showActionsTT:function(e,t){cancelEvent(t);var n=i("FaveArticles__row",e);if(a(n,"wi_actions_opened"))Fave.hideActionsTT();else{var r=s("wi_actions_wrap",n),u=s("FaveArticles__row_actions",n);l(r,"top",e.offsetTop+e.offsetHeight+"px"),o(n,"wi_actions_opened"),c.addHandler(Fave.hideActionsTT),c.show(r,u)}},hideActionsTT:function(){r("wi_actions_opened",s("wi_actions_opened")),c.hide()},removeArticle:function(e,t,n){Fave.hideActionsTT();var a=i("FaveArticles__row",e);o(a,"removed"),u.post("fave.php",{act:"defave_article",link:t,hash:n},{onFail:function(){return r(a,"removed")}})},restoreArticle:function(e,t,n){var a=i("FaveArticles__row",e);r(a,"removed"),u.post("fave.php",{act:"enfave_article",link:t,hash:n},{onFail:function(){return o(a,"removed")}})}}},xk4V:function(e,t,n){var i=n("4fRq"),a=n("I2ZF");e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[o+s]=r[s];return t||a(r)}},yVza:function(e,t){window.FaceRecognitionSwitch={onChange:function(e,t){ajax.post(e,{checked:t.checked,_ajax:1})}}},yuVR:function(e,t){var n="friendsStat.events",i=null;function a(){clearTimeout(i);var e=lsGet(n)||[];if(e.length){lsSet(n);var t,a={act:"stats"};a=extend(a,(t={},each(e,(function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]})),t)),ajax.post("/friends",a)}}window.FriendsStats={log:function(e,t){var o=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(e,t);if(!o)return;var r=lsGet(n)||[];r.push({type:e,data:o}),lsSet(n,r),clearTimeout(i),i=setTimeout(a,1e4)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},i=setTimeout(a,1e4)},z1UI:function(e,t,n){"use strict";n.r(t);var i=n("k+Df");t.default=i.default},z9Td:function(e,t,n){"use strict";n.r(t),n.d(t,"PLATFORM_MVK",(function(){return i}));var i="mvk"},z9sQ:function(e,t,n){"use strict";n.r(t);n("OcsD");var i={class:function(e,t,n){void 0===t&&(t={});void 0===n&&(n="_");var i=[e];return Object.keys(t).forEach((function(o){if(a(o)){var r=t[o];!0===r?i.push(""+e+n+o):a(r)&&i.push(""+e+n+o+n+r)}})),i.join(" ")},setMod:function(e,t,n){var i,o=new RegExp("\\s*"+t+"(_[-a-zA-Z]+)?");i=!0===n?" "+t:a(n)?" "+t+"_"+n:"";o.test(e.className)?e.className=e.className.replace(o,i):e.className+=i}};function a(e){return"number"==typeof e||"string"==typeof e&&e}t.default=i;window.Bem=i},zHNa:function(e,t){var n=need("Control"),i=need("Popup"),a={init:function(){var e=geByClass1("_adultConfirm"),t=geByClass1("_adultConfirm__submit",e),i=geByClass1("adultConfirm__checkbox",e);toggleClass("adultConfirm__submit_disabled",t,!n.isChecked(i))},toggle:function(e){var t=gpeByClass("_adultConfirm",e.$control),n=geByClass1("_adultConfirm__submit",t);toggleClass("adultConfirm__submit_disabled",n,!e.checked)},submit:function(e,t){if(cancelEvent(e),!hasClass("adultConfirm__submit_disabled",t)){var n=gpeByClass("_adultConfirm",t),a=geByClass1("_adultConfirm__form",n),o={_ajax:1};each(geByTag("input",a),(function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(o[i]=t.value)}));var r=attr(a,"action");ajax.post(r,o),i.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}};window.AdultConfirm=a},zRDV:function(e,t){var n="";window.DonutDuration={init:function(e){n=e.select_url||""},selectDuration:function(e){var t=document.querySelector("#value_link");if(t){var i=n.replace("{value}",e);t.setAttribute("href",i)}}}},zouF:function(e,t,n){"use strict";n.r(t),n.d(t,"Confirm",(function(){return s}));var i=n("OcsD"),a=n("TYsd"),o=n("Po+v"),r=n("29dZ");function s(e,t,n,s){void 0===s&&(s={});var l=Object(i.ceFromString)(a.default.html(Object(o.default)({id:s.id,class:"Confirm",scrollable:!0,header:{title:s.title||getLang("mobile_warning_header")},on_overlay_click_native:n,content:[e,{class:"Popup__buttons",inner:[Object(r.default)({onClick:t,use_native_onclick:!0,class:"Popup__button",theme:s.theme_accept_btn||"regular",url:s.yes_href,inner:a.default.wrap(s.yes_label||getLang("mobile_continue"))}),Object(r.default)({onClick:n||"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:s.theme_close_btn||"secondary",url:s.no_href,inner:a.default.wrap(s.no_label||getLang("mobile_cancel"))})]}]})));o.default.open(l,!0)}window.page&&page.onChange((function(){$$(".Confirm").forEach((function(e){return o.default.close(e)}))})),window.Confirm=s},zvhO:function(e,t,n){"use strict";function i(e){return"number"==typeof e&&!isNaN(e)}n.r(t),n.d(t,"isNumber",(function(){return i}))}},[[9,"runtime","vendors","b-a8f7cf0af671e2a555da7b25524b9a42","b-35216c87a51105ca4c1dd702437ad9c1","b-2367543f76e467ff06e88e6568dd4311"]]]);